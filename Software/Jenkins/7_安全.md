# Securing Jenkins 保护 Jenkins

Chapter Sub-Sections 章节小节

- [ Access Control  存取控制](https://www.jenkins.io/doc/book/security/access-control)
- [ Securing Jenkins  保护 Jenkins](https://www.jenkins.io/doc/book/security/securing-jenkins)
- [ Managing Security  管理安全性](https://www.jenkins.io/doc/book/security/managing-security)
- [ Controller Isolation  控制器隔离](https://www.jenkins.io/doc/book/security/controller-isolation)
- [ Securing Builds  保护构建](https://www.jenkins.io/doc/book/security/securing-builds)
- [ CSRF Protection  CSRF 保护](https://www.jenkins.io/doc/book/security/csrf-protection)
- [ Rendering User Content  渲染用户内容](https://www.jenkins.io/doc/book/security/user-content)
- [ Access Control for Builds 
  构建的访问控制](https://www.jenkins.io/doc/book/security/build-authorization)
- [ Handling Environment Variables 
  处理环境变量](https://www.jenkins.io/doc/book/security/environment-variables)
- [ Markup Formatters  标记格式化程序](https://www.jenkins.io/doc/book/security/markup-formatter)
- [ Exposed Services and Ports 
  暴露的服务和端口](https://www.jenkins.io/doc/book/security/services)
- [ Credentials  凭据](https://www.jenkins.io/doc/book/security/credentials)

Jenkins is used everywhere from workstations on corporate intranets, to  high-powered servers connected to the public internet. To safely support this wide spread of security and threat profiles,  Jenkins offers many configuration options for enabling, customizing, or  disabling various security features.
Jenkins 无处不在，从企业内部网的工作站到连接到公共互联网的高性能服务器。为了安全地支持如此广泛的安全和威胁配置文件，Jenkins 提供了许多配置选项，用于启用、自定义或禁用各种安全功能。

Many of the security options are enabled by default when passing the  interactive setup wizard to ensure that Jenkins is secure. Others involve environment-specific setup and trade-offs and depend on  specific use cases supported in individual Jenkins instances.
在传递交互式设置向导时，默认情况下会启用许多安全选项，以确保 Jenkins 是安全的。其他选项涉及特定于环境的设置和权衡，并取决于单个 Jenkins 实例中支持的特定使用案例。

This chapter will introduce the various security options available to  Jenkins administrators and users, explaining the protections offered,  and trade-offs to disabling some of them.
本章将介绍 Jenkins 管理员和用户可用的各种安全选项，解释所提供的保护，以及禁用其中一些保护的权衡。

## Basic Setup 基本设置

- [Controller Isolation 控制器隔离](https://www.jenkins.io/doc/book/security/controller-isolation)

  Builds should not be executed on the built-in node, but that is just the beginning: This section discusses what other steps can be taken to protect the controller from being impacted by running builds. 构建不应该在内置节点上执行，但这只是开始： 本节讨论可以采取哪些其他步骤来保护控制器免受正在运行的构建的影响。  **This needs to be configured according to the needs of your environment. 这需要根据您的环境需求进行配置。**

- [Access Control 存取控制](https://www.jenkins.io/doc/book/security/access-control)

  By default, Jenkins does not allow anonymous access, and a single admin user exists. This chapter discusses which level of access is provided by permissions and how to safely grant access to more users. 默认情况下，Jenkins 不允许匿名访问，并且存在单个管理员用户。 本章讨论权限提供哪个级别的访问权限以及如何安全地向更多用户授予访问权限。  *This is set up securely by the setup wizard. If the setup wizard is disabled on first launch, this may not be configured securely by default. 这是由设置向导安全地设置的。如果在首次启动时禁用了设置向导，则默认情况下可能无法安全地配置此设置。*

## Build Behavior 构建行为

- [Access Control for Builds 构建的访问控制](https://www.jenkins.io/doc/book/security/build-authorization)

  Learn how to restrict what individual builds can do in Jenkins once they’re running. 了解如何限制单个构建在运行后可以在 Jenkins 中执行的操作。  **This needs to be configured according to the needs of your environment. 这需要根据您的环境需求进行配置。**

- [Securing Builds 保护构建](https://www.jenkins.io/doc/book/security/securing-builds)

  Learn about how builds can interfere with each other and your infrastructure, and what to do about it. 了解构建如何相互干扰以及您的基础设施如何干扰，以及如何应对。  **This needs to be configured according to the needs of your environment. 这需要根据您的环境需求进行配置。**

- [Handling Environment Variables 处理环境变量](https://www.jenkins.io/doc/book/security/environment-variables)

  Improperly written build scripts may be tricked into behaving differently than  intended due to special environment variable names or values being  injected as build parameters. This section discusses how to protect your builds. 由于作为构建参数注入了特殊的环境变量名称或值，因此编写不当的构建脚本可能会被欺骗，使其行为与预期不同。 本节讨论如何保护您的构建。  **This needs to be configured according to the needs of your environment. 这需要根据您的环境需求进行配置。**

## User Interface 用户界面

- [CSRF Protection CSRF 保护](https://www.jenkins.io/doc/book/security/csrf-protection)

  Jenkins protects from cross-site request forgery (CSRF) by default. This chapter explains how to work around any problems this may cause. 默认情况下，Jenkins 可以防止跨站点请求伪造 （CSRF）。 本章介绍如何解决可能导致的任何问题。  *This is set up securely by default. 默认情况下，这是安全的设置。*

- [Markup Formatter 标记格式化程序](https://www.jenkins.io/doc/book/security/markup-formatter)

  The default markup formatter renders text as entered (i.e. escaping HTML metacharacters). This chapter explains how to switch to a different markup formatter and explains what admins need to be aware of. 默认标记格式化程序将文本呈现为输入的文本（即转义 HTML 元字符）。 本章介绍了如何切换到不同的标记格式化程序，并说明了管理员需要注意的事项。  *This is set up securely by default. 默认情况下，这是安全的设置。*

- [Rendering User Content 渲染用户内容](https://www.jenkins.io/doc/book/security/user-content)

  By default, Jenkins strictly limits the features useable in user content  (files from workspaces, archived artifacts, etc.) it serves. This chapter discusses how to customize this and make HTML reports and  similar content both functional and safe to view. 默认情况下，Jenkins 严格限制它所服务的用户内容（来自工作区的文件、存档工件等）中可用的功能。 本章讨论如何自定义此内容，并使 HTML 报告和类似内容既实用又可安全查看。  *This is set up securely by default. 默认情况下，这是安全的设置。*



# Access Control 存取控制

Table of Contents 目录

- [Common Configuration Mistakes
  常见配置错误](https://www.jenkins.io/doc/book/security/access-control/#common-configuration-mistakes)
- [Permissions 权限](https://www.jenkins.io/doc/book/security/access-control/#permissions)
- [Disabling Access Control 禁用访问控制](https://www.jenkins.io/doc/book/security/access-control/#disabling-access-control)

Jenkins access control is split into two parts:
Jenkins 访问控制分为两部分：

- Authentication (users prove who they are) is done using a *security realm*. The security realm determines user identity and group memberships.
  身份验证 （用户证明他们是谁） 是使用*安全域*完成的。安全域确定用户身份和组成员身份。
- Authorization (users are permitted to do something) is done by an *authorization strategy*. This controls whether a user (directly or through group memberships) has a permission.
  授权 （允许用户执行某项操作） 由*授权策略*完成。这控制用户 （直接或通过组成员身份） 是否具有权限。

These can be independent, or work in combination. An independent configuration would be [Active Directory](https://plugins.jenkins.io/active-directory) or [LDAP](https://plugins.jenkins.io/ldap) as security realm, and something like [Matrix Authorization Strategy](https://plugins.jenkins.io/matrix-auth) as authorization strategy. An example for related security realm and authorization strategy configuration is [GitHub Authentication](https://plugins.jenkins.io/github-oauth): While its security realm can be used with a generic authorization  strategy, it also provides an authorization strategy that looks up a  user’s repository permissions on GitHub, and grants or denies  permissions to related jobs in Jenkins based on that.
这些可以是独立的，也可以是组合工作的。一个独立的配置是 [Active Directory](https://plugins.jenkins.io/active-directory) 或 [LDAP](https://plugins.jenkins.io/ldap) 作为安全领域，以及 [Matrix Authorization Strategy](https://plugins.jenkins.io/matrix-auth) 之类的授权策略。相关安全域和授权策略配置的一个示例是 [GitHub Authentication](https://plugins.jenkins.io/github-oauth)：虽然其安全域可以与通用授权策略一起使用，但它也提供了一种授权策略，用于查找用户在 GitHub 上的存储库权限，并基于此授予或拒绝对 Jenkins 中相关作业的权限。

|      | Jenkins could be set up to have basic access control happen outside of it. Some examples: Jenkins 可以设置为在它之外进行基本访问控制。一些例子：   The built-in [Winstone/Jetty servlet container wrapper](https://github.com/jenkinsci/winstone) provides options that implement a basic security realm outside Jenkins. 内置的 [Winstone/Jetty servlet 容器包装](https://github.com/jenkinsci/winstone)器提供了在 Jenkins 之外实现基本安全域的选项。  If Jenkins is running behind a reverse proxy like Nginx or Apache, those can limit access to Jenkins. 如果 Jenkins 在 Nginx 或 Apache 等反向代理后面运行，则这些可能会限制对 Jenkins 的访问。   An advantage of these approaches is that they do not allow any access to  Jenkins unless a user is authorized, reducing the impact of security  issues in Jenkins or plugins especially when accessible from the  internet. A disadvantage is the lack of integration with Jenkins access controls  and potentially even interfering with it (e.g. when trying to  authenticate scripted clients). 这些方法的一个优点是，除非用户获得授权，否则它们不允许对 Jenkins 进行任何访问，从而减少了 Jenkins 或插件中安全问题的影响，尤其是在从 Internet 访问时。缺点是缺乏与  Jenkins 访问控制的集成，甚至可能干扰它（例如，在尝试验证脚本客户端时）。 |
| ---- | ------------------------------------------------------------ |
|      |                                                              |

## Common Configuration Mistakes 常见配置错误

When configuring authentication and authorization in Jenkins, it is easy to accidentally allow far more access than intended. See [the documentation on the access given to administrators](https://www.jenkins.io/doc/book/security/access-control/permissions/#administer) about the impact of unintentionally granting Administer permission.
在 Jenkins 中配置身份验证和授权时，很容易意外地允许比预期多得多的访问。请参阅[有关授予管理员的访问权限的文档](https://www.jenkins.io/doc/book/security/access-control/permissions/#administer)，了解无意中授予 Administer 权限的影响。

- Anyone can do anything 任何人都可以做任何事情

  The **anyone can do anything** authorization strategy is very rarely a good choice, as it allows even anonymous users to administer Jenkins. As a rule of thumb, it should not be used. Never rely on the Jenkins URL to not be known outside your team or organization alone for security. **任何人都可以做任何事情**授权策略很少是一个好的选择，因为它甚至允许匿名用户管理 Jenkins。根据经验，不应使用它。为了安全起见，切勿依赖 Jenkins URL 在您的团队或组织之外不为人知。

- Logged-in users can do anything 已登录用户可以执行任何操作

  Using the **logged-in users can do anything** authorization strategy can be a sensible choice as long as only fully trusted users have accounts to access Jenkins. This is the default with Jenkins’s single admin user when setting up Jenkins with the setup wizard. 使用**已登录的用户可以执行任何操作，**只要只有完全受信任的用户才有帐户访问 Jenkins，授权策略可能是一个明智的选择。这是使用设置向导设置 Jenkins 时 Jenkins 的单个管理员用户的默认设置。 Switching to an authentication realm that allows untrusted users to have an  account later will result in those users getting administrative access  to Jenkins if you keep this authorization strategy. Examples include enabling account signup for *Jenkins' own user database*, or various other authorization realms, many of which (GitHub, Google, GitLab, etc.) allow anyone to sign up for an account. 如果您保留此授权策略，切换到允许不受信任的用户稍后拥有帐户的身份验证领域将导致这些用户获得对 Jenkins 的管理访问权限。示例包括为 *Jenkins 自己的用户数据库*或各种其他授权领域启用帐户注册，其中许多授权领域（GitHub、Google、GitLab 等）允许任何人注册帐户。

- Anonymous and authenticated users 匿名用户和经过身份验证的用户

  Similar to the previous items, you should generally not grant significant permissions to `anonymous` (the anonymous user) or authenticated (any authenticated user) when  using an authorization strategy that allows finer-grained control (like [Matrix Authorization Strategy](https://plugins.jenkins.io/matrix-auth)). Granting Overall/Administer permission to *anonymous* is similar to *Anyone can do anything*, while granting that permission to *authenticated* is essentially the same as *Logged-in users can do anything*. 与前面的项目类似，在使用允许更精细控制的授权策略（如 [Matrix 授权策略](https://plugins.jenkins.io/matrix-auth)）时，通常不应向`匿名` （匿名用户） 或经过身份验证 （任何经过身份验证的用户） 授予重要权限。向匿名授予 Overall/Administer *权限类似于* *Anyone can do anything*，而向 *authenticated* 授予该权限本质上与 *Logged-in users can do anything* 相同。

- Built-in node 内置节点

  Users with limited permissions [must not be able to configure jobs that run on the built-in node](https://www.jenkins.io/doc/book/security/controller-isolation/). When setting up a new Jenkins instance, adding users and switching  authorization strategies, it is important to also set up distributed  builds and limit what jobs are able to run on the built-in node. 具有有限权限的用户[必须无法配置在内置节点上运行的作业](https://www.jenkins.io/doc/book/security/controller-isolation/)。在设置新的 Jenkins 实例、添加用户和切换授权策略时，还必须设置分布式构建并限制能够在内置节点上运行的作业。

## Permissions 权限

At a very basic level, the *Overall/Read* permission provides users some basic access to Jenkins. This permission is a prerequisite for more substantial access to Jenkins. Without this permission, only very few features explicitly intended to be used without authentication are available.
在非常基本的层面上，*Overall/Read* 权限为用户提供了对 Jenkins 的一些基本访问权限。此权限是对 Jenkins 进行更实质性访问的先决条件。如果没有此权限，则只有极少数明确打算在不进行身份验证的情况下使用的功能可用。

The highest level of permissions is *Overall/Administer*. With this permission, users can upload and install plugins and have access to the [Script Console](https://www.jenkins.io/doc/book/managing/script-console/).
最高级别的权限是 *Overall/Administer*。拥有此权限，用户可以上传和安装插件，并有权访问 [Script Console](https://www.jenkins.io/doc/book/managing/script-console/)。

Between these two extremes is finer-grained permission control involving other permissions. Permissions in Jenkins have a *scope*: They can be granted globally, on an item (like a folder or job), on a  build, etc. Whenever a user attempts to do something that is protected by  permissions, the authorization strategy is checked for whether the  current user has the specific permission (e.g., *Job/Read*) on the specific object (e.g., a job). Exactly how permissions are assigned and whether and how they’re inherited is controlled by the specific authorization strategy.
在这两个极端之间是涉及其他权限的更精细的权限控制。Jenkins 中的权限有一个*范围*：它们可以全局授予，也可以授予项目（如文件夹或作业）、构建等。每当用户尝试执行受权限保护的操作时，都会检查授权策略，以确定当前用户是否对特定对象（例如，作业）具有特定权限（例如，*作业/读取*）。权限的确切分配方式以及是否继承权限以及如何继承权限由特定的授权策略控制。

As an example, [Matrix Authorization Strategy](https://plugins.jenkins.io/matrix-auth) provides two different authorization strategies:
例如，[矩阵授权策略](https://plugins.jenkins.io/matrix-auth)提供两种不同的授权策略：

- One provides a single global configuration of all permissions. A user granted *Item/Read* will be granted that permission everywhere.
  一个提供所有权限的单个全局配置。被授予 *Item/Read* 的用户将在所有位置被授予该权限。
- One provides a project-based configuration. In this model, permissions can be granted globally (as in the previous strategy), or only on specific folders, jobs, or agents. Permissions are by default inherited, but that can be customized as well, so that users granted *Item/Read* globally or on a parent folder may be excluded from access to a job.
  一个提供基于项目的配置。在此模型中，可以全局授予权限（如上一个策略），也可以仅对特定文件夹、作业或代理授予权限。默认情况下，权限是继承的，但也可以自定义，因此可以排除全局或父文件夹上被授予 *Item/Read* 的用户对作业的访问权限。

For more details about the various permissions in Jenkins and the level of access they grant, see [Permissions](https://www.jenkins.io/doc/book/security/access-control/permissions/).
有关 Jenkins 中的各种权限及其授予的访问级别的更多详细信息，请参阅[权限](https://www.jenkins.io/doc/book/security/access-control/permissions/)。

## Disabling Access Control 禁用访问控制

See [Disable Access Control](https://www.jenkins.io/doc/book/security/access-control/disable/).
请参阅[禁用访问控制](https://www.jenkins.io/doc/book/security/access-control/disable/)。

# Securing Jenkins 保护 Jenkins

|      | This section is a work in progress. Want to help? Check out the [jenkinsci/docs gitter channel](https://app.gitter.im/#/room/#jenkins/docs:matrix.org). For other ways to contribute to the Jenkins project, see [this page about participating and contributing](https://www.jenkins.io/participate). 此部分正在进行中。想要提供帮助？查看 [jenkinsci/docs gitter 频道](https://app.gitter.im/#/room/#jenkins/docs:matrix.org)。有关为 Jenkins 项目做出贡献的其他方式，请参阅[此页关于参与和贡献](https://www.jenkins.io/participate)。 |
| ---- | ------------------------------------------------------------ |
|      |                                                              |

Table of Contents 目录

- [Access Control 存取控制](https://www.jenkins.io/doc/book/security/securing-jenkins/#access-control)

Securing Jenkins has two aspects to it.
保护 Jenkins 有两个方面。

- Access control, which ensures users are authenticated when accessing Jenkins and their activities are authorized.
  访问控制，确保用户在访问 Jenkins 时经过身份验证，并且他们的活动得到授权。
- Protecting Jenkins against external threats
  保护 Jenkins 免受外部威胁

## Access Control 存取控制

You should lock down the access to Jenkins UI so that users are authenticated and appropriate set of permissions are given to them. This setting is controlled mainly by two axes:
您应该锁定对 Jenkins UI 的访问，以便对用户进行身份验证并为其授予适当的权限集。此设置主要由两个轴控制：

- **Security Realm**, which determines users and their passwords, as well as what groups the users belong to.
  **安全领域**，用于确定用户及其密码，以及用户所属的组。
- **Authorization Strategy**, which determines who has access to what.
  **授权策略**，用于确定谁有权访问哪些内容。

These two axes are orthogonal, and need to be individually configured. For example, you might choose to use external LDAP or Active Directory as the security realm, and you might choose "everyone full access once logged in" mode for authorization strategy. Or you might choose to let Jenkins run its own user database, and perform access control based on the permission/user matrix.
这两个轴是正交的，需要单独配置。例如，您可以选择使用外部 LDAP 或 Active Directory 作为安全域，并且可以为授权策略选择“everyone full access once  logged in”模式。或者，您可以选择让 Jenkins 运行自己的用户数据库，并根据权限/用户矩阵执行访问控制。

- [Quick and Simple Security](https://wiki.jenkins.io/display/JENKINS/Quick+and+Simple+Security) --- if you are running Jenkins like `java -jar jenkins.war` and only need a very simple setup
  如果您运行的是 Jenkins，例如 `java -jar jenkins.war`，并且只需要一个非常简单的设置，那么[快速简单的安全性](https://wiki.jenkins.io/display/JENKINS/Quick+and+Simple+Security)---
- [Standard Security Setup](https://wiki.jenkins.io/display/JENKINS/Standard+Security+Setup) --- discusses the most common setup of letting Jenkins run its own user database and do finer-grained access control
  [标准安全设置](https://wiki.jenkins.io/display/JENKINS/Standard+Security+Setup) --- 讨论了让 Jenkins 运行自己的用户数据库并进行更精细的访问控制的最常见设置
- [Apache frontend for security](https://wiki.jenkins.io/display/JENKINS/Apache+frontend+for+security) --- run Jenkins behind Apache and perform access control in Apache instead of Jenkins
  [用于安全性的 Apache 前端](https://wiki.jenkins.io/display/JENKINS/Apache+frontend+for+security)---在 Apache 后面运行 Jenkins，并在 Apache 而不是 Jenkins 中执行访问控制
- [Authenticating scripted clients](https://wiki.jenkins.io/display/JENKINS/Authenticating+scripted+clients) --- if you need to programmatically access security-enabled Jenkins web UI, use BASIC auth
  [验证脚本客户端](https://wiki.jenkins.io/display/JENKINS/Authenticating+scripted+clients) ---如果您需要以编程方式访问启用安全性的 Jenkins Web UI，请使用 BASIC 身份验证
- [Matrix-based security|Matrix-based security](https://wiki.jenkins.io/display/JENKINS/Matrix-based+security) --- Granting and denying finer-grained permissions
  [基于矩阵的安全性 |基于矩阵的安全性](https://wiki.jenkins.io/display/JENKINS/Matrix-based+security) --- 授予和拒绝更精细的权限

In addition to access control of users, [access control for builds](https://www.jenkins.io/doc/book/security/build-authorization) limits what builds can do, once started.
除了对用户的访问控制之外，[构建的访问控制](https://www.jenkins.io/doc/book/security/build-authorization)还会限制构建在启动后可以执行的操作。

# Managing Security 管理安全性

Table of Contents 目录

- Enabling Security 启用安全性
  - [TCP Port TCP 端口](https://www.jenkins.io/doc/book/security/managing-security/#tcp-port)
  - [Access Control 存取控制](https://www.jenkins.io/doc/book/security/managing-security/#access-control)
  - [Markup Formatter 标记格式化程序](https://www.jenkins.io/doc/book/security/managing-security/#markup-formatter)
- [CSRF Protection CSRF 保护](https://www.jenkins.io/doc/book/security/managing-security/#csrf-protection)
- [Agent/Master Access Control
  代理/主访问控制](https://www.jenkins.io/doc/book/security/managing-security/#agentmaster-access-control)

Jenkins is used everywhere from workstations on corporate intranets, to high-powered servers connected to the public internet. To safely support this wide spread of security and threat profiles, Jenkins offers many configuration options for enabling, editing, or disabling various security features.
Jenkins 无处不在，从企业内部网的工作站到连接到公共互联网的高性能服务器。为了安全地支持如此广泛的安全和威胁配置文件，Jenkins 提供了许多配置选项，用于启用、编辑或禁用各种安全功能。

As of Jenkins 2.0, many of the security options were enabled by default to ensure that Jenkins environments remained secure unless an administrator explicitly disabled certain protections.
从 Jenkins 2.0 开始，许多安全选项默认启用，以确保 Jenkins 环境保持安全，除非管理员明确禁用某些保护。

This section will introduce the various security options available to a Jenkins administrator, explaining the protections offered, and trade-offs to disabling some of them.
本节将介绍 Jenkins 管理员可用的各种安全选项，解释提供的保护措施，以及禁用其中一些保护措施的权衡。

## Enabling Security 启用安全性

Beginning with Jenkins 2.214 and Jenkins LTS 2.222.1, the "Enable Security" checkbox has been removed. Jenkins own user database is used as the default security realm.
从 Jenkins 2.214 和 Jenkins LTS 2.222.1 开始，“Enable Security”（启用安全性）复选框已被删除。Jenkins 自己的用户数据库用作默认安全域。

In versions before Jenkins 2.214 and Jenkins LTS 2.222.1, when the **Enable Security** checkbox is checked, users can log in with a username and password in order to perform operations not available to anonymous users. Which operations require users to log in depends on the chosen authorization strategy and its configuration; by default anonymous users have no permissions, and logged in users have full control. The "Enable Security" checkbox should **always** be enabled for any non-local (test) Jenkins environment.
在 Jenkins 2.214 和 Jenkins LTS 2.222.1 之前的版本中，当选中 **Enable Security** 复选框时，用户可以使用用户名和密码登录，以执行匿名用户无法使用的操作。哪些操作需要用户登录取决于所选的授权策略及其配置;默认情况下，匿名用户没有权限，而已登录的用户具有完全控制权。对于任何非本地（测试）Jenkins 环境，应**始终**启用“启用安全性”复选框。

The "Security" section of the web UI allows a Jenkins administrator to enable, configure, or disable key security features which apply to the entire Jenkins environment.
Web UI 的“安全”部分允许 Jenkins 管理员启用、配置或禁用适用于整个 Jenkins 环境的关键安全功能。

![Security](https://www.jenkins.io/doc/book/resources/security/configure-global-security.png)

### TCP Port TCP 端口

Jenkins can use a TCP port to communicate with inbound (formerly known as “JNLP”) agents, such as Windows-based agents. As of Jenkins 2.0, by default this port is disabled.
Jenkins 可以使用 TCP 端口与入站（以前称为“JNLP”）代理（例如基于 Windows 的代理）进行通信。从 Jenkins 2.0 开始，默认情况下，此端口处于禁用状态。

For administrators wishing to use inbound TCP agents, the two port options are:
对于希望使用入站 TCP 代理的管理员，有两个端口选项：

1. **Random**: The TCP port is chosen at random to avoid collisions on the Jenkins [controller](https://www.jenkins.io/doc/book/glossary/#controller). The downside to randomized ports is that they are chosen during the boot of the Jenkins controller, making it difficult to manage firewall rules allowing TCP traffic.
   **Random**：随机选择 TCP 端口，以避免在 Jenkins [控制器](https://www.jenkins.io/doc/book/glossary/#controller)上发生冲突。随机端口的缺点是它们是在 Jenkins 控制器启动期间选择的，因此很难管理允许 TCP 流量的防火墙规则。
2. **Fixed**: The port is chosen by the Jenkins administrator and is consistent across reboots of the Jenkins controller. This makes it easier to manage firewall rules allowing TCP-based agents to connect to the controller.
   **已修复**：该端口由 Jenkins 管理员选择，并且在 Jenkins 控制器重启后保持一致。这使得管理允许基于 TCP 的代理连接到控制器的防火墙规则变得更加容易。

As of Jenkins 2.217, inbound agents may instead be configured to use WebSocket transport to connect to Jenkins. In this case no extra TCP port need be enabled and no special security configuration is needed.
从 Jenkins 2.217 开始，入站代理可以配置为使用 WebSocket 传输连接到 Jenkins。在这种情况下，不需要启用额外的 TCP 端口，也不需要特殊的安全配置。

### Access Control 存取控制

Access Control is the primary mechanism for securing a Jenkins environment against unauthorized usage. Two facets of configuration are necessary for configuring Access Control in Jenkins:
访问控制是保护 Jenkins 环境免受未经授权使用的主要机制。在 Jenkins 中配置访问控制需要两个方面的配置：

1. A **Security Realm** which informs the Jenkins environment how and where to pull user (or identity) information from. Also commonly known as "authentication."
   **一个安全域**，它通知 Jenkins 环境如何以及从何处提取用户（或身份）信息。通常也称为 “authentication”。
2. **Authorization** configuration which informs the Jenkins environment as to which users and/or groups can access which aspects of Jenkins, and to what extent.
   **授权**配置，通知 Jenkins 环境哪些用户和/或组可以访问 Jenkins 的哪些方面，以及访问到什么程度。

Using both the Security Realm and Authorization configurations it is possible to configure very relaxed or very rigid authentication and authorization schemes in Jenkins.
使用 Security Realm 和 Authorization 配置，可以在 Jenkins 中配置非常宽松或非常严格的身份验证和授权方案。

Additionally, some plugins such as the [Role-based Authorization Strategy](https://plugins.jenkins.io/role-strategy) plugin can extend the Access Control capabilities of Jenkins to support even more nuanced authentication and authorization schemes.
此外，一些插件（例如[基于角色的授权策略](https://plugins.jenkins.io/role-strategy)插件）可以扩展 Jenkins 的访问控制功能，以支持更细微的身份验证和授权方案。

#### Security Realm 安全领域

By default Jenkins includes support for a few different Security Realms:
默认情况下，Jenkins 包括对几种不同安全领域的支持：

- Delegate to servlet container 委托给 servlet 容器

  For delegating authentication a servlet container running the Jenkins controller, such as [Jetty](https://www.eclipse.org/jetty/). If using this option, please consult the servlet container’s authentication documentation. 为了委托运行 Jenkins 控制器的 servlet 容器（如 [Jetty](https://www.eclipse.org/jetty/)）进行身份验证。如果使用此选项，请查阅 servlet 容器的身份验证文档。

- Jenkins’ own user database Jenkins 自己的用户数据库

  Use Jenkins’s own built-in user data store for authentication instead of delegating to an external system. This is enabled by default with new Jenkins 2.0 or later installations and is suitable for smaller environments. 使用 Jenkins 自己的内置用户数据存储进行身份验证，而不是委托给外部系统。默认情况下，新的 Jenkins 2.0 或更高版本安装会启用此功能，适用于较小的环境。

- LDAP LDAP 协议

  Delegate all authentication to a configured LDAP server, including both users and groups. This option is more common for larger installations in organizations which already have configured an external identity provider such as LDAP. This also supports Active Directory installations. 将所有身份验证委托给已配置的 LDAP 服务器，包括用户和组。对于已配置外部身份提供程序（如 LDAP）的组织中的大型安装，此选项更为常见。这也支持 Active Directory 安装。

|      | This feature is provided by the [LDAP plugin](https://plugins.jenkins.io/ldap) that may not be installed on your instance. 此功能由 [LDAP 插件](https://plugins.jenkins.io/ldap)提供，该插件可能未安装在您的实例上。 |
| ---- | ------------------------------------------------------------ |
|      |                                                              |

- Unix user/group database Unix 用户/组数据库

  Delegates the authentication to the underlying Unix OS-level user database on the Jenkins controller. This mode will also allow re-use of Unix groups for authorization. For example, Jenkins can be configured such that "Everyone in the `developers` group has administrator access." To support this feature, Jenkins relies on [PAM](https://en.wikipedia.org/wiki/Pluggable_Authentication_Modules) which may need to be configured external to the Jenkins environment. 将身份验证委托给 Jenkins 控制器上的底层 Unix OS 级用户数据库。此模式还将允许重用 Unix 组进行授权。例如，可以将 Jenkins 配置为“`developers` 组中的每个人都具有管理员访问权限”。为了支持此功能，Jenkins 依赖于 [PAM](https://en.wikipedia.org/wiki/Pluggable_Authentication_Modules)，可能需要在 Jenkins 环境外部进行配置。

|      | Unix allows an user and a group to have the same name. In order to disambiguate, use the `@` prefix to force the name to be interpreted as a group. For example, `@dev` would mean the `dev` group and not the `dev` user. Unix 允许用户和组具有相同的名称。为了消除歧义，请使用 `@` 前缀强制将名称解释为一个组。例如，`@dev` 表示 `dev` 组，而不是 `dev` 用户。 |
| ---- | ------------------------------------------------------------ |
|      |                                                              |

------

Plugins can provide additional security realms which may be useful for incorporating Jenkins into existing identity systems, such as:
插件可以提供额外的安全域，这对于将 Jenkins 合并到现有身份系统可能很有用，例如：

- [Active Directory 活动目录](https://plugins.jenkins.io/active-directory)
- [GitHub Authentication GitHub 身份验证](https://plugins.jenkins.io/github-oauth)

#### Authorization 授权

The Security Realm, or authentication, indicates *who* can access the Jenkins environment. The other piece of the puzzle is **Authorization**, which indicates *what* they can access in the Jenkins environment. By default Jenkins supports a few different Authorization options:
安全领域或身份验证指示*谁*可以访问 Jenkins 环境。难题的另一部分是 **Authorization**，它表示他们可以在 Jenkins 环境中访问*的内容*。默认情况下，Jenkins 支持几种不同的 Authorization 选项：

- Anyone can do anything 任何人都可以做任何事情

  Everyone gets full control of Jenkins, including anonymous users who haven’t logged in. **Do not use this setting** for anything other than local test Jenkins controllers. 每个人都可以完全控制 Jenkins，包括尚未登录的匿名用户。**请勿将此设置用于**本地测试 Jenkins 控制器以外的任何内容。

- Legacy mode 旧版模式

  Behaves exactly the same as Jenkins <1.164. Namely, if a user has the "admin" role, they will be granted full control over the system, and otherwise (including anonymous users) will only have the read access. **Do not use this setting** for anything other than local test Jenkins controllers. 行为与 Jenkins <1.164 完全相同。也就是说，如果用户具有 “admin” 角色，他们将被授予对系统的完全控制权，否则（包括匿名用户）将只有读取访问权限。**请勿将此设置用于**本地测试 Jenkins 控制器以外的任何内容。

- Logged in users can do anything 已登录的用户可以执行任何操作

  In this mode, every logged-in user gets full control of Jenkins. Depending on an advanced option, anonymous users get read access to Jenkins, or no access at all. This mode is useful to force users to log in before taking actions, so that there is an audit trail of users' actions. 在此模式下，每个登录用户都可以获得对 Jenkins 的完全控制权。根据高级选项，匿名用户将获得对 Jenkins 的读取访问权限，或者根本没有访问权限。此模式可用于强制用户在执行操作之前登录，以便对用户的操作进行审计跟踪。

- Matrix-based security 基于矩阵的安全性

  This authorization scheme allows for granular control over which users and groups are able to perform which actions in the Jenkins environment (see the screenshot below). 此授权方案允许精细控制哪些用户和组能够在 Jenkins 环境中执行哪些操作（请参阅下面的屏幕截图）。

- Project-based Matrix Authorization Strategy 基于项目的矩阵授权策略

  This authorization scheme is an extension to Matrix-based security which allows additional access control lists (ACLs) to be defined for **each project** separately in the Project configuration screen. This allows granting specific users or groups access only to specified projects, instead of all projects in the Jenkins environment. The ACLs defined with Project-based Matrix Authorization are additive such that access grants defined in the Security screen will be combined with project-specific ACLs. 此授权方案是基于矩阵的安全性的扩展，它允许在 Project configuration 屏幕中为每个**项目**单独定义额外的访问控制列表 （ACL）。这允许仅授予特定用户或组对指定项目的访问权限，而不是 Jenkins 环境中的所有项目的访问权限。使用基于项目的矩阵授权定义的 ACL 是累加的，因此在“安全”屏幕中定义的访问授权将与特定于项目的 ACL 合并。

|      | Matrix-based security and Project-based Matrix Authorization Strategy are provided by the [Matrix Authorization Strategy Plugin](https://plugins.jenkins.io/matrix-auth) and may not be installed on your Jenkins. 基于矩阵的安全性和基于项目的矩阵授权策略由 [Matrix 授权策略插件](https://plugins.jenkins.io/matrix-auth)提供，可能无法安装在您的 Jenkins 上。 |
| ---- | ------------------------------------------------------------ |
|      |                                                              |

For most Jenkins environments, Matrix-based security provides the most security and flexibility so it is recommended as a starting point for "production" environments.
对于大多数 Jenkins 环境，基于 Matrix 的安全性提供了最大的安全性和灵活性，因此建议将其作为“生产”环境的起点。

![Security - Matrix authorization](https://www.jenkins.io/doc/book/resources/security/configure-global-security-matrix-authorization.png)

Figure 1. Matrix-based security
图 1.基于矩阵的安全性

The table shown above can get quite wide as each column represents a permission provided by Jenkins core or a plugin. Hovering the mouse over a permission will display more information about the permission.
上面显示的表格可能会很宽，因为每列都代表 Jenkins 核心或插件提供的权限。将鼠标悬停在权限上将显示有关该权限的更多信息。

Each row in the table represents a user or group (also known as a "role"). This includes special entries named "anonymous" and "authenticated." The "anonymous" entry represents permissions granted to all unauthenticated users accessing the Jenkins environment. Whereas "authenticated' can be used to grant permissions to all authenticated users accessing the environment.
表中的每一行都表示一个用户或组（也称为 “角色”） 。这包括名为 “anonymous” 和 “authenticated” 的特殊条目。“anonymous” 条目表示授予访问  Jenkins 环境的所有未经身份验证的用户的权限。而 “authenticated” 可用于向访问环境的所有经过身份验证的用户授予权限。

The permissions granted in the matrix are additive. For example, if a user "kohsuke" is in the groups "developers" and "administrators", then the permissions granted to "kohsuke" will be a union of all those permissions granted to "kohsuke", "developers", "administrators", "authenticated", and "anonymous."
矩阵中授予的权限是累加的。例如，如果用户 “kohsuke” 位于组 “developers” 和 “administrators” 中，则授予 “kohsuke” 的权限将是授予  “kohsuke”、“developers”、“administrators”、“authenticated” 和 “anonymous”  的所有权限的联合。

### Markup Formatter 标记格式化程序

See [Markup Formatter](https://www.jenkins.io/doc/book/security/markup-formatter/).
请参阅 [标记格式化程序](https://www.jenkins.io/doc/book/security/markup-formatter/)。

## CSRF Protection CSRF 保护

See [CSRF Protection](https://www.jenkins.io/doc/book/security/csrf-protection).
请参阅 [CSRF 保护](https://www.jenkins.io/doc/book/security/csrf-protection)。

## Agent/Master Access Control 代理/主访问控制

See [Isolating the Controller from Builds](https://www.jenkins.io/doc/book/security/controller-isolation).
请参阅[将控制器与 Build 隔离](https://www.jenkins.io/doc/book/security/controller-isolation)。

# Controller Isolation 控制器隔离

Table of Contents 目录

- [Not building on the built-in node
  不在内置节点上构建](https://www.jenkins.io/doc/book/security/controller-isolation/#not-building-on-the-built-in-node)
- [Agent → Controller Access Control
  Agent → Controller 访问控制](https://www.jenkins.io/doc/book/security/controller-isolation/#agent-controller-access-control)

What exactly happens during a build is often controlled by people less trusted than a Jenkins administrator:
构建过程中到底发生什么通常由比 Jenkins 管理员更不受信任的人控制：

- Jenkins users with Job/Configure permission
  具有 Job/Configure 权限的 Jenkins 用户
- Build script authors (`pom.xml`, `Makefile`, etc.)
  构建脚本作者（`pom.xml`、`Makefile` 等）
- Code authors (for example test code executed during a build)
  代码作者（例如，在构建期间执行的测试代码）

They all have some control over commands executed during a build.
它们都可以对构建期间执行的命令进行一些控制。

To ensure the stability of the Jenkins controller, builds should be executed on other nodes than the built-in node. This concept is called *distributed builds* in Jenkins, and you can learn more about this [here](https://www.jenkins.io/doc/book/scaling/architecting-for-scale/). Setting up distributed builds in Jenkins is a great start for protecting the Jenkins controller from malicious (or just broken) build scripts,  but care needs to be taken for protections to be effective.
为了确保 Jenkins 控制器的稳定性，应在内置节点以外的其他节点上执行构建。这个概念在 Jenkins 中称为*分布式构建*，您可以[在此处](https://www.jenkins.io/doc/book/scaling/architecting-for-scale/)了解更多信息。在 Jenkins 中设置分布式构建是保护 Jenkins 控制器免受恶意（或只是损坏的）构建脚本攻击的良好开端，但需要注意保护才能有效。

|      | Most Jenkins environments grow over time requiring their trust models to  evolve as the environment grows. Please consider scheduling regular  "check-ups" to review whether any disabled security settings should be  re-enabled. 大多数 Jenkins 环境会随着时间的推移而增长，这需要其信任模型随着环境的增长而发展。请考虑安排定期“检查”，以检查是否应重新启用任何已禁用的安全设置。 |
| ---- | ------------------------------------------------------------ |
|      |                                                              |

## Not building on the built-in node 不在内置节点上构建

Out of the box, Jenkins is set up to run builds on the built-in node. This is to make it easier to get started with Jenkins, but is inadvisable longer term: Any builds running on the built-in node have the same level of access to the controller file system as the Jenkins process.
Jenkins 设置为在内置节点上运行构建，开箱即用。这是为了更容易开始使用 Jenkins，但从长远来看是不可取的：在内置节点上运行的任何构建都具有与 Jenkins 进程相同的控制器文件系统访问权限级别。

It is therefore highly advisable to not run any builds on the built-in  node, instead using agents (statically configured or provided by *clouds*) to run builds.
因此，强烈建议不要在内置节点上运行任何构建，而是使用代理（静态配置或由*云*提供）来运行构建。

To prevent builds from running on the built-in node directly, navigate to *Manage Jenkins » Nodes and Clouds*. Select *Built-In Node* in the list, then select *Configure* in the menu. Set the number of executors to 0 and save. Make sure to also set up clouds or build agents to run builds on, otherwise builds won’t be able to start.
要防止构建直接在内置节点上运行，请导航至*Manage Jenkins » Nodes and Clouds*。在列表中选择 *Built-In Node*，然后在菜单中选择 *Configure*。将 executor 数量设置为 0 并保存。请确保还设置云或生成代理以在其上运行生成，否则生成将无法启动。

Alternatively, use a plugin such as [Job Restrictions Plugin](https://plugins.jenkins.io/job-restrictions) to limit which jobs can be run on certain nodes (like the built-in  node), independent of what your less trusted users may use as label  expression in their jobs' configurations.
或者，使用诸如 [Job Restrictions Plugin](https://plugins.jenkins.io/job-restrictions) 之类的插件来限制哪些作业可以在某些节点（如内置节点）上运行，而与不太受信任的用户可能在其作业配置中用作标签表达式无关。

|      | If you do not have any other computers to run agents on, you can also run  an agent process as a different operating system user on the same system to achieve a similar isolation effect. In this case, ensure that the agent process has no file system access  (neither read nor write) to the Jenkins home directory, and that the  agent process cannot use `sudo` or similar methods to elevate its own permissions. 如果没有其他计算机可以运行 Agent，也可以在同一系统上以不同的操作系统用户身份运行 Agent 进程，以实现类似的隔离效果。在这种情况下，请确保代理进程没有对 Jenkins 主目录的文件系统访问权限（既不读取也不写入），并且代理进程不能使用 `sudo` 或类似方法来提升自己的权限。 |
| ---- | ------------------------------------------------------------ |
|      |                                                              |

## Agent → Controller Access Control Agent → Controller 访问控制

The Jenkins controller and agents can be thought of as a distributed  process which executes across multiple discrete processes and machines. This allows an agent to ask the controller process for information  available to it, for example, the contents of files, etc., and even to  have the controller run certain commands when requested by the agent.
可以将 Jenkins 控制器和代理视为跨多个离散进程和计算机执行的分布式进程。这允许代理向控制器进程请求可用的信息，例如，文件内容等，甚至可以让控制器在代理请求时运行某些命令。

So while not building on the built-in node is a good general practice to  protect from bugs and less sophisticated attackers, an agent process  taken over by a malicious user would still be able to obtain data or  execute commands on the Jenkins controller. To prevent this, the Agent → Controller Access Control system prevents  agent processes from being able to send malicious commands to the  Jenkins controller.
因此，虽然不在内置节点上构建是防止错误和不太复杂的攻击者的良好常规做法，但恶意用户接管的代理进程仍然能够在 Jenkins 控制器上获取数据或执行命令。为了防止这种情况，Agent → Controller 访问控制系统可以防止 Agent 进程向  Jenkins 控制器发送恶意命令。

This system is always enabled since Jenkins 2.326 (see [Agent → Controller Security Changes in 2.326](https://www.jenkins.io/doc/book/security/controller-isolation/jep-235)). In Jenkins 2.325 and earlier, it is enabled by default, but can be disabled in the web UI by un-checking the box on the *Manage Jenkins » Security* page.
自 Jenkins 2.326 以来，此系统始终处于启用状态（请参阅 [2.326 中的 Agent → Controller 安全更改](https://www.jenkins.io/doc/book/security/controller-isolation/jep-235)）。在 Jenkins 2.325 及更早版本中，它默认处于启用状态，但可以通过取消选中 *Manage Jenkins » Security* 页面上的复选框在 Web UI 中禁用它。

|      | It is strongly recommended that you not disable the Agent → Controller Access Control system.  强烈建议您不要禁用 Agent → Controller Access Control 系统。 |
| ---- | ------------------------------------------------------------ |
|      |                                                              |

![Security - Enable Agent ⇒ Controller Access Control](https://www.jenkins.io/doc/book/resources/security/configure-global-security-agent-controller-toggle.png)

As an alternative to disabling Agent → Controller Access Control, in  Jenkins 2.325 and earlier, administrators can selectively allow greater  access. See [the documentation](https://www.jenkins.io/doc/book/security/controller-isolation/agent-to-controller/) for details.
作为禁用代理→控制器访问控制的替代方法，在 Jenkins 2.325 及更早版本中，管理员可以选择性地允许更大的访问权限。有关详细信息[，请参阅文档](https://www.jenkins.io/doc/book/security/controller-isolation/agent-to-controller/)。

# Securing Builds 保护构建

Table of Contents 目录

- [Isolating Distributed Builds
  隔离分布式构建](https://www.jenkins.io/doc/book/security/securing-builds/#isolating-distributed-builds)
- [Pull Request Abuse 拉取请求滥用](https://www.jenkins.io/doc/book/security/securing-builds/#pull-request-abuse)
- [Safe Environment Variable Handling
  安全的环境变量处理](https://www.jenkins.io/doc/book/security/securing-builds/#safe-environment-variable-handling)

Building software is the primary use case for Jenkins. To accomplish that, Jenkins invokes build scripts containing  user-specified code, and ensuring this is done in a safe manner must be a major concern for Jenkins administrators. The following sections discuss potential issues and strategies to deal  with them.
构建软件是 Jenkins 的主要用例。为了实现这一点，Jenkins 调用包含用户指定代码的构建脚本，确保以安全的方式完成这必须是 Jenkins 管理员的主要关注点。以下部分讨论潜在问题和处理这些问题的策略。

## Isolating Distributed Builds 隔离分布式构建

As discussed in [Controller Isolation](https://www.jenkins.io/doc/book/security/controller-isolation), Jenkins should be set up for *distributed builds* to ensure build scripts are not executing on the controller, where they could access the Jenkins home directory or otherwise interfere with the operation of Jenkins.
如[控制器隔离](https://www.jenkins.io/doc/book/security/controller-isolation)中所述，应为*分布式构建*设置 Jenkins，以确保构建脚本不会在控制器上执行，因为它们可能会访问 Jenkins 主目录或以其他方式干扰 Jenkins 的运行。

An additional concern is that builds need to be isolated from each other: While simple Jenkins instances building a single project may be able to  operate securely with a single static agent, administrators of more  complex instances need to consider whether builds need to be isolated  from each other. Some examples:
另一个问题是构建需要彼此隔离：虽然构建单个项目的简单 Jenkins 实例可能能够使用单个静态代理安全地运行，但更复杂实例的管理员需要考虑是否需要将构建彼此隔离。一些例子：

- Jenkins hosts multiple teams, which are not allowed to access each others' projects or source code.
  Jenkins 托管多个团队，这些团队不允许访问彼此的项目或源代码。
- Jenkins builds pull requests/merge requests submitted to public repositories, e.g., on GitHub.
  Jenkins 构建提交到公共仓库（例如 GitHub）的拉取请求/合并请求。

In these scenarios, build scripts running on the same agents may be able  to access data related to other, unrelated, projects, and potentially  even manipulate their build results. Even not assuming malicious intent, badly set up build scripts can  accidentally delete unrelated data or cause resource exhaustion on the  static agent, delaying builds.
在这些情况下，在相同代理上运行的生成脚本可能能够访问与其他不相关的项目相关的数据，甚至可能操纵其生成结果。即使没有恶意，设置不当的构建脚本也可能会意外删除不相关的数据或导致静态代理上的资源耗尽，从而延迟构建。

Solutions to this issue include the following:
此问题的解决方案包括：

- Use [cloud providers](https://plugins.jenkins.io/ui/search/?labels=cloud) that create a new agent for every build.
  使用为每个构建创建新代理的[云提供商](https://plugins.jenkins.io/ui/search/?labels=cloud)。
- Plugins such as [Job Restrictions Plugin](https://plugins.jenkins.io/job-restrictions) limit which jobs can be run on certain nodes.
  [Job Restrictions Plugin](https://plugins.jenkins.io/job-restrictions) 等插件限制了哪些作业可以在某些节点上运行。

## Pull Request Abuse 拉取请求滥用

When using organization folders or [multibranch Pipelines](https://plugins.jenkins.io/workflow-multibranch/), Jenkins automatically builds new pull requests by default. Especially when a Jenkins instance builds projects from public repositories, this can open the door for abuse, such as:
使用组织文件夹或[多分支管道](https://plugins.jenkins.io/workflow-multibranch/)时，Jenkins 默认自动生成新的拉取请求。特别是当 Jenkins 实例从公共存储库构建项目时，这可能会为滥用打开大门，例如：

- Spam pull requests that trigger many new builds.
  触发许多新构建的垃圾邮件拉取请求。
- Malicious pull requests that modify build scripts, e.g., to mine cryptocurrency.
  修改构建脚本的恶意拉取请求，例如，挖掘加密货币。

Strategies for dealing with this include:
处理此问题的策略包括：

- Use cloud providers and limit how many agents can be launched in parallel.  This is easy to implement, but can delay legitimate builds due to  resource constraints.
  使用云提供商并限制可以并行启动的代理数量。这很容易实现，但由于资源限制，可能会延迟合法构建。
- Define [timeouts](https://plugins.jenkins.io/build-timeout) in the Pipeline definition (typically `Jenkinsfile`), as it cannot be modified by users without commit access given appropriate Pipeline trust settings.
  在 Pipeline 定义（通常为 `Jenkinsfile`）中定义[超时](https://plugins.jenkins.io/build-timeout)，因为在给定适当的 Pipeline 信任设置的情况下，没有提交访问权限的用户无法修改它。
- Do not automatically build new pull requests and instead require committers to opt into them, e.g., using plugins like [GitHub Label Filter](https://plugins.jenkins.io/github-label-filter/)
  不要自动生成新的拉取请求，而是要求提交者选择加入它们，例如，使用 [GitHub Label Filter](https://plugins.jenkins.io/github-label-filter/) 等插件

## Safe Environment Variable Handling 安全的环境变量处理

Build scripts and tools invoked during the build may change behavior  depending on environment variables defined for the build. These variables can come from various sources, such as build parameters, predefined agent environment variables, files read from the workspace  and injected into the environment, etc.
在构建期间调用的构建脚本和工具可能会更改行为，具体取决于为构建定义的环境变量。这些变量可以来自各种来源，例如构建参数、预定义的代理环境变量、从工作区读取并注入到环境中的文件等。

[Handling Environment Variables](https://www.jenkins.io/doc/book/security/environment-variables) discusses this topic in detail, including solutions.
[处理环境变量](https://www.jenkins.io/doc/book/security/environment-variables) 详细讨论了这个主题，包括解决方案。

# CSRF Protection CSRF 保护

Table of Contents 目录

- [CSRF Protection in Jenkins
  Jenkins 中的 CSRF 保护](https://www.jenkins.io/doc/book/security/csrf-protection/#csrf-protection-in-jenkins)
- [Configuring CSRF Protection
  配置 CSRF 保护](https://www.jenkins.io/doc/book/security/csrf-protection/#configuring-csrf-protection)
- [Working with Scripted Clients
  使用脚本化客户端](https://www.jenkins.io/doc/book/security/csrf-protection/#working-with-scripted-clients)
- [Disabling CSRF Protection
  禁用 CSRF 保护](https://www.jenkins.io/doc/book/security/csrf-protection/#disabling-csrf-protection)

[Cross-Site Request Forgery](https://en.wikipedia.org/wiki/Cross-site_request_forgery) (CSRF or XSRF) is a type of security vulnerability in web applications. Without protection from CSRF, a Jenkins user or administrator visiting  some other web site would allow the operator of that site to perform  actions in Jenkins as the victim.
[跨站点请求伪造](https://en.wikipedia.org/wiki/Cross-site_request_forgery)（CSRF 或 XSRF）是 Web 应用程序中的一种安全漏洞。如果没有 CSRF 的保护，Jenkins 用户或管理员访问其他网站将允许该站点的操作员作为受害者在 Jenkins 中执行操作。

## CSRF Protection in Jenkins Jenkins 中的 CSRF 保护

CSRF protection uses a token (called *crumb* in Jenkins) that is created by Jenkins and sent to the user. Any form submissions or similar action resulting in modifications, like  triggering builds or changing configuration, requires that the crumb be  provided. The crumb contains information identifying the user it was created for,  so submissions with another user’s token would be rejected. All of this happens in the background and has no visible impact except  in rare circumstances, e.g., after a user’s session expired and they  logged in again.
CSRF 保护使用由 Jenkins 创建并发送给用户的令牌（在 Jenkins 中称为 *crumb*）。任何导致修改的表单提交或类似操作（如触发构建或更改配置）都需要提供 crumb。Crumb  包含标识为其创建它的用户的信息，因此使用其他用户的令牌的提交将被拒绝。所有这些都在后台进行，除了在极少数情况下，例如，在用户的会话过期并再次登录后，否则不会产生明显的影响。

|      | The documentation on this page applies to Jenkins 2.222 or newer.  本页文档适用于 Jenkins 2.222 或更高版本。 |
| ---- | ------------------------------------------------------------ |
|      |                                                              |

## Configuring CSRF Protection 配置 CSRF 保护

In *Manage Jenkins » Security » CSRF Protection*, administrators can configure CSRF Protection.
在 *Manage Jenkins » Security » CSRF Protection*中，管理员可以配置 CSRF Protection。

![CSRF Protection in Security](https://www.jenkins.io/doc/book/resources/security/configure-global-security-prevent-csrf.png)

The *Default Crumb Issuer* encodes the following information in the [hash](https://en.wikipedia.org/wiki/Cryptographic_hash_function) used as crumb:
*Default Crumb Issuer* 在用作 Crumb 的[哈希](https://en.wikipedia.org/wiki/Cryptographic_hash_function)中对以下信息进行编码：

- The user name that the crumb was generated for
  为其生成 crumb 的用户名
- The web session ID that the crumb was generated in
  生成 crumb 的 Web 会话 ID
- The IP address of the user that the crumb was generated for
  为其生成 crumb 的用户的 IP 地址
- A [salt](https://en.wikipedia.org/wiki/Salt_(cryptography)) unique to this Jenkins instance
  此 Jenkins 实例独有的[盐](https://en.wikipedia.org/wiki/Salt_(cryptography))

All of this information needs to match when a crumb is sent back to Jenkins for that submission to be considered valid.
当 crumb 被发送回 Jenkins 时，所有这些信息都需要匹配，才能使该提交被视为有效。

The only supported option *Enable proxy compatibility* removes information about the user IP address from the token. This can be useful when Jenkins is running behind a reverse proxy and a  user’s IP address as seen from Jenkins would regularly change.
唯一支持的选项 *Enable proxy compatibility （启用代理兼容性*） 将从令牌中删除有关用户 IP 地址的信息。当 Jenkins 在反向代理后面运行时，从 Jenkins 看到的用户 IP 地址会定期更改时，这可能很有用。

|      | The web session ID was added in Jenkins 2.176.2 and 2.186 to cause crumb to expire. See [security advisory](https://www.jenkins.io/security/advisory/2019-07-17/#SECURITY-626) and [upgrade guide](https://www.jenkins.io/doc/upgrade-guide/2.176/#SECURITY-626).  在 Jenkins 2.176.2 和 2.186 中添加了 Web 会话 ID，以使 crumb 过期。请参阅[安全建议](https://www.jenkins.io/security/advisory/2019-07-17/#SECURITY-626)和[升级指南](https://www.jenkins.io/doc/upgrade-guide/2.176/#SECURITY-626)。 |
| ---- | ------------------------------------------------------------ |
|      |                                                              |

Plugins may provide other crumb issuers that use other criteria to determine whether a crumb is valid. The [Strict Crumb Issuer](https://plugins.jenkins.io/strict-crumb-issuer) provides an alternative crumb issuer implementation that is more customizable.
插件可能会提供其他 crumb 颁发者，这些颁发者使用其他标准来确定 crumb 是否有效。[Strict Crumb Issuer](https://plugins.jenkins.io/strict-crumb-issuer) 提供了可自定义性更强的替代 Crumb Issuer 实施。

## Working with Scripted Clients 使用脚本化客户端

Requests sent using the `POST` method are subject to CSRF protection in Jenkins and generally need to provide a crumb. This also applies to scripted clients that **authenticate using username and password**. Since the crumb includes the web session ID, clients need to do the following:
使用 `POST` 方法发送的请求在 Jenkins 中受 CSRF 保护，通常需要提供 crumb。这也适用于**使用用户名和密码进行身份验证**的脚本化客户端。由于 crumb 包含 Web 会话 ID，因此客户端需要执行以下操作：

- Send a request to the `/crumbIssuer/api` endpoints, requesting a crumb. Note the `Set-Cookie` response header.
  向 `/crumbIssuer/api` 端点发送请求，请求 crumb。请注意 `Set-Cookie` 响应标头。
- For all subsequent requests, provide the crumb and the session cookie in addition to username and password.
  对于所有后续请求，除了用户名和密码外，还要提供 crumb 和会话 cookie。

Alternatively **authenticate using username and API token**. Requests authenticating with an [API token](https://www.jenkins.io/doc/book/system-administration/authenticating-scripted-clients/) are exempt from CSRF protection in Jenkins.
或者**，使用 username 和 API token 进行身份验证**。使用 [API 令牌](https://www.jenkins.io/doc/book/system-administration/authenticating-scripted-clients/)进行身份验证的请求不受 Jenkins 中的 CSRF 保护。

## Disabling CSRF Protection 禁用 CSRF 保护

Outdated plugins that send HTTP requests to Jenkins may not work with CSRF protection enabled. In this case, it may be necessary to disable CSRF protection temporarily.
向 Jenkins 发送 HTTP 请求的过时插件在启用 CSRF 保护的情况下可能无法工作。在这种情况下，可能需要暂时禁用 CSRF 保护。

|      | It is **strongly recommended** that CSRF protection be left **enabled**, including on instances operating on private, fully trusted networks.  **强烈建议****启用** CSRF 保护，包括在私有的、完全受信任的网络上运行的实例。 |
| ---- | ------------------------------------------------------------ |
|      |                                                              |

To disable CSRF protection, set the system property `hudson.security.csrf.GlobalCrumbIssuerConfiguration.DISABLE_CSRF_PROTECTION` to `true` on startup. [Learn more about system properties in Jenkins](https://www.jenkins.io/doc/book/managing/system-properties/).
要禁用 CSRF 保护，请在启动时将 system 属性设置为 `hudson.security.csrf.GlobalCrumbIssuerConfiguration.DISABLE_CSRF_PROTECTION` `true`。[详细了解 Jenkins 中的系统属性](https://www.jenkins.io/doc/book/managing/system-properties/)。

------

# Rendering User Content 渲染用户内容

Table of Contents 目录

- [Content-Security-Policy 内容安全策略](https://www.jenkins.io/doc/book/security/user-content/#content-security-policy)
- Resource Root URL 资源根 URL
  - [Security considerations 安全注意事项](https://www.jenkins.io/doc/book/security/user-content/#security-considerations)

Multiple features of Jenkins, and many more in plugins, serve files that can be viewed or downloaded from Jenkins. Some built-in examples of that are the workspace browser, archived artifacts, file parameters to builds, or the `/userContent/` directory. Plugins like [Javadoc](https://plugins.jenkins.io/javadoc), [HTML Publisher](https://plugins.jenkins.io/htmlpublisher), or [Maven Integration](https://plugins.jenkins.io/maven-plugin) (when publishing the Maven site) prominently feature functionality that serves HTML controlled by users from Jenkins.
Jenkins 的多种功能以及插件中的更多功能提供可从 Jenkins 查看或下载的文件。一些内置示例包括工作区浏览器、存档的工件、构建的文件参数或 `/userContent/` 目录。[Javadoc](https://plugins.jenkins.io/javadoc)、[HTML Publisher](https://plugins.jenkins.io/htmlpublisher) 或 [Maven 集成](https://plugins.jenkins.io/maven-plugin)（发布 Maven 站点时）等插件突出了提供由 Jenkins 用户控制的 HTML 的功能。

This can be a risk, as [Cross-Site Scripting](https://owasp.org/www-community/attacks/xss/) attacks could be put into those HTML files by people with influence over builds who may not be fully trusted.
这可能是一个风险，因为[跨站点脚本](https://owasp.org/www-community/attacks/xss/)攻击可能由对构建有影响力的人放入这些 HTML 文件中，这些人可能不完全信任。

## Content-Security-Policy 内容安全策略

By default, Jenkins serves files that could come from less trusted sources with a strict `Content-Security-Policy` HTTP response header. This default prevents all JavaScript and other active elements, and only allows CSS and images served from other files in Jenkins.
默认情况下，Jenkins 使用严格的 `Content-Security-Policy` HTTP 响应标头提供可能来自不太受信任的来源的文件。此默认设置会阻止所有 JavaScript 和其他活动元素，并且只允许从 Jenkins 中的其他文件提供 CSS 和图像。

While this is safe, it also prevents a lot of useful functionality from  working, such as rich, dynamic HTML reports created during builds. It is possible to [configure Content-Security-Policy](https://www.jenkins.io/doc/book/security/configuring-content-security-policy/). This is often a difficult tradeoff between functionality and security, so should only be done with great care.
虽然这是安全的，但它也会阻止许多有用的功能正常工作，例如在构建期间创建的丰富、动态的 HTML 报告。可以[配置 Content-Security-Policy](https://www.jenkins.io/doc/book/security/configuring-content-security-policy/)。这通常是功能和安全性之间的艰难权衡，因此只能非常小心地进行。

## Resource Root URL 资源根 URL

As an alternative to relaxing `Content-Security-Policy`, administrators can configure Jenkins to serve files from potentially less trusted sources from a different domain. This option can be configured in *Manage Jenkins » System* in the section *Serve resource files from another domain*.
作为放宽 `Content-Security-Policy` 的替代方案，管理员可以将 Jenkins 配置为从来自不同域中可能不太受信任的来源提供文件。此选项可以在 *Manage Jenkins » System* 的 *Serve resource files from another domain*部分中进行配置。

If the resource root URL is defined, Jenkins will instead redirect  requests for user-created resource files to URLs starting with the URL  configured here. These URLs will not set the CSP header, allowing JavaScript and similar  features to work. For this option to work as expected, the following constraints and  considerations apply:
如果定义了资源根 URL，则 Jenkins 会将用户创建的资源文件的请求重定向到以此处配置的 URL 开头的 URL。这些 URL 不会设置 CSP 标头，从而允许 JavaScript 和类似功能工作。要使此选项按预期工作，以下约束和注意事项适用：

- The resource root URL must be a valid alternative choice for the Jenkins URL for requests to be processed correctly.
  资源根 URL 必须是 Jenkins URL 的有效替代选择，才能正确处理请求。
- The Jenkins URL must be set and it must be different from this resource root URL (in fact, a different host name is required).
  必须设置 Jenkins URL，并且它必须与此资源根 URL 不同（实际上，需要不同的主机名）。
- Once set, Jenkins will only serve resource URL requests via the resource root URL. All other requests will get *HTTP 404 Not Found* responses.
  设置后，Jenkins 将仅通过资源根 URL 提供资源 URL 请求。所有其他请求都将收到 *HTTP 404 Not Found* 响应。

Once this URL has been set up correctly, Jenkins will redirect requests to  workspaces, archived artifacts, and similar collections of usually  user-generated content to URLs starting with the resource root URL. Instead of a path like `job/name_here/ws`, resource URLs will contain a token encoding that path, the user for  which the URL was created, and when it was created. These resource URLs access static files as if the user for which they  were created would access them: If the user’s permission to access these files is removed, the corresponding resource URLs will not work anymore either. **These URLs are accessible to anyone without authentication until they expire, so sharing these URLs is akin to sharing the files directly.**
正确设置此 URL 后，Jenkins 会将对工作区、存档构件和通常由用户生成的内容的类似集合的请求重定向到以资源根 URL 开头的 URL。资源 URL 将包含一个令牌，而不是 `job/name_here/ws` 之类的路径，该令牌编码该路径、为其创建 URL 的用户以及创建 URL 的时间。这些资源 URL 访问静态文件，就好像为其创建它们的用户将访问它们一样：如果用户访问这些文件的权限被删除，则相应的资源 URL 也将不再有效。**这些 URL 在过期之前无需身份验证即可被任何人访问，因此共享这些 URL 类似于直接共享文件。**

### Security considerations 安全注意事项

#### Authentication 认证

Resource URLs do not require authentication (users will not have a valid session for the resource root URL). Sharing a resource URL with another user, even one lacking Overall/Read  permission for Jenkins, will grant that user access to these files until the URLs expire.
资源 URL 不需要身份验证（用户将没有资源根 URL 的有效会话）。与其他用户共享资源 URL，即使是缺少 Jenkins 的总体/读取权限的用户，也会授予该用户访问这些文件的权限，直到 URL 过期。

#### Expiration 呼气

Resource URLs expire after 30 minutes by default. Expired resource URLs will redirect users to their equivalent Jenkins  URLs, so that the user can reauthenticate, if necessary, and then be  redirected back to a new resource URL that will be valid for another 30  minutes. This will generally be transparent to the user if they have a valid  Jenkins session. Otherwise, they will need to authenticate with Jenkins again. However, when browsing pages with HTML frames, like Javadoc sites, the  login form cannot appear in a frame. In these cases, users will need to reload the top-level frame to make  the login form appear.
默认情况下，资源 URL 在 30 分钟后过期。过期的资源 URL 会将用户重定向到其等效的 Jenkins  URL，以便用户可以在必要时重新进行身份验证，然后重定向回有效期为 30 分钟的新资源 URL。如果用户具有有效的 Jenkins  会话，这通常对用户是透明的。否则，他们将需要再次使用 Jenkins 进行身份验证。但是，在浏览带有 HTML 框架的页面（如 Javadoc  站点）时，登录表单不能显示在框架中。在这些情况下，用户需要重新加载顶级框架才能显示登录表单。

To change how quickly resource URLs expire, set the system property `jenkins.security.ResourceDomainRootAction.validForMinutes` to the desired value in minutes. Earlier expiration might make it harder to use these URLs, while later  expiration increases the likelihood of unauthorized users gaining access through URLs shared with them by authorized users.
要更改资源 URL 的过期速度，请将 system 属性设置为 `jenkins.security.ResourceDomainRootAction.validForMinutes` 所需的值（以分钟为单位）。较早的过期可能会使使用这些 URL 变得更加困难，而较晚的过期会增加未经授权的用户通过授权用户共享的 URL 获得访问权限的可能性。

#### Authenticity 真实性

Resource URLs encode the URL, the user for which they were created, and their creation timestamp. Additionally, this string contains an [HMAC](https://en.wikipedia.org/wiki/HMAC) to ensure the authenticity of the URL. This prevents attackers from forging URLs that would grant them access to resource files as if they were another user.
资源 URL 对 URL、为其创建资源的用户及其创建时间戳进行编码。此外，此字符串还包含一个 [HMAC](https://en.wikipedia.org/wiki/HMAC)，以确保 URL 的真实性。这可以防止攻击者伪造 URL，从而授予他们访问资源文件的权限，就像他们是另一个用户一样。

# Access Control for Builds  构建的访问控制

Similar to access control for users, builds in Jenkins run with an associated  user authorization. By default, builds run as the internal SYSTEM user that has full  permissions to run on any node, create or delete jobs, start and cancel  other builds, etc.
与用户的访问控制类似，Jenkins 中的构建使用关联的用户授权运行。默认情况下，构建以内部 SYSTEM 用户身份运行，该用户具有在任何节点上运行、创建或删除作业、启动和取消其他构建等的完全权限。

|      | The permission Agent/Build requires access control for builds to be set  up, as the build’s authentication is checked, and not the user starting  the build.  权限 Agent/Build 需要对要设置的构建进行访问控制，因为会检查构建的身份验证，而不是启动构建的用户。 |
| ---- | ------------------------------------------------------------ |
|      |                                                              |

In a Jenkins setup with fine-grained permissions control, this is  undesirable. For example, having builds run as SYSTEM could allow users with access  to configure and start one job to start builds of any other jobs using [Pipeline Build Step Plugin](https://plugins.jenkins.io/pipeline-build-step).
在具有精细权限控制的 Jenkins 设置中，这是不可取的。例如，让构建以 SYSTEM 方式运行，可以允许具有配置和启动一个作业权限的用户使用 [Pipeline Build Step Plugin](https://plugins.jenkins.io/pipeline-build-step) 启动任何其他作业的构建。

|      | Some plugins implement their own access control beyond build authorization. Not using build authorization, or having builds run as SYSTEM, is an *indicator* that problems like the one described above can occur.  一些插件在构建授权之外实现了自己的访问控制。不使用构建授权或将构建作为 SYSTEM 运行，*表明*可能会发生上述问题。 |
| ---- | ------------------------------------------------------------ |
|      |                                                              |

One solution to this is to configure access control for builds. This is implemented by [Authorize Project Plugin](https://plugins.jenkins.io/authorize-project), which allows flexible configuration of global and per-project build authorization. That plugin is however not actively maintained, and there are known limitations to this approach.
一种解决方案是为 build 配置访问控制。这是由 [Authorize Project Plugin](https://plugins.jenkins.io/authorize-project) 实现的，它允许灵活配置全局和每个项目的构建授权。然而，该插件并未得到积极维护，并且这种方法存在已知的局限性。

# Handling Environment Variables  处理环境变量

It is common for build scripts executed by Jenkins to be passed parameters in the form of environment variables. For example, parameterized freestyle projects pass parameter values to Shell and Batch build steps as environment variables. Other common sources of environment variables are the trigger or cause for the build. If a pull request is built, environment variables may contain the pull request ID or even the name of the pull request.
Jenkins 执行的构建脚本通常以环境变量的形式传递参数。例如，参数化的 Freestyle 项目将参数值作为环境变量传递给 Shell 和 Batch  构建步骤。环境变量的其他常见来源是构建的触发器或原因。如果构建了拉取请求，则环境变量可能包含拉取请求 ID 甚至拉取请求的名称。

Jenkins users and administrators need to be aware of potential problems  involving environment variables and their impact on the behavior of  builds.
Jenkins 用户和管理员需要了解涉及环境变量的潜在问题及其对构建行为的影响。

## Setting special environment variables 设置特殊环境变量

Special environment variables can change the behavior of build scripts: `PATH` (or `Path` on Windows) is generally used to find the programs that are launched  during a build, so overriding its value may have an unexpected effect,  as other programs than usually expected may be launched.
特殊的环境变量可以更改构建脚本的行为：`PATH`（或 Windows 上的 `Path`）通常用于查找在构建期间启动的程序，因此覆盖其值可能会产生意外效果，因为可能会启动超出通常预期的其他程序。

Less well known variables, such as `LD_PRELOAD` (on Linux) and `DYLD_LIBRARY_PATH` (on macOS) may have a similar effect. Many other environment variables are read by different programs, and setting them may alter behavior.
不太知名的变量，例如 `LD_PRELOAD`（在 Linux 上）和 `DYLD_LIBRARY_PATH`（在 macOS 上）可能具有类似的效果。许多其他环境变量由不同的程序读取，设置它们可能会改变行为。

Any user who can add environment variables with a name they choose may be  able to modify the behavior of builds this way. While this is a useful feature for users with Job/Configure permission,  administrators should review plugins' ability to add arbitrary  environment variables into the build environment from sources that do  not require permission to configure jobs.
任何可以使用他们选择的名称添加环境变量的用户都可以通过这种方式修改构建的行为。虽然这对于具有 Job/Configure 权限的用户来说是一个有用的功能，但管理员应该查看插件的能力，即从不需要配置作业权限的源向构建环境添加任意环境变量。

## Setting unsafe environment variable values 设置不安全的环境变量值

Not all scripts and script interpreters commonly invoked during builds are  designed for this use case, and special care may need to be taken to  filter or sanitize environment variable values.
并非构建期间通常调用的所有脚本和脚本解释器都是为此用例设计的，可能需要特别小心地过滤或清理环境变量值。

An example for this problematic behavior is Windows Batch. `cmd.exe` by default *evaluates* the values of variables as they’re read. A variable value that contains valid Batch commands may result in the execution of these commands by Jenkins. See [this report](https://threatpost.com/shellshock-like-weakness-may-affect-windows/108696/) for a summary of the problem. While Windows Batch allows scripts to be written in a manner that prevents this problem (using `EnableDelayedExpansion` and the `!variable!` syntax), other scripts or script interpreters may not. Additionally, administrators may not want to have to rely on every  Jenkins user writing build scripts being aware of this problem.
此有问题的行为的一个示例是 Windows Batch。默认情况下`，cmd.exe` 在读取变量时*评估*变量的值。包含有效 Batch 命令的变量值可能会导致 Jenkins 执行这些命令。有关问题的摘要，请参阅[此报告](https://threatpost.com/shellshock-like-weakness-may-affect-windows/108696/)。虽然 Windows Batch 允许以防止此问题的方式编写脚本（使用 `EnableDelayedExpansion` 和 `！variable！` 语法），但其他脚本或脚本解释器则不能。此外，管理员可能不希望依赖每个编写构建脚本的 Jenkins 用户都知道这个问题。

Since Jenkins 2.248 and LTS 2.249.1, administrators are able to globally  define filters for environment variables passed to build steps that  support them. The built-in Shell and Windows Batch build steps support these filters,  as do the various pipeline steps provided by [Pipeline: Nodes and Processes](https://plugins.jenkins.io/workflow-durable-task-step) 2.36 and newer. This functionality can be used to change or remove variables containing potentially unsafe metacharacters (such as `^` or `&` in the case of Windows Batch) from the environment of these build steps, or even fail the build step.
从 Jenkins 2.248 和 LTS 2.249.1 开始，管理员能够为传递给支持它们的构建步骤的环境变量全局定义过滤器。内置的 Shell 和 Windows Batch 构建步骤支持这些筛选器，管道提供的各种管道步骤也支持这些筛选器[：节点和进程](https://plugins.jenkins.io/workflow-durable-task-step) 2.36 及更高版本。此功能可用于从这些构建步骤的环境中更改或删除包含可能不安全的元字符（例如`^`或`&`在Windows Batch的情况下）的变量，甚至使构建步骤失败。

The following plugins implement functionality that is useful for filtering out potentially unsafe environment variables:
以下插件实现了有助于过滤掉可能不安全的环境变量的功能：

- [Safe Batch Environment Filter](https://plugins.jenkins.io/safe-batch-environment-filter) allows administrators to automatically fail Batch build steps (both in  classic projects and in Pipelines) if those steps would have environment variables with Batch metacharacters.
  [安全 Batch 环境筛选器](https://plugins.jenkins.io/safe-batch-environment-filter)允许管理员自动失败 Batch 生成步骤（在 Classic Projects 和 Pipelines 中），前提是这些步骤具有带有 Batch 元字符的环境变量。
- [Generic Build Step Environment Filters](https://plugins.jenkins.io/generic-environment-filters) provides generic implementations for build step environment filters  that can be used to filter environment variables for other script  interpreters.
  [通用构建步骤环境过滤器](https://plugins.jenkins.io/generic-environment-filters) 为构建步骤环境过滤器提供通用实施，可用于过滤其他脚本解释器的环境变量。
- [Pipeline: Keep Environment Step](https://plugins.jenkins.io/pipeline-keepenv-step) can be used to filter out unused environment variables in pipelines to prevent a global configuration from failing build steps.
  [Pipeline： Keep Environment Step](https://plugins.jenkins.io/pipeline-keepenv-step) 可用于筛选掉管道中未使用的环境变量，以防止全局配置无法通过构建步骤。

# Markup Formatters 标记格式化程序

Jenkins allows users with the appropriate permissions to enter descriptions of various objects, like views, jobs, builds, etc. These descriptions are filtered by *markup formatters*. They serve two purposes:
Jenkins 允许具有适当权限的用户输入各种对象的描述，例如视图、作业、构建等。这些描述按*标记格式化程序*进行筛选。它们有两个用途：

1. Allow users to use rich formatting for these descriptions
   允许用户对这些描述使用丰富格式
2. Protect other users from [Cross-Site Scripting](https://en.wikipedia.org/wiki/Cross-site_scripting) (XSS) attacks
   保护其他用户免受[跨站点脚本](https://en.wikipedia.org/wiki/Cross-site_scripting) （XSS） 攻击

## Configuring the Markup Formatter 配置标记格式化程序

The markup formatter can be configured in *Manage Jenkins » Security » Markup Formatter*.
标记格式化程序可以在 *Manage Jenkins » Security » Markup Formatter* 中配置。

The default markup formatter *Plain text* renders all descriptions as entered: Unsafe HTML metacharacters like `<` and `&` are escaped, and line breaks are rendered as `<br/>` HTML tags.
默认的标记格式化程序纯*文本*将所有描述呈现为输入的内容：像`<`和`&`这样的不安全的HTML元字符被转义，换行符被渲染为`<br/>` HTML标签。

Another commonly installed markup formatter is *Safe HTML*, provided by the [OWASP Markup Formatter Plugin](https://plugins.jenkins.io/antisamy-markup-formatter). It allows the use of a basic, safe subset of HTML.
另一个常用安装的标记格式化程序是 *Safe HTML*，由 [OWASP Markup Formatter 插件](https://plugins.jenkins.io/antisamy-markup-formatter)提供。它允许使用基本的、安全的 HTML 子集。

## Security Considerations 安全注意事项

### User Profile Descriptions 用户配置文件描述

Every user with an account and Overall/Read permission can edit their own user profile. This includes a description that is rendered using the configured markup formatter.
每个拥有帐户和“总体/读取”权限的用户都可以编辑自己的用户配置文件。这包括使用配置的标记格式化程序呈现的描述。

Therefore it can be unsafe to configure a markup formatter allowing arbitrary HTML even when restricting permissions like *Job/Configure* and *Build/Update* to fully trusted users: Anyone with an account will be able to edit their own description and  any other user accessing their profile may become victim of an XSS  attack.
因此，即使将 *Job/Configure* 和 *Build/Update* 等权限限制为完全受信任的用户，配置允许任意 HTML 的标记格式化程序也可能是不安全的：任何拥有帐户的人都可以编辑自己的描述，而访问其配置文件的任何其他用户都可能成为 XSS 攻击的受害者。

This is particularly risky on publicly accessible Jenkins instances when the security realm is implemented using a service like GitHub, GitLab, or  Google accounts, resulting in potentially anyone being able to log in to Jenkins and edit their own profile.
当安全领域是使用 GitHub、GitLab 或 Google 帐户等服务实现时，这在可公开访问的 Jenkins 实例上尤其危险，导致任何人都可能能够登录 Jenkins 并编辑自己的配置文件。

# Exposed Services and Ports  暴露的服务和端口

Jenkins is a fairly complex application and as such does more than just serve a web interface. This section documents the services it frequently exposes on the network.
Jenkins 是一个相当复杂的应用程序，因此不仅仅是提供 Web 界面。本节记录了它经常在网络上公开的服务。

|      | Plugins may expose further services on the network. Only very commonly installed plugins are considered below.  插件可能会在网络上公开更多服务。下面仅考虑非常常用安装的插件。 |
| ---- | ------------------------------------------------------------ |
|      |                                                              |

## Web UI Web 用户界面

The web UI served via HTTP (or HTTPS), by default on port 8080. Sometimes Jenkins is running behind a reverse proxy that may customize or filter requests and responses.
Web UI 通过 HTTP（或 HTTPS）提供，默认情况下在端口 8080 上提供。有时，Jenkins 在反向代理后面运行，该代理可能会自定义或筛选请求和响应。

For an overview of the URLs accessible to users without any permissions in Jenkins, see [Access Control](https://www.jenkins.io/doc/book/security/access-control).
有关 Jenkins 中没有任何权限的用户可访问的 URL 的概述，请参阅[访问控制](https://www.jenkins.io/doc/book/security/access-control)。

## TCP Agent Listener Port TCP 代理侦听器端口

Jenkins can expose a TCP port that allows inbound agents to connect to it. It can be enabled, disabled, and configured in *Manage Jenkins » Security*.
Jenkins 可以公开一个 TCP 端口，允许入站代理连接到它。它可以在*Manage Jenkins » Security*中启用、禁用和配置。

The two supported modes (while enabled) are:
支持的两种模式（启用时）是：

1. **Random**: The TCP port is chosen at random to avoid collisions on the Jenkins [controller](https://www.jenkins.io/doc/book/glossary/#controller). The downside to randomized ports is that they are chosen during the boot of the Jenkins controller, making it difficult to manage firewall rules allowing TCP traffic.
   **Random**：随机选择 TCP 端口，以避免在 Jenkins [控制器](https://www.jenkins.io/doc/book/glossary/#controller)上发生冲突。随机端口的缺点是它们是在 Jenkins 控制器启动期间选择的，因此很难管理允许 TCP 流量的防火墙规则。
2. **Fixed**: The port is chosen by the Jenkins administrator and is consistent across reboots of the Jenkins controller. This makes it easier to manage firewall rules allowing TCP-based agents to connect to the controller.
   **已修复**：该端口由 Jenkins 管理员选择，并且在 Jenkins 控制器重启后保持一致。这使得管理允许基于 TCP 的代理连接到控制器的防火墙规则变得更加容易。

This service is disabled by default in most packages, but the Docker images expose it at port 50000.
默认情况下，此服务在大多数软件包中处于禁用状态，但 Docker 镜像会在端口 50000 上公开它。

HTTP requests at this port get a minimal plain text response with some diagnostic information. It looks like the following:
此端口的 HTTP 请求将获得包含一些诊断信息的最小纯文本响应。它如下所示：

```
Jenkins-Agent-Protocols: JNLP4-connect, Ping 
Jenkins-Version: 2.289 
Jenkins-Session: b4783dfa 
Client: 172.17.0.1 
Server: 172.17.0.3 
Remoting-Minimum-Version: 3.14 
```

|      | List of currently enabled TCP inbound agent protocols. 当前启用的 TCP 入站代理协议列表。 |
| ---- | ------------------------------------------------------------ |
|      | The current version of Jenkins. 当前版本的 Jenkins。         |
|      | The session of the current Jenkins execution. This is unrelated to web  session cookies. This is changed to a new value whenever Jenkins starts. It is used in various URLs to help implement caching of static  resources, and can be used by clients to tell whether Jenkins restarted. 当前 Jenkins 执行的会话。这与网络会话 Cookie 无关。每当 Jenkins 启动时，此值都会更改为新值。它用于各种 URL 以帮助实现静态资源的缓存，客户端可以使用它来判断 Jenkins 是否重新启动。 |
|      | The client IP address as seen from Jenkins. 从 Jenkins 中看到的客户端 IP 地址。 |
|      | The Jenkins controller’s IP address. Jenkins 控制器的 IP 地址。 |
|      | The minimum required version of the [Remoting](https://github.com/jenkinsci/remoting/) library for agents to connect to this Jenkins controller. 代理连接到此 Jenkins 控制器所需的 [Remoting](https://github.com/jenkinsci/remoting/) 库的最低版本。 |

Inbound agents may instead be configured to use WebSocket transport to connect to Jenkins. In this case no extra TCP port need be enabled and no special security configuration is needed.
入站代理可以配置为使用 WebSocket 传输连接到 Jenkins。在这种情况下，不需要启用额外的 TCP 端口，也不需要特殊的安全配置。

## SSH Server SSH 服务器

The [SSH Server](https://plugins.jenkins.io/sshd) Plugin can be configured to open an SSH port on the Jenkins controller.
[SSH 服务器](https://plugins.jenkins.io/sshd)插件可以配置为在 Jenkins 控制器上打开 SSH 端口。

|      | This plugin’s functionality was part of Jenkins (core) until Jenkins 2.281.  在 Jenkins 2.281 之前，此插件的功能是 Jenkins（核心）的一部分。 |
| ---- | ------------------------------------------------------------ |
|      |                                                              |

Authentication can be username/password or using public key authentication. For the latter, the public keys can be stored in Jenkins users' profiles.
身份验证可以是用户名/密码或使用公钥身份验证。对于后者，公钥可以存储在 Jenkins 用户的配置文件中。

This SSH server does not provide a regular OS shell once logged in. Instead, it provides a shell-like interface for the [Jenkins CLI](https://www.jenkins.io/doc/book/managing/cli/).
此 SSH 服务器在登录后不提供常规的 OS shell。相反，它为 [Jenkins CLI](https://www.jenkins.io/doc/book/managing/cli/) 提供了一个类似 shell 的接口。

Additionally, some plugins may provide features that require the SSH server to be enabled, like the [GIT server](https://plugins.jenkins.io/git-server) Plugin.
此外，某些插件可能提供需要启用 SSH 服务器的功能，例如 [GIT 服务器](https://plugins.jenkins.io/git-server)插件。

This service is disabled by default.
默认情况下，此服务处于禁用状态。

## UDP and mDNS Service Discovery UDP 和 mDNS 服务发现

Jenkins releases 2.219 and earlier included features that allowed users to discover Jenkins on their network. These features have been removed without replacement in Jenkins 2.220 for security reasons.
Jenkins 版本 2.219 及更早版本包含允许用户在其网络上发现 Jenkins 的功能。出于安全原因，这些功能已在 Jenkins 2.220 中删除，无需替换。

# Credentials 凭据

Table of Contents 目录

- [Working with Credentials 使用凭证](https://www.jenkins.io/doc/book/security/credentials/#working-with-credentials)
- [Limit Access to Credentials
  限制对凭证的访问](https://www.jenkins.io/doc/book/security/credentials/#limit-access-to-credentials)
- [Protect Secrets 保护密钥](https://www.jenkins.io/doc/book/security/credentials/#protect-secrets)
- [Other Notes about Credentials
  有关凭证的其他说明](https://www.jenkins.io/doc/book/security/credentials/#other-notes-about-credentials)

Use credentials to secure access to external sites and applications that can interact with Jenkins such as  artifact repositories, cloud-based storage systems and services, and  databases. This is both more secure and more convenient than hard coding username  and password or other authentication devices in each Pipeline.
使用凭证来保护对可与 Jenkins 交互的外部站点和应用程序的访问，例如构件存储库、基于云的存储系统和服务以及数据库。这比每个 Pipeline 中的硬编码用户名和密码或其他身份验证设备更安全、更方便。

This page summarizes the best practices for securing your credentials.
本页总结了保护凭证的最佳实践。

## Working with Credentials 使用凭证

Implementing credentials has two elements:
实施凭证有两个要素：

- Configure the credential. See [Configuring Credentials](https://www.jenkins.io/doc/book/using/using-credentials/#configuring-credentials) on the [Using Credentials](https://www.jenkins.io/doc/book/using/using-credentials/) page.
  配置凭证。请参阅 [Using Credentials](https://www.jenkins.io/doc/book/using/using-credentials/) 页面上的 [Configuring Credentials](https://www.jenkins.io/doc/book/using/using-credentials/#configuring-credentials)。
- Call credentials in the Pipeline to gain access to an external resource. See [Handling Credentials](https://www.jenkins.io/doc/book/pipeline/jenkinsfile/#handling-credentials) on the [Using a Jenkinsfile](https://www.jenkins.io/doc/book/pipeline/jenkinsfile/) page.
  在 Pipeline 中调用凭证以获取对外部资源的访问权限。请参阅[使用 Jenkinsfile](https://www.jenkins.io/doc/book/pipeline/jenkinsfile/) 页面上的[处理凭证](https://www.jenkins.io/doc/book/pipeline/jenkinsfile/#handling-credentials)。

## Limit Access to Credentials 限制对凭证的访问

Limit the scope of who has access to the credentials. This minimizes the attack surface. You should "build from the bottom". In other words, start with no access to the credentials and then grant access to specific people and projects rather than granting access to everyone and then removing some grants. Specifically:
限制有权访问凭证的人员范围。这样可以最大限度地减少攻击面。您应该 “从底部开始构建”。换句话说，从没有凭证访问权限开始，然后向特定人员和项目授予访问权限，而不是向所有人授予访问权限，然后删除一些授权。具体说来：

- Severely limit the number of people with **Credentials > Create** permissions.
  严格限制具有**凭据 > 创建**权限的人数。
- Grant access only to specific people, projects, and items that actually require this access to do their jobs.
  仅向实际需要此访问权限才能完成其工作的特定人员、项目和项目授予访问权限。
- Define each credential at the lowest possible level. Credentials defined for the controller are available to all Pipelines run by that controller. Credentials defined for a folder are only available to Pipelines run from that folder. The screens used to add and manage credentials for controllers and folders are identical except for their location.
  在尽可能低的级别定义每个凭证。为控制器定义的凭证可用于该控制器运行的所有管道。为文件夹定义的凭据仅适用于从该文件夹运行的 Pipelines。用于添加和管理 Controller 和文件夹凭据的屏幕除位置外完全相同。

## Protect Secrets 保护密钥

Keys to decrypt secrets are stored in the *$JENKINS_HOME/secrets/* directory. This directory has restrictive Linux file system permissions and should be carefully protected:
用于解密密钥的密钥存储在 *$JENKINS_HOME/secrets/* 目录中。此目录具有限制性的 Linux 文件系统权限，应小心保护：

- You must be able to retrieve your secrets if you need to restore your instance.
  如果您需要还原实例，则必须能够检索密钥。
- If someone were to get access to your backups as well as the secret, they would have full access to your entire Jenkins instance and everything it accesses.
  如果有人可以访问您的备份和密钥，他们将拥有对您的整个 Jenkins 实例及其访问的所有内容的完全访问权限。

The following practices are recommended to ensure that your secrets are kept secret:
建议采用以下做法来确保您的密钥保密：

- Never include the *secrets* directory in a backup of your instance.
  切勿在实例的备份中包含 *secrets* 目录。
- Do not store keys in the SCM where their contents could be breached.
  不要将密钥存储在 SCM 中，以免其内容被泄露。
  - A disk crash or data corruption for your application could cause the loss of all the encrypted information for your instance.
    应用程序的磁盘崩溃或数据损坏可能会导致实例的所有加密信息丢失。
  - If someone breaches your SCM and your *secrets* are there, they have full access to your Jenkins instance.
    如果有人破坏了您的 SCM 并且您的*密钥*在那里，则他们拥有对您的 Jenkins 实例的完全访问权限。
- Instead, keep a copy of the secrets in a location apart from other backups and copies of your application. The secret is small and never changes after it is created. You can manually re-add it when restoring from backup.
  相反，请将密钥的副本保存在与应用程序的其他备份和副本不同的位置。密钥很小，创建后永远不会更改。您可以在从备份还原时手动重新添加它。

## Other Notes about Credentials 有关凭证的其他说明

- Modify the underlying credentials (username/password, secret text, etc) frequently.
  经常修改底层凭证（用户名/密码、密钥文本等）。