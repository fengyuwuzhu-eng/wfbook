# Installation and Upgrades

This section covers  installing and upgrading Nexus Repository. Installing and running Nexus  Repository is straight-forward. You can either unpack the archive in a  directory to which you have full access, or you can install it with a  Docker image.

- Learn more about our [installation methods](https://help.sonatype.com/repomanager3/installation-and-upgrades/installation-methods)
- Read through the [post-install checklist](https://help.sonatype.com/repomanager3/installation-and-upgrades/post-install-checklist)
- Follow our guidance for [migrating to a PostgreSQL or H2 database](https://help.sonatype.com/repomanager3/installation-and-upgrades/migrating-to-a-new-database)
- Check out our [upgrading](https://help.sonatype.com/repomanager3/installation-and-upgrades/upgrading-a-standalone-instance) documentation

------

Read about the above topics and much more in this section:

 

- [Installation Methods](https://help.sonatype.com/repomanager3/installation-and-upgrades/installation-methods)
- [Supported Nexus Repository Manager Upgrade Paths](https://help.sonatype.com/repomanager3/installation-and-upgrades/supported-nexus-repository-manager-upgrade-paths)
- [Run as a Service](https://help.sonatype.com/repomanager3/installation-and-upgrades/run-as-a-service)
- [Configuring the Runtime Environment](https://help.sonatype.com/repomanager3/installation-and-upgrades/configuring-the-runtime-environment)
- [Directories](https://help.sonatype.com/repomanager3/installation-and-upgrades/directories)
- [Post Install Checklist](https://help.sonatype.com/repomanager3/installation-and-upgrades/post-install-checklist)
- [Accessing the User Interface](https://help.sonatype.com/repomanager3/installation-and-upgrades/accessing-the-user-interface)
- [Migrating to a New Database](https://help.sonatype.com/repomanager3/installation-and-upgrades/migrating-to-a-new-database)
- [Configuring Nexus Repository Pro for H2 or PostgreSQL](https://help.sonatype.com/repomanager3/installation-and-upgrades/configuring-nexus-repository-pro-for-h2-or-postgresql)
- [Upgrading a Standalone Instance](https://help.sonatype.com/repomanager3/installation-and-upgrades/upgrading-a-standalone-instance)
- [Migrating an Existing Nexus Repository Instance to a Resiliency Architecture](https://help.sonatype.com/repomanager3/installation-and-upgrades/migrating-an-existing-nexus-repository-instance-to-a-resiliency-architecture)
- [Minimally Compatible Server Versions for Lifecycle Features](https://help.sonatype.com/repomanager3/installation-and-upgrades/minimally-compatible-server-versions-for lifecycle-features)
- [Upgrading from Nexus Repository Manager 2](https://help.sonatype.com/repomanager3/installation-and-upgrades/upgrading-from-nexus-repository-manager-2)

# Installation Methods

 

 

## Installing and Running with the Distribution Archive

The distribution archives combine the application and all required  resources in an archive file. If you are testing Nexus Repository  Manager on a local workstation the files may be extracted and run from  anywhere, for production see the platform specific sections. Extracting  the files will result in an application directory and a data directory,  further details about the folder structure and their contents can be  found in [Directories](https://help.sonatype.com/repomanager3/installation-and-upgrades/directories).

 

To uninstall the repository manager from an archive installation, remove  the service configuration and delete the entire directory.

### Unix

The downloaded GZip’d TAR archive can be extracted with the command `tar xvzf`. For production it is not recommend that nexus be run from a users home directory, a common practice is to use `/opt`.

#### Running Repository Manager in the Foreground

To start the repository manager from application directory in the `bin` folder on a Unix-like platform like Linux use:

```
./nexus run
```

Starting the repository manager with the `run` command will leave it running in the current shell and display the log output. The running application can be stopped using `CTRL+C` at the appropriate console.

The application can be [accessed](https://help.sonatype.com/repomanager3/installation-and-upgrades/accessing-the-user-interface) once the the log shows the message "Started Sonatype Nexus." 

#### Running Repository Manager in the Background

The `nexus` script can be used to manage the repository manager as a background application on OSX and Unix with the `start`, `stop`, `restart`, `force-reload` and `status` commands.

To start repository manager and run it in the background:

```
./nexus start
```

While running in the background, all logging will go to then application log file.

To stop repository manager running in the background:

```
./nexus stop
```

### Windows

The zip archive can be unpacked using the Windows [compression utility](https://support.microsoft.com/en-ca/help/14200/windows-compress-uncompress-zip-files) or a third party utility such as [7zip](http://www.7-zip.org/download.html). Nexus Repository Manager should not be installed in the `Program Files` directory to avoid problems with Windows file registry virtualization.  If you plan to run the repository manager as a specific user you can  install it into the `AppData\Local` directory of that users home directory. Otherwise simply use e.g., `C:\nexus` or something similar, ensuring that the user running the application has  full access. The Nexus Repository Manager executable nexus.exe can be  found inside the bin directory and can be run as an application using  the following command:

```
nexus.exe /run
```

Starting the repository manager with the `run` command will leave it running in the current shell and display the log output. The application can be [accessed](https://help.sonatype.com/repomanager3/installation-and-upgrades/accessing-the-user-interface) once the the log shows the message "Started Sonatype Nexus". The running application can be stopped using `CTRL+C` at the appropriate console.

The `nexus.exe` executable can be used to manage the repository manager as a service with the `/start`, `/stop`, `/restart`,` /force-reload` and `/``status` commands.

## Installing with Docker

Docker automates the deployment of applications inside virtualized Linux  containers. You can create a container that supports the installation of Nexus Repository Manager Pro and Nexus Repository Manager OSS. To  install the repository manager with a Docker image, follow the steps at [the Sonatype nexus3 Docker Hub image](https://hub.docker.com/r/sonatype/nexus3/).

## Installing using CloudFormation Templates on AWS

If you plan to deploy Nexus Repository Manager to AWS, we also make available [CloudFormation templates](https://help.sonatype.com/integrations/cloud-deployments/cloudformation---repository-manager).

# Supported Nexus Repository Manager Upgrade Paths

Find the Nexus Repository version you have in the left column. Follow the upgrade procedure in the right column.

| Source Nexus Repository Manager | Required Upgrade Procedure                                   |
| ------------------------------- | ------------------------------------------------------------ |
| 3.1.0 and newer                 | 1. Upgrade to latest available 3.x version                   |
| 3.0.0 to 3.0.2                  | [Learn about important directory layout changes introduced in 3.1.0](https://support.sonatype.com/hc/en-us/articles/231723267)Upgrade to latest available 3.x version |
| 3 milestone 7                   | [Upgrade to 3.0.0](https://support.sonatype.com/hc/en-us/articles/222159808-How-to-Upgrade-Repository-Manager-3-0-0-m7-to-3-0-0-final)[Learn about important directory layout changes introduced in 3.1.0](https://support.sonatype.com/hc/en-us/articles/231723267)Upgrade to latest available 3.x version |
| 3 milestone 1 to milestone 6    | Upgrading these versions is **not supported**.               |
| Latest 2.x version              | Upgrade to latest available 3.x version                      |
| 2.0 or any later 2.x version    | Upgrade to latest available 2.x versionUpgrade to latest available 3.x version |
| 1.x                             | Upgrade to any 2.x version up to 2.7.2 *Upgrade to latest available 2.x versionUpgrade to latest available 3.x version |

***** Versions after 2.7.2 do not include support for upgrading 1.x versions

The latest Nexus Repository Manager version 2 can be downloaded [here](http://links.sonatype.com/products/nxrm2/download).

The latest Nexus Repository Manager version 3 can be downloaded [here](http://links.sonatype.com/products/nxrm3/download).

​        

# Run as a Service

 

 

When installing Nexus Repository for production usage it has to be  configured it to run as a service, so it restarts after the server  reboots. It is good practice to run that service or daemon as a specific user that has only the required access rights. Installation from the [distribution archive](https://help.sonatype.com/repomanager3/product-information/download) does not include the configuration of a service. The following sections  provide instructions for configuring the service manually. Independent  of the operating system the steps are:

- Create operating system user with limited access rights dedicated to run the repository manager as a service
- Ensure suitable Java runtime environment is installed - see [Java Runtime Environment](https://help.sonatype.com/repomanager3/product-information/system-requirements#SystemRequirements-Java)
- Configure the service and ensure it starts as part of the operating system boot process

## Linux

You can configure the repository manager to run as a service with `init.d `or `systemd` . Both are startup frameworks used in Linux-based systems such as Ubuntu  and CentOS. They are, essentially, initscripts that load commands to  manage the repository manager daemon. Before running the service configure an absolute path for your repository manager files. Then create a `nexus` user with sufficient access rights to run the service. In `bin/nexus.rc` assign the user between the quotes in the line below:

```
run_as_user="nexus"
```

Symlink `$installdir/bin/nexus` to `/etc/init.d/nexus`:

```
sudo ln -s /opt/nexus-3.15.2-01/bin/nexus /etc/init.d/nexus
```

Adjust the location (shown above as "/opt/nexus-3.15.2-01'") as needed for your installation location.

### chkconfig

This example uses `chkconfig`, a tool that targets the initscripts in `init.d` to run the `nexus` service. Run these commands to activate the service:

```
cd /etc/init.d
sudo chkconfig --add nexus
sudo chkconfig --levels 345 nexus on
sudo service nexus start
```



The second command adds nexus as a service to be started and stopped with the command. `chkconfig` manages the symbolic links in `/etc/rc[0-6].d` which control the services to be started and stopped when the operating  system restarts or transitions between run-levels. The third command  adds nexus to run-levels 3, 4 and 5. Then the service command starts the repository manager.

### update-rc.d

This example uses `update-rc.d`, a tool similar to the `chkconfig`.

```
cd /etc/init.d
sudo update-rc.d nexus defaults
sudo service nexus start
```

In the second line you will run a default priority to add the `nexus` service before starting it.

### systemd

This example is a script that uses `systemd` to run the repository manager service. Create a file called `nexus.service`. Add the following contents, then save the file in the `/etc/systemd/system/` directory:

```
[Unit]
Description=nexus service
After=network.target
  
[Service]
Type=forking
LimitNOFILE=65536
ExecStart=/etc/init.d/nexus start
ExecStop=/etc/init.d/nexus stop 
User=nexus
Restart=on-abort
TimeoutSec=600
  
[Install]
WantedBy=multi-user.target
```

Activate the service with the following commands:

```
sudo systemctl daemon-reload
sudo systemctl enable nexus.service
sudo systemctl start nexus.service
```

After starting the service for any Linux-based operating systems, verify that the service started successfully.

```
tail -f /opt/sonatype-work/nexus3/log/nexus.log
```

The tail command verifies that the service has been started successfully.  If successful, you should see a message notifying you that it is  listening for HTTP.

 

Be sure to assign the appropriate permissions to the user running the `nexus` service.

### PID File

When started as a service on Linux, Nexus Repository will create a file  which holds a process ID in the operating system /tmp directory. This  file will have have a name of the form:

- prefix: "i4jdaemon_"
- suffix: the absolute path to the nexus start script with path part separators replaced with underscores
  *Example:* Temporary directory is /tmp and path to start script is at  /opt/nexus/nexus-3.14.0-04/bin/nexus , then the file created will be at  "/tmp/i4jdaemon__opt_nexus_nexus-3.14.0-04_bin_nexus". 

***If the service pid file cannot be written the service startup will  silently fail, without any logging statements written to the nexus.log***. 

If the Nexus Repository process is already stopped, and the service is  failing to start, first confirm there is no log output being added to  the nexus.log file. If not, then check for an pre-existing pid file. If  that file is present, delete it first before trying to start the  service.

The directory this file is created in can opttionally be changed by editing [$install-dir](https://help.sonatype.com/nxrm3master/installation-and-upgrades/directories)/bin/nexus.vmoptions and adding a line like this:

```
-Dinstall4j.pidDir=/some/absolute/path/to/a/directory
```

The directory specified by the propery must already exist for the property  to work - the directory will not be created automatically.

### Native Linux Installers from the community

There are community provided native installers for linux available here: [nexus-repository-installer](https://github.com/sonatype-nexus-community/nexus-repository-installer)

These installers setup Nexus Repository Manager to run as a service. NOTE:  These are provided by the community, and not officially supported.

## Windows

The startup script that runs Nexus Repository on Windows platforms is `bin/nexus.exe`. The script includes standard commands for starting and stopping the service. It also contains commands `install` and `uninstall` to create and delete the configuration for the service. You can create the service configuration with:

```
nexus.exe /install <optional-service-name>
```

The new service is named `nexus` by default. It is available in the Windows console application to manage  services such as Windows Services. You can start, stop and restart the  service there as well as configure it to start as part of a operating  system startup. Alternatively you can manage the service on the command  line:

```
nexus.exe /start <optional-service-name>
nexus.exe /stop <optional-service-name>
nexus.exe /uninstall <optional-service-name>
```

The `<optional-service-name>` parameter with a value of e.g. `nexus3` can be used to create a service that does not collide with an existing service established for [Nexus Repository Manager 2](https://help.sonatype.com/repomanager2) running on the same server.

## Mac OS

The standard way to run a service on Mac OS is to use `launchd`, a program that starts, stops and manages daemons and scripts in Apple  OS X environments. To run the service you need to create an XML document called with the file extension `.plist` to define its properties. An example plist file for the repository manager installed in `/opt` is shown here:

```
<!DOCTYPE plist PUBLIC "-//Apple//DTD PLIST 1.0//EN"
    "http://www.apple.com/DTDs/PropertyList-1.0.dtd">
<plist version="1.0">
<dict>
    <key>Label</key>
    <string>com.sonatype.nexus</string>
    <key>ProgramArguments</key>
    <array>
        <string>/opt/nexus/bin/nexus</string>
        <string>start</string>
    </array>
    <key>RunAtLoad</key>
    <true/>
</dict>
</plist>
```

After saving the file as `com.sonatype.nexus.plist` in `/Library/LaunchDaemons/` you have to change the ownership and access rights:

```
sudo chown root:wheel /Library/LaunchDaemons/com.sonatype.nexus.plist
sudo chmod 644 /Library/LaunchDaemons/com.sonatype.nexus.plist
```

Consider setting up a different user to run the repository manager and adapt permissions and the `RUN_AS_USER` setting in the nexus startup script. With this setup the repository manager  starts as a service at boot time. To manually start it after the  configuration you can use:

```
sudo launchctl load /Library/LaunchDaemons/com.sonatype.nexus.plist
```

# Configuring the Runtime Environment

 

 

Configuring the specifics of the repository manager runtime involves configuration  for all components in various configuration files and startup scripts.  This section details these and provides recipes for specific tasks. The  startup of the JVM running the repository manager is managed via files  in the `$install-dir/bin` directory within the installation.

The application startup loads JVM arguments from the Java [properties](https://docs.oracle.com/javase/8/docs/api/java/util/Properties.html#load-java.io.Reader-) file `$install-dir/bin/nexus.vmoptions`:

```
-Xms2703m
-Xmx2703m
-XX:MaxDirectMemorySize=2703m
-XX:+UnlockDiagnosticVMOptions
-XX:+LogVMOutput
-XX:LogFile=../sonatype-work/nexus3/log/jvm.log
-XX:-OmitStackTraceInFastThrow
-Djava.net.preferIPv4Stack=true
-Dkaraf.home=.
-Dkaraf.base=.
-Dkaraf.etc=etc/karaf
-Djava.util.logging.config.file=etc/karaf/java.util.logging.properties
-Dkaraf.data=../sonatype-work/nexus3
-Dkaraf.log=../sonatype-work/nexus3/log
-Djava.io.tmpdir=../sonatype-work/nexus3/tmp
-Dkaraf.startLocalConsole=false
-Djava.endorsed.dirs=lib/endorsed
```

The main location for configuration files is the `etc` directory. It includes one properties file and a number of nested directories:

```
$ ls -1 nexus-<version>/etc
fabric
jetty
karaf
logback
nexus-default.properties
ssl
```

 **`fabric`** 

Configuration files for Ehcache, Elasticsearch, and OrientDB

```
    **karaf**  
```

Configuration files for Apache Karaf, including:

- -  **`config.properties`**  - The main configuration for the Apache Karaf runtime. This file should not be modified.
  -  **`custom.properties`**  - Customizable configuration used by Apache Karaf. This file can be used  to pass additional parameters to the Apache Karaf container.
  -  **`org.apache.\*`**  and **`org.ops4j.\*`** - various Karaf and OSGi related configuration files
  -  **`system.properties`** - system properties used for the JVM and application start up

 **`jetty`** 

Configuration files for Eclipse Jetty

 **`logback`** 

Configuration files for logback including:

- -  **`logback.xml` -** Contains default logger definitions for log file names, log levels, pattern layouts and rotation rules for the `nexus.log `and `tasks/*.log` files 
  -  **`logback-access.xml` -** Contains the default logger definition for the log file name, log level, pattern layout and rotation rules for the `request.log` file

See [Logging and Log Viewer](https://help.sonatype.com/repomanager3/nexus-repository-administration/support-features#SupportFeatures-LoggingandLogViewer) for more information on repository manager logging and the recommended  approach for adjusting the logging configuration to meet your needs. 

 **`nexus-default.properties`** 

**This file should not be modified**. A sample of default property values are listed in this file such as the main HTTP connector port and the webapp context path. 

Change or add new configuration properties in `$data-dir/etc/nexus.properties`.

The file `$data-dir/etc/nexus.properties` is created the first time NXRM is started. If configuration is needed before first start then manually create `$data-dir/etc/nexus.properties` and add customizations there.

 **`ssl`** 

A directory to put keystores when configuring HTTPS

## Configuring Memory

Before changing the default memory settings, [review our memory guidelines](https://help.sonatype.com/repomanager3/product-information/system-requirements#SystemRequirements-Memory). Changing any one setting will require adjusting all 3 settings. The `-Xms` and `-Xmx` settings must always have the same value.

### To change JVM memory

1. Open `$install-dir/bin/nexus.vmoptions` in a text editor

2. Find the lines which configure memory:

   ```
   -Xms2703M
   -Xmx2703M
   -XX:MaxDirectMemorySize=2703M
   ```

3. Edit the values of each settting using the following format. The  size  is a number and the literal unit letters represent gigabytes (  g , G  ) , megabytes ( m , M ), or kilobytes ( k , K ).

   ```
   -Xmssize[g|G|m|M|k|K]
   ```

   ```
   -Xmxsize[g|G|m|M|k|K]
   ```

   ```
   -XX:MaxDirectMemorySize=size[g|G|m|M|k|K]
   ```

4. Save the file with permission and ownership of the user that will own the repository manager process.

## Configuring Java Tool Options

The file `$install-dir/bin/nexus.vmoptions` specifies [java tool arguments](https://docs.oracle.com/javase/8/docs/technotes/tools/unix/java.html#BGBCIEFC), one per line, in [Java properties file format](https://docs.oracle.com/javase/8/docs/api/java/util/Properties.html#load-java.io.Reader-).

### To edit java options

1. Open `$install-dir/bin/nexus.vmoptions` in a text editor
2. Specify each java option on a new line. 
   *Make sure the last property is followed by an end of line character or a new blank line. Otherwise the last specified property will not be loaded.*
3. Save the file with permission and ownership of the user that will own the repository manager process.

## Changing the HTTP Port

The default value for the HTTP port used to access the repository manager user interface and resources is `8081`. Therefore the user interface would be available at `http://localhost:8081/`. To change or update the port, locate the line `application-port=8081` in `$data-dir/etc/nexus.properties`, then edit the number. Here is an example where you would change the port to `9081`:

```
application-port=9081
```

Therefore, the exposed URL will be `http://localhost:9081/`.

### Or setup HTTPS

Additionally, or instead, your use case may require you to run your server on HTTPS.  This includes both business policy and usage of some NXRM features or  repository formats.  See [our security article on setting up SSL](https://help.sonatype.com/repomanager3/nexus-repository-administration/configuring-ssl) for the means to do this.

## Changing the Context Path

To change or update the context path in the instance you want point to a specific webapp or component, locate the `nexus-context-path=/` line in the `$data-dir/etc/nexus.properties`. Here is an example where you expose the user interface to a `components` directory.

```
nexus-context-path=/components/
```

Therefore, if the port is set to `9081`, the exposed URL will be `http://localhost:9081/components/`.

## Configuring the Data Directory

You can use `$install-dir/bin/nexus.vmoptions` to define a new location for data you want to preserve. In the configuration file change the values of -`Dkaraf.data`, `-Djava.io.tmpdir`, `-Dkaraf.log` and `-XX:LogFile` to designate an absolute path you prefer to use. The *nexus* service will look to add the data directory to the absolute path that you configure. For example, to use the absolute path `/opt/sonatype-work/nexus3` change the values as follows:

```
-Dkaraf.data=/opt/sonatype-work/nexus3
-Djava.io.tmpdir=/opt/sonatype-work/nexus3/tmp
-XX:LogFile=/opt/sonatype-work/nexus3/log/jvm.log
-Dkaraf.log=/opt/sonatype-work/nexus3/log
```

## Configuring the Temporary Directory

Repository manager uses the Java virtual machine temporary directory for important runtime files.

The temporary directory is set to be inside of the Nexus Repository data directory at `$data-dir/tmp`. The advantage is file ownership and permissions can be isolated under a single directory tree.

If you wish to change the default temporary location, keep in mind the following requirements:

- the tmp directory requires `exec` permissions by the user owning the repository manager process. Do not use the `noexec` mount option on Linux for the location that contains the tmp directory. If `noexec` is set on the tmp directory, repository manager startup will fail with an `java.lang.UnsatisfiedLinkError` message of `failed to map segment from shared object: Operation not permitted `. If the repository manager docker image is being used, one may need to adjust the permissions on the host directory that's being mounted as a docker volume to allow execution. 
- do not manipulate any files put into the temp directory, especially when repository manager is running
- make sure the disk hosting the directory has at least 1GB free space

### To Change the Temporary Directory

1. Open `$install-dir/bin/nexus.vmoptions` in a text editor
2. Edit the line which contains `-Djava.io.tmpdir=../sonatype-work/nexus3/tmp`. The value can either be an absolute path or a path relative to the `$install-dir/bin` directory.
3. Save the file with permission and ownership of the user that will own the repository manager process.

​        

# Directories

 

 

After you extract the repository manager archive, two directories will appear:

**Installation directory**

This directory contains the Nexus Repository Manager application and all the required additional components such as Java libraries and configuration files. The name of the directory by default uses `nexus-` and is appended with the version name. In this section, and throughout the documentation, it is referred to as `$install-dir` in any code segments.

**Data directory**

This directory contains all the repositories, components and other data that are stored and managed by the repository manager. The default location  of the data directory is `../sonatype-work/nexus3` relative to the installation directory. In this section, and throughout the documentation, it is referred to as `$data-dir` in any code segments.

## Installation Directory

#### `LICENSE.txt` , `NOTICE.txt`

These are files that contain legal details about the license and copyright notices

#### `bin/`

This directory contains the **`nexus`** startup script itself as well as startup-related configuration files

#### `etc/`

This directory contains configuration files

#### `lib/`

This directory contains binary libraries related to Apache Karaf

#### `public/`

This directory contains public resources of the application

#### `system/`

This directory contains all components and plugins that constitute the application

## Data Directory

The data directory contents are unique to each instance and include  subdirectories that contain all the components, repositories,  configurations and other persistent data used by the repository manager.

The data directory is found by default at `../sonatype-work/nexus3`.

To change from the default location see the [Configuring the Data Directory section of the Configuring the Runtime Environment](https://help.sonatype.com/repomanager3/installation-and-upgrades/configuring-the-runtime-environment#ConfiguringtheRuntimeEnvironment-ConfiguringtheDataDirectory) page.

Files and directories under the data directory include:

#### `blobs/`

The parent directory of all file system based blob stores that are not  defined with an absolute storage path. For example, the default blob  store will live at `../sonatype-work/nexus3/blobs/default` .

#### `cache/`

This directory contains information on currently cached Karaf bundles

#### `db/`

This directory contains the OrientDB databases which are the primary storage for your repository manager’s metadata

#### `elasticsearch/`

This directory contains the currently configured state of Elasticsearch

#### `etc/`

This directory contains the main runtime configuration and customization of  the repository manager. The files are explained further in [Configuring the Runtime Environment](https://help.sonatype.com/repomanager3/installation-and-upgrades/configuring-the-runtime-environment).

#### `health-check/`

This directory contains cached reports from the Repository Health Check feature

#### `keystores/`

This contains the automatically generated key used to identify your repository manager

#### `log/`

This directory and sub-directories contain active and archived application log files.

You can choose to delete old log files from the logs directory to reclaim  disk. Only 90 days of rotated logs are automatically kept.

##### `nexus.log`

The main repository manager application log, rotated and compressed daily.  Log messages contain standard log output fields including date/time, log level, the associated thread, class and message.

##### `request.log`

Inbound HTTP request log, rotated and compressed daily. Log messages include  information such as date/time, client IP, authenticated user id,  user-agent header value, response status code, bytes sents, and total  response time.

##### `jvm.log`

Contains JVM stdout, stderr and full thread dumps when explicitly triggered. This  log file is normally only relevant when thread dumps need to be  extracted from it. This file is not rotated because it should not grow  very large. On each application start, the entire contents of this file  will be replaced.

##### `karaf.log`

This is the Apache Karaf container log file which contains messages specific to the repository manager startup

#### `log/audit/` 

When Auditing is enabled, audit logs are written to this directory.

##### audit.log

The active log file is named audit.log. Audit logs are rotated and compressed daily.

#### `log/tasks/`

Tasks can generate logs for each execution so that one can better examine  what that task did. These log files include messages that would  typically be too noisy to out into the main application log. Logs are  named by task internal name and a timestamp. See [Task Logging](https://help.sonatype.com/repomanager3/nexus-repository-administration/nodes#Nodes-TaskLogging) for more details about these files.

#### `tmp/`

This directory is used for temporary storage

 

Unless you specify a relative path, running *Export configuration & metadata for backup* task creates a folder with a snapshot of the databases, in the data directory. See [Prepare a Backup](https://help.sonatype.com/repomanager3/planning-your-implementation/backup-and-restore/prepare-a-backup) for the repository manager to learn how to configure this task.

# Post Install Checklist

After installing Nexus Repository, complete the tasks below to ensure your Nexus Repository instance's security.

## 1 - Change the Admin Password

To ensure the system begins with a secure state, Nexus Repository Manager  generates a unique random password during the system’s initial startup  which it writes to the data directory (`$data-dir`, typically `sonatype-work/nexus3`) in a file called `admin.password`.

To configure the system, the user must prove they’re the system owner by  retrieving the initial password from the filesystem. This password can  then be changed manually through the user interface, or programmatically through the REST API.

### Using the User Interface

Click the *Sign in* button in the top right of the page, until the initial password has  been changed the dialog that comes up will indicate the file path of a  file containing the password for the *admin* user.

![img](https://help.sonatype.com/repomanager3/files/5415431/30382197/1/1563396538801/8d870193fe34a9a59db35c416771dda724c2edd4.png)

The *admin* user will then be presented with a setup wizard which will assist the user in changing the admin password along with other initial system setup.

### Using the REST API

For systems that are provisioned programmatically we also provide a REST  API which can be used to change a user’s password. The provisioning  system must first read the randomly generated password from the  admin.password file.

## 2 - Configure Anonymous Access

When using the user interface another step in the wizard is configuring whether [anonymous access](https://help.sonatype.com/repomanager3/nexus-repository-administration/user-authentication/anonymous-access) is allowed in the system. Until configured the system will allow unauthenticated users to read the contents of repositories.

## 3 - Change the Administrative Email Address

The  *admin* user comes with a default email address configured and, since this address is not going to be very useful to anyone, see [Working with Your User Profile](https://help.sonatype.com/repomanager3/using-nexus-repository/working-with-your-user-profile) for details.

## 4 - Configure the SMTP Settings

The repository manager can send username and password recovery emails. To  enable this feature, you will need to configure a SMTP Host and Port as  well as any necessary authentication parameters that the repository  manager needs to connect to the mail server.

## 5 - Configure Default HTTP and HTTPS Proxy Settings

In many deployments the internet, and therefore any remote repositories  that the repository manager needs to proxy, can only be reached via a  HTTP or HTTPS proxy server internal to the deployment company. In these  cases the connection details to that proxy server need to be configured in order for the repository manager to be able to proxy remote repositories at all.

## 6 - Set Up a Backup Procedure for Your Server

Read and utilize [Backup and Restore](https://help.sonatype.com/repomanager3/planning-your-implementation/backup-and-restore). Things happen and it is always advisable to backup your configurations and data on a scheduled basis.

## 7 - Set Up Routing Rules

Set up [routing rules](https://help.sonatype.com/nxrm3master/nexus-repository-administration/repository-management/routing-rules) to prevent issues such as a name hijacking attack where a malicious  user creates packages in a registry with names used by your internal  projects.

## 8 - Require User Tokens for Repository Access PRO

Nexus Repository Pro users should consider configuring [token-based access](https://help.sonatype.com/repomanager3/nexus-repository-administration/user-authentication/security-setup-with-user-tokens). 

## 9 - Set Up Maintenance Tasks

You should set up the following essential maintenance tasks:

- [Maven - Delete unused SNAPSHOTS](https://help.sonatype.com/repomanager3/nexus-repository-administration/tasks#Tasks-Maven-DeleteunusedSNAPSHOT)
- [Docker - Delete incomplete uploads](https://help.sonatype.com/repomanager3/nexus-repository-administration/tasks#Tasks-Docker-Deleteincompleteuploads)
- [Admin - Compact blob store](https://help.sonatype.com/repomanager3/nexus-repository-administration/tasks#Tasks-Admin-Compactblobstore)

## 10 - Set Up Cleanup Policies

In your repository settings, set up [cleanup policies](https://help.sonatype.com/repomanager3/nexus-repository-administration/repository-management/cleanup-policies#CleanupPolicies-CleanupPolicies).

# Accessing the User Interface

Once the repository  manager is started, the application is listening on the configured IP  address range and port. By default any IP address and port 8081 are  used. To access the web application user interface, fire up a web  browser and type in the URL `http://<server_host>:<port>` e.g. `http://localhost:8081/`. If the repository manager started up successfully and network settings  allow you to connect to the server, the user interface looks similar to *Figure: “Initial User Interface”*.

![img](https://help.sonatype.com/repomanager3/files/5411782/16351759/1/1528754386889/Screen+Shot+2018-06-11+at+5.20.04+PM.png)
**Figure: "Initial User Interface"**

While the documentation uses `localhost` throughout, you may need to use the IP Loopback Address of `127.0.0.1`, the IP address or the DNS hostname assigned to the machine running the  repository manager. The user interface shows the features available to  an anonymous user. The repository manager installation includes an  administrative user with full access. Its username is *admin* and the initial password can be found in an `admin.password` file in the `$data-dir` directory. You can sign in with the button on the top right corner of the user interface.

Next steps after successfully accessing the user interface are detailed in [Using Nexus Repository](https://help.sonatype.com/repomanager3/using-nexus-repository), [Nexus Repository Administration](https://help.sonatype.com/repomanager3/nexus-repository-administration), and setting up whatever [Formats](https://help.sonatype.com/repomanager3/nexus-repository-administration/formats) you will use.

More information about security related topics can be found in [Access Control](https://help.sonatype.com/repomanager3/nexus-repository-administration/access-control).

# Migrating to a New Database

 

 

 

**Only available in Nexus Repository Pro. Interested in a free trial? [Start here](https://www.sonatype.com/products/repository-pro/trial).**

 

We highly recommend that you have your Nexus Repository 3 instance use an external PostgreSQL database. See our [documentation on configuring Nexus Repository Pro for an external PostgreSQL database](https://help.sonatype.com/repomanager3/installation-and-upgrades/configuring-nexus-repository-pro-for-h2-or-postgresql#ConfiguringNexusRepositoryProforH2orPostgreSQL-ConfiguringforExternalPostgreSQL) or on [migrating an existing Nexus Repository 3 instance to a PostgreSQL database](https://help.sonatype.com/repomanager3/installation-and-upgrades/migrating-to-a-new-database).

## Are You Ready to Migrate?

Checkpoint: Are You Ready to Migrate?

 

While migration is non-destructive (i.e., OrientDB still exists, and you can [manually revert back to OrientDB](https://help.sonatype.com/repomanager3/installation-and-upgrades/migrating-to-a-new-database#MigratingtoaNewDatabase-RevertingBacktoOrientDB)), the migration process is one-way: the Database Migrator can extract configuration and component metadata from OrientDB and move it to H2 or PostgreSQL, but not vice versa. Therefore, it is very important to  review the following questions to ensure you are ready to migrate before doing so:

1. Have you reviewed 

   [Feature Availability for PostgreSQL and H2 Databases](https://help.sonatype.com/repomanager3/planning-your-implementation/database-options/feature-availability-for-postgresql-and-h2-databases) to ensure that your new database supports all of your formats and to  see if any feature changes impact your Nexus Repository use? 

   1. Unsupported formats will not be migrated.
   2. You will not be able to add new formats that your new database does not support. 

2. Have you [backed up your blob storage](https://help.sonatype.com/repomanager3/planning-your-implementation/backup-and-restore/prepare-a-backup)? 

   1. Once you start your newly migrated Nexus Repository instance, database and blob storage contents will diverge. 
   2. If you end up needing to revert to OrientDB, it will require restoring the blob store(s) from backup.

3. If migrating from on-premises OrientDB to cloud PostgreSQL, have you  ensured that the Database Migrator can see both the on-premises file  system and new database? 

   1. The Database Migrator does not directly support on-premises OrientDB to cloud PostgreSQL migration. 
   2. It is your DevOps Engineer's responsibility to set up the underlying  architecture to ensure that the Database Migrator has this access before proceeding.

4. Are you aware that migration is a one-time process?

   1. Attempts to migrate again will overwrite data in the target database.

5. Have you ensured your migration environment meets the [Database Migrator utility's requirements](https://help.sonatype.com/repomanager3/installation-and-upgrades/migrating-to-a-new-database#MigratingtoaNewDatabase-MigrationEnvironmentRequirements)?

6. Have you performed a test migration using a test instance or backup of your production instance?

   1. Perform a test migration using a test instance or backup of your production instance
   2. If testing this process first, we do not recommend using instances which use S3/Azure blob stores;  your test instance may still point to production cloud storage locations and cause unintentional modification. 
   3. Similarly, any file-based blob stores should be a copy of production (i.e., not accessing the same file system).

## Migration Overview

Migration converts an existing offline Nexus Repository instance to a new  database mode. (This is different from the 2-to-3 upgrade wizard, which  moves content between two instances of Nexus Repository running in  parallel.)

During migration, component binaries are unaffected;  they are not moved or modified during migration. The migration process  only affects OrientDB's content (configuration and component metadata).

To carry out the actual migration, you will complete the following steps:

1. Upgrade Nexus Repository Pro to the  [latest release](https://help.sonatype.com/repomanager3/download) 
2. Provision an external PostgreSQL database (external mode only); ensure that it uses UTF8 encoding.
3. Obtain the Database Migrator utility, which you can download from [here](https://help.sonatype.com/repomanager3/product-information/download) 
4. Ensure you are using OpenJDK 8; the database migrator will not work with Oracle JDK
5. Perform a full backup using normal [backup](https://help.sonatype.com/repomanager3/planning-your-implementation/backup-and-restore) procedures
6. Shut down Nexus Repository
7. Run the migrator utility from `$data-dir/db`  [directory](https://help.sonatype.com/repomanager3/installation-and-upgrades/directories) 
8. Configure Nexus Repository to boot in the appropriate database mode
9. Restart Nexus Repository

These steps are explained in detail below.

##  Migration Environment Requirements

You must meet the following migrator utility requirements in order to have a successful migration: 

- You should be on the latest Nexus Repository version.

- The migrator utility requires OpenJDK8.

- The migrator utility requires access to the `$data-dir/db` directory. 

-   The migrator utility requires three times the disk space (minimum 10 GB) as your `$data-dir/db` directory.  

  - The migrator checks the `$data-dir/db` directory and a temporary directory location (`java.io.tmpdir`) to ensure both have at least 10 GB of space.

  - If the temporary directory does not have enough free space, you can do one of the following:

    - Add more space to the default temporary directory (`java.io.tmpdir`)

    - Change the temporary directory that the migration tool uses to a location  where there is more space by passing a command like the following to the migration tool:

      ```
      -Djava.io.tmpdir=/path/to/new/location/example
      ```

## Migrating to H2 

1. Using your system console, change directory to  `$data-dir/db`.

2. If migrating **from OrientDB**,   run the following command: (See [Optional Parameters](https://help.sonatype.com/repomanager3/installation-and-upgrades/migrating-to-a-new-database#MigratingtoaNewDatabase-OptionalParam) before running.)  

   ```
   java -Xmx4G -Xms4G -XX:MaxDirectMemorySize=4014M -jar /path/to/<migrator_utility>.jar --migration_type=h2
   ```

   If migrating **from PostgreSQL**, use the following command instead:  (See [Optional Parameters](https://help.sonatype.com/repomanager3/installation-and-upgrades/migrating-to-a-new-database#MigratingtoaNewDatabase-OptionalParam) before running.)

   NEW IN 3.35.0

   ```
   java -jar <Database_Migrator_JAR>.jar --migration_type=postgres_to_h2 --db_url="jdbc:postgresql://<database URL>:<port>/nexus?user=postgresUser&password=secretPassword&currentSchema=nexus"
   ```

   - ```
     --db_url="jdbc:postgresql://localhost:5432/nexus?user=postgresUser&password=secretPassword&currentSchema=nexus"
     ```

      – This is the URL to your Postgres database

     - `nexus` – database name

     - `user=postgresUser` – database user

     - `password=secretPassword `– database user password

     - `currentSchema=nexus` – example database schema (optional). 

        

       - Note that you must enter 2 dashes before the `migration_type` parameter.
       - You must wrap the `db_url` parameter value with double quotes and enter two dashes before the `db_url` parameter.

3. Edit the `$data-dir/etc/nexus.properties` file and add the following line:

   

   ```
   nexus.datastore.enabled=true
   ```

4.  If you are migrating to H2 from PostgreSQL, you must remove or rename the `nexus-store.properties` file you used for PostgreSQL so that Nexus Repository will not continue to try and boot to that properties file.

Your Nexus Repository instance will now start in H2 mode with a migrated H2 database.

## Migrating to PostgreSQL

 

The Database Migrator does not directly support on-premises OrientDB to  cloud PostgreSQL migration. Before using the Database Migrator, you need to ensure that it can see both locations (e.g., the on-premises file  system and new database). It is your DevOps Engineer's responsibility to set up the underlying architecture to ensure that the Database Migrator has this access before proceeding.

Reminder: You must have a Pro (licensed) instance to use this feature. Attempting this on an OSS (unlicensed)  instance may appear to function, but it will not fully succeed.

 

If using AWS Aurora as your database, you will need to include  `            gssEncMode=disable          `  as a query parameter of JDBC URL. 

1. In a PostgreSQL server, create a database called   `          nexus`. You may use an alternative name if desired, but this document will refer to the example provided.

    

   When creating your database, ensure it is set to use UTF8 as its character  set in order to be compatible with Nexus Repository's character set. For more information, see the [PostgreSQL documentation on setting your character set](https://www.postgresql.org/docs/current/multibyte.html#id-1.6.11.5.6).

   

2. In the `$data-dir/etc/fabric/`   directory,    create `nexus-store.properties`; below is a sample that you will need to update with the appropriate configuration. 

   ```
   username=<postgres_user>
   password=<postgres_password> 
   jdbcUrl=jdbc\:postgresql\://<database-host>\:<database-port>/nexus
   ```

    

   For versions 3.31.0 - 3.34.1, you will need the following additional properties in your `nexus-store.properties` file:

   ```
   name=nexus
   type=jdbc
   ```

3. Servers under heavy load may also need to configure the connection pool size  for the database. Nexus Repository uses a default pool of 100, but you  may increase this by appending a line like the following example to `nexus-store.properties`: 

   ```
   advanced=maximumPoolSize\=200
   ```

4. Edit the $`data-dir/etc/nexus.properties`  file and add the following line:

   ```
   nexus.datastore.enabled=true
   ```

5.   Using your system console, change directory to  `$data-dir/db`.

6. If migrating **from** **OrientDB**,  update and run the following command with the appropriate values for host, port, username, password and migrator utility jar file name: (See [Optional Parameters](https://help.sonatype.com/repomanager3/installation-and-upgrades/migrating-to-a-new-database#MigratingtoaNewDatabase-OptionalParam) before running.) 

   ```
   java -Xmx4G -Xms4G -XX:MaxDirectMemorySize=4014M \
   -jar /path/to/<migrator_utility>.jar \
   --migration_type=postgres \
   --db_url="jdbc:postgresql://<database URL>:<port>/nexus?user=<postgres_user>&password=<postgres_password>"
   ```

    

   If you use database names and schemas that do not match, you will need to add `¤tSchema=<name>` to the end of the line. See the following example:  

   ```
   --db_url="jdbc:postgresql://<database URL>:<port>/content?user=<postgres_user>&password=<postgres_password>&currentSchema=<name>"
   ```

   This is not expected to be a standard setup, so the variables are optional   . 

   
   If migrating **from** **H2** database, use the following command instead:  (See [Optional Parameters](https://help.sonatype.com/repomanager3/installation-and-upgrades/migrating-to-a-new-database#MigratingtoaNewDatabase-OptionalParam) before running.)

   ```
   java -Xmx4G -Xms4G -XX:MaxDirectMemorySize=4014M -jar <Database_Migrator_JAR>.jar --migration_type=h2_to_postgres --db_url="jdbc:postgresql://<database URL>:<port>/nexus?user=postgresUser&password=secretPassword&currentSchema=nexus"
   ```

   -  `--db_url="jdbc:postgresql://<database URL>:<port>/nexus?user=postgresUser&password=secretPassword¤tSchema=nexus"` – This is the URL to your Postgres database

     -  `nexus` – database name

     -  `user=postgresUser` – database user

     -  `password=secretPassword `– database user password

     -  `currentSchema=nexus` – example database schema (optional). 

       

    

   - Note that you must enter 2 dashes before the `migration_type` parameter.
   - You must wrap the `db_url` parameter value with double quotes and enter two dashes before the `db_url` parameter.

   

    

### Optional Parameters  

- - `-y` or `--yes` NEW IN 3.41.0 - Use this optional parameter to skip waiting for user input and assume a "yes" response to the prompt "Please ensure any Nexus Repository  instance has been gracefully shut down before proceeding. Do you want to continue?"
  - `--content_migration=false` – Use this parameter to disable content migration (optional); this is set to `          true        ` by default. This parameter disables repository migration so that only data from security and config tables (e.g., users, roles,  blobstore configuration, etc.) is migrated.
    - Note that you must enter two dashes before the `content_migration` parameter. 
  - `--shutdown_compact=false` – Use this parameter to enable or disable H2 Content DB compression (optional); this is set to true by default.
  -    `                  --healthcheck` – Use this parameter before migrating from OrientDB to run a health check on your OrientDB database (optional). This check will focus on detecting and reporting any existing corruption in component and asset classes.    

 

No migration will occur when you use the` --healthcheck `parameter; using this parameter will only return a report on your OrientDB  database's health. The command to run your health check should look like the following: 
`java -jar <nexus-db-migrator-version.jar> --healthcheck` 

The Database Migrator exports the OrientDB database to JSON files during  the migration process and then deletes these files. You can use the  following optional parameters to reuse these JSON files if the import to the target database finishes unexpectedly: 

- - `--save_migration_files` NEW IN 3.41.0 - Use this parameter if you would prefer to not delete exported Orient  JSON files (optional). You can use these files again without additional  export. 
  - `--migration_folder `NEW IN 3.41.0` `- Use this parameter to identify the absolute path to the folder where  previously exported Orient JSON files are stored (optional). This allows you to use these files again without additional export.

The following examples illustrate how to use the `save_migration_files` and `migration_folder` parameters and how to reuse the JSON files:

### Example 1 - Initial Migration Attempt

The following example attempts migration. OrientDB is exported to JSON files that will *not* be deleted. 

```
java -jar nexus-db-migrator-<version>.jar --migration_type=postgres --db_url='jdbc:postgresql://<databaseURL>' --content_migration=true --migrate_dev=true --save_migration_files
```

### Example 2 - Reuse Exported JSON Files

The following example attempts to import data to the target database from  the existing JSON files created during a previous migration attempt.  There is no export from OrientDB to JSON files.

```
java -jar nexus-db-migrator-<version>.jar --migration_type=postgres --db_url='jdbc:postgresql://<databaseURL>' --content_migration=true --migrate_dev=true --migration_folder=<absolute/path/to/folder/of/exported/JSONs>
```

## Determining Current Database

After migrating, you can confirm you are using the correct database by navigating to the *[Data Store](https://help.sonatype.com/repomanager3/nexus-repository-administration/repository-management/data-store)* screen at *Administration → Repository → Data Store*. Here you will see the JDBC URL for your current database. See the *[Data Store](https://help.sonatype.com/repomanager3/nexus-repository-administration/repository-management/data-store)* topic for more information.

 

Note that the *Data Store* screen only appears for those with a valid Nexus Repository Pro license who are using either an H2 or PostgreSQL database; it will not appear  for OSS deployments or any deployment using OrientDB.

If you are in an administrator account and do not see the *Data Store* option, you are either using an OSS license or using OrientDB. If this  is not what you were expecting, first confirm that you are using a valid Pro license.

If you are certain that you are using Nexus  Repository Pro or if you are using OSS and just want to confirm your  database, you can see if you are using OrientDB by looking at the *System Information* screen under *Support → System Information*; find the *nexus-properties* section, and check to see if `nexus.orient.enabled` is set to `true`. If it is, then you are using OrientDB.

## Reverting Back to OrientDB

The migration process is one-way: the migrator utility can extract configuration and component metadata from OrientDB and move it to H2 or PostgreSQL, but not vice versa. However, **migration is non-destructive**, and the OrientDB still exists as a restoration point until you delete it. 

 

Once you start a Nexus Repository instance, database and blob storage  contents will diverge. After this, reverting to Orient will require  restoring the blobstore(s) from backup.

If it is necessary to revert back to OrientDB, take the following steps:

1. Shut down Nexus Repository.

2.  Return to OrientDB mode by    editing the `$data-dir/etc/nexus.properties` file and remove the following line:

   ```
   nexus.datastore.enabled=true
   ```

3. Restart Nexus Repository.

This will bring Nexus Repository configuration and component metadata back to the point in time when the migration first took place. We recommend running the blob store reconciliation task after reverting to reconcile any changes to the blob store with the database. 

This doesn't undo any additions or deletions to binaries that you may have made since the migration.

## Restoring a Pre-Migration Backup

If you need to restore a particular backup from before migration to  PostgreSQL, you would need to set up a new PostgreSQL instance. Unzip  the backup file into a location, and ensure that the Database Migrator  can see both locations (i.e., where you unzipped the backup file and the new database location). Run the Database Migrator on the .bak files to  migrate the data to the second database. Finally, point your Nexus Repository instance to the new database.

# Configuring Nexus Repository Pro for H2 or PostgreSQL

 

**Only available in Nexus Repository Pro. Interested in a free trial? [Start here](https://www.sonatype.com/products/repository-pro/trial).** 

If you're standing up a new instance of Nexus Repository Pro and wish to  begin in a new database mode, follow these instructions:

## Installing Nexus Repository Pro

1. [ Download ](https://help.sonatype.com/repomanager3/download)the latest Nexus Repository 3 version
2. Expand and install the archive as with the standard [installation instructions ](https://help.sonatype.com/repomanager3/installation/installation-methods)
3. Follow the instructions for your chosen database

## Configuring for the Embedded H2

 Create the `<data-dir>/etc/nexus.properties` file and add the following line: 

```
nexus.datastore.enabled=true
```

You can now start your Nexus Repository instance and use an embedded H2 database.

## Configuring for External PostgreSQL (Preferred)

 

Before proceeding, see the [System Requirements for H2 and PostgreSQL Databases](https://help.sonatype.com/repomanager3/product-information/system-requirements-for-h2-and-postgresql-databases) and ensure you have the required [trigram module installed](https://help.sonatype.com/repomanager3/product-information/system-requirements-for-h2-and-postgresql-databases#SystemRequirementsforH2andPostgreSQLDatabases-trigram).



To use an external PostgreSQL database, follow these additional instructions:

1. Create a database in a PostgreSQL server

    

   When creating your database, ensure it is set to use UTF8 as its character  set in order to be compatible with Nexus Repository's character set. For more information, see the [PostgreSQL documentation on setting your character set](https://www.postgresql.org/docs/current/multibyte.html#id-1.6.11.5.6).

    

2. Create the    `<data-dir>/etc/nexus.properties` file.   Add a property to enable external database access:
    

   ```
   nexus.datastore.enabled=true
   ```

3. On first run only, add the following line, replacing the placeholders with the appropriate filepath to point to your valid Pro license:

   ```
   nexus.licenseFile=/path/to/your/sonatype-license.lic
   ```

4. Create a `<data-dir>/etc/fabric` directory

5. In the `<data-dir>/etc/fabric` directory,  create a text file named `nexus-store.properties` 

   1.  Below is a sample `nexus-store.properties` that you will need to update with the appropriate configuration. 

      ```
      username=<postgres_user>
      password=<postgres_password>
      jdbcUrl=jdbc\:postgresql\://<database-host>\:<database-port>/<database-name>
      ```

      Note that the JDBC URL format outside of the` nexus-store.properties` is in the following format (without the backslashes in the `nexus-store.properties` file):` jdbc:postgresql://<database-host>:<database-port>/<database-name>`

       

      If using AWS Aurora as your database, you will need to include `        gssEncMode=disable      ` as a query parameter of the JDBC URL.

   2.  Note that you can also use the following JVM arguments to specify connection information; you can also specify these in the  `sonatype-work/nexus3/etc/nexus.properties` file without the preceding `-D`:

      - -Dnexus.datastore.enabled
      - -Dnexus.datastore.nexus.jdbcUrl
      - -Dnexus.datastore.nexus.username 
      - -Dnexus.datastore.nexus.password

   3. You can also pass the following connectivity details as environment variables:

      - `NEXUS_DATASTORE_NEXUS_JDBCURL`
      - `NEXUS_DATASTORE_NEXUS_USERNAME`
      - `NEXUS_DATASTORE_NEXUS_PASSWORD`

   4.  Nexus Repository uses the system and environment variables to populate the `nexus-store.properties` file; so, configuration via these methods can only be done once. The priority order is as follows:

      - sonatype-work/nexus3/etc/fabric/nexus-store.properties
      - System Properties
      - Environment variables

You can now start your Nexus Repository instance and use a PostgreSQL database.

### Extra Configuration Options for PostgreSQL

Servers under heavy load may also need to configure the connection pool size  for the database. Nexus Repository uses a default pool of 100, but you  may increase this by appending a line like the following example to `nexus-store.properties` :

```
username=<postgres_user>
password=<postgres_password>
jdbcUrl=jdbc\:postgresql\://<database-host>\:<database-port>/<database-name>
advanced=maximumPoolSize\=200
```

If you use a container orchestration tool, relational database service, or other infrastructure to launch Nexus Repository, you should configure your `maxLifetime` for database connections.

Ensure your `maxLifetime` is set to be several seconds shorter than your infrastructure-imposed connection time limit.

By default, `maxLifetime` is set to 30 minutes (1800000ms), but you may change this by appending a line like the following example to your `nexus-store.properties` file:

```
username=<postgres_user>
password=<postgres_password>
jdbcUrl=jdbc\:postgresql\://<database-host>\:<database-port>/<database-name>
advanced=maxLifetime\=840000
```

## How Does Nexus Repository Pro Determine Which Database To Use

If you've omitted `nexus.datastore.enabled` or set it to `false`, then Nexus Repository will use OrientDB.

If you've configured `nexus.datastore.enabled=true`, then Nexus Repository determines which database it is meant to use based on the configuration source. 

 Nexus Repository Pro will look for configuration information from `<data-dir>/etc/fabric/` `nexus-store.properties` before falling back to the embedded database, which is H2.  

# Upgrading a Standalone Instance

 

 

Upgrading Nexus Repository Manager presents a necessary step to gain access to  new features, bug fixes, performance improvements and other advantages.  Regular updates to the latest release are recommended as a general best  practice. Version 3 upgrades will only work from version 3.0.0 milestone 7 and later.

## Before Upgrading

Review [release notes](https://help.sonatype.com/repomanager3/product-information/release-notes) to understand any important or breaking changes. If using Nexus Lifecycle features, ensure that your new version [will be compatible](https://help.sonatype.com/iqserver/product-information/download-and-compatibility).

Become familiar with [the basic directory structure of a Nexus Repository Manager installation](https://help.sonatype.com/repomanager3/installation-and-upgrades/directories). You are encouraged to stick with the standard installation layout to make future upgrades as simple as possible.

You will have to [determine your existing installation data directory location](https://support.sonatype.com/hc/articles/218707647). Record this value for later use.

If you are using the embedded OrientDB, databases will be checkpointed automatically to the data directory `upgrades` directory during upgrade. The databases are compressed but still may  consume a lot of disk space, equivalent to the size of the database  backups produced by the [Admin - Export databases for backup](https://help.sonatype.com/repomanager3/planning-your-implementation/backup-and-restore/configure-and-run-the-backup-task) task. Ensure you have adequate free space for the checkpointed databases before upgrade.

## Download the Latest Installer Archive

Download the latest installer archive for your platform from [the official downloads](https://help.sonatype.com/repomanager3/product-information/download).

Extract the newest downloaded distribution archive [using the standard approach](https://support.sonatype.com/hc/en-us/articles/231740007).

## Preparing to Upgrade

The archive distribution offers the familiar process of downloading and  simply extracting the install archive in place. There is no graphical or automated process and all commands are done inside a terminal console.

```
tar xzvf nexus-<version-number>-mac.tgz
tar xzvf nexus-<version-number>-unix.tar.gz
7za.exe nexus-<version-number>-win64.zip
```

Compare the `nexus-<version-number>/bin/nexus.vmoptions` file with your existing version.

 

Important notes regarding impacts of certain changes you may have made:

- If you changed the default location of the Data Directory (sonatype-work by default)

  , then edit 

  ```
  ./bin/nexus.vmoptions
  ```

   and change the line 

  ```
  -Dkaraf.data=../sonatype-work/nexus3
  ```

   to point to your existing data directory.

  - Example: `-Dkaraf.data=/app/nexus3/data`
  - **You will also need to change the location of these 4 values**: -`Dkaraf.data`, `-Djava.io.tmpdir`, `-Dkaraf.log` and `-XX:LogFile` 

- **If you changed the default location of the temporary directory,** then edit `./bin/nexus.vmoptions` and replace the line `-Djava.io.tmpdir=../sonatype-work/nexus3/tmp` to point to your preferred temporary directory.

- **If you adjusted the default Java virtual machine max heap memory**, then edit `./bin/nexus.vmoptions` and edit the line containing `-Xmx` accordingly.

- **If you have enabled jetty HTTPS access**, make sure your `etc/jetty/jetty-https.xml` SSL keystore location is still available to the new install and configured according to our recommendations.

- **If you manually adjusted any other install files under `./etc`** you will need to manually perform a diff between the old files and the new  files and apply your changes if applicable to the new version.

## Perform the Upgrade

1. Ensure you have taken recent backups of the existing Data Directory and any custom blobstore locations [according to our recommended practices](https://help.sonatype.com/repomanager3/planning-your-implementation/backup-and-restore).  Because of involved Upgrade steps, downgrading a Nexus Repository version is **not supported** and will almost always result in failures.  If you have issues, restore from this backup instead.
2. Stop your existing install using the scripts under `./bin` or [your operating system service](https://help.sonatype.com/repomanager3/installation-and-upgrades/run-as-a-service). Make sure it stops completely.
3. Start the new installation using the scripts under `./bin` or [adjust your operating system service to use these scripts](https://help.sonatype.com/repomanager3/installation-and-upgrades/run-as-a-service).
4. Review the log files for any possible issues and sign-in to the server to confirm things are working as expected.

# Migrating an Existing Nexus Repository Instance to a Resiliency Architecture

Migrating an existing Nexus Repository instance to a [resilient architecture](https://help.sonatype.com/repomanager3/planning-your-implementation/resiliency-and-high-availability) requires migrating to a PostgreSQL database (preferably cloud-based)  and then migrating your blobs before setting up the architecture  outlined in one of our [resilient deployment examples](https://help.sonatype.com/repomanager3/planning-your-implementation/resiliency-and-high-availability).

The sections below describe the necessary steps for migrating.

## Prerequisite: Migrating to a PostgreSQL Database

Regardless of whether you are migrating from on-premises to on-premises or  migrating to the cloud, you will need to be using a PostgreSQL database  to use any of our resilient deployment options. If you are migrating to  the cloud, you can migrate to AWS Aurora or RDS PostgreSQL, Azure  Database for PostgreSQL, or any self-hosted PostgreSQL database in your  cloud environment.

 

The Database Migrator utility available in our [Download section](https://help.sonatype.com/repomanager3/product-information/download) and described in our [help documentation for migrating to PostgreSQL](https://help.sonatype.com/repomanager3/installation-and-upgrades/migrating-to-a-new-database#MigratingtoaNewDatabase-MigratingtoPostgreSQL) does not directly support migrating from an on-premises OrientDB to a  cloud PostgreSQL database. Before using the Database Migrator, you need  to ensure that it can see both locations (e.g., the on-premises file  system and new database). It is your DevOps Engineer's responsibility to set up the underlying architecture to ensure migrator has this access  before proceeding.

If your existing instance is using OrientDB or H2, you will first need to follow [these instructions for migrating to PostgreSQL](https://help.sonatype.com/repomanager3/installation-and-upgrades/migrating-to-a-new-database#MigratingtoaNewDatabase-MigratingtoPostgreSQL).

## Migrating an On-Premises Single Nexus Repository Instance to an On-Premises Resilient Deployment

To migrate from an on-premises single Nexus Repository instance to an  on-premises resilient deployment, complete the following steps:

\1. First, [migrate to a PostgreSQL database](https://help.sonatype.com/repomanager3/installation-and-upgrades/migrating-to-a-new-database#MigratingtoaNewDatabase-MigratingtoPostgreSQL).

\2. After migration, ensure that you have database scheduled backups  configured; if not, you should kick this off manually and consider  scheduling backups.

 

PostgreSQL backups take place outside of Nexus Repository and are not covered in our documentation. See [PostgreSQL documentation](https://www.postgresql.org/docs/current/backup.html) for more information.

\3. After migrating your database, follow the instructions for setting up the architecture in our [Single Data Center On-Premises Deployment Example Using Kubernetes](https://help.sonatype.com/repomanager3/planning-your-implementation/resiliency-and-high-availability/single-data-center-on-premises-deployment-example-using-kubernetes).

## Migrating a Single Cloud Nexus Repository Instance to a Resilient Cloud Deployment (AWS/Azure)

 

If you need to migrate multiple Terabytes of blob data, you should consult directly with AWS or Azure for guidance to avoid prolonged downtime.

To migrate from a single cloud Nexus Repository instance to a resilient  cloud deployment using AWS or Azure, complete the following steps:

\1. First, [migrate to a PostgreSQL database](https://help.sonatype.com/repomanager3/installation-and-upgrades/migrating-to-a-new-database#MigratingtoaNewDatabase-MigratingtoPostgreSQL). (You can migrate to AWS Aurora or RDS PostgreSQL, Azure Database for  PostgreSQL, or any self-hosted PostgreSQL database in your cloud  environment.)

\2. After migration, ensure that you have database scheduled backups  configured; if not, you should kick this off manually and consider  scheduling backups.

 

PostgreSQL backups take place outside of Nexus Repository and are not covered in our documentation. See [PostgreSQL documentation](https://www.postgresql.org/docs/current/backup.html) for more information.

\3. Move blobs to either Amazon Simple Storage Service (S3) or Azure Blob:

 

Before proceeding, you should ensure you have [backed up your blob store](https://help.sonatype.com/repomanager3/planning-your-implementation/backup-and-restore/prepare-a-backup#PrepareaBackup-BlobStoreBackup).

a. **Moving to Amazon S3** - Migrating from file blob storage to Amazon S3 requires copying blobs to S3 using a tool such as [AWS DataSync](https://aws.amazon.com/datasync/). Amazon provides [documentation](https://docs.aws.amazon.com/datasync/latest/userguide/what-is-datasync.html) for using DataSync to move data between other storage systems and AWS storage services.

b. **Moving to Azure Blob** - In order to migrate to Azure Blob, you must copy blobs to Azure Blob using a tool such as [AzCopy](https://docs.microsoft.com/en-us/azure/storage/common/storage-use-azcopy-v10). Microsoft provides [documentation](https://docs.microsoft.com/en-us/azure/storage/common/storage-use-azcopy-blobs-upload?toc=%2Fazure%2Fstorage%2Fblobs%2Ftoc.json) for using AzCopy to move data to and from Azure Blob.

\4. After migrating your database and blob store, refer to to [Single-Node Cloud Resilient Deployment Example Using AWS](https://help.sonatype.com/repomanager3/planning-your-implementation/resiliency-and-high-availability/single-node-cloud-resilient-deployment-example-using-aws) or [Single-Node Cloud Resilient Deployment Example Using Azure](https://help.sonatype.com/repomanager3/planning-your-implementation/resiliency-and-high-availability/single-node-cloud-resilient-deployment-example-using-azure) for instructions on setting up the resilient architecture.

## Migrating an On-Premises Single Nexus Repository Instance to a Resilient Cloud Deployment (AWS/Azure)

 

If you need to migrate multiple Terabytes of blob data, you should consult directly with AWS or Azure for guidance to avoid prolonged downtime.

To migrate from a single on-premises Nexus Repository instance to a  resilient cloud deployment using AWS or Azure, complete the following  steps:

\1. First, [migrate your database](https://help.sonatype.com/repomanager3/installation-and-upgrades/migrating-to-a-new-database#MigratingtoaNewDatabase-MigratingtoPostgreSQL) to Aurora PostgreSQL or Azure Database for PostgreSQL.

 

The Database Migrator does not directly support on-premises OrientDB to  cloud PostgreSQL migration. Before using the Database Migrator, you need to ensure that it can see both locations (e.g., the on-premises file  system and new database). It is your DevOps Engineer's responsibility to set up the underlying architecture to ensure that the Database Migrator has this access before proceeding.

\2. After migration, ensure that you have database scheduled backups  configured; if not, you should kick this off manually and consider  scheduling backups.

 

PostgreSQL backups take place outside of Nexus Repository and are not covered in our documentation. See [PostgreSQL documentation](https://www.postgresql.org/docs/current/backup.html) for more information.

\3. Move blobs to either Amazon Simple Storage Service (S3) or Azure Blob:

 

Before proceeding, you should ensure you have [backed up your blob store](https://help.sonatype.com/repomanager3/planning-your-implementation/backup-and-restore/prepare-a-backup#PrepareaBackup-BlobStoreBackup).

a. **Moving to Amazon S3** - Migrating from file blob storage to Amazon S3 requires copying blobs to S3 using a tool such as [AWS DataSync](https://aws.amazon.com/datasync/). Amazon provides [documentation](https://docs.aws.amazon.com/datasync/latest/userguide/what-is-datasync.html) for using DataSync to move data between other storage systems and AWS storage services.

b. **Moving to Azure Blob** - In order to migrate to Azure Blob, you must copy blobs to Azure Blob using a tool such as [AzCopy](https://docs.microsoft.com/en-us/azure/storage/common/storage-use-azcopy-v10). Microsoft provides [documentation](https://docs.microsoft.com/en-us/azure/storage/common/storage-use-azcopy-blobs-upload?toc=%2Fazure%2Fstorage%2Fblobs%2Ftoc.json) for using AzCopy to move data to and from Azure Blob.

\4. After migrating your database and blob store, refer to [Single-Node Cloud Resilient Deployment Example Using AWS](https://help.sonatype.com/repomanager3/planning-your-implementation/resiliency-and-high-availability/single-node-cloud-resilient-deployment-example-using-aws) or [Single-Node Cloud Resilient Deployment Example Using Azure](https://help.sonatype.com/repomanager3/planning-your-implementation/resiliency-and-high-availability/single-node-cloud-resilient-deployment-example-using-azure) for instructions on setting up the resilient architecture.

# Minimally Compatible Server Versions for Lifecycle Features

Below is a matrix of Sonatype server product versions minimally **verified for Lifecycle features**. This does not mean all features are supported by these versions.

The table is suggesting that major issues should not be encountered running these minimal versions congruently.

If you encounter problems with any of the versions listed, we advise  upgrading to the most recent version first to attempt resolution of the  issue.

| Version 2 | Version 3 | Minimum Lifecycle Firewall compatible IQ Server |
| --------- | --------- | ----------------------------------------------- |
|           | 3.30.0    | 106                                             |
| 2.14.8    | 3.12.1    | 1.46.0                                          |
| 2.14.6    | 3.8.0     | 1.42.0                                          |
| 2.14.5    | 3.7.1     | 1.33.0                                          |
| 2.14.4    | 3.4.0     | Not Supported                                   |

# Upgrading from Nexus Repository Manager 2

Nexus Repository 3 is a complete redesign of  the repository manager and does not include any legacy code from Nexus  Repository 2. 

While Nexus Repository 2 was based on a Maven repository design that was dependant on how components were  stored on the file system, Nexus Repository 3 uses blob storage, moving  away from the idea of a repository being a folder in a file system. This makes Nexus Repository 3 far more scalable to different ecosystems and  deployment environments, avoiding the file system limitations that some  Nexus Repository 2 deployments encountered with flat directories  containing tens of thousands of components common in some repositories.

Upgrading from Nexus Repository 2 to Nexus Repository 3 requires creating an upgrade plan:

1. Begin by 

   Determining and Planning Your Upgrade Path

   1. [Built-in Upgrade Wizard](https://help.sonatype.com/repomanager3/installation-and-upgrades/upgrading-from-nexus-repository-manager-2/nexus-repository-3-upgrade-wizard) (Always Preferred)
   2. [Manual Import/Export](https://help.sonatype.com/repomanager3/installation-and-upgrades/upgrading-from-nexus-repository-manager-2/manual-upgrade-methods#ManualUpgradeMethods-Export/ImportManualUpgradeMethodBluePROexportimport) (Preferred if Cannot Use Wizard)
   3. [Manually Proxying Old Repositories](https://help.sonatype.com/repomanager3/installation-and-upgrades/upgrading-from-nexus-repository-manager-2/manual-upgrade-methods#ManualUpgradeMethods-StepsfortheProxyingRepositoriesManualUpgradeMethod)

2. Understand [Nexus Repository 2 vs. Nexus Repository 3 feature equivalency](https://help.sonatype.com/repomanager3/installation-and-upgrades/upgrading-from-nexus-repository-manager-2/nexus-repository-2-vs.-nexus-repository-3-feature-equivalency-matrix)

3. Consider any [IQ Server](https://help.sonatype.com/repomanager3/installation-and-upgrades/upgrading-from-nexus-repository-manager-2/determining-and-planning-your-upgrade-path#DeterminingandPlanningYourUpgradePath-AreYouUsingIQServer?IQ) or [Firewall integration impacts](https://help.sonatype.com/repomanager3/installation-and-upgrades/upgrading-from-nexus-repository-manager-2/determining-and-planning-your-upgrade-path#DeterminingandPlanningYourUpgradePath-AreYouUsingNexusFirewall?firewall), especially if using a manual method

4. Plan to replace custom plugins and scripts using the Nexus Repository 3 API 

5. If not already complete, upgrade your Nexus Repository 2 instance to the latest Nexus Repository version using [these instructions](https://support.sonatype.com/hc/en-us/articles/213464138?_ga=2.18566265.1925118275.1667825797-986364695.1656691738&_gac=1.182528468.1667572342.CjwKCAjw8JKbBhBYEiwAs3sxN48e7FmEPe_zEoJ4YRsGq1rT_X6zY5yQxB--1Z-tcSq5FjyTb4PwjxoCZKgQAvD_BwE)

6. If using the Upgrade Wizard,

    

   decide on a data transfer method

   1. Whether using the Upgrade Wizard or Import, hard linking is always preferred;  consider if you can remove any barriers to hard linking

7. If using the Upgrade Wizard, complete [optimization steps](https://help.sonatype.com/repomanager3/installation-and-upgrades/upgrading-from-nexus-repository-manager-2/nexus-repository-3-upgrade-wizard/optimizing-upgrade-performance)

8. Ensure you meet all prerequisites

   1. [Upgrade Wizard Prerequisites ](https://help.sonatype.com/repomanager3/installation-and-upgrades/upgrading-from-nexus-repository-manager-2/nexus-repository-3-upgrade-wizard/prerequisites-for-upgrading-from-nexus-repository-2-to-nexus-repository-3)
   2. [Manual Method Prerequisites](https://help.sonatype.com/repomanager3/installation-and-upgrades/upgrading-from-nexus-repository-manager-2/manual-upgrade-methods#ManualUpgradeMethods-Prerequisites)

Once you have made the above decisions and created a plan, you are ready to upgrade!

 

Nexus Repository Pro customers can also take advantage of support team assistance.

# Nexus Repository 2 vs. Nexus Repository 3 Feature Equivalency Matrix

Nexus Repository 3 represents a complete rewrite of architecture and  functionality. Some features from Nexus Repository 2 are no longer  available in Nexus Repository 3. The matrix below provides details about features that have been replaced or removed in Nexus Repository 3.

| Repository 2 Feature                      |                   Repository 3 Equivalent                    | Note                                                         |
| ----------------------------------------- | :----------------------------------------------------------: | ------------------------------------------------------------ |
| Server Settings                           | ![(滴答)](https://help.sonatype.com/s/-scv42a/8703/51k4y0/_/images/icons/emoticons/check.svg) Yes | These are settings under *Administration* → *Server* in Nexus Repository 2 |
| Security                                  | ![(滴答)](https://help.sonatype.com/s/-scv42a/8703/51k4y0/_/images/icons/emoticons/check.svg) Yes | Please refer to the [Security](https://help.sonatype.com/display/NXRM3/Security) section |
| Local User Accounts                       | ![(滴答)](https://help.sonatype.com/s/-scv42a/8703/51k4y0/_/images/icons/emoticons/check.svg) Yes |                                                              |
| Privileges                                | ![(滴答)](https://help.sonatype.com/s/-scv42a/8703/51k4y0/_/images/icons/emoticons/check.svg) Yes | Names may change on upgrade from Nexus Repository 2 to 3. Note that  transitive group privileges are implemented differently in Nexus  Repository 2 and 3:In Nexus Repository 2, when a user is given a privilege to a group  repository, then that user will also have that privilege to all  transitive members of that group repository.  This  permission access applies even if the HTTP requests are sent directly to the member repositories rather than the group repository.  As repositories are added to or removed from a group, the user may gain or lose access to those individual repositories. (See more in  [this Nexus Repository 2 support article](https://support.sonatype.com/hc/en-us/articles/221279107?_ga=2.108313093.609935302.1662465096-1261099841.1662465096) .)  In Nexus Repository 3, when a user is given a privilege to a group  repository, then that user will also have that privilege to all  transitive members of that group repository **only when their request is directed to the group repository**. Direct requests to indvidual member repositories will only work if the  user is given explicit permission to the individual repository.  The Upgrade Wizard does not detect this difference. After upgrading from  Nexus Repository 2 to 3, you may need to manually assign privileges for  individual repositories to a subset of users. |
| Roles                                     | ![(滴答)](https://help.sonatype.com/s/-scv42a/8703/51k4y0/_/images/icons/emoticons/check.svg) Yes |                                                              |
| Maven Repositories                        | ![(滴答)](https://help.sonatype.com/s/-scv42a/8703/51k4y0/_/images/icons/emoticons/check.svg) Yes |                                                              |
| Proxy Repository of `maven.oracle.com`    | ![(滴答)](https://help.sonatype.com/s/-scv42a/8703/51k4y0/_/images/icons/emoticons/check.svg) Yes | [See KB article to help getting this configured](https://support.sonatype.com/hc/en-us/articles/213465728) |
| Browse Remote                             | ![(出错)](https://help.sonatype.com/s/-scv42a/8703/51k4y0/_/images/icons/emoticons/error.svg) No |                                                              |
| Repository Targets                        | ![(滴答)](https://help.sonatype.com/s/-scv42a/8703/51k4y0/_/images/icons/emoticons/check.svg) Yes | Maps to [content selectors](https://help.sonatype.com/repomanager3/nexus-repository-administration/repository-management#RepositoryManagement-ContentSelectors) |
| Manual Routing Rules                      | ![(滴答)](https://help.sonatype.com/s/-scv42a/8703/51k4y0/_/images/icons/emoticons/check.svg) Yes | See [Routing Rules](https://help.sonatype.com/repomanager3/nexus-repository-administration/repository-management/routing-rules) |
| Maven Settings                            | ![(出错)](https://help.sonatype.com/s/-scv42a/8703/51k4y0/_/images/icons/emoticons/error.svg) No |                                                              |
| Automatic Routing                         | ![(出错)](https://help.sonatype.com/s/-scv42a/8703/51k4y0/_/images/icons/emoticons/error.svg) No | We will consider similar optimization features like this in the future as warranted. |
| Smart Proxy                               | ![(出错)](https://help.sonatype.com/s/-scv42a/8703/51k4y0/_/images/icons/emoticons/error.svg) No | We are planning a set of instance-to-instance replication features. |
| Procurement                               | ![(滴答)](https://help.sonatype.com/s/-scv42a/8703/51k4y0/_/images/icons/emoticons/check.svg) Yes | The Procurement feature, which is limited to Maven in Nexus Repository 2, has been deprecated. Going forward, Sonatype's [Nexus Firewall](https://www.sonatype.com/nexus-firewall) solution provides a far more robust and comprehensive set of features aimed at managing risky components via your repository. |
| Staging                                   | ![(滴答)](https://help.sonatype.com/s/-scv42a/8703/51k4y0/_/images/icons/emoticons/check.svg) Yes | Nexus Repository 2.x Staging has been replaced with a more robust solution that relies on  component tagging to manage workflow. See our Nexus Repository 3 [Staging topic](https://help.sonatype.com/repomanager3/nexus-repository-administration/staging) for details. |
| Custom Metadata                           | ![(滴答)](https://help.sonatype.com/s/-scv42a/8703/51k4y0/_/images/icons/emoticons/check.svg) Yes | Nexus Repository 3 has the ability to associate arbitrary data with any component in any repository format via it's [tagging](https://help.sonatype.com/repomanager3/nexus-repository-administration/tagging) feature. However, there is no automated way to migrate Nexus Repository 2 [custom metadata](https://support.sonatype.com/hc/en-us/articles/213465338-How-can-I-add-additional-metadata-to-an-artifact-stored-in-Nexus-?_ga=2.262676298.717644679.1669834604-291822469.1668525051). |
| YUM Repositories                          | ![(滴答)](https://help.sonatype.com/s/-scv42a/8703/51k4y0/_/images/icons/emoticons/check.svg) Yes | [YUM](https://help.sonatype.com/repomanager3/nexus-repository-administration/formats/yum-repositories) proxy support is included in the Nexus Repository   3.5.0 release and hosted support is included in the Nexus Repository 3.8.0 release. Feature was completed in 3.11.0. |
| p2 and p2 Update Site Repositories        | ![(滴答)](https://help.sonatype.com/s/-scv42a/8703/51k4y0/_/images/icons/emoticons/check.svg) Yes |                                                              |
| RubyGems Repositories                     | ![(滴答)](https://help.sonatype.com/s/-scv42a/8703/51k4y0/_/images/icons/emoticons/check.svg) Yes |                                                              |
| PyPI Repositories                         | ![(滴答)](https://help.sonatype.com/s/-scv42a/8703/51k4y0/_/images/icons/emoticons/check.svg) Yes |                                                              |
| npm Repositories                          | ![(滴答)](https://help.sonatype.com/s/-scv42a/8703/51k4y0/_/images/icons/emoticons/check.svg) Yes |                                                              |
| NuGet Repositories                        | ![(滴答)](https://help.sonatype.com/s/-scv42a/8703/51k4y0/_/images/icons/emoticons/check.svg) Yes |                                                              |
| NuGet API Keys                            | ![(滴答)](https://help.sonatype.com/s/-scv42a/8703/51k4y0/_/images/icons/emoticons/check.svg) Yes |                                                              |
| Bower Repositories                        | ![(滴答)](https://help.sonatype.com/s/-scv42a/8703/51k4y0/_/images/icons/emoticons/check.svg) Yes |                                                              |
| Site Repositories                         | ![(滴答)](https://help.sonatype.com/s/-scv42a/8703/51k4y0/_/images/icons/emoticons/check.svg) Yes | This is called Raw repository format in Nexus Repository 3   |
| System Feeds                              | ![(出错)](https://help.sonatype.com/s/-scv42a/8703/51k4y0/_/images/icons/emoticons/error.svg) No | We have no plans to upgrade System Feeds as the data is specific to the  instance where it was generated. Near equivalent functionality is  available through [auditing](https://help.sonatype.com/repomanager3/nexus-repository-administration/auditing) and [webhooks](https://help.sonatype.com/repomanager3/integrations/webhooks). |
| Branding                                  | ![(滴答)](https://help.sonatype.com/s/-scv42a/8703/51k4y0/_/images/icons/emoticons/check.svg) Yes | The Nexus Repository  2 branding configuration will not be upgraded automatically. Nexus Repository 3 uses the [Branding capability](https://help.sonatype.com/repomanager3/nexus-repository-administration/capabilities/branding-capability). |
| REST API                                  | ![(滴答)](https://help.sonatype.com/s/-scv42a/8703/51k4y0/_/images/icons/emoticons/check.svg) Yes | See the Nexus Repository 3 [REST API documentation](https://help.sonatype.com/repomanager3/integrations/rest-and-integration-api).  Note that Nexus Repository 2 REST APIs are not compatible with Nexus Repository 3. |
| Non-Sonatype Repository Plugins           | ![(出错)](https://help.sonatype.com/s/-scv42a/8703/51k4y0/_/images/icons/emoticons/error.svg) No | Nexus Repository 2 plugins are not compatible with Nexus Repository 3 OSGI bundle architecture |
| SSL Certificates                          | ![(滴答)](https://help.sonatype.com/s/-scv42a/8703/51k4y0/_/images/icons/emoticons/check.svg) Yes | SSL certificates trusted in the UI will be upgraded, but not all of them  may be applicable to a new server. Trusted certificates should be  reviewed after your upgrade. The Upgrade Wizard does not automatically migrate the certificate that Nexus Repository uses for its own HTTPS connection. |
| Analytics                                 | ![(出错)](https://help.sonatype.com/s/-scv42a/8703/51k4y0/_/images/icons/emoticons/error.svg) No | This little-used feature was removed in 3.15.                |
| LDAP                                      | ![(滴答)](https://help.sonatype.com/s/-scv42a/8703/51k4y0/_/images/icons/emoticons/check.svg) Yes |                                                              |
| Nexus Repository OSS Servers              | ![(滴答)](https://help.sonatype.com/s/-scv42a/8703/51k4y0/_/images/icons/emoticons/check.svg) Yes |                                                              |
| Nexus Repository Pro (Enterprise) Servers | ![(滴答)](https://help.sonatype.com/s/-scv42a/8703/51k4y0/_/images/icons/emoticons/check.svg) Yes | Individual LDAP Server configurations will be upgraded. Backup Mirror servers will not be upgraded . |
| Mapped Users and Roles                    | ![(滴答)](https://help.sonatype.com/s/-scv42a/8703/51k4y0/_/images/icons/emoticons/check.svg) Yes |                                                              |
| Atlassian Crowd                           | ![(滴答)](https://help.sonatype.com/s/-scv42a/8703/51k4y0/_/images/icons/emoticons/check.svg) Yes | After your upgrade, you will need to ensure your Crowd application is configured to accept connections from Nexus Repository 3 |
| Mapped User and Roles                     | ![(滴答)](https://help.sonatype.com/s/-scv42a/8703/51k4y0/_/images/icons/emoticons/check.svg) Yes |                                                              |
| User Token                                | ![(滴答)](https://help.sonatype.com/s/-scv42a/8703/51k4y0/_/images/icons/emoticons/check.svg) Yes | See section on [User Token Upgrade](https://help.sonatype.com/repomanager3/installation-and-upgrades/upgrading-from-nexus-repository-manager-2/nexus-repository-2-vs.-nexus-repository-3-feature-equivalency-matrix#) |
| IQ Server Configuration                   | ![(滴答)](https://help.sonatype.com/s/-scv42a/8703/51k4y0/_/images/icons/emoticons/check.svg) Yes | The Upgrade Wizard will clone IQ Server configuration and expects that  Nexus Repository 3 will use the same IQ Server as Nexus Repository 2.  The data inside IQ Server for Nexus Repository 2 will be cloned to work  with the repositories upgraded to Nexus Repository 3. |
| Repository Health Check Analysis (RHC)    | ![(滴答)](https://help.sonatype.com/s/-scv42a/8703/51k4y0/_/images/icons/emoticons/check.svg) Yes |                                                              |
| RUT Auth Realm                            | ![(滴答)](https://help.sonatype.com/s/-scv42a/8703/51k4y0/_/images/icons/emoticons/check.svg) Yes | This will NOT be upgraded automatically . This feature can be a security concern when enabled. Configure this  manually inside Nexus Repository 3 when you are confident that Nexus Repository 3 access is protected. |

​        

# Determining and Planning Your Upgrade Path

Upgrading from Nexus Repository 2 to Nexus  Repository 3 requires a complete transformation of the repository  metadata and storage methods. Because of this, you will need to use one  of the following for upgrade:

- Built-in Upgrade Wizard (Preferred Method)
  - Best for those upgrading to a fresh Nexus Repository 3 instance
  - Not appropriate when you are already using Nexus Repository 3
- Manual Methods
  - Exporting / Importing Content and Configuration (Preferred Manual Method)
    - Best for those already using Nexus Repository 3 and wishing to bring Nexus  Repository 2 content into the existing Nexus Repository 3 instance
    - Not appropriate for proxy repositories, content cannot be imported into a proxy repository
  - Proxy Old Repositories
    - Best for those only wishing to bring over what is actively being used
    - Not appropriate when you do not wish to maintain your Nexus Repository 2 instance
- Hybrid Model
  - Due to the complicated nature of this method, we do not recommend using a  hybrid method unless you have access to our support and customer success teams.

 

We recommend using the built-in Upgrade Wizard whenever possible.

While the built-in Upgrade Wizard is always our top recommendation, we also  recognize that it's not always possible to use this tool in every  scenario. The questions below will help you determine the best  upgrade path for your individual deployment.

## Baseline Requirements & Limitations

The following questions are not considerations, but requirements to be able to use the specified upgrade path. You **must** be able to answer yes to all questions below in order to use the specified method:

| Path                                        | Requirements                                                 | Limitations                                                  |
| ------------------------------------------- | ------------------------------------------------------------ | ------------------------------------------------------------ |
| **Upgrade Wizard (Preferred)**              | Are you upgrading to a fresh Nexus Repository 3 instance?Will you be using the same license type (OSS or Pro) on your Nexus Repository 3 instance as on your Nexus Repository 2 instance?Can you ensure that your Nexus Repository 2 instance is on the latest Nexus Repository 2 version before upgrading?Can you ensure that all files in the Nexus Repository work directory are  owned by the OS user and that there are no zero length files in the work directory? (See [Prerequisites for Upgrading from Nexus Repository 2 to Nexus Repository 3](https://help.sonatype.com/repomanager3/installation-and-upgrades/upgrading-from-nexus-repository-manager-2/nexus-repository-3-upgrade-wizard/prerequisites-for-upgrading-from-nexus-repository-2-to-nexus-repository-3) for more details.)Can you ensure that Nexus Repository 2 repository and repository group  Repository IDs differ by more than just case and use distinguishable  names? | Cannot be used to upgrade to an existing Nexus Repository 3 instance. |
| **Import/Export (Preferred Manual Method)** | Are you prepared for a potentially lengthy upgrade process?  | Only moves repository contents, not configuration.           |
| **Proxy Old Repositories**                  | Are you prepared for a prolonged upgrade process?Are you prepared to keep your Nexus Repository 2 instance after this upgrade, potentially long-term?Are you prepared to allow inbound network traffic from Nexus Repository 3 to Nexus Repository 2?Are you ok with some components in repositories not being upgraded? | Only moves repository contents, not configuration.           |
| **Hybrid (Upgrade Wizard + Manual)**        | A common hybrid scenario would be using the Upgrade Wizard to move user tokens, then using manual methods for everything else.Are you upgrading to a fresh Nexus Repository 3 instance?Will you be using the same license type (OSS or Pro) on your Nexus Repository 3 instance as on your Nexus Repository 2 instance?Can you ensure that your Nexus Repository 2 instance is on the latest Nexus Repository 2 version before upgrading?Are you prepared for a potentially lengthy upgrade process? | Due to the complicated nature of this method, we do not recommend using a  hybrid method unless you have access to our support and customer success teams. |

## Additional Considerations for Fine Tuning Your Path

### RPMs in Maven Repositories

If you have RPMs in Maven repositories in Nexus Repository 2, we highly  suggest using the Nexus Repository 3 import task to import these into [Yum hosted repositories](https://help.sonatype.com/repomanager3/nexus-repository-administration/formats/yum-repositories#YumRepositories-HostingYumRepositories) in Nexus Repository 3.

When doing this, you will need to disable the [*Yum: Configuration* capability](https://help.sonatype.com/repomanager2/rpm-packages-and-yum-repositories#RPMPackagesandYUMRepositories-Configuration) on any Maven repositories in Nexus Repository 2. If you do not disable this capability, the entire Maven 2 hosted  repository will not import into a Maven 2 repository in Nexus Repository 3.

### How much data do you need to move?

Whether using the Upgrade Wizard or Import, we always recommend using hard  links when possible. Using hard linking will save both time and storage  space. 

See [hard linking requirements](https://help.sonatype.com/repomanager3/installation-and-upgrades/upgrading-from-nexus-repository-manager-2/nexus-repository-3-upgrade-wizard/deciding-on-a-data-transfer-method) when using the Upgrade Wizard or hard linking requirements when using [Import](https://help.sonatype.com/repomanager3/nexus-repository-administration/tasks/repository-import) depending on which method you are using. 

### How are you using Nexus Repository 2 APIs, and how will you get that same functionality in Nexus Repository 3?

Custom plugins and scripts written using the Nexus Repository 2 APIs will not  work for Nexus Repository 3. You will need to rewrite scripts using the  Nexus Repository 3 API.

Nexus Repository 3 does support legacy content URLs; however, you should transition builds to default URLs as soon as possible.

### Do You Want to Use Different Architecture (e.g., Resilient Deployment)?

It is best to upgrade to a Nexus Repository 3 instance using the same  architecture as your Nexus Repository 2 deployment. If you wish to move  to a different architecture (e.g., if you wish to use one of our [resilient deployment options](https://help.sonatype.com/repomanager3/planning-your-implementation/resiliency-and-high-availability)), we recommend first upgrading to a Nexus Repository 3 instance that uses the same architecture as your Nexus Repository 2 deployment and then  doing a separate upgrade to the new architecture.

### Do You Wish to Use Cloud Object Stores?

While possible to do, moving to cloud object stores (e.g., S3 blob stores)  takes two to three times longer than moving to other storage options. As a best practice, we recommend importing to a file-based blob store on a low-latency file system and following the instructions in [Moving a Blob Store](https://help.sonatype.com/repomanager3/nexus-repository-administration/repository-management/configuring-blob-stores#ConfiguringBlobStores-MovingaBlobStore) to move the content to the cloud object store.

### Are You Using IQ Server?  

The Upgrade Wizard will clone IQ Server configuration and expects that  Nexus Repository 3 will use the same IQ Server as Nexus Repository 2.  The data inside IQ Server for Nexus Repository 2 will be cloned to work  with the repositories upgraded to Nexus Repository 3.

### Are You Using Nexus Firewall?  

The Upgrade Wizard will move Nexus Firewall waivers and approved components to your new Nexus Repository 3 instance.

While you cannot manually move Firewall waivers and approval, you can  pre-fetch the approved components before enabling Firewall quarantine on the new repository.

1. Export the Firewall report from the source repository using the [IQ Server REST API for Repository Results](https://help.sonatype.com/iqserver/automating/rest-apis/experimental---repository-results-view-rest-api).
2. Use this report to request components from the new proxy repository.
3. Enable Firewall quarantine on the new repository once all of the allowed components have been proxied.

# Nexus Repository 3 Upgrade Wizard

Nexus Repository includes upgrade capabilities which, when enabled, allow you to use an Upgrade Wizard that will walk you  through migrating your Nexus Repository 2 configuration and repositories to a fresh Nexus Repository 3 instance.

 

Upgrading to Nexus Repository 3 using the Upgrade Wizard is always the preferred method.

The following sections will help you plan and perform your migration using this wizard.

1. Understand what is [included in, excluded from, and modified during the upgrade](https://help.sonatype.com/repomanager3/installation-and-upgrades/upgrading-from-nexus-repository-manager-2/nexus-repository-3-upgrade-wizard/data-included%2C-excluded%2C-and-changed-during-nexus-repository-2-to-3-upgrade-process)
2. Ensure you meet all [prerequisites](https://help.sonatype.com/repomanager3/installation-and-upgrades/upgrading-from-nexus-repository-manager-2/nexus-repository-3-upgrade-wizard/prerequisites-for-upgrading-from-nexus-repository-2-to-nexus-repository-3); if you can't, you may need to [reevaluate your upgrade path](https://help.sonatype.com/repomanager3/installation-and-upgrades/upgrading-from-nexus-repository-manager-2/determining-and-planning-your-upgrade-path)
3. Decide on a [data transfer method](https://help.sonatype.com/repomanager3/installation-and-upgrades/upgrading-from-nexus-repository-manager-2/nexus-repository-3-upgrade-wizard/deciding-on-a-data-transfer-method); if possible, we always recommend hard linking
4. Take steps to [optimize upgrade performance](https://help.sonatype.com/repomanager3/installation-and-upgrades/upgrading-from-nexus-repository-manager-2/nexus-repository-3-upgrade-wizard/optimizing-upgrade-performance)
5. [Configure the upgrade capabilities](https://help.sonatype.com/repomanager3/installation-and-upgrades/upgrading-from-nexus-repository-manager-2/nexus-repository-3-upgrade-wizard/configuring-upgrade-capabilities-on-nexus-repository-2-and-3) in your Nexus Repository 2 and 3 instances
6. Follow our [step-by-step guide through the wizard itself](https://help.sonatype.com/repomanager3/installation-and-upgrades/upgrading-from-nexus-repository-manager-2/nexus-repository-3-upgrade-wizard/step-by-step-nexus-repository-2-to-3-upgrade-wizard-instructions)
7. If you need to start over, [reset your upgrade](https://help.sonatype.com/repomanager3/installation-and-upgrades/upgrading-from-nexus-repository-manager-2/nexus-repository-3-upgrade-wizard/resetting-a-nexus-repository-2-to-3-upgrade)
8. Configure [legacy URL paths](https://help.sonatype.com/repomanager3/installation-and-upgrades/upgrading-from-nexus-repository-manager-2/nexus-repository-3-upgrade-wizard/configuring-legacy-url-paths)

# Data Included, Excluded, and Changed During Nexus Repository 2 to 3 Upgrade Process

The Upgrade Wizard will help guide you through the upgrade process as outlined in [Step-by-Step Nexus Repository 2 to 3 Upgrade Wizard Instructions](https://help.sonatype.com/repomanager3/installation-and-upgrades/upgrading-from-nexus-repository-manager-2/nexus-repository-3-upgrade-wizard/step-by-step-nexus-repository-2-to-3-upgrade-wizard-instructions). However, the wizard is only able to include certain configurations in the upgrade.

## What is Included in the Upgrade?

The Upgrade capability upgrades the following automatically:

- Configuration
  - Active Security Realms
  - Anonymous Access Settings
  - Atlassian Crowd Settings
  - HTTP Proxy Settings
  - LDAP Settings
  - NuGet API Keys
  - Privileges
  - Repository Health Check and its corresponding SSL trust store configuration
    - For OSS, only *Health Check: Configuration* capability settings are included
    - For Pro, existing *SSL: Health Check* settings are also included
  - Role Mappings for LDAP/Crowd
  - Roles
  - SSL Certificates that have been trusted in SSL Certificates feature
  - Users
  - User Tokens
- IQ Server configuration
  - *IQ Server URL*
  - *Username*
  - *Password*
  - *Request Timeout*
  - Analysis properties
  - Trust store usage
  - Enabled Nexus IQ Server connection 
  - Repositories configured with the *IQ: Audit and Quarantine* capability will keep the capabilities as well as the audited and quarantined items

 

While Nexus Repository 2 can keep running while upgrade occurs, changes to the content will only be upgraded through the  *Synchronization*  upgrade step. Changes to audited and quarantined items from the IQ Server are included in this caveat.



- Repositories in supported formats:

  - Maven2 (excluding staging repositories)
  - npm
  - NuGet
  - Site (called Raw in Nexus Repository 3)
  - RubyGems

- NuGet API key - The upgrade tool adds all keys from Nexus Repository 2 to  Nexus Repository 3 even if the NuGet API Key Realm is not active in  Nexus Repository 2

- The following existing Nexus Repository artifact information is maintained during upgrade: 

   NEW IN 3.37.0 

  - `uploaded_by`
  - `uploaded_by_ip`
  - `uploaded_date`
  - `lastModified`

### Changes to Data During Upgrade Process

Nexus Repository 3 uses different architecture from Nexus Repository 2;  therefore, some core changes to data occur as part of the upgrade  process. 

#### Content Storage

In Nexus Repository 2, all content is stored in a filesystem on disk.

 Nexus Repository 3, however, uses a blob store format for storing content. This allows Nexus Repository 3 to work with more formats since they no longer have to map directly to a file system. See [Storage Planning](https://help.sonatype.com/repomanager3/planning-your-implementation/storage-guide/storage-planning) for more details about how to work with blob stores.

Nexus Repository 3 must iterate over every component stored in Nexus  Repository 2. This takes the bulk of the time required for the upgrade  process.

#### Settings and Metadata

In Nexus Repository 2, settings and some component metadata are stored across many files.

Nexus Repository 3 loads equivalent data into the database.

#### URLs

Nexus Repository 2 uses a different URL pattern to expose repositories and  repository groups than Nexus Repository 3. During upgrade, Nexus  Repository 3 adds a *NXRM2 style URLs* capability to allow your automated tools and CI to use the old patterns. [Configuring Legacy URL Paths](https://help.sonatype.com/repomanager3/installation-and-upgrades/upgrading-from-nexus-repository-manager-2/nexus-repository-3-upgrade-wizard/configuring-legacy-url-paths) covers this in more detail.

#### Roles

Roles upgraded from Nexus Repository 2 are assigned a Role ID that starts with  `nx2-`  in Nexus Repository 3. Role descriptions created during the upgrade process have the word  `legacy`  in their description.

#### Repository Targets

Repository targets from Nexus Repository 2 are converted to [Content Selectors](https://help.sonatype.com/repomanager3/nexus-repository-administration/access-control/content-selectors) in Nexus Repository 3. Repository targets were based on regular  expressions; these are automatically converted to Content Selector  Expression Language (CSEL), a performant subset of JEXL.

#### Repository IDs

Nexus Repository 3 uses the Repository ID defined in Nexus Repository 2 as  the Name for the upgraded repository; they define the access URL in both cases. The user-facing Repository Name from Nexus Repository 2 is  dropped during the upgrade since there is no equivalent feature in Nexus Repository 3 .  

IDs of repositories and repository groups in Nexus Repository 2 that differ only by case will not be accepted during an upgrade to Nexus Repository 3 (example version 2 IDs: `myrepoid` vs `Myrepoid`). To resolve the ID conflict review and change any IDs in version 2 to distinguishable names.

#### HTTP(S) Proxy Configuration

Your HTTP or HTTPS proxy settings for Nexus Repository 2 **may not be valid** for your Nexus Repository 3 environment. You must configure your HTTP or  HTTPS proxy settings in Nexus Repository 3 in order to upgrade them.

If HTTP or HTTPS proxy settings are enabled in your source Nexus  Repository 2, the upgrade to your target Nexus Repository 3 might fail  because the target can not communicate with the source repository  manager. This could happen if Nexus Repository 3 could not find a Nexus  Repository 2 proxy server in place.

If you enabled Nexus  Repository 2 HTTP or HTTPS settings during an upgrade, Nexus Repository 3 would use its original HTTP or HTTPS settings and ignore the settings  in place for Nexus Repository 2. 

Nexus Repository 3 generates a warning is in the log if this error occurrs. It will also log "Skipping HTTP(S) proxy settings, connection to Nexus 2 failed using new  settings. Please manually configure the HTTP proxy settings after the  upgrade is done." if something else fails.

What is Not Included in the Upgrade?

The following items are not included in the upgrade:

- Unsupported repository formats
  - Yum
    -  RPMs stored in Yum-enabled Maven2 repositories on Nexus Repository 2 can  only be moved to Maven2 repositories in Nexus Repository 3.  Any Yum-related capabilities must be disabled on the Maven2 repository  first. There is no automatic option to move RPMs in Nexus Repository 2  Maven2 repositories into Yum format repositories in Nexus Repository 3.
  - Maven1
  - p2
  - OBR
- Capabilities
- Custom branding
- Custom log levels or edits to `logback.xml `configuration files (e.g., custom log file rotation, file naming, log patterns)
- Environment variables affecting values used to control the repository manager
- Java VM settings, including custom system properties or variables
- Jetty server XML configuration files
- Manual edits to other files under the `nexus` installation directory, such as edits to `nexus/WEB-INF/classes/ehcache.xml`
- Operating system `nexus` service scripts
- Operating system optimization, such as increasing allowable open file handles
- Routing rules
- Scheduled tasks
- Staging repositories, settings, or configuration
- The *admin* user password from Nexus Repository 2
- Third-party or custom-developed plugins
- Virtual repositories

​        

# Prerequisites for Upgrading from Nexus Repository 2 to Nexus Repository 3

A successful upgrade from Nexus Repository 2 to Nexus Repository 3 requires planning, decision making, and, if possible,  testing before attempting the actual upgrade.

| Prerequisite                                                 | Required/Recommended | Details                                                      |
| ------------------------------------------------------------ | -------------------- | ------------------------------------------------------------ |
| Nexus Repository 2 instance is on the latest Nexus Repository 2 version | Required             | Your Nexus Repository 2 instance must be on the latest Nexus Repository 2  version before upgrading to the latest Nexus Repository 3 version.Upgrading to an older Nexus Repository 3 then subsequently updating to the latest Nexus Repository 3 is not equivalent, as it will hit old upgrade bugs. |
| Both Nexus Repository 2 and Nexus Repository 3 have the same license type (OSS or Pro) | Required             | When upgrading from Nexus Repository 2 to 3, both versions must have the same licensing setup. The same license file can be used in Nexus Repository 2 and Nexus  Repository 3 or a license can always be applied at a later time.If the Nexus Repository 3 instance is on the same server as the Nexus  Repository 2 instance, both instances will automatically share the same  license. Otherwise, you will need to install the license on the new  Nexus Repository 3 instance. |
| The Nexus Repository 3 instance must not yet be in use; it must be a fresh/clean instance | Required             | The upgrade tool completely replaces existing configurations in Nexus  Repository 3. It is intended for one-time use, and if you need to  re-start an upgrade, you must first[ reset that upgrade](https://help.sonatype.com/repomanager3/installation-and-upgrades/upgrading-from-nexus-repository-manager-2/nexus-repository-3-upgrade-wizard/resetting-a-nexus-repository-2-to-3-upgrade). |
| All files in the Nexus Repository work directory must be owned by the OS  user, and there should be no zero length files in the work directory | Required             | You can use the following Linux command to find files in the work directory that are not owned by the 'nexus' user as well as zero length files:`find . \! -user nexus -print` |
| Decide on a [data transfer method](https://help.sonatype.com/repomanager3/installation-and-upgrades/upgrading-from-nexus-repository-manager-2/nexus-repository-3-upgrade-wizard/deciding-on-a-data-transfer-method); ensure you have adequate storage space for the upgrade | Required             | Full details available in [Deciding on a Data Transfer Method](https://help.sonatype.com/repomanager3/installation-and-upgrades/upgrading-from-nexus-repository-manager-2/nexus-repository-3-upgrade-wizard/deciding-on-a-data-transfer-method). |
| Ensure Nexus Repository 2 repository and repository group Repository IDs  differ by more than just case. You must use distinguishable names. | Required             | IDs of repositories and repository groups in Nexus Repository 2 that differ only by case will not be accepted during an upgrade to Nexus Repository 3 (example version 2 IDs: `myrepoid` vs. `Myrepoid`). |
| Ensure your Nexus Repository 3 instance is using an external PostgreSQL database PRO | Recommended          | We highly recommend that you set up your Nexus Repository 3 instance with an external PostgreSQL database. See our [documentation on configuring Nexus Repository Pro for an external PostgreSQL database](https://help.sonatype.com/repomanager3/installation-and-upgrades/configuring-nexus-repository-pro-for-h2-or-postgresql#ConfiguringNexusRepositoryProforH2orPostgreSQL-ConfiguringforExternalPostgreSQL). |
| Review repository groups' contents in Nexus Repository Manager 2 to ensure all contents are selected for upgrade. | Recommended          | Neglecting to select a single repository within a group may prevent the entire group from being upgraded. |
| If necessary, configure your blob stores in Nexus Repository 3. (See our [Storage Guide](https://help.sonatype.com/repomanager3/planning-your-implementation/storage-guide)) | Recommended          | You will not be able to make configuration changes in Nexus Repository 3 again until the upgrade has successfully completed. |
| If you wish to use and move user tokens, navigate to the *User Token* tab in the *Administration* menu on the Nexus Repository 2 instance and check to ensure that user tokens are enabled. | Recommended          | The upgrade tool only upgrades pre-existing user tokens to Nexus Repository 3 if user token support is enabled in Nexus Repository 2. |
| Consider [optimizing upgrade performance](https://help.sonatype.com/repomanager3/installation-and-upgrades/upgrading-from-nexus-repository-manager-2/nexus-repository-3-upgrade-wizard/optimizing-upgrade-performance) by disabling unnecessary tasks and enabling some helfup ones. | Recommended          | Full details available in the [Optimizing Upgrade Performance](https://help.sonatype.com/repomanager3/installation-and-upgrades/upgrading-from-nexus-repository-manager-2/nexus-repository-3-upgrade-wizard/optimizing-upgrade-performance) topic. |
| Back up your infrastructure                                  | Recommended          | Establish a safe recovery point should something go wrong.   |
| Test your upgrade with your desired upgrade settings using a similar test environment | Recommended          | As a best practice, we recommend trying to create a test version of your  current production environment so that you can test upgrading from Nexus Repository 2 to 3 there before performing it in a production  environment. This can help you see what errors (such as out of memory  errors in Nexus Repository 2) may occur with your selected test upgrade  settings. Then, you can adjust your settings so that you do not  encounter these errors when upgrading your production instance. |

# Deciding on a Data Transfer Method

When performing the upgrade from Nexus Repository 2  to 3, there are three data transfer methods from which you must choose:  HTTP downloading, file system copying, or file system hard linking. Each method has its own pros, cons, and requirements as detailed below.

| Data Transfer Method                 | Description                                                  | Pros                                                         | Cons                                                         | Requirements                                                 |
| ------------------------------------ | ------------------------------------------------------------ | ------------------------------------------------------------ | ------------------------------------------------------------ | ------------------------------------------------------------ |
| File System Hard Linking (Preferred) | Nexus Repository 2 tells Nexus Repository 3 the path of the file content to  transfer. Nexus Repository 3 then creates a file system hard link to the same content. Data is not duplicated | The fastest methodSaves storage space                        | Nexus Repository 2 and 3 must be installed on the same server | Nexus Repository 2 and 3 must be configured to access the same storage system on identically named mount points.The file system must support hard linking.There must be adequate file handles for both Nexus Repository 2 and 3.See the [System Requirements for Nexus Repository 3](https://help.sonatype.com/repomanager3/product-information/system-requirements#SystemRequirements-AdequateFileHandleLimits).See [this article](https://support.sonatype.com/hc/en-us/articles/213465218-The-nexus-log-file-is-full-of-too-many-open-files-exceptions-how-can-I-fix-this-) on how to determine configured open file handles for Nexus Repository 2. |
| File System Copying                  | Nexus Repository 2 provides Nexus Repository 3 with the necessary path to file content, which Nexus Repository 3 then copies. | Faster than HTTP downloadingLess impact on performance of Nexus Repository 2 | Not as fast as hard linking                                  | Nexus Repository 2 and 3 must be configured to access the same storage system on identically named mount points.You must ensure you have enough storage space; upwards of double the  original storage space will be needed at least temporarily during data  duplication. |
| HTTP Downloading                     | Nexus Repository 3 makes HTTP requests to Nexus Repository 2 to transfer configuration and data. | The only method that works for situations where Nexus Repository 2 and 3  are on different machines and do not share access to the same file  system storage | The slowest option                                           | You should not synchronize Nexus Repository content to cloud services or  on-premises data centers while this method is running. This tool is  solely designed to allow for data and configuration transfers between  Nexus Repository 2 and 3.You must ensure you have enough  storage space; upwards of double the original storage space will be  needed at least temporarily during data duplication. |

# Optimizing Upgrade Performance

To speed up the upgrade process, you may wish to make some changes and perform some cleanup in Nexus  Repository 2. The suggestions below can help you reduce the amount of  content you need to move, free up resources to speed up the upgrade, and avoid some issues that could arise regarding old repositories.

| Feature                                                      | How to Optimize                                              |
| ------------------------------------------------------------ | ------------------------------------------------------------ |
| [System Feeds](https://help.sonatype.com/repomanager2/using-the-user-interface/browsing-system-feeds) | If your organization does not rely on system feeds (often used for team communication), consider [disabling them](https://support.sonatype.com/hc/en-us/articles/213464998-How-to-disable-the-System-Feeds-nexus-timeline-plugin-feature-to-improve-Nexus-performance?_ga=2.132181390.14056720.1669046939-291822469.1668525051). |
| [Repair Index Tasks](https://support.sonatype.com/hc/en-us/articles/213465468-What-do-all-of-the-search-index-related-scheduled-tasks-do-and-when-should-I-schedule-them-?_ga=2.132181390.14056720.1669046939-291822469.1668525051) | These tasks support searching components within the user interface and do not need to be rebuilt that often. Consider disabling them across all repositories. Disabling the *[\*Update Repositories Index\* ](https://help.sonatype.com/repomanager2/configuration/managing-scheduled-tasks#ManagingScheduledTasks-UpdateRepositoriesIndex)*[task](https://help.sonatype.com/repomanager2/configuration/managing-scheduled-tasks#ManagingScheduledTasks-UpdateRepositoriesIndex) while using the Upgrade Wizard will enhance the wizard's performance and free up resources that Nexus Repository 2 will need. |
| Snapshot Removal Tasks                                       | Enable both [*Remove Snapshots from Repository* ](https://help.sonatype.com/repomanager2/configuration/managing-scheduled-tasks#ManagingScheduledTasks-RemoveSnapshotsfromRepository)and *[Remove Unused Snapshots From Repository](https://help.sonatype.com/repomanager2/configuration/managing-scheduled-tasks#ManagingScheduledTasks-RemoveUnusedSnapshotsFromRepository)*, which deletes old unneeded component versions. Running these task in  Nexus Repository 2 before upgrade will reduce the amount of content to  move, meaning a faster upgrade. |
| Deprecated Repositories                                      | Remove any deprecated repositories. For example, any Maven 2 proxy repositories with the domain name ["codehaus.org" should be deleted](https://support.sonatype.com/hc/en-us/articles/217611787).If Nexus Repository 2 contains proxy repositories that are pointing at  sites that don't exist and are not manually blocked for remote contact  even though remote contact cannot work, this can slow things down during upgrade as Nexus Repository 2 could get hung up trying to contact bad  remotes.You can also elect not to include very old repositories when selecting repositories to upgrade in the Upgrade Wizard. |
| [Rebuild Maven Metadata Files Task](https://help.sonatype.com/nxrm2master/configuration/managing-scheduled-tasks#ManagingScheduledTasks-RebuildMavenMetadataFiles) | This scheduled task is disabled by default and should only be run if you  need to repair a corrupted Maven repository storage on disk. |
| [Staging Rules](https://help.sonatype.com/nxrm2master/staging-releases/configuring-the-staging-suite) | If you are a Nexus Repository Pro user that uses the application for  staging releases, redefine or reduce the number of configured staging  rules and staging profiles. |
| Scheduled Tasks for Releases                                 | If you find empty *Use Index* checkboxes under *[Task Settings](https://help.sonatype.com/repomanager2/configuration/managing-scheduled-tasks#ManagingScheduledTasks-TaskSettings)*, use the opportunity to disable or remove those specific tasks for releases. |

​        

# Configuring Upgrade Capabilities on Nexus Repository 2 and 3

Before you can use the Upgrade Wizard, you will need  to configure upgrade capabilities on both the Nexus Repository 2 and 3  instances. The instructions below walk you through this process.

## Create the Upgrade Capability on the Nexus Repository 3 Instance 

\1. Under *Administration* → *System* → *Capabilities*, create an *Upgrade* capability on your Nexus Repository 3 instance.

![img](https://help.sonatype.com/repomanager3/files/137207306/137207309/1/1674155137260/Screen+Shot+2022-09-21+at+2.53.50+PM.png)

\2. After selecting the *Upgrade* capability type, ensure the *Enable this capability* checkbox is checked, and select Create capability. 

![img](https://help.sonatype.com/repomanager3/files/137207306/137207308/1/1674155137218/Screen+Shot+2022-09-21+at+2.59.39+PM.png)

\3. An *Upgrade* option now appears at the bottom of your main side menu.

## Create the Upgrade Agent Capability on the Nexus Repository 2 Instance  

\1. In your Nexus Repository 2 instance, navigate to *Administration* → *Capabilities*; select the *New* button under the *Capabilities* tab to create a new capability (see the [ Nexus Repository 2 documentation ](https://help.sonatype.com/repomanager2/configuration/accessing-and-configuring-capabilities)for more details on capabilities).

![img](https://help.sonatype.com/repomanager3/files/137207306/137207307/1/1674155137171/Screen+Shot+2022-09-22+at+12.45.58+PM.png)

\2. Select *Upgrade Agent* as the capability *Type*.

\3. Ensure the *Enabled* checkbox is selected.

\4. You can either keep the generated *Access Token* or provide your own as shown in the highlighted box above. You will need this access token later when performing the upgrade.

\5. Select *Add* to add the capability.

​        

# Step-by-Step Nexus Repository 2 to 3 Upgrade Wizard Instructions

 

 

 

As a best practice, we recommend trying to create a test version of your  current production environment so that you can test upgrading from Nexus Repository 2 to 3 there before performing it in a production  environment. This can help you see what errors (such as out of memory  errors in Nexus Repository 2) may occur with your selected test upgrade  settings. Then, you can adjust your settings so that you do not  encounter these errors when upgrading your production instance.

 

The wizard is meant to be used once; do not try to transfer server configuration multiple times.

Follow [our instructions for resetting your upgrade](https://help.sonatype.com/repomanager3/installation-and-upgrades/upgrading-from-nexus-repository-manager-2/nexus-repository-3-upgrade-wizard/resetting-a-nexus-repository-2-to-3-upgrade) before attempting another upgrade.

## Are You Ready to Upgrade?

Checkpoint: Are You Ready to Upgrade?

 

Before proceeding, have you done the following things?

- Have you [configured the upgrade capabilities in Nexus Repository 2 and 3](https://help.sonatype.com/repomanager3/installation-and-upgrades/upgrading-from-nexus-repository-manager-2/nexus-repository-3-upgrade-wizard/configuring-upgrade-capabilities-on-nexus-repository-2-and-3)?
- Have you performed a test upgrade with your desired upgrade settings using a similar test environment to evaluate any potential issues? (Recommended)
- Have you ensured that nobody is using the Nexus Repository 3 instance? While this upgrade is happening, Nexus Repository 3 will be offline, and nobody should be using it.
- Have you upgraded your Nexus Repository 2 instance to the latest version of Nexus Repository 2? (Required)
- Do both your Nexus Repository 2 and 3 instances have the same licensing setup (both OSS or both Pro)? (Required)
- Do you need to configure your blob stores in Nexus Repository 3? (See our [Storage Guide](https://help.sonatype.com/repomanager3/planning-your-implementation/storage-guide))
- Have you evaluated and decided on which transfer method you wish to use and ensured you meet all storage requirements? (See [Deciding on a Data Transfer Method](https://help.sonatype.com/repomanager3/installation-and-upgrades/upgrading-from-nexus-repository-manager-2/nexus-repository-3-upgrade-wizard/deciding-on-a-data-transfer-method))

## Step 1 - Configure the Connection Between Nexus Repository 2 and Nexus Repository 3

\1. In your Nexus Repository 3 instance, select the *Upgrade* option from the side menu. This launches the Upgrade wizard and takes you to the *Overview* screen, which contains important information. Be sure to read this information before proceeding. Then, select *Next* to navigate to the next screen in the wizard.

![img](https://help.sonatype.com/repomanager3/files/137207312/137207324/1/1674155146735/Screen+Shot+2022-09-22+at+12.25.41+PM.png)

\2. On the *Agent Connection* screen, complete the following information:

- URL

   \- Enter the base URL for the Nexus Repository 2 instance (available in your 

  *Application Server Settings*

  ).

  - By default, Nexus Repository 2 ships with a` /nexus` web context that must be included in the URL (e.g., `http://<hostname>:<port>/nexus`)

    

- *Access Token* - You will need to obtain this from the Nexus Repository 2 instance. This was created when [configuring the *Upgrade Agent* capability in Nexus Repository 2](https://help.sonatype.com/repomanager3/installation-and-upgrades/upgrading-from-nexus-repository-manager-2/nexus-repository-3-upgrade-wizard/configuring-upgrade-capabilities-on-nexus-repository-2-and-3#ConfiguringUpgradeCapabilitiesonNexusRepository2and3-upgradeagent) and is available in your Nexus Repository 2 instance at *Administration → Capabilities → Upgrade Agent → Status* tab.

![img](https://help.sonatype.com/repomanager3/files/137207312/137207322/1/1674155146648/Screen+Shot+2022-09-22+at+12.51.29+PM.png)

- *Fetch Size* - This dictates the number of components that Nexus Repository 3  requests from Nexus Repository 2 at one time. It is set to 100 by  default.

 

Keeping your *Fetch Size* too high can cause out of memory errors with Nexus Repository 2 and is  especially common for NPM and NuGet repositories, which have a lot of  package metadata. Consider reducing your fetch size to a smaller value  (e.g., 20). 

\3. Select *Next* to continue.

## Step 2 - Decide What Content to Transfer

\1. On the *Content* screen, select the appropriate checkboxes for what you wish to transfer from your Nexus Repository 2 instance: *Repository configuration and content* and/or *S**erver configuration.* (See [Data Included, Excluded, and Changed During Nexus Repository 2 to 3 Upgrade Process](https://help.sonatype.com/repomanager3/installation-and-upgrades/upgrading-from-nexus-repository-manager-2/nexus-repository-3-upgrade-wizard/data-included%2C-excluded%2C-and-changed-during-nexus-repository-2-to-3-upgrade-process).)

![img](https://help.sonatype.com/repomanager3/files/137207312/137207321/1/1674155146607/Screen+Shot+2022-09-26+at+3.32.21+PM.png)

 

This tool is intended for single use on both repositories and server configuration.

Upgrading repositories in batches or more than once is not supported.

Do not try to transfer server configuration multiple times.

Follow [our instructions for resetting your upgrade](https://help.sonatype.com/repomanager3/installation-and-upgrades/upgrading-from-nexus-repository-manager-2/nexus-repository-3-upgrade-wizard/resetting-a-nexus-repository-2-to-3-upgrade) before attempting another upgrade.

\2. Select *Next* to continue. 

## Step 3 - Configure and Select Repositories for Upgrade

\1. On the *Repository Defaults* screen, configure the default settings to use for your upgrade:

- *Blob store* - Choose the blob store where the repository content should be stored. 

- Method 

  \- Choose how the repository content should be transferred (See 

  Deciding on a Data Transfer Method

  ). 

  - *Hard Link (fastest)* (Recommended)

  - **Filesystem copy (slow)** 

  - *Download (slowest)

    *

 

If your Nexus Repository 2 and 3 instances are running on different  machines and do not share access to the same file system storage, you  must use the HTTP download method.

 

When running the HTTP download method, we discourage you from synchronizing  Nexus Repository content to cloud services or on-premises data centers.  This tool is solely designed to allow for data and configuration  transfers between Nexus Repository 2 to 3.



*![img](https://help.sonatype.com/repomanager3/files/137207312/137207319/1/1674155146528/Screen+Shot+2022-09-27+at+8.19.38+AM.png)*

\2. Select *Next* to continue to select the repositories you wish to upgrade.

\3. On the *Repositories* screen, select the repositories you wish to upgrade by selecting the  checkbox next to each repository; or, select the checkbox in the header  row to select all repositories. 

 

Repositories that you cannot upgrade to Nexus Repository 3 will appear greyed out and will not be selectable in the list.

![img](https://help.sonatype.com/repomanager3/files/137207312/137207320/1/1674155146567/Screen+Shot+2022-09-26+at+3.50.39+PM.png)

\4. You can also select the wrench icon in the last column to customize  advanced configuration of the upgrade per-repository as needed (e.g., to select a different blob store).

\5.  Review the preview of the upgrade configuration. These are all the steps that will take place during the upgrade after you select the *Begin* button at the bottom of the screen.

![img](https://help.sonatype.com/repomanager3/files/137207312/137207318/1/1674155146489/Screen+Shot+2022-09-27+at+9.16.19+AM.png)

## Step 4 - Run the Upgrade

The upgrade is broken into three phases:

- *Prepare* - Prepares the transfer and creation of all configuration and components.
- *Sync*  - Counts and processes all components set to upgrade and upgrades all other configurations.
- *Finish* - Performs the final clean up then closes the process.

\1. To begin the upgrade from the *Preview* screen, select *Begin*; then, select *Yes* when asked if you wish to proceed. This will initiate the *Prepare* phase and take you to a progress screen where you can watch the progress of this phase.

The invoked upgrade process destroys any existing configuration in the  target Nexus Repository 3 server and replaces it with the configuration  from the Nexus Repository 2 instance.

 

From this point on, do not make further configuration changes in Nexus  Repository 2. Any changes made will not be moved to Nexus Repository 3.

 

Note that the progress percentage above the table represents the number of  completed steps in the phase (e.g., it may read 54% when 14 of 26 steps  are complete).

\2. When all steps in the *Preparing* phase are complete, select *Continue* to move to the *Synchronizing* phase.

\3. Monitor the *Synchronizing* phase screen to observe progress; you can select the arrows in the  first column to see more details. Any content changes to the version 2  repositories continue to be upgraded during the *Synchronizing* step (e.g., new proxied components or new deployed components in version 2 are transferred to version 3). 

![img](https://help.sonatype.com/repomanager3/files/137207312/137207316/1/1674155146407/Screen+Shot+2022-09-28+at+9.05.57+AM.png)

 

During the transfer process, you can already view and access your content in  Nexus Repository 3 by using the component search or browsing in  repositories or repository groups. However, the repositories will be  offline until the process is fully complete.

## Step 5 - Finalize the Upgrade

Nexus Repository 3 continues to ask Nexus Repository 2 for new content.

\1. Once the *Process changes* step shows a sufficient amount of time "*since last change*," press *Continue* and then *Yes* when prompted to finalize the upgrade and move to the *Finishing* screen. Note that any future changes in Nexus Repository 2 will not be synchronized. 

![img](https://help.sonatype.com/repomanager3/files/137207312/137207313/1/1674155146268/Screen+Shot+2022-11-10+at+12.52.35+PM.png)

\2. Select *Done* on the *Finishing* screen to complete.

- Repository content is available immediately for direct download.
- *[Repair - Rebuild repository browse](https://help.sonatype.com/repomanager3/system-configuration/tasks#Tasks-Repair-Rebuildrepositorybrowse)* and *[Repair - Rebuild repository search](https://help.sonatype.com/repomanager3/system-configuration/tasks#Tasks-Repair-Rebuildrepositorysearch)* tasks run automatically after an upgrade completes to build component Search  UI and Search REST APIs as well as component Browse UI and HTML views.  You do not need to manually schedule tasks to rebuild search indexes or  browse nodes. 
- Components will not be visible in the user interface (browse or search), HTML views of content, or Search REST API results until tasks named "Repo 2 Migration" finish. You can monitor this status in the *[Tasks](https://help.sonatype.com/repomanager3/nexus-repository-administration/tasks)* section or by examining the associated task log.

 

**Licensing Note**: If you upgraded your versions on the same server, no additional work  need be done. If you upgraded your Nexus Repository 3 to a different  server than Nexus Repository 2, then you must reinstall the license on  the new server. You can use the same license file for Nexus Repository 3 as for Nexus Repository 2.

## Aborting an Upgrade

If you select the *Abort* button during the upgrade process, the upgrade stops, and Nexus  Repository 3 deletes all of the repositories it has created during this  upgrade process. 

Everything you've done up to this point is removed, and you must start over.

If you need to attempt this upgrade again, you should follow [our instructions for resetting your upgrade](https://help.sonatype.com/repomanager3/installation-and-upgrades/upgrading-from-nexus-repository-manager-2/nexus-repository-3-upgrade-wizard/resetting-a-nexus-repository-2-to-3-upgrade) and start from scratch.

# Resetting a Nexus Repository 2 to 3 Upgrade

If you need to restart a Nexus Repository 2 to 3  upgrade for any reason, you will need to reset the upgrade and start it  over from the beginning. 

\1. To end the upgrade process explicitly, use the *Abort* button in the upgrade wizard in Nexus Repository 3 if available.

 

Complete all remaining steps regardless of whether or not you are able to use the *Abort* button.

\2. Shut down Nexus Repository 3

\3. Remove the entire Nexus Repository 3 [data directory](https://help.sonatype.com/repomanager3/installation-and-upgrades/directories) (i.e., $data-dir directory). If needed, see our [support article](https://support.sonatype.com/hc/en-us/articles/218707647-How-to-Determine-the-Location-of-the-Nexus-3-Data-Directory) on how to determine your Nexus Repository 3's data directory location.

\4. Shut down Nexus Repository 2.

 

If your Nexus Repository 2 instance is a production instance, a brief production outage will be required.

\5. Remove the entire Nexus Repository 2 directory at[ $work-dir/db/migrationagent](https://support.sonatype.com/hc/en-us/articles/213464308-Understanding-Nexus-Repository-Manager-2-Basic-Directories#WorkDir).

\6. Restart Nexus Repository 2.

\7. In Nexus Repository 2, go to *Administration* → *Capabilities*.

\8. Select the *Upgrade: Agent* capability; then, select the *Delete* button to remove the capability.
![img](https://help.sonatype.com/repomanager3/files/137207335/137207336/1/1674155158526/image2021-8-23_18-54-44.png)

This step will remove any internal RepositoryMigrationTask scheduled tasks that pertain to repository upgrade. These tasks will not be visible in the Scheduled Tasks view to an administrator, so this is the only way to remove these if they remain.

You can now start a new upgrade when ready by [re-configuring the upgrade capabilities](https://help.sonatype.com/repomanager3/installation-and-upgrades/upgrading-from-nexus-repository-manager-2/nexus-repository-3-upgrade-wizard/configuring-upgrade-capabilities-on-nexus-repository-2-and-3).

​        

# Configuring Legacy URL Paths

Nexus Repository 2 uses a different URL pattern than Nexus Repository 3 to expose  repositories and repository groups. Nexus Repository 3 creates an *NXRM2 style URLs* capability during upgrade so that it automatically supports the old  patterns and your automated tools and CI continue to work. This allows  you to access the example of  `http://localhost:8081/nexus/repository/sample ` by using` http://localhost:8081/nexus/content/repositories/sample`.

 

This example assumes your hostname ( `localhost` ), port ( `8081` ) and context path ( `nexus` ) match between your Nexus Repository 2 and Nexus Repository 3  installations. If not, you must use the ones from version 3 or  reconfigure as stated in [Changing the Context Path section](https://help.sonatype.com/repomanager3/installation-and-upgrades/configuring-the-runtime-environment#ConfiguringtheRuntimeEnvironment-ChangingtheContextPath).

The *NXRM2 style URLs* capability has no effect on REST API calls, which were totally rewritten in Nexus  Repository 3. You will need to reevaluate REST API calls and rewrite  them against the Nexus Repository 3 [REST API](https://help.sonatype.com/repomanager3/integrations/rest-and-integration-api).

 

Any automated tooling that uses direct repository browsing will need to be reconfigured for Nexus Repository 3 endpoints. See [Nexus Repository 3 HTML View documentation](https://help.sonatype.com/repomanager3/using-nexus-repository/browsing-repositories-and-repository-groups#BrowsingRepositoriesandRepositoryGroups-HTMLView) for more information on how to obtain this endpoint.

# Manual Upgrade Methods

When either upgrading to a new Nexus Repository 3  instance or consolidating to an existing instance, you can manually  upgrade repository content into Nexus Repository 3 Pro using any of the  following methods:

- Using the Repository Export/Import features
- Including external proxies in a group repository
- Running scripts using the REST API

Manual upgrade methods have a few considerations:

- Expect to spend a fair amount of time in planning and executing any upgrade
- You cannot import or export repository configuration
- Some data duplication is required

## Prerequisites

Before proceeding with any upgrade, we recommend taking the following steps:

| Prerequisite                                                 | Required/Recommended | Details                                                      |
| ------------------------------------------------------------ | -------------------- | ------------------------------------------------------------ |
| Access to Repository Storage                                 | Required             | You must export content to a folder that the Nexus Repository 3 instance can access.You can only import content from a folder that the Nexus Repository 3 instance can access. |
| Ensure your Nexus Repository 3 instance is using an external PostgreSQL database PRO | Recommended          | We highly recommend that you set up your Nexus Repository 3 instance with an external PostgreSQL database. See our [documentation on configuring Nexus Repository Pro for an external PostgreSQL database](https://help.sonatype.com/repomanager3/installation-and-upgrades/configuring-nexus-repository-pro-for-h2-or-postgresql#ConfiguringNexusRepositoryProforH2orPostgreSQL-ConfiguringforExternalPostgreSQL) or on [migrating an existing Nexus Repository 3 instance to a PostgreSQL database](https://help.sonatype.com/repomanager3/installation-and-upgrades/migrating-to-a-new-database). |
| Back Up Infrastructure                                       | Recommended          |                                                              |
| Do a Test Run                                                | Recommended          | Do a test run of the import process to identify issues and approximately how long the process could take. |
| Use Import Hard Links                                        | Recommended          | Hard linking is far faster and does not duplicate the data on disk.Review the [Import Hard Links](https://help.sonatype.com/repomanager3/nexus-repository-administration/tasks/repository-import) documentation for details. |
| Avoid Importing Directly to S3                               | Recommended          | Use File-based blobstores when possible.Importing directly to an S3 blobstore can be 3x slower.Use the [move blobstore functionality](https://help.sonatype.com/repomanager3/nexus-repository-administration/repository-management/configuring-blob-stores#ConfiguringBlobStores-MovingaBlobStore) to migrate to S3. |
| Firewall Repositories                                        | Optional             | You cannot migrate Firewall waivers.Prefetch the approved components through the proxy before enabling the Firewall quarantine.Export the Firewall report to obtain a list of approved components. |

## Export/Import Manual Upgrade Method PRO  

Using [Repository Export](https://help.sonatype.com/repomanager3/nexus-repository-administration/tasks/repository-export) and [Repository Import](https://help.sonatype.com/repomanager3/nexus-repository-administration/tasks/repository-import) (both Pro-only) is the easiest and fastest manual method to copy a  repository's contents from one Nexus Repository 3 instance to another. 

### Considerations

- You can directly import Nexus Repository 2 repository content from where it is stored on disk.
- The import task will maintain the created date, last updated date, and the  last downloaded date attributes from Nexus Repository 2.
- In  cases where the content in the source directory changes or the process  is interrupted, you can use these tasks to only add the  missing/additional content. 
- The tasks must be manually created; you cannot use scripts or the API.
- You will need to create and run individual tasks for each repository.
- Multiple tasks will not run at the same time.

### Steps for Nexus Repository 2 to 3 Export/Import Upgrade   

1. Ensure that your Nexus Repository 3 instance has file system access to the  Nexus Repository 2 storage; consider using a backup if Nexus Repository 2 is located on a different server.

2. On your Nexus Repository 3 instance, create the target repository to which the content will be imported.

    

   As a best practice, ensure that the blobstore for the target repository is on the same storage as the source repository; this will allow you to  use hard linking (recommended).

3. Under 

   Administration

    → 

   System

    → 

   Tasks 

   on the Nexus Repository 3 instance, create a new 

   [Repository - Import external files](https://help.sonatype.com/repomanager3/nexus-repository-administration/tasks/repository-import)

    task.

   1. Set the source directory to the folder where the Nexus Repository 2 repository is stored.
   2. Optionally, select *Enable Hard Links* (Recommended).

4. Run the task.

   1. For testing, you may stop the task before it completes.
   2. Review the[ importing documentation ](https://help.sonatype.com/repomanager3/nexus-repository-administration/tasks/repository-import)on how to [reset the import proces](https://help.sonatype.com/repomanager3/nexus-repository-administration/tasks/repository-import#RepositoryImport-ResettingData(.dat)Files).

5. When finished use the [Move Blobstore steps](https://help.sonatype.com/repomanager3/nexus-repository-administration/repository-management/configuring-blob-stores#ConfiguringBlobStores-MovingaBlobStore) to use a different storage disk or S3 object store 

 

If you have a lot of data to copy into the repository, this upgrade may take some time. Consider using the [Proxying Repositories](https://help.sonatype.com/repomanager3/installation-and-upgrades/upgrading-from-nexus-repository-manager-2/manual-upgrade-methods#ManualUpgradeMethods-proxy) method below to make the source content available while waiting for the import tasks to complete.

## Proxying Repositories Manual Upgrade Method  

One common use case for proxy repositories is to use them to make content  immediately available on a new Nexus Repository instance while slowly  moving content as it is requested.

### Considerations

- This upgrade will only copy content that is actively being requested by  development and production. This may be an effective way to avoid moving unused content.
- Nexus Repository fetches imported components through the proxy over HTTP(S), which can be very slow.
- You will need to maintain both repository instances until your new instance contains all needed content.
- You cannot convert a proxy repository to a hosted repository when the process is complete.

### Steps for the Proxying Repositories Manual Upgrade Method

This method involves creating a proxy repository (called `target-proxy` in the example below) on the new Nexus Repository 3 instance and having that proxy repository use the URL of hosted repository on a source  instance (called `source-hosted` in the example below).

When a component is requested from but not found on the target repository group (called `request-endpoint` in the example below), Nexus Repository downloads the component from  the hosted repository on the source instance through the proxy  repository. This is demonstrated in the diagram below:

![How the Proxy Method Migrates Components Over Time](https://help.sonatype.com/repomanager3/files/137207345/137207346/1/1674155236970/Blank+diagram+%281%29.png)

This configuration can be used until the upgrade is complete.

# Upgrading Staging

This topic provides Nexus Repository administrators  valuable information about the change in staging implementation between  Nexus Repository 2 and 3 as well as guidance on migrating your data and  processes. For detailed information on using the staging feature in  Nexus Repository 3, see the [Staging topic](https://help.sonatype.com/repomanager3/nexus-repository-administration/staging).

## Staging in Nexus Repository 2 vs. Nexus Repository 3

In Nexus Repository 2, staging is done through the staging suite; in Nexus Repository 3, staging is done through tagging and REST API calls. This  difference means that upgrading from Nexus Repository 2 to 3 lets you go from a dynamic repo-based model to a tag-based model.

When  designing staging in Nexus Repository 3, the Sonatype Nexus Repository  team had a chance to look for areas of improvement in Nexus Repository 2 and then develop the new staging feature to mitigate these issues.

Some of the issues identified in Nexus Repository 2 staging were as follows:

- It only works for the Maven2 format.
- Deployment/approval workflows are increasingly external to Nexus Repository.
- It doesn’t scale. Failing to apply proper housekeeping controls means  there can be 1000’s of repositories, leading to significant performance  problems in Nexus Repository 2.
- It’s easy to lose track of build identity after promotion (the staging repo goes away).

The Nexus Repository team worked to resolve these issues and develop  features in Nexus Repository 3 that let you do the following:

- Administer access control to in-house components at different phases of the SDLC.  Components can be restricted until fully tested.
- Store  components in a single hosted repository for each stage, while  identifying individual builds and managing retention periods by stage.
- Move components between release stages using the REST API.
- Associate custom metadata to builds as components are uploaded to the repository.
- Manage workflows with external CI/CD tools.


A side by side comparison:

| Staging in Nexus Repository 2          | Staging in Nexus Repository 3               |
| -------------------------------------- | ------------------------------------------- |
| Workflow defined in Nexus Repository 2 | Workflow defined externally (i.e., Jenkins) |
| Each build is a separate repository    | Each build is a tag                         |
| Hundreds of repositories accumulate    | Small, fixed number of repositories         |
| Builds are absorbed into release repo  | Build metadata outlives promotion           |
| UI-driven                              | Powered by REST, no UI                      |
| Maven2 only                            | Maven2, raw, Docker, npm, Nuget, YUM        |
| Rules defined in Nexus Repository 2    | Rules invoked externally by CI/CD           |
| “Staging” is a feature                 | Toolkit APIs used to build staging          |

Due to the extent to which we redesigned staging in Nexus Repository 3, it  is not compatible with Nexus Repository 2 staging. Nexus Repository 3  staging provides a set of flexible building block capabilities that can  be combined and arranged as needed to accommodate your organization’s  software build and release pipeline. The set of REST endpoints that  expose these capabilities allow for easy integration into CI/CD systems, and are easily customized to the workflows or client tooling and  technologies needed to interact with them.

## Benefits of Tagging and Staging in Nexus Repository 3

There are several advantages to upgrading to Nexus Repository 3:

### Flexible Workflow

Staging is a set of powerful REST endpoints that are highly customizable to  your environment. This new implementation makes build deployment  configuration more flexible for teams as they expand beyond CI server  usage to the staging repository and the ability to dynamically select  builds for promotion.

Staging for Nexus Repository 3 also helps  empower teams to take control of the build deployment process using  advanced metadata capabilities. This includes deciding how the metadata  changes along the release workflow, as well as how to isolate the right  builds for the right teams.

### Tags

Staging also works closely together with our tagging feature. In Nexus  Repository Pro, staging works by moving components across hosted  repositories. For instance, you could have hosted repositories for  development, UAT, and production. You can then promote software  components matching your organization’s software development lifecycle  phases by moving components between these hosted repositories. This is  where the tagging feature comes in. Tagging in Nexus Repository 3 is  more powerful because you can easily group multiple builds and promote  them as if they were a single unit.

For example, a complex project like Nexus Repository has thousands of files and all sorts of  components that go into a build. The Nexus Repository teams needs a way  to take all of these components that span multiple different coordinates and group them together in a way that lets us know it’s a single build. You can use the tagging REST endpoints to create and delete tags, list  all tags, and attach metadata to tags. This is the Nexus Repository 3  equivalent to custom metadata.

As you can see from the example  above, using tags provides a way to group and move your artifacts. Nexus Repository 3 provides several means for tagging, which usually happens  on upload, but can also be done after upload as well. You can tag  components with your automated CI/CD processes using the Jenkins  Platform plugin. Alternatively, you can also tag components during  upload within the UI.

## Path from Nexus Repository 2 to 3

Now that you understand how staging in Nexus Repository 3 works, the next  step is redefining your process from Nexus Repository 2 to the new  instance. Upgrading to Nexus Repository 3 will give you a staging  feature with a set of extremely configurable building blocks that can be adapted to your organization’s needs.

Although there is no direct upgrade path from Nexus Repository 2 to 3, this section will go over  some steps you can take to get started.

A basic setup workflow for staging in Nexus Repository 3 might look something like this:

1. Ensure that your upgrade from Nexus Repository 2 to Nexus Repository 3 is complete.
2. Identify the staging workflow from your Nexus Repository 2 configuration.
3. Create matching hosted repos in Nexus Repository 3.
4. Incorporate the stages of your agile software development lifecycle into the Nexus Platform Plugin for Staging.
5. Add a tagging call to the build.
6. Update the Nexus Repository 2 Maven calls to the Nexus Repository 3 REST calls.
7. Associate custom metadata to tags. Custom information is an extension of tagging. See [Viewing Tags](https://help.sonatype.com/repomanager3/user-interface/viewing-tags) for more info.
8. Use the Move REST API endpoint to promote tagged components among the hosted repos.
9. Use the Delete REST API endpoint to delete tagged components among the hosted repos.
10. Run a cleanup task to delete tags you no longer need.

The above steps represent a basic scenario. Our REST APIs give you a lot of flexibility to make this more robust and well integrated into your  CI/CD pipeline.

For more information on our staging workflow, please see the staging and tagging topics in our help documentation.

## Best Practices and Troubleshooting

Although migration from Nexus Repository 2 staging to Nexus Repository 3 staging is not supported, there are a few things you can do to make the move  easier. Here are a few ideas to help you make the switch:

- Keep in mind that this is an opportunity to start fresh with a new set of  features that are compatible with modern CI/CD pipelines.
- Review what worked in Nexus Repository 2 staging and what didn’t. This can  help you determine what needs to be implemented similarly and where  there are areas for improvement.
  - For example, you may need to keep your Nexus Repository 2 staging repos for data retention purposes. These types of requirements should be taken into account.
- When you upgrade, any “in flight” staging repositories in Nexus Repository 2 are not migrated. This means upgraded components in a build promotion  repo or staging repo are not moved. This is an important setup step that should be thought about prior to upgrade.
- Get familiar with concepts and terminology, such as the following:
  - Tag names are a string (or label) that are the primary key for what gets “staged.”
  - Metadata is extra information.
  - You cannot stage or create permissions based on metadata.
- Invest your time in establishing a strategy for naming tags and your  management approach for tags. For example, think about things like the  following:
  - Will tags be used? (This may depend on your organization’s approach to naming builds and repos.)
  - How will tags be routinely aged off?
  - What is the best way to implement tag creation and assignment to your artifacts?
- Keep in mind the benefits of staging in Nexus Repository 3:
  - You can control who can see in-house components at different parts of the SDLC, so they aren’t used before they’re ready.
  - You can batch components together and easily identify builds.
  - Stagings REST APIs are powerful and flexible.
  - You can control the workflow from your CI/CD pipeline.
  - The “toolkit” style implementation means it supports other use cases.
  - Maven and Jenkins integration (e.g., automatically tested, manually tested, signed, approved, etc.).

# Optimizing Upgrade Performance

To speed up the upgrade process, you may wish to make some changes and perform some cleanup in Nexus  Repository 2. The suggestions below can help you reduce the amount of  content you need to move, free up resources to speed up the upgrade, and avoid some issues that could arise regarding old repositories.

| Feature                                                      | How to Optimize                                              |
| ------------------------------------------------------------ | ------------------------------------------------------------ |
| [System Feeds](https://help.sonatype.com/repomanager2/using-the-user-interface/browsing-system-feeds) | If your organization does not rely on system feeds (often used for team communication), consider [disabling them](https://support.sonatype.com/hc/en-us/articles/213464998-How-to-disable-the-System-Feeds-nexus-timeline-plugin-feature-to-improve-Nexus-performance?_ga=2.132181390.14056720.1669046939-291822469.1668525051). |
| [Repair Index Tasks](https://support.sonatype.com/hc/en-us/articles/213465468-What-do-all-of-the-search-index-related-scheduled-tasks-do-and-when-should-I-schedule-them-?_ga=2.132181390.14056720.1669046939-291822469.1668525051) | These tasks support searching components within the user interface and do not need to be rebuilt that often. Consider disabling them across all repositories. Disabling the *[\*Update Repositories Index\* ](https://help.sonatype.com/repomanager2/configuration/managing-scheduled-tasks#ManagingScheduledTasks-UpdateRepositoriesIndex)*[task](https://help.sonatype.com/repomanager2/configuration/managing-scheduled-tasks#ManagingScheduledTasks-UpdateRepositoriesIndex) while using the Upgrade Wizard will enhance the wizard's performance and free up resources that Nexus Repository 2 will need. |
| Snapshot Removal Tasks                                       | Enable both [*Remove Snapshots from Repository* ](https://help.sonatype.com/repomanager2/configuration/managing-scheduled-tasks#ManagingScheduledTasks-RemoveSnapshotsfromRepository)and *[Remove Unused Snapshots From Repository](https://help.sonatype.com/repomanager2/configuration/managing-scheduled-tasks#ManagingScheduledTasks-RemoveUnusedSnapshotsFromRepository)*, which deletes old unneeded component versions. Running these task in  Nexus Repository 2 before upgrade will reduce the amount of content to  move, meaning a faster upgrade. |
| Deprecated Repositories                                      | Remove any deprecated repositories. For example, any Maven 2 proxy repositories with the domain name ["codehaus.org" should be deleted](https://support.sonatype.com/hc/en-us/articles/217611787).If Nexus Repository 2 contains proxy repositories that are pointing at  sites that don't exist and are not manually blocked for remote contact  even though remote contact cannot work, this can slow things down during upgrade as Nexus Repository 2 could get hung up trying to contact bad  remotes.You can also elect not to include very old repositories when selecting repositories to upgrade in the Upgrade Wizard. |
| [Rebuild Maven Metadata Files Task](https://help.sonatype.com/nxrm2master/configuration/managing-scheduled-tasks#ManagingScheduledTasks-RebuildMavenMetadataFiles) | This scheduled task is disabled by default and should only be run if you  need to repair a corrupted Maven repository storage on disk. |
| [Staging Rules](https://help.sonatype.com/nxrm2master/staging-releases/configuring-the-staging-suite) | If you are a Nexus Repository Pro user that uses the application for  staging releases, redefine or reduce the number of configured staging  rules and staging profiles. |
| Scheduled Tasks for Releases                                 | If you find empty *Use Index* checkboxes under *[Task Settings](https://help.sonatype.com/repomanager2/configuration/managing-scheduled-tasks#ManagingScheduledTasks-TaskSettings)*, use the opportunity to disable or remove those specific tasks for releases. |