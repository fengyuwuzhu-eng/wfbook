# Template examples

- [Simple alert field templates ](https://prometheus.io/docs/prometheus/latest/configuration/template_examples/#simple-alert-field-templates)
- [Simple iteration ](https://prometheus.io/docs/prometheus/latest/configuration/template_examples/#simple-iteration)
- [Display one value ](https://prometheus.io/docs/prometheus/latest/configuration/template_examples/#display-one-value)
- [Using console URL parameters ](https://prometheus.io/docs/prometheus/latest/configuration/template_examples/#using-console-url-parameters)
- [Advanced iteration ](https://prometheus.io/docs/prometheus/latest/configuration/template_examples/#advanced-iteration)
- [Defining reusable templates ](https://prometheus.io/docs/prometheus/latest/configuration/template_examples/#defining-reusable-templates)

Prometheus supports templating in the annotations and labels of alerts, as well as in served console pages. Templates have the ability to run queries against the local database, iterate over data, use conditionals, format data, etc. The Prometheus templating language is based on the [Go templating](https://golang.org/pkg/text/template/) system.

## Simple alert field templates

```
alert: InstanceDown
expr: up == 0
for: 5m
labels:
  severity: page
annotations:
  summary: "Instance {{$labels.instance}} down"
  description: "{{$labels.instance}} of job {{$labels.job}} has been down for more than 5 minutes."
```

Alert field templates will be executed during every rule iteration for each alert that fires, so keep any queries and templates lightweight. If you have a need for more complicated templates for alerts, it is recommended to link to a console instead.

## Simple iteration

This displays a list of instances, and whether they are up:

```
{{ range query "up" }}
  {{ .Labels.instance }} {{ .Value }}
{{ end }}
```

The special `.` variable contains the value of the current sample for each loop iteration.

## Display one value

```
{{ with query "some_metric{instance='someinstance'}" }}
  {{ . | first | value | humanize }}
{{ end }}
```

Go and Go's templating language are both strongly typed, so one must check that samples were returned to avoid an execution error. For example this could happen if a scrape or rule evaluation has not run yet, or a host was down.

The included `prom_query_drilldown` template handles this, allows for formatting of results, and linking to the [expression browser](https://prometheus.io/docs/visualization/browser/).

## Using console URL parameters

```
{{ with printf "node_memory_MemTotal{job='node',instance='%s'}" .Params.instance | query }}
  {{ . | first | value | humanize1024 }}B
{{ end }}
```

If accessed as `console.html?instance=hostname`, `.Params.instance` will evaluate to `hostname`.

## Advanced iteration

```
<table>
{{ range printf "node_network_receive_bytes{job='node',instance='%s',device!='lo'}" .Params.instance | query | sortByLabel "device"}}
  <tr><th colspan=2>{{ .Labels.device }}</th></tr>
  <tr>
    <td>Received</td>
    <td>{{ with printf "rate(node_network_receive_bytes{job='node',instance='%s',device='%s'}[5m])" .Labels.instance .Labels.device | query }}{{ . | first | value | humanize }}B/s{{end}}</td>
  </tr>
  <tr>
    <td>Transmitted</td>
    <td>{{ with printf "rate(node_network_transmit_bytes{job='node',instance='%s',device='%s'}[5m])" .Labels.instance .Labels.device | query }}{{ . | first | value | humanize }}B/s{{end}}</td>
  </tr>{{ end }}
</table>
```

Here we iterate over all network devices and display the network traffic for each.

As the `range` action does not specify a variable, `.Params.instance` is not available inside the loop as `.` is now the loop variable.

## Defining reusable templates

Prometheus supports defining templates that can be reused. This is particularly powerful when combined with [console library](https://prometheus.io/docs/prometheus/latest/configuration/template_reference/#console-templates) support, allowing sharing of templates across consoles.

```
{{/* Define the template */}}
{{define "myTemplate"}}
  do something
{{end}}

{{/* Use the template */}}
{{template "myTemplate"}}
```

Templates are limited to one argument. The `args` function can be used to wrap multiple arguments.

```
{{define "myMultiArgTemplate"}}
  First argument: {{.arg0}}
  Second argument: {{.arg1}}
{{end}}
{{template "myMultiArgTemplate" (args 1 2)}}
```

# Template reference

- [Data Structures ](https://prometheus.io/docs/prometheus/latest/configuration/template_reference/#data-structures)
- [Functions ](https://prometheus.io/docs/prometheus/latest/configuration/template_reference/#functions)
  - [Queries ](https://prometheus.io/docs/prometheus/latest/configuration/template_reference/#queries)
  - [Numbers ](https://prometheus.io/docs/prometheus/latest/configuration/template_reference/#numbers)
  - [Strings ](https://prometheus.io/docs/prometheus/latest/configuration/template_reference/#strings)
  - [Others ](https://prometheus.io/docs/prometheus/latest/configuration/template_reference/#others)
- [Template type differences ](https://prometheus.io/docs/prometheus/latest/configuration/template_reference/#template-type-differences)
  - [Alert field templates ](https://prometheus.io/docs/prometheus/latest/configuration/template_reference/#alert-field-templates)
  - [Console templates ](https://prometheus.io/docs/prometheus/latest/configuration/template_reference/#console-templates)

Prometheus supports templating in the annotations and labels of alerts, as well as in served console pages. Templates have the ability to run queries against the local database, iterate over data, use conditionals, format data, etc. The Prometheus templating language is based on the [Go templating](https://golang.org/pkg/text/template/) system.

## Data Structures

The primary data structure for dealing with time series data is the sample, defined as:

```
type sample struct {
        Labels map[string]string
        Value  float64
}
```

The metric name of the sample is encoded in a special `__name__` label in the `Labels` map.

`[]sample` means a list of samples.

`interface{}` in Go is similar to a void pointer in C.

## Functions

In addition to the [default functions](https://golang.org/pkg/text/template/#hdr-Functions) provided by Go templating, Prometheus provides functions for easier processing of query results in templates.

If functions are used in a pipeline, the pipeline value is passed as the last argument.

### Queries

| Name        | Arguments        | Returns  | Notes                                                        |
| ----------- | ---------------- | -------- | ------------------------------------------------------------ |
| query       | query string     | []sample | Queries the database, does not support returning range vectors. |
| first       | []sample         | sample   | Equivalent to `index a 0`                                    |
| label       | label, sample    | string   | Equivalent to `index sample.Labels label`                    |
| value       | sample           | float64  | Equivalent to `sample.Value`                                 |
| sortByLabel | label, []samples | []sample | Sorts the samples by the given label. Is stable.             |

`first`, `label` and `value` are intended to make query results easily usable in pipelines.

### Numbers

| Name               | Arguments        | Returns    | Notes                                                        |
| ------------------ | ---------------- | ---------- | ------------------------------------------------------------ |
| humanize           | number or string | string     | Converts a number to a more readable format, using [metric prefixes](https://en.wikipedia.org/wiki/Metric_prefix). |
| humanize1024       | number or string | string     | Like `humanize`, but uses 1024 as the base rather than 1000. |
| humanizeDuration   | number or string | string     | Converts a duration in seconds to a more readable format.    |
| humanizePercentage | number or string | string     | Converts a ratio value to a fraction of 100.                 |
| humanizeTimestamp  | number or string | string     | Converts a Unix timestamp in seconds to a more readable format. |
| toTime             | number or string | *time.Time | Converts a Unix timestamp in seconds to a time.Time.         |

Humanizing functions are intended to produce reasonable output for consumption by humans, and are not guaranteed to return the same results between Prometheus versions.

### Strings

| Name          | Arguments                  | Returns | Notes                                                        |
| ------------- | -------------------------- | ------- | ------------------------------------------------------------ |
| title         | string                     | string  | [strings.Title](https://golang.org/pkg/strings/#Title), capitalises first character of each word. |
| toUpper       | string                     | string  | [strings.ToUpper](https://golang.org/pkg/strings/#ToUpper), converts all characters to upper case. |
| toLower       | string                     | string  | [strings.ToLower](https://golang.org/pkg/strings/#ToLower), converts all characters to lower case. |
| stripPort     | string                     | string  | [net.SplitHostPort](https://pkg.go.dev/net#SplitHostPort), splits string into host and port, then returns only host. |
| match         | pattern, text              | boolean | [regexp.MatchString](https://golang.org/pkg/regexp/#MatchString) Tests for a unanchored regexp match. |
| reReplaceAll  | pattern, replacement, text | string  | [Regexp.ReplaceAllString](https://golang.org/pkg/regexp/#Regexp.ReplaceAllString) Regexp substitution, unanchored. |
| graphLink     | expr                       | string  | Returns path to graph view in the [expression browser](https://prometheus.io/docs/visualization/browser/) for the expression. |
| tableLink     | expr                       | string  | Returns path to tabular ("Table") view in the [expression browser](https://prometheus.io/docs/visualization/browser/) for the expression. |
| parseDuration | string                     | float   | Parses a duration string such as "1h" into the number of seconds it represents. |
| stripDomain   | string                     | string  | Removes the domain part of a FQDN. Leaves port untouched.    |

### Others

| Name       | Arguments             | Returns                | Notes                                                        |
| ---------- | --------------------- | ---------------------- | ------------------------------------------------------------ |
| args       | []interface{}         | map[string]interface{} | This converts a list of objects to a map with keys arg0, arg1 etc.  This is intended to allow multiple arguments to be passed to templates. |
| tmpl       | string, []interface{} | nothing                | Like the built-in `template`, but allows non-literals as  the template name. Note that the result is assumed to be safe, and will  not be auto-escaped. Only available in consoles. |
| safeHtml   | string                | string                 | Marks string as HTML not requiring auto-escaping.            |
| pathPrefix | *none*                | string                 | The external URL [path](https://pkg.go.dev/net/url#URL) for use in console templates. |

## Template type differences

Each of the types of templates provide different information that can be used to parameterize templates, and have a few other differences.

### Alert field templates

`.Value`, `.Labels`, `.ExternalLabels`, and `.ExternalURL` contain the alert value, the alert labels, the globally configured external labels, and the external URL (configured with `--web.external-url`) respectively. They are also exposed as the `$value`, `$labels`, `$externalLabels`, and `$externalURL` variables for convenience.

### Console templates

Consoles are exposed on `/consoles/`, and sourced from the directory pointed to by the `-web.console.templates` flag.

Console templates are rendered with [html/template](https://golang.org/pkg/html/template/), which provides auto-escaping. To bypass the auto-escaping use the `safe*` functions.,

URL parameters are available as a map in `.Params`. To access multiple URL parameters by the same name, `.RawParams` is a map of the list values for each parameter. The URL path is available in `.Path`, excluding the `/consoles/` prefix. The globally configured external labels are available as `.ExternalLabels`. There are also convenience variables for all four: `$rawParams`, `$params`, `$path`, and `$externalLabels`.

Consoles also have access to all the templates defined with `{{define "templateName"}}...{{end}}` found in `*.lib` files in the directory pointed to by the `-web.console.libraries` flag. As this is a shared namespace, take care to avoid clashes with other users. Template names beginning with `prom`, `_prom`, and `__` are reserved for use by Prometheus, as are the functions listed above.