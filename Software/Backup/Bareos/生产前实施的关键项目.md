# 生产前实施的关键项目

We recommend you take your time before implementing a production on a Bareos backup system since Bareos is a rather complex program, and if  you make a mistake, you may suddenly find that you cannot restore your  files in case of a disaster. This is especially true if you have not  previously used a major backup product.

建议在 Bareos 备份系统上实施生产之前花点时间，因为 Bareos 是一个相当复杂的程序，如果您犯了错误，您可能会突然发现在发生灾难时无法恢复文件。如果您以前没有使用过主要的备份产品，则更是如此。

如果您按照本章的说明进行操作，您将涵盖可能发生的大多数主要问题。不用说，如果你发现我们遗漏了一个重要的问题，请通知我们，这样我们就可以记录下来，以造福于每个人。

If you follow the instructions in this chapter, you will have covered most of the major problems that can occur. It goes without saying that  if you ever find that we have left out an important point, please inform us, so that we can document it to the benefit of everyone.

## Critical Items关键项目

The following assumes that you have installed Bareos, you more or  less understand it, you have at least worked through the tutorial or  have equivalent experience, and that you have set up a basic production  configuration. If you haven’t done the above, please do so and then come back here. The following is a sort of checklist that points with  perhaps a brief explanation of why you should do it. In most cases, you  will find the details elsewhere in the manual. The order is more or less the order you would use in setting up a production system (if you already are in  production, use the checklist anyway).

以下内容假设您已经安装了Bareos，您或多或少地了解它，您至少已经完成了教程或具有同等经验，并且您已经设置了基本的生产配置。如果您还没有完成以上操作，请完成后再返回此处。下面是一个清单，也许是一个简短的解释，为什么你应该这样做。在大多数情况下，你会发现在手册的其他地方的细节。该顺序或多或少是您在设置生产系统时使用的顺序（如果您已经在生产中，请使用检查表）。

- Test your tape drive for compatibility with Bareos by using the test command of the [btape](https://docs.bareos.org/Appendix/BareosPrograms.html#btape) program.

- Test the end of tape handling of your tape drive by using the fill command in the [btape](https://docs.bareos.org/Appendix/BareosPrograms.html#btape) program.

- Do at least one restore of files. If you backup  multiple OS types (Linux, Solaris, HP, MacOS, FreeBSD, Win32, …),  restore files from each system type. The [Restoring Files](https://docs.bareos.org/TasksAndConcepts/TheRestoreCommand.html#restorechapter) chapter shows you how.

- Write a bootstrap file to a separate system for each backup job. See [`Write Bootstrap (Dir->Job)`](https://docs.bareos.org/Configuration/Director.html#config-Dir_Job_WriteBootstrap) directive and more details are available in the [The Bootstrap File](https://docs.bareos.org/Appendix/TheBootstrapFile.html#bootstrapchapter) chapter. Also, the default `bareos-dir.conf` comes with a Write Bootstrap directive defined. This allows you to recover the state of your system as of the last backup.

- Backup your catalog. An example of this is found in the default bareos-dir.conf file. The backup script is installed by  default and should handle any database, though you may want to make your own local modifications. See also [Backing Up Your Bareos Database](https://docs.bareos.org/TasksAndConcepts/CatalogMaintenance.html#backingupbareos) for more information.

- Write a bootstrap file for the catalog. An example  of this is found in the default bareos-dir.conf file. This will allow  you to quickly restore your catalog in the event it is wiped out –  otherwise it is many excruciating hours of work.

- Make a copy of the bareos-dir.conf, bareos-sd.conf, and bareos-fd.conf files that you are using on your server. Put it in a safe place (on another machine) as these files can be difficult to  reconstruct if your server dies.

- Bareos assumes all filenames are in UTF-8 format.  This is important when saving the filenames to the catalog. For Win32  machine, Bareos will automatically convert from Unicode to UTF-8, but on Unix, Linux, *BSD, and MacOS X machines, you must explicitly ensure  that your locale is set properly. Typically this means that the LANG  environment variable must end in .UTF-8. A full example is en_US.UTF-8.  The exact syntax may vary a bit from OS to OS, and exactly how you  define it will also vary.

  On most modern Win32 machines, you can edit the conf files with notepad and choose output encoding UTF-8.
  
  使用btape程序的test命令测试磁带机与Bareos的兼容性。
  
  使用btape程序中的fill命令测试磁带驱动器的磁带结束处理。
  
  至少执行一次文件还原。如果备份多个操作系统类型（Linux、Solaris、HP、MacOS、FreeBSD、Win32等），请从每个系统类型还原文件。“恢复文件”一章将向您展示如何恢复文件。
  
  为每个备份作业将引导文件写入单独的系统。请参阅Write Bootstrap（Dir->Job）指令，更多细节请参阅The Bootstrap File一章。此外，默认的bareos-dir.conf带有一个定义的WriteBootstrap指令。这使您可以恢复到上次备份时的系统状态。
  
  备份您的目录。在默认的bareos-dir.conf文件中可以找到一个这样的示例。备份脚本默认情况下安装，应该处理任何数据库，尽管您可能希望进行自己的本地修改。有关详细信息，请参阅备份Bareos数据库。
  
  为目录编写引导文件。在默认的bareos-dir.conf文件中可以找到一个这样的示例。这将允许您在目录被删除时快速恢复目录-否则将需要花费许多痛苦的工作时间。
  
  复制服务器上正在使用的bareos-dir.conf、bareos-sd.conf和bareos-fd.conf文件。把它放在一个安全的地方（在另一台机器上），因为这些文件可能很难重建，如果你的服务器死亡。
  
  Bareos假设所有文件名都是UTF-8格式。这在将文件名保存到目录时很重要。对于Win32机器，Bareos将自动从Unicode转换为UTF-8，但在Unix、Linux、*BSD和MacOS X机器上，您必须明确确保正确设置了区域设置。通常这意味着LANG环境变量必须以.UTF-8结尾。一个完整的例子是en_US.UTF-8。确切的语法可能会因操作系统的不同而有所不同，您如何定义它也会有所不同。
  
  在大多数现代Win32机器上，您可以使用记事本编辑conf文件并选择输出编码UTF-8。

## Recommended Items推荐项目

虽然这些项目可能不是关键的，但它们是推荐的，可以帮助您避免问题。

- Read the [Getting Started with Bareos](https://docs.bareos.org/IntroductionAndTutorial/GettingStartedWithBareos.html#quickstartchapter) chapter

- 阅读Bareos入门章节

  在安装和试用Bareos之后，请仔细阅读本手册第二章中的示例。

  了解每个Bareos程序的作用。
  设置合理的保留期，使您的目录不会增长太大。参见以下三章：
  自动卷回收，
  卷管理，
  自动磁盘备份。

- After installing and experimenting with Bareos, read and work carefully through the examples in the [Tutorial](https://docs.bareos.org/IntroductionAndTutorial/Tutorial.html#tutorialchapter) chapter of this manual.

- Learn what each of the [Bareos Programs](https://docs.bareos.org/Appendix/BareosPrograms.html#section-utilities) does.

- Set up reasonable retention periods so that your catalog does not grow to be too big. See the following three chapters:

  [Automatic Volume Recycling](https://docs.bareos.org/TasksAndConcepts/VolumeManagement.html#recyclingchapter),

  [Volume Management](https://docs.bareos.org/TasksAndConcepts/VolumeManagement.html#diskchapter),

  [Automated Disk Backup](https://docs.bareos.org/TasksAndConcepts/AutomatedDiskBackup.html#poolschapter).

If you absolutely must implement a system where you write a different tape each night and take it offsite in the morning. We recommend that  you do several things:如果你绝对必须实现一个系统，你每天晚上写一个不同的磁带，早上把它带离现场。我们建议您做几件事：

- Write a bootstrap file of your backed up data and a bootstrap file  of your catalog backup to a external media like CDROM or USB stick, and  take that with the tape. If this is not possible, try to write those  files to another computer or offsite computer, or send them as email to a friend. If none of that is possible, at least print the bootstrap files and take that offsite with the tape. Having the bootstrap files will  make recovery much easier.
- 将备份数据的引导文件和目录备份的引导文件写入外部介质（如CDROM或USB棒），并将其与磁带一起使用。如果这是不可能的，请尝试将这些文件写入另一台计算机或异地计算机，或将其作为电子邮件发送给朋友。如果这些都不可能，至少打印引导文件，并将其与磁带一起带离现场。拥有引导文件将使恢复更容易。
- It is better not to force Bareos to load a particular tape each day. Instead, let Bareos choose the tape. If you need to know what tape to  mount, you can print a list of recycled and appendable tapes daily, and  select any tape from that list. Bareos may propose a particular tape for use that it considers optimal, but it will accept any valid tape from  the correct pool.
- 最好不要强迫Bareos每天加载特定的磁带。相反，让Bareos选择磁带。如果您需要知道要装入的磁带，可以每天打印回收磁带和可追加磁带的列表，并从该列表中选择任何磁带。Bareos可能会建议使用它认为最佳的特定磁带，但它将接受来自正确池的任何有效磁带。