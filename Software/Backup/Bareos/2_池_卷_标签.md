# 池、卷和标签

如果您一直在使用 tar 等程序来备份系统，那么池、卷和标签一开始可能会有点混乱。卷是 Bareos 将在其上写入备份数据的单个物理磁带（或可能是单个文件）。池将卷分组在一起，以便备份不限于单个卷（磁带）的长度。因此，不必在作业中显式命名卷，而是指定一个池，Bareos 将从池中选择下一个可追加卷并装载它。

虽然基本的池选项是在 Director 的池资源中指定的，但真实的的池是在 Bareos 目录中维护的。它包含从池资源（配置文件）获取的信息以及已添加到池的所有卷的信息。

对于每个卷，Bareos 维护大量的目录信息，例如第一次写入日期/时间、最后一次写入日期/时间、卷上的文件数、卷上的字节数、装载数等。

在 Bareos 读取或写入卷之前，物理卷必须具有 Bareos 软件标签，以便 Bareos 可以确保装载了正确的卷。根据您的配置，这可以由 Bareos 自动完成，也可以使用 Console 程序中的 label 命令手动完成。

创建池、向其中添加卷以及向卷写入软件标签的步骤，起初可能看起来很繁琐，但实际上，这些步骤非常简单，并且允许您使用多个卷（而不是限制在单个磁带的大小）。池还为您在备份过程中提供了极大的灵活性。例如，您可以使用“每日”卷池进行增量备份，使用“每周”卷池进行完整备份。通过在每日备份作业和每周备份作业中指定适当的池，可以确保每日作业不会写入每周备份池中的卷，反之亦然，Bareos 将告诉您需要什么磁带以及何时需要。

## 池

创建池是在 Bareos Director 启动时自动完成的。

当您运行备份作业时，Bareos 必须知道的一件事是使用什么磁盘。与直接指定卷（磁带）不同，you specify which Pool of Volumes you want Bareos to consult when it  wants a Volume for writing backups.可以指定希望 Bareos 在需要卷用于写入备份时参考哪个磁盘池。Bareos will select the first  available Volume from the Pool that is appropriate for the [`Storage (Dir->Job)`](https://docs.bareos.org/Configuration/Director.html#config-Dir_Job_Storage) you have specified for the Job being run. Bareos 将从池中选择第一个适用于您为正在运行的作业指定的存储`Storage (Dir->Job)`的可用卷。当一个卷已被数据填满时，Bareos 将其 `VolStatus` 从 `Append` 更改为 `Full` ，然后 Bareos 将使用下一个卷，依此类推。如果池中不存在可追加的卷，则 Director 将尝试回收旧卷。

如果仍然没有可用的附加卷，Bareos 将发送一条消息，请求操作员创建一个适当的卷。

Bareos 跟踪池名称、池中包含的卷以及每个卷的许多属性。

当 Bareos 启动时，它确保所有池资源定义都已记录在目录中。可以通过输入以下内容进行验证：

```bash
*list pools
+--------+--------------+---------+---------+----------+---------------+
| PoolId | Name         | NumVols | MaxVols | PoolType | LabelFormat   |
+--------+--------------+---------+---------+----------+---------------+
| 1      | Full         | 1       | 100     | Backup   | Full-         |
| 2      | Differential | 0       | 100     | Backup   | Differential- |
| 3      | Incremental  | 1       | 100     | Backup   | Incremental-  |
| 4      | Scratch      | 0       | 0       | Backup   | *             |
+--------+--------------+---------+---------+----------+---------------+
```

### 向池中添加卷

If you have used the label command to label a Volume, it will be  automatically added to the Pool, and you will not need to add any media  to the pool.

Alternatively, you may choose to add a number of Volumes to the pool  without labeling them. At a later time when the Volume is requested by  Bareos you will need to label it.

Before adding a volume, you must know the following information:

1. The name of the Pool (normally “Default”)
2. The Media Type as specified in the Storage Resource in the Director’s configuration file (e.g. “DLT8000”)
3. The number and names of the Volumes you wish to create.

For example, to add media to a Pool, you would issue the following commands to the console program:

如果您已使用label命令标记某个卷，则该卷将自动添加到池中，而您无需向池中添加任何介质。

或者，您可以选择向池中添加多个对象而不对其进行标记。以后当Bareos请求卷时，您将需要对其进行标记。

在添加卷之前，您必须了解以下信息：

    池的名称（通常为“Default”）
    
    在控制器配置文件的存储资源中指定的介质类型（例如“DLT 8000”）
    
    要创建的对象的编号和名称。

例如，要将介质添加到池中，您可以向控制台程序发出以下命令：

```
*add
Enter name of Pool to add Volumes to: Default
Enter the Media Type: DLT8000
Enter number of Media volumes to create. Max=1000: 10
Enter base volume name: Save
Enter the starting number: 1
10 Volumes created in pool Default
*
```

To see what you have added, enter:

```
*list media pool=Default
+-------+----------+---------+---------+-------+------------------+
| MedId | VolumeNa | MediaTyp| VolStat | Bytes | LastWritten      |
+-------+----------+---------+---------+-------+------------------+
|    11 | Save0001 | DLT8000 | Append  |     0 | 0000-00-00 00:00 |
|    12 | Save0002 | DLT8000 | Append  |     0 | 0000-00-00 00:00 |
|    13 | Save0003 | DLT8000 | Append  |     0 | 0000-00-00 00:00 |
|    14 | Save0004 | DLT8000 | Append  |     0 | 0000-00-00 00:00 |
|    15 | Save0005 | DLT8000 | Append  |     0 | 0000-00-00 00:00 |
|    16 | Save0006 | DLT8000 | Append  |     0 | 0000-00-00 00:00 |
|    17 | Save0007 | DLT8000 | Append  |     0 | 0000-00-00 00:00 |
|    18 | Save0008 | DLT8000 | Append  |     0 | 0000-00-00 00:00 |
|    19 | Save0009 | DLT8000 | Append  |     0 | 0000-00-00 00:00 |
|    20 | Save0010 | DLT8000 | Append  |     0 | 0000-00-00 00:00 |
+-------+----------+---------+---------+-------+------------------+
*
```

Notice that the console program automatically appended a number to  the base Volume name that you specify (Save in this case). If you don’t  want it to append a number, you can simply answer 0 (zero) to the  question “Enter number of Media volumes to create. Max=1000:”, and in  this case, it will create a single Volume with the exact name you  specify.



