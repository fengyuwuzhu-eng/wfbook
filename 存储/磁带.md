# 磁带

磁带设备应只用于定期的文件归档或将数据从一台服务器传送至另一台。通常磁带设备与 Unix 机器连接，用 mt 或 mtx 控制。

## 术语

* **存储容量：** 指整个磁介质表面能记录的二进制数码的总量，与记录介质的长度和记录密度直接相关。
* **记录密度：** 每英寸磁带所记录的二进制代码的位数。与磁带机轨数有关。每毫米32位，63位和246位。
* **存取时间：** 磁头从起始位置移动到指定位置，并开始读写数据所需的时间。用平均值来衡量。与走带速度和带长有关。
* **数据传输速率：** 单位时间内所能读写的二进制代码数量。与位密度和记录介质的运动速度成正比。
* **记录格式：** 对磁带记录内容和记录位置所做的规定。目前采用的记录格式由美国地球物理勘探协会（SEG）制定的标准，SEG-A,SEG-B,SEG-C,SEG-D,SEG-Y,SEG-2等

## 磁带技术

**8mm** 由Exabyte公司在1987年开发，采用螺旋扫描技术，其特点是磁带容量大，传输速率高。8mm磁带机的发展经历了8200、8500、8500c和8900（mammoth）的数据格式，容量从最初的2GB发展到现在的40GB，传输速率最快可达6M/s。新一代的Mammoth-2指标又进一步提升，存储容量达到150GB（非压缩60GB）传输速率30M/s（非压缩12M/s）。主要制造商是Exabyte公司。MammothTap技术是由MammothTap技术磁带机和AME系列介质组成。Mammoth驱动器是螺旋扫描的记录方式，8mm磁带与DLT磁带相比既薄又窄，节省了大量的空间。Mammoth是使用磁鼓来读写8mm磁带的，磁鼓上有8个磁头。在写磁带的时候，有四个磁头用来写，有四个磁头用来校验写的数据，在读的时候8个磁头都用来读数据，写满整盘磁带走带次数只需要一次，大量的磨损了磁带和磁头。Mammoth驱动器的走带路径很简捷，供带轮和走带轮在同一个盒子内，而线性磁带走带路径需要一个引导头以到达走带轮。由于Mammoth的走带速度低而且磁带与磁头间不完全接触留有空气层，所以磁带所受的张力就小，磁带的使用寿命比较长。智能自动清洗功能，自带的动态磁头清洗轮自动清除磁头上的污染物。

**ADR** (高级数字记录技术，Advanced Digital Recording）是由Philips所研发，特征是具有可变速度。ADR技术采192轨设计，目前已有一种比较新的ADR2技术（384轨），如Onstream ADR2 60Si等产品。它的压缩容量是60GB，非压缩容量则为30GB。
ADR磁带技术属于一种早期的磁带技术。ADR磁带机的传输速率会视计算机传送到磁盘驱动器的数据多少而定，所以磁带机不必停下来重新定位，造成数据传输速率下降。由于它的传输速率通常在2MB/s以内，存储容量通常也在50GB以内，所以在企业备份存储中很少使用了。

**AIT** Sony（索尼）的AIT（Advanced Intelligent Tape，高级智能磁带），目前最新版本为AIT-4。采用螺旋扫描技术（Helical Scan Technology），透过旋转滚筒进行倾斜写入操作。磁带在设计上类似于DDS，不过尺寸比较大。AIT采用独具效率的ALDC（Advanced Lossless Data Compression，高级非失真数据压缩）功能，内置在磁带里的64K位记忆芯片（MIC，Memory-in-Cassette），能够加速磁带的存取。AIT-1的容量可达35 GB，AIT-2可达50 GB，而AIT-3则可达100 GB，AIT-4的最高容量已达到200GB。

**DAT** （Digital Audio Tape，数字音频磁带）技术也称为DDS（Digital Data Storage，数字数据存储）技术，最初是有惠普公司（HP）与索尼公司（SONY）共同开发出来的。目前这一磁带格式技术仍主要由HP主导，它开发了第七代DAT技术。DAT技术允许并发磁道，以实现不同的写角与重叠，同时，由于无需保护带，它可在给定长度的磁带上实现更高的容量。目前，HP StorageWorks DAT磁带备份产品包括DAT 72、DAT 40、以及DAT24。DDS-4 的下一代产品StorageWorks DAT 72（也称“DAT的第七代产品”）。DAT 72磁带驱动器和数据盒式磁带机的使用，在3.5个小时内可以使存储容量高达72GB，数据传送速率达到6MB/s，压缩率达到2:1。DAT 72能够与DDS-3和DDS-4实现后向读写。

这种技术以螺旋扫描记录（Helical Scan Recording）为基础，将数据转化为数字后再存储下来，早期的DAT技术主要应用于声音的记录，后来随着这种技术的不断完善，又被应用在数据存储领域里。DAT技术主要应用于用户系统或局域网。

即写即读功能能在数据被写入之后马上进行检测，这不仅确保了数据的可靠性，而且还节省了大量时间。

**DLT** DLT（Digital Linear Tape）又称为数字线型磁带技术，最早于1985年由DEC公司开发,主要应用于VAX系统。DLT技术采用单轴1/2英寸磁带仓，以纵向曲线性记录法为基础。目前DLT驱动器的容量从10GB到80GB不等，数据传送速度相应由1.25MB/S至6MB/S。在DLT磁带匣里只用到一个线轴将磁带卷起来。磁带的尾端有一个大环，当磁带匣安装到磁带机上时，磁带会从里头被抽出来，卷到磁带机里的线轴上。里头采用引导滚轮设计，不过在卷的时候数据面不会接触到任何滚轮。只有读写头会接触到数据面。

**LTO** (Linear Tape Open，开放性线型磁带）由HP、IBM、Seagate这三家厂商在1997年11月联合制定的，是目前应用最广，最有发展前途的一种开放型磁带格式技术。它结合了线性多通道、双向磁带格式的优点，基于服务系统、硬件数据压缩、优化的磁道面和高效率纠错技术，提高了磁带的读写能力和性能。采用LTO技术的产品工作方式与DLT磁带机类似。磁带匣里，也采用单一线轴设计，将600公尺长的磁带卷起来。当安装到磁带机上时，一样会卷到磁带机内部的线轴上。每个磁带匣里都内置4KB的记忆芯片，以确保不间断的数据沟通。除此之外，磁带机也会将磁带索引、序号、第一次使用日期与使用历程记录等信息存在这里头。目前，LTO具有两种存储格式：高速开放磁带格式傲群（Ultrium）和快速访问开放磁带格式（Accelis），定制两种格式是因为并不是所有的用户都要求相同的特性和功能性。一些应用程序强调重点在于“写”，要求最高的磁带存储能力。而另一些应用程序则重点在“读”，要求快速的数据访问速度。这两种格式都使用同样的头、介质磁道面、通道和服务技术，并共享许多普通的代码部分。因为目前存储用户更偏重于对存储容量的需求，所以两种格式相比较而言，Ultrium格式是当今存储业界更值得关注的技术，它是由IBM开发和主导的。由于IBM第二代LTO（LTO-2）产品采用了增强型磁带表面控制导引技术，可以降低磁带磨损，提高可靠性和耐用型。而其具有的动态速度匹配技术可以减少重定位操作，增强可靠性，并提高性能。而ECC纠错码和IBM独有的内置统计分析和报告系统（Statical Analysis and Reporting System）具有更强大的错误隔离保护机制，确保数据完整性。

LTO技术是一种“开放格式”的技术，将生产许可开放给存储介质、磁带机的生产商，使不同厂商的产品能更好地进行兼容，这意味着用户将拥有多项产品和介质。LTO还特别规定，由第三方进行每年一次的兼容测试，以确保产品的延续性更好。

**Super DLT** 从DLT技术中衍生出来的，由昆腾（Quantum）公司开发。在昆腾开发的激光引导磁性记录（LGMR）技术基础上，Super DLT磁带采用一种完全不同的先进技术来进行磁带记录。LGMR提供一种光和磁技术的独一无二的结合，通过增加介质数据承载面记录轨道的数目大幅度地增加容量。另外，Super DLT系统利用昆腾公司自己发明的旋转光伺服（POS）技术，可不再要求预先格式化磁带。通过读取在未使用的介质反面预先录制的光伺服轨迹，能够百分之百使用介质正面进行数据记录。PRML通道技术，是昆腾公司与美国朗讯一道开发，将更高水平的性能和容量带给高性能线性磁带机。高级PRML提供高效的解码记录密度，以获得更大的容量和性能，使SuperDLT磁带系统能够充分地提升磁带存储容量和传输速度。Super DLT磁带系统使用先进的金属粉质（AMP）介质技术，可储存非常高密度的数据。AMP介质有四层，包括接收光伺服轨迹的反面涂层。其他先进技术包括一个新的磁带头扣接机械、不规则磁带盒接收器和一个即插即用模件设计，保证了长期的可靠性和数据的完整性，以满足全球客户备份和数据存储归档的需求。对于高端服务器市场，昆腾提供存储能力320GB、数据传输速率超过32MB每秒的Super DLT磁带系统。适合此类高端用户的应用包括运行企业关键任务程序的网络UNIX和大型NT系统。该型号也适合为高终端磁带库自动化市场服务。对于中幅服务器市场，昆腾提供存储能力220GB、数据传输速度22MB每秒的Super DLT磁带系统。该型号为大型公司部门中局域网或单机程序环境下运行的中幅UNIX和NT系统提供出色的数据备份和归档存储。

**SLR** Tandberg（腾保）公司的SLR（比例线性记录，Scale Linear Recording）技术能够储存达50 GB的数据，传输速率则可达每秒5 MB，磁带容量和存储速度性能都一般，主要在小型企业中使用。另外3M （怡敏信）公司也OEM这种格式的磁带产品。磁带匣采用金属外壳，外观看起来像QIC磁带，其它技术方面也和QIC磁带机很类似。SLR采用一般的线性轨段，可同时记录四个数据轨。因为数据密度也很高，所以SLR也采用PRML技术作信号侦错。

**QIC** 也称“Travan”格式，由3M公司80年代初期随着DC6000格式推出的。从TR-1/TR-3一直发展到TR-4、TR-5。近年来Travan技术在容量、可靠性等方面取得了一定的进展，具备了数据压缩和即写即读等功能。这类磁带机的磁带宽度为1/4英寸，其盒式磁带也被称作1/4英寸磁带。目前主要由Tandberg（腾保）数据公司采用，其最新产品当然是采用TR-5格式的，最高容量为10GB，持续传输速率仅1MB/s。

**VXA** 由Exabyte公司主导的，目前也属于一种开放型磁带格式技术标准。它特别重视数据的保护，以及当磁带机更换或环境影响（湿气、温度等）时磁带的可读性。为了达到这个目的，两组轮轴（螺旋扫描技术）上的读写头在写入时会采串联方式。首先第一个读写头写入数据，第二个读写头会读取数据以确定正确性。如果发生错误，那么将重新写入轨段。在读取时两个读写头也会相互搭配，并先后读取同一个轨段。如果这样还无法成功读取数据，磁带机会把四个读写头都用在读取数据上。就算轨段过于倾斜，仍旧可以读取。  
(1）高可靠性和经济性。VXA使用非连续数据包格式技术（DPF），以小数据包读写数据，创造了高可靠性和经济性的数据传输方法。  
(2）可靠的数据恢复能力。VXA使用无缝隙扫描操作技术（OSO），其独特性在于以多次扫描的方式读数据包，赋予用户在存储业界空前可靠的数据恢复能力。  
(3）可靠的磁带驱动能力。不同于传统的磁带驱动器，VXA磁带机通过自动调节磁带移动易和主机的传输速率相匹配，完全消除磁带“回扯”问题。显著的提高介质和驱动器的可靠性，并且优化了备份和存储。  
(4）存储容量大。VXA－2使用不同长度的磁带，容量可分别达到20/40GB、40/80GB、59/118GB、80/160GB。  
(5）速度快。VXA －1磁带驱动器比同价位的DDS－4的实测速度要快一倍、可靠性高很多，容量高出60％（非压缩状态33GB），速度VXA-2可达每秒12MB（非压缩3MB），并且可自动变速。  
(6）高的存储寿命。VXA磁带机使用AME介质，支持所有应用所需的不同容量。VXAtape磁带使用寿命2万次，是DDSMP磁带的200倍。VXAtape磁带存档寿命为30年，而DDSMP 磁带存档寿命只有10年。  

## 磁带机分类

### 带速
高速机，中速机，低速机

### 磁带的缓冲方式
真空缓冲箱式，摆杆式

### 读写磁带的方式
数据流磁带机，螺旋扫描磁带机

## 磁带文件标记和块大小

![](../Image/a/p.jpg)

每个磁带设备能存储多个备份文件。磁带备份文件通过 cpio，tar，dd 等命令创建。同时，磁带设备可以由多种程序打开、写入数据、及关闭。你可以存储若干备份（磁带文件）到一个物理磁带上。在每个磁带文件之间有个“磁带文件标记”。这用来指示一个物理磁带上磁带文件的结尾以及另一个文件的开始。你需要使用 mt 命令来定位磁带（快进，倒带和标记）。磁头在空白间隔内启停。

## 磁带上的数据存储

![](../Image/a/q.jpg)

所有的数据使用 tar 以连续磁带存储格式连续地存储。第一个磁带归档会从磁带的物理开始端开始存储（tar #0）。接下来的就是 tar #1，以此类推。常用的标准格式有不归零（NRZI）、相位编码（PE）和成组编码（GCR）三种。

## Unix 上的磁带设备名

    /dev/rmt/0 或 /dev/rmt/1 或 /dev/rmt/[0-127] ：Unix 上的常规磁带设备名。磁带自动倒回。
    /dev/rmt/0n ：以无倒回为特征，换言之，磁带使用之后，停留在当前状态等待下个命令。
    /dev/rmt/0b ：使用磁带接口，也就是 BSD 的行为。各种类型的操作系统比如 AIX，Windows，Linux，FreeBSD 等的行为更有可读性。
    /dev/rmt/0l ：设置密度为低。
    /dev/rmt/0m ：设置密度为中。
    /dev/rmt/0u ：设置密度为高。
    /dev/rmt/0c ：设置密度为压缩。
    /dev/st[0-9] ：Linux 特定 SCSI 磁带设备名。
    /dev/sa[0-9] ：FreeBSD 特定 SCSI 磁带设备名。
    /dev/esa0 ：FreeBSD 特定 SCSI 磁带设备名，在关闭时弹出（如果可以的话）。

磁带设备名示例

    /dev/rmt/1cn 指明正在使用 unity 1，压缩密度，无倒回。
    /dev/rmt/0hb 指明正在使用 unity 0，高密度，BSD 行为。
    Linux 上的自动倒回 SCSI 磁带设备名：/dev/st0
    Linux 上的无倒回 SCSI 磁带设备名：/dev/nst0
    FreeBSD 上的自动倒回 SCSI 磁带设备名：/dev/sa0
    FreeBSD 上的无倒回 SCSI 磁带设备名：/dev/nsa0

## 列出已经安装的　scsi 磁带设备

    ### Linux ###
    lsscsi
    lsscsi -g

    ### IBM AIX ###
    lsdev -Cc tape
    lsdev -Cc adsm
    lscfg -vl rmt*

    ### Solaris Unix ###
    cfgadm –a
    cfgadm -al
    luxadm probe
    iostat -En

    ### HP-UX Unix ###
    ioscan Cf
    ioscan -funC tape
    ioscan -fnC tape
    ioscan -kfC tape

## mt 命令示例

在 Linux 和类 Unix 系统上，mt 命令用来控制磁带驱动器的操作，比如查看状态或查找磁带上的文件或写入磁带控制标记。下列大多数命令需要作为 root 用户执行。语法如下：

mt -f /tape/device/name operation

设置环境

你可以设置 TAPE shell 变量。这是磁带驱动器的路径名。在 FreeBSD 上默认的（如果变量没有设置，而不是 null）是 /dev/nsa0。可以通过 mt 命令的 -f 参数传递变量覆盖它，就像下面解释的那样。

 ### 添加到你的 shell 配置文件 ###
 TAPE=/dev/st1 #Linux
 TAPE=/dev/rmt/2 #Unix
 TAPE=/dev/nsa3 #FreeBSD
 export TAPE

1：显示磁带/驱动器状态

mt status  ### Use default
mt -f /dev/rmt/0  status ### Unix
mt -f /dev/st0 status ### Linux
mt -f /dev/nsa0 status ### FreeBSD
mt -f /dev/rmt/1 status ### Unix unity 1 也就是 tape device no. 1

你可以像下面一样使用 shell 循环语句遍历一个系统并定位其所有的磁带驱动器：

for d in 0 1 2 3 4 5
do
 mt -f "/dev/rmt/${d}" status
done

2：倒带

mt rew
mt rewind
mt -f /dev/mt/0 rewind
mt -f /dev/st0 rewind

3：弹出磁带

mt off
mt offline
mt eject
mt -f /dev/mt/0 off
mt -f /dev/st0 eject

4：擦除磁带（倒带，在支持的情况下卸载磁带）

mt erase
mt -f /dev/st0 erase  #Linux
mt -f /dev/rmt/0 erase #Unix

5：张紧磁带盒

如果磁带在读取时发生错误，你重新张紧磁带，清洁磁带驱动器，像下面这样再试一次：

mt retension
mt -f /dev/rmt/1 retension #Unix
mt -f /dev/st0 retension #Linux

6：在磁带当前位置写入 EOF 标记

mt eof
mt weof
mt -f /dev/st0 eof

7：将磁带前进指定的文件标记数目，即跳过指定个 EOF 标记

磁带定位在下一个文件的第一个块，即磁带会定位在下一区域的第一个块（见图01）：

mt fsf
mt -f /dev/rmt/0 fsf
mt -f /dev/rmt/1 fsf 1 #go 1 forward file/tape (see fig.01)

8：将磁带后退指定的文件标记数目，即倒带指定个 EOF 标记

磁带定位在下一个文件的第一个块，即磁带会定位在 EOF 标记之后（见图01）：

mt bsf
mt -f /dev/rmt/1 bsf
mt -f /dev/rmt/1 bsf 1 #go 1 backward file/tape (see fig.01)

这里是磁带定位命令列表：

   fsf    前进指定的文件标记数目。磁带定位在下一个文件的第一块。

   fsfm   前进指定的文件标记数目。磁带定位在前一文件的最后一块。

   bsf    后退指定的文件标记数目。磁带定位在前一文件的最后一块。

   bsfm   后退指定的文件标记数目。磁带定位在下一个文件的第一块。

   asf    磁带定位在指定文件标记数目的开始位置。定位通过先倒带，再前进指定的文件标记数目来实现。

   fsr    前进指定的记录数。

   bsr    后退指定的记录数。

   fss    （SCSI tapes）前进指定的 setmarks。

   bss    （SCSI tapes）后退指定的 setmarks。




             列出磁带机状态

             :mt -f   

             磁带机设备文件名

              status



             擦掉数据：

             mt -f

             磁带机设备文件名

              erase



             注：关于

             mt

             命令更详细的使用说明可参考

             mt

             的

             man page

             。





             磁带机操作管理命令举例：



                 $ mt -f /dev/rmt/0h retension /*

             拉紧磁带

              */

                 $ mt -f /dev/rmt/0h rewind     /*

             倒带

              */

                 $ mt

             –

             f /dev/rmt/0h status     /*

             列出磁带机状态

              */

                 $ mt -f /dev/rmt/0h erase      /*

             擦掉磁带数据

              */

             $ mt

             –

             f /dev/st0 offline  /*

             出带，将磁带卷至初始位置然后从磁带机内弹出

             */





             注意：



             1

             、擦除工作非常慢，并且对磁带有损伤，最好不要执行，



             当数据写满后，可以继续写入数据并覆盖原有数据，无须执行



             擦除动作。新磁带打开封装后立刻可以使用，不需要执行擦除



             2

             、写入数据的方法有两种：不打包直接写入文件和打包压缩后写入文件。二者各

             有优缺点。不打包直接写入文件的方法，看起来效率低，操作复杂，但是可以提高

             数据的生存率。磁带是一种线性存储的设备，所有数据紧挨着顺序写入。当磁带的

             某一点损坏的时候，其余位置的磁带还可以继续读取，其中的文件也都能读出。如

             果采用了打包压缩后写入的方法，则磁带上存储的只有一个文件。当磁带有任何一

             个地方发生了故障无法读取，则这个压缩文件将缺少一些细节，即使是一个

             bit

             的

             错误，也将导致压缩文件报告

             CRC

             错误无法解压。所以，如果是存储大量的数

             据，建议直接写入。如果是存取小文件，则最好打包并给文件名加时间标记


基本备份命令

让我们来看看备份和恢复命令。
9：备份目录（tar 格式）

tar cvf /dev/rmt/0n /etc
tar cvf /dev/st0 /etc

10：恢复目录（tar 格式）

tar xvf /dev/rmt/0n -C /path/to/restore
tar xvf /dev/st0 -C /tmp

11：列出或检查磁带内容（tar 格式）

mt -f /dev/st0 rewind; dd if=/dev/st0 of=-

### tar 格式 ###
tar tvf {DEVICE} {Directory-FileName}
tar tvf /dev/st0
tar tvf /dev/st0 desktop
tar tvf /dev/rmt/0 foo > list.txt

12：使用 dump 或 ufsdump 备份分区

### Unix 备份 c0t0d0s2 分区 ###
ufsdump 0uf /dev/rmt/0  /dev/rdsk/c0t0d0s2

### Linux 备份 /home 分区 ###
dump 0uf /dev/nst0 /dev/sda5
dump 0uf /dev/nst0 /home

### FreeBSD 备份 /usr 分区 ###
dump -0aL -b64 -f /dev/nsa0 /usr

12：使用 ufsrestore 或 restore 恢复分区

### Unix ###
ufsrestore xf /dev/rmt/0
### Unix 交互式恢复 ###
ufsrestore if /dev/rmt/0

### Linux ###
restore rf /dev/nst0
### 从磁带媒介上的第6个备份交互式恢复 ###
restore isf 6 /dev/nst0

### FreeBSD 恢复 ufsdump 格式 ###
restore -i -f /dev/nsa0

13：从磁带开头开始写入（见图02）

### 这会覆盖磁带上的所有数据 ###
mt -f /dev/st1 rewind

### 备份 home ###
tar cvf /dev/st1 /home

### 离线并卸载磁带 ###
mt -f /dev/st0 offline

从磁带开头开始恢复：

mt -f /dev/st0 rewind
tar xvf /dev/st0
mt -f /dev/st0 offline

14：从最后一个 tar 后开始写入（见图02）

### 这会保留之前写入的数据 ###
mt -f /dev/st1 eom

### 备份 home ###
tar cvf /dev/st1 /home

### 卸载 ###
mt -f /dev/st0 offline

15：从 tar number 2 后开始写入（见图02）

### 在 tar number 2 之后写入（应该是 2+1）###
mt -f /dev/st0 asf 3
tar cvf /dev/st0 /usr

### asf 等效于 fsf ###
mt -f /dev/sf0 rewind
mt -f /dev/st0 fsf 2

从 tar number 2 恢复 tar：

mt -f /dev/st0 asf 3
tar xvf /dev/st0
mt -f /dev/st0 offline

如何验证使用 tar 创建的备份磁带？

定期做全系统修复和服务测试是很重要的，这是唯一确定整个系统正确工作的途径。参见我们的验证 tar 命令磁带备份的教程以获取更多信息。
示例 shell 脚本

    #!/bin/bash
    # A UNIX / Linux shell script to backup dirs to tape device like /dev/st0 (linux)
    # This script make both full and incremental backups.
    # You need at two sets of five  tapes. Label each tape as Mon, Tue, Wed, Thu and Fri.
    # You can run script at midnight or early morning each day using cronjons.
    # The operator or sys admin can replace the tape every day after the script has done.
    # Script must run as root or configure permission via sudo.
    # -------------------------------------------------------------------------
    # Copyright (c) 1999 Vivek Gite <vivek@nixcraft.com>
    # This script is licensed under GNU GPL version 2.0 or above
    # -------------------------------------------------------------------------
    # This script is part of nixCraft shell script collection (NSSC)
    # Visit http://bash.cyberciti.biz/ for more information.
    # -------------------------------------------------------------------------
    # Last updated on : March-2003 - Added log file support.
    # Last updated on : Feb-2007 - Added support for excluding files / dirs.
    # -------------------------------------------------------------------------
    LOGBASE=/root/backup/log

    # Backup dirs; do not prefix /
    BACKUP_ROOT_DIR="home sales"

    # Get todays day like Mon, Tue and so on
    NOW=$(date +"%a")

    # Tape devie name
    TAPE="/dev/st0"

    # Exclude file
    TAR_ARGS=""
    EXCLUDE_CONF=/root/.backup.exclude.conf

    # Backup Log file
    LOGFIILE=$LOGBASE/$NOW.backup.log

    # Path to binaries
    TAR=/bin/tar
    MT=/bin/mt
    MKDIR=/bin/mkdir

    # ------------------------------------------------------------------------
    # Excluding files when using tar
    # Create a file called $EXCLUDE_CONF using a text editor
    # Add files matching patterns such as follows (regex allowed):
    # home/vivek/iso
    # home/vivek/*.cpp~
    # ------------------------------------------------------------------------
    [ -f $EXCLUDE_CONF ] && TAR_ARGS="-X $EXCLUDE_CONF"

    #### Custom functions #####
    # Make a full backup
    full_backup(){
        local old=$(pwd)
        cd /
        $TAR $TAR_ARGS -cvpf $TAPE $BACKUP_ROOT_DIR
        $MT -f $TAPE rewind
        $MT -f $TAPE offline
        cd $old
    }

    # Make a  partial backup
    partial_backup(){
        local old=$(pwd)
        cd /
        $TAR $TAR_ARGS -cvpf $TAPE -N "$(date -d '1 day ago')" $BACKUP_ROOT_DIR
        $MT -f $TAPE rewind
        $MT -f $TAPE offline
        cd $old
    }

    # Make sure all dirs exits
    verify_backup_dirs(){
        local s=0
        for d in $BACKUP_ROOT_DIR
        do
            if [ ! -d /$d ];
            then
                echo "Error : /$d directory does not exits!"
                s=1
            fi
        done
        # if not; just die
        [ $s -eq 1 ] && exit 1
    }

    #### Main logic ####

    # Make sure log dir exits
    [ ! -d $LOGBASE ] && $MKDIR -p $LOGBASE

    # Verify dirs
    verify_backup_dirs

    # Okay let us start backup procedure
    # If it is Monday make a full backup;
    # For Tue to Fri make a partial backup
    # Weekend no backups
    case $NOW in
        Mon)    full_backup;;
        Tue|Wed|Thu|Fri)    partial_backup;;
        *) ;;
    esac > $LOGFIILE 2>&1


## 第三方备份工具

    Amanda
    Bacula
    rsync
    duplicity
    rsnapshot



    mt -f /dev/st0 status

    检视磁带机的硬件信息。

    mt -f /dev/st0 erase

    将磁带机中的磁带进行数据删除动作。

    mt -f /dev/st0 rewind

    将磁带进行回带动作。

    mt -f /dev/st0 offline

    将磁带进行回带并由磁带机中退出。

    mt –f /dev/st0 unload

    将磁带由磁带机中退出。

    mt -f /dev/st0 compression off

    将硬件压缩功能关闭。


pax命令

    1.

    拷贝一个目录中所有的文件到磁带上







    使用下面的步骤来用

    pax

    命令将当前目录下的所有文件拷贝到磁带上。







    (1)

    改变到包含想要拷贝的文件的目录中。







    (2)

    向磁带驱动器中插入可写磁带。







    (3)

    输入

    pax -w -f > /dev/st0

    并回车。

    -w

    选项将当前目录里写的内容写

    到磁带上。

    -f

    选项标识出磁带驱动器。

    命令最后的据点

    (.)

    指明了当前目录。

    Pax

    命令在拷贝时并列出拷贝的文件。







    (4)

    输入

    pax -l -f < /dev/st0

    并回车。

    -l

    选项列出了磁带上的文件来确

    认已经拷贝完成的文件。







    (5)

    从磁带驱动器中拿出磁带并在磁带标签上写明文件名。







    下面的例子向驱动器

    0

    中磁带上拷贝所有文件。







    %pax -w -f > /dev/st0





    2.

    恢复磁带上所有的文件







    使用下面的步骤来用

    pax

    命令将磁带上所有的文件拷贝到当前的目录中。







    (1)

    改变到想要拷贝文件的目录中。







    (2)

    向磁带驱动器中插入可写磁带。







    (3)

    输入

    pax -r -f < /dev/st0

    并回车。

    -r

    选项将磁带上的内容读取到当

    前目录。

    -f

    选项标识磁带驱动器。命令末尾句点

    (.)

    指明当前工作目录。

    Pax

    命

    令在拷贝时并不列出拷贝文件。







    (4)

    输入

    ls -l

    并回车。







    Ls

    -l

    命令列出了当前目录下的文件及其许可权，

    以此来验证文件拷贝的完

    成。







    (5)

    从磁带驱动器中拿走磁带并在磁带标签上写下文件名。







    下面的例子显示了从驱动器

    0

    中的磁带上拷贝所有的文件。



          % pax -r -f /dev/rmt/0  





    % ls -l



## 维护

1. 请定期清洁和检查磁带机，以确保其正确操作。请将磁带存储在远离磁性设备的无尘安全位置。　　
2. 应该创建一个日志并对其进行维护，该日志用于跟踪存储每个作业(备份)的介质(磁带卷)和每个备份文件的位置。
3. 注意物理安全。在保存备份磁带的位置，应该考虑一般性的物理安全：必须保护磁带免遭偷窃、蓄意破坏以及可能的环境破坏。
4. 正确保存磁带介。一些媒介有特殊的要求，必须加以考虑。比如盒式磁带的磁带卷轴要垂直放置(垂直于地面，就像汽车的轮胎一样)，并且与驱动器接触的边朝下(从而重力把磁带拖离磁带轴)。

## 厂商

HP  
IBM  
FUJITSU


The default tape device to operate on is taken from the file /usr/include/sys/mtio.h when mt is compiled. It can be overridden by giving a device file name in the environment variable TAPE or by a command line option (see below), which also overrides the environment variable.

The device must be either a character special file or a remote tape drive. To use a tape drive on another machine as the archive, use a filename that starts with 'HOSTNAME:'. The hostname can be preceded by a username and an '@' to access the remote tape drive as that user, if you have permission to do so (typically an entry in that user's '~/.rhosts' file).

The available operations are listed below. Unique abbreviations are accepted. Not all operations are available on all systems, or work on all types of tape drives. Some operations optionally take a repeat count, which can be given after the operation name and defaults to 1.
mt syntax

mt [-V] [-f device] [--file=device] [--rsh-command=command] [--version]
   operation [count]

Operations
eof, weof 	Write count EOF marks at current position.
fsf 	Forward space count files. The tape is positioned on the first block of the next file.
bsf 	Backward space count files. The tape is positioned on the first block of the next file.
fsr 	Forward space count records.
bsr 	Backward space count records.
bsfm 	Backward space count file marks. The tape is positioned on the beginning-of-the-tape side of the file mark.
fsfm 	Forward space count file marks. The tape is positioned on the beginning-of-the-tape side of the file mark.
asf 	Absolute space to file number count. Equivalent to rewind followed by fsf count.
seek 	Seek to block number count.
eom 	Space to the end of the recorded media on the tape (for appending files onto tapes).
rewind 	Rewind the tape.
offline, rewoffl 	Rewind the tape and, if applicable, unload the tape.
status 	Print status information about the tape unit.
retension 	Rewind the tape, then wind it to the end of the reel, then rewind it again.
erase 	Erase the tape.
Options
-f, --file=device 	Use device as the file name of the tape drive to operate on. To use a tape drive on another machine, use a filename that starts with 'HOSTNAME:'. The hostname can be preceded by a username and an '@' to access the remote tape drive as that user, if you have permission to do so (typically an entry in that user's '~/.rhosts' file).
--rsh-command=command 	Notifies mt that it should use command to communicate with remote devices instead of /usr/bin/ssh or /usr/bin/rsh.
-V, --version 	Print the version number of mt.
Exit Status

mt exits with a status of 0 if the operation succeeded, 1 if the operation or device name given was invalid, or 2 if the operation failed.
Related commands

during restoration(恢复) of files from a tape with multiple archives, the need arises to position the tape to the archive that holds the necessary files. to accomplish this control, use the mt command,(the name comes from "magnetic(有磁性的,有吸收力的) tape"). the mt command uses a set of simple instructions that directs the tape drive to perform a particular action.
mt
  mt [-h] [-f device_file] operation [count]
  description control a tape drive. the tape drive is intructed to perform the specified operation once, unless count is specified.
  -h print usage information, including iperation names, and exit.
  -f device_file specify the device file. if omitted, the default is used. as defined in the header file /usr/include/sys/mtio.h. the typical default is /dev/tape.
   popular tape operations
   fsf [count] forward space files. move forward the number of files specified by count(archives, in the case of tar). leaving the tape positioned at the first block of the next file.
   rewind rewind to the beginning of the tape.
   offline eject(驱逐,放逐) the tape. this is appropriate for 8 mm or similar drives. where the tape is handled automatically by the mechanism. ejecting the tape at the end of a backup may prevent at accidental subsequent backup to the same media. this operation is meaningless on devices that cannot eject the tape.
  status display status information about the tape drive being used
  tell for some SCSI tape drives. report the position of the tape in blocks
  example:
   move the tape in /dev/sto to the third archive on the tape by skipping forward over two archives:
  mt -f /dev/nst0 fsf 2
  rewind the tape in /dev/st0:
  mt -f /dev/st0 rewind
  eject the tape cartridge:
  mt -f /dev/st0 offline
  detemine what device is represented by the default /dev/tape:
   ls -l /dev/tape

Magnetic tape is a non-volatile storage medium consisting of a magnetic coating on a thin plastic strip. Nearly all recording tape is of this type, whether used for video, audio storage or general purpose digital data storage using a computer. How do I make backup using tapes under Linux operating systems?

Linux (and other Unixish system) use mt command to control magnetic tape drive operation. You need to use mt command while working with tape drive. It allows you to reading and writing to tape.

The default tape drive under Linux is /dev/st0 (first SCSI tape device name). You can read more about tape drives naming convention used under Linux here. Following paragraph summaries command you need to use control tape drive for backup/restore purpose.

Rewind tape drive:# mt -f /dev/st0 rewindBackup directory /www and /home with tar command (z – compressed):# tar -czf /dev/st0 /www /homeFind out what block you are at with mt command:# mt -f /dev/st0 tellDisplay list of files on tape drive:# tar -tzf /dev/st0Restore /www directory:# cd /
# mt -f /dev/st0 rewind
# tar -xzf /dev/st0 wwwUnload the tape:# mt -f /dev/st0 offlineDisplay status information about the tape unit:# mt -f /dev/st0 statusErase the tape:# mt -f /dev/st0 eraseYou can go BACKWARD or FORWARD on tape with mt command itself:
(a) Go to end of data:# mt -f /dev/nst0 eod(b) Goto previous record:# mt -f /dev/nst0 bsfm 1(c) Forward record:# mt -f /dev/nst0 fsf 1 Replace /dev/st0 with your actual tape drive name.
Linux Tape Backup Example

To backup to multiple tape use the following command (backup /home file system):
# tar -clpMzvf /dev/st0 /home
To compare tape backup, enter:
# tar -dlpMzvf /dev/st0 /home
To restore tape in case of data loss or hard disk failure:
# tar -xlpMzvf /dev/st0 /home
Where,

    d : find differences between archive and file system
    x : extract files from an archive
    l : list the contents of an archive
    p : ignore umask when extracting files
    M : create/list/extract multi-volume archive (multiple tapes)
    z : Compress backup using gzip
    v : verbosely list files processed
    f /dev/st0 : Tape device name
    /home : Backup /home file system

Putting it all tougher

#!/bin/bash
# A UNIX / Linux shell script to backup dirs to tape device like /dev/st0 (linux)
# This script make both full and incremental backups.
# You need at two sets of five  tapes. Label each tape as Mon, Tue, Wed, Thu and Fri.
# You can run script at midnight or early morning each day using cronjons.
# The operator or sys admin can replace the tape every day after the script has done.
# Script must run as root or configure permission via sudo.
# -------------------------------------------------------------------------
# Copyright (c) 1999 Vivek Gite <vivek@nixcraft.com>
# This script is licensed under GNU GPL version 2.0 or above
# -------------------------------------------------------------------------
# This script is part of nixCraft shell script collection (NSSC)
# Visit http://bash.cyberciti.biz/ for more information.
# -------------------------------------------------------------------------
# Last updated on : March-2003 - Added log file support.
# Last updated on : Feb-2007 - Added support for excluding files / dirs.
# -------------------------------------------------------------------------
LOGBASE=/root/backup/log

# Backup dirs; do not prefix /
BACKUP_ROOT_DIR="home sales"

# Get todays day like Mon, Tue and so on
NOW=$(date +"%a")

# Tape devie name
TAPE="/dev/st0"

# Exclude file
TAR_ARGS=""
EXCLUDE_CONF=/root/.backup.exclude.conf

# Backup Log file
LOGFIILE=$LOGBASE/$NOW.backup.log

# Path to binaries
TAR=/bin/tar
MT=/bin/mt
MKDIR=/bin/mkdir

# ------------------------------------------------------------------------
# Excluding files when using tar
# Create a file called $EXCLUDE_CONF using a text editor
# Add files matching patterns such as follows (regex allowed):
# home/vivek/iso
# home/vivek/*.cpp~
# ------------------------------------------------------------------------
[ -f $EXCLUDE_CONF ] && TAR_ARGS="-X $EXCLUDE_CONF"

#### Custom functions #####
# Make a full backup
full_backup(){
	local old=$(pwd)
	cd /
	$TAR $TAR_ARGS -cvpf $TAPE $BACKUP_ROOT_DIR
	$MT -f $TAPE rewind
	$MT -f $TAPE offline
	cd $old
}

# Make a  partial backup
partial_backup(){
	local old=$(pwd)
	cd /
	$TAR $TAR_ARGS -cvpf $TAPE -N "$(date -d '1 day ago')" $BACKUP_ROOT_DIR
	$MT -f $TAPE rewind
	$MT -f $TAPE offline
	cd $old
}

# Make sure all dirs exits
verify_backup_dirs(){
	local s=0
	for d in $BACKUP_ROOT_DIR
	do
		if [ ! -d /$d ];
		then
			echo "Error : /$d directory does not exits!"
			s=1
		fi
	done
	# if not; just die
	[ $s -eq 1 ] && exit 1
}

#### Main logic ####

# Make sure log dir exits
[ ! -d $LOGBASE ] && $MKDIR -p $LOGBASE

# Verify dirs
verify_backup_dirs

# Okay let us start backup procedure
# If it is monday make a full backup;
# For Tue to Fri make a partial backup
# Weekend no backups
case $NOW in
	Mon)	full_backup;;
	Tue|Wed|Thu|Fri) 	partial_backup;;
	*) ;;
esac > $LOGFIILE 2>&1

Customize above shell script as per your needs and setup a cron job to execute it:
@midnight /path/to/tapebackup.sh
See also:

    Howto – Use tar command through network over ssh session (i.e. writing to tape on a remote Linux server system)
    Download : Linux / UNIX Tar Full and Incremental Tape Backup Shell Script
    This small how-to covered all options used in day today life; however, it is highly recommended that you go through man pages of mt and tar command for more options/information.

Share this tutorial on:
TwitterFacebookGoogle+Download PDF version Found an error/typo on this page?
About the author: Vivek Gite is a seasoned sysadmin and a trainer for the Linux/Unix & shell scripting. Follow him on Twitter. OR read more like this:

    Verify tar command tape backup under Linux or UNIX
    Tape drives naming convention under Linux
    Howto: Use tar Command Through Network Over SSH Session
    Linux Set the Block Size for a SCSI Tape Device
    Creating A tar File in Linux Via Command Line Options
    Backup Home Directories in Linux
    How do I use cpio command under Linux?
    Solaris UNIX Tape Backup And Recovery With tar And cpio Commands
    How to: HP-UX UNIX Backup and Recover Data to Tape Device
    Can I use tape drive with XEN VPS / Guest oses?

{ 42 comments… add one }

    vinayak nageli October 4, 2006, 5:33 am

    I am new to Red Hat Linux. I want to know How to copy the whole content of tape drive to thum drive or on system directory
    Reply Link
    nikto October 6, 2006, 3:45 pm

    I think you should talk about verifying the backup just after copying files to tape
    Reply Link
    Leon November 26, 2006, 3:55 pm

    Hi. My name in leon. I thanks you for the support shown for linux. I wish you all the very best and good luck on your work.
    Reply Link
    Chris April 8, 2007, 2:37 pm

    Info about how to manage multiple tapes, and what happens when a tape gets full would be handy!
    Reply Link
    Vijay March 5, 2008, 10:36 am

    whall all should be checked as regular health check of the HP proliant servers having Linux OS platform. what all are the commands to do so?

    Regards,
    Reply Link
    Athan March 10, 2008, 4:26 am

    Hi am new to linux redhat and require some information in determining if tape drive compression is enabled on the system (ibm ultrium lto3
    Reply Link
        Thanh September 27, 2013, 9:48 pm

        tapeinfo -f /dev/st#
        Reply Link
    Glen April 7, 2008, 5:10 pm

    I have found that on RHL FC8 the mt command doesn’t work. I have had to use the full mount command and it tells me its already mounted. Has the command changed for the free version versus enterprise?

    some help on this would be appreciated.
    Reply Link
    orionsune April 23, 2008, 5:43 pm

    mt is not mount… if mt doesn’t work then you don’t have the utility installed.
    mt stands for magentic tape, it is not short for ‘mount’ like your probably thinking.
    Reply Link
    vz June 25, 2008, 10:05 pm

    Hi Glen,

    On my fedora FC8 mt was not installed from the beginning. The suitable package for installation is mt-st (something, mt-st-0.9b-4.fc8.i386)
    Reply Link
    Daniele December 30, 2008, 1:48 am

    For multiple tapes just add the -M option.

    Typical use:
    tar -clpMzvf /dev/st0 /anydir <— to backup to tape
    tar -dlpMzvf /dev/st0 /anydir <— to compare
    tar -xlpMzvf /dev/st0 /anydir <— to restore
    Reply Link
    Paolo May 5, 2009, 2:12 pm

    Thank you very much for this tutorial. It’s really useful.

    Thanks to Daniele too.
    Reply Link
    roberto June 4, 2009, 4:34 am

    Thank you! Works great.
    Reply Link
    rafi July 7, 2009, 7:01 am

    thanks to all of you
    Reply Link
    Anoop July 20, 2009, 7:10 pm

    I just wanted the TAR commands to Backup my data in etc folder to Tape media in Red hat enterprise 5.3 Linux OS. The mt option is not enabled then how can i verify and rewind the files written on the Tape ? How to enable the mt commands in Linux?

    Please let me know about this. I can see both the Tape Drives in the Library online from the Host operating system ( Red hat Entrerprise Linux 5.3 ).
    Reply Link
    k -dat software in redhat linux November 18, 2009, 3:05 pm

    my k-dat software is crashed
    what is solution
    Reply Link
    Jorge November 25, 2009, 3:07 pm

    You can’t use -M (multiple tapes) with -z option (compression).

    $ tar -clpMzvf /dev/st0 /anydir
    tar: Cannot use multi-volume compressed archives
    Reply Link
    Shafi Mohammad December 4, 2009, 6:33 am

    # mount (disk name like = /dev/sdc1) /mnt/backup
    Reply Link
    mahesh March 1, 2010, 6:12 am

    part3/radhika/Maildir/.Sent/cur/1214196153.M754850P28131V0000000000001609I004A8301_0.webmail.srishti,S=60346:2,S

    tar: /dev/st0: Cannot write: No space left on device

    tar: Error is not recoverable: exiting now

    no I want to know that in this case Backup is happen or not.

    please Reply me as soon as possible.
    Reply Link
    Yusoff April 8, 2010, 6:15 am

    Very useful article.

    Just one thing to add. I tried the various commands above. For my end, when I run the command:-
    # tar -clpMzvf /dev/nst0 /home
    I got the following error:-
    Cannot use Multi-volume compressed archive.

    So I had to drop the “z” before it runs.
    Just wondering if you’d know the reason why. In any case, just to highlight.
    Reply Link
        Jane October 16, 2010, 5:39 am

        I tried using the multiple tape option. Since my data is now bigger than my tape. However, it does not prompt me to put in the next tape the backup would just stop. Is there a way to pause and wait for the next tape to be inserted?

        Cheers!
        Reply Link
    Gopinath April 12, 2010, 11:31 am

    Hello ,

    thanking for this help menu… How we check the size of tape after writing or tack backup files …
    Reply Link
    Chandrakant September 30, 2010, 2:52 pm

    Hello,
    I am using IBM Server with OS RHEL ver 5.0
    I am using tar command to take the backup as follows
    tar -cvfr /dev/st0 —file names—
    This is appending the files to earlier backups no of times.
    How to list out all files available in the dat?
    How to restore the files which have appended no of times. i.e. 2,3,4,5 —.
    Will you help me with the examples.
    Reply Link
    Camilo Macias November 11, 2010, 10:14 pm

    Hi everyone!!!!
    I’m trying to record my Backp in a DAT 72 tape.

    I’m using the following command:

    tar cvMf /dev/nst0 $(date –date=’1 month ago’ +’%B”%Y’)

    and in some part of the recording… shows the message:

    Prepare volume #2 for `/dev/nst0′ and hit return:

    I know it’s an stupid question, but….
    I’ve done everything to eject “volume #1” from the drive,
    but anything works….
    I’ve pushed “Enter”, but, it just read the same tape,
    and shows the message again:

    repare volume #3 for `/dev/nst0′ and hit return:

    I’ve pushed the button “eject” right from the drive, nothing happens..
    I’ve writen the eject command as follows:

    mt -f /dev/nst0 eject

    But once again…. nothing happens…

    Am I doing something wrong??
    Your support and guidance will be very helpfull.

    Thanks!

    pdt: Sorry for my horrible english! I’m from Bogota, Colombia.
    Reply Link
        Aravind January 20, 2011, 10:34 pm

        For eject try the below command
        mt -f /dev/nst0 offline
        Reply Link
    Lucy Clark February 9, 2011, 4:16 pm

    I need help writing a script for Linux that will copy everything from tape to system directory. I built a Linux box with 3 TB hardware space. Now I have 60 tapes to move data from on to the system directory. I am using the following commands in order
    1) mt â€“f /dev/st0 rewind
    2) tar â€“xvf /dev/st0
    3) tar â€“xvf /dev/st0 fsf (Using this to move to the next segment of the tape)
    and then
    4) tar -xvf/dev/st0

    I keep repeating steps 3 and 4 until the end of the tape. This is very cumbersome. Being a nubie with Linux I am not sure how to simply the process. I am thinking there has to be a way of having the above in shell script or a command that copies everything from tape to system directory of the new box.
    Thanks for your help
    Reply Link
        Paul June 4, 2015, 5:11 am

        Hey Lucy,

        I know this thread/post is a couple years old and I was wondering if you figured this out. I have multipe LTO6 tapes and need to copy everything off of them, but don’t want to do one TAR at a time. I am not sure how many TARs are on the files. I thought there was a (0..100) type code I could write in Cygwin, but sure.

        Thanks,
        P
        Reply Link
    Marsupilamies March 16, 2011, 7:53 am

    I’ve noticed a trouble when you’re not on english system (for exemple, mine, french):
    NOW=$(date +”%a”) gives not “Mon” for monday but “Lun.”
    Maybe you can change NOW=$(date +”%a”) by NOW=$(date +”%u”), so $NOW will be a number (the same in each system).

    And just change:
    case $NOW in
    Mon ) full_backup;;
    Tue|Wed|Thu|Fri) partial_backup;;
    *) ;;

    by:
    case $NOW in
    1) full_backup;;
    2|3|4|5) partial_backup;;
    *) ;;

    Hope it’ll help ;-)
    Reply Link
    martin March 22, 2011, 7:43 pm

    Hi,

    My files are backed up as
    srv/scripts/…
    srv/www/.,..
    srv/blablabla…

    How to restore file srv/www/site1 to home dir?
    Is it just
    cd TOTHEDIRIWANTFILETOBERESTORED
    # tar -xzf /dev/st0 srv/www/site1
    ?
    Thank you
    Reply Link
    mahesh June 28, 2011, 4:58 am

    Hi all,

    Please tell me how to find free space in the tape drive.
    And how to restore the backup from the tape drive ( have to move the backup to other server).
    Please give me clarity about tape drive information because iam confused about tape drive.

    Thanks in adv…
    Reply Link
        Peter August 3, 2011, 12:01 pm

        I am also having a similar problem. please if you’ve receive a solution to your question then let me know the solution so that i can also apply it . Thanks.
        Reply Link
    Poppy February 7, 2012, 3:10 am

    Just to avoid snomoee having to spend a few hours restoring from backups; The first example would copy the files from server Y to server X, not the other way around.
    Reply Link
    Abdull February 10, 2012, 5:22 am

    ubunut/linux has been left beinhd quite a bit. i’m open to any helping out especially for linux and macos
    Reply Link
    DONALDO October 17, 2012, 8:36 am

    Great script at the end, very handy as i have 1.1tb to back up on an 800gb SDLT
    Reply Link
    Eslam Esmaiel February 27, 2013, 9:21 am

    Please I need your help and support for the Following Issue:
    How I can backup data from Linux to a SDLT tapes 600GB?

    Eslam
    Reply Link
    krishna chaitanya July 17, 2013, 5:00 am

    I have taken a Backup in LTO from RHEL 5.6 using tar command and i want to check the total size of data present in LTO..Please suggest me the command through which i can check the size?????
    Reply Link
    shiva December 23, 2013, 4:21 pm

    Could you please guide me the procedure to take multiple backups on single tape?

    how to take the backup using append method
    Reply Link
    mohammed March 28, 2014, 1:19 pm

    To estimate the size of the backups, calculate the size of /home and /etc directories.
    i) What command(s) did you use for this?

    ii) What are the sizes?

    Note that compressed archives will take about 30% less space.
    However you will need to store one complete backup of /home and two backups of /etc.

    iii) What is the estimate of the total space required for your backups?

    iv) What would happen if the root partition (/) ran out of space?
    Reply Link
    Byloon November 26, 2014, 6:43 am

    To estimate the size of the backups, calculate the size of /home and /etc directories.

    i) What command(s) did you use for this?

    ii) What are the sizes?

    Note that compressed archives will take about 30% less space.

    However you will need to store one complete backup of /home and two backups of /etc.

    iii) What is the estimate of the total space required for your backups?

    iv) What would happen if the root partition (/) ran out of space?

    Examine the space available on your drive, both free space (if any) as well as volumes that are using only a small amount of their allocated space. You will not only need space for the new /tmp volume, but also for a backup snap-shot volume, about 20% of the size of the /home volume.

    v) How much free disk space do you need altogether?

    If you don’t have sufficient free space available on your volume group then you must shrink one (or more) existing logical volumes to free up enough space for the new volumes.

    vi) Which volumes will you need to shrink, and what will be the new sizes of those volumes?

    Now that the volume group has sufficient free space for the new /tmp volume, create a new logical volume and then format it. Here is an example of creating a 1 gigabyte volume for /tmp, using the name LogVol04:

    vgdisplay # Note available space

    lvcreate -n LogVol04 -L 1G VolGroup00

    mkfs -t ext4 /dev/VolGroup00/LogVol04

    vi /etc/fstab # add entry for /tmp

    # Move old /tmp contents to new /tmp partition. This will likely require a reboot before the new /tmp files get used.

    mv /tmp /oldtmp

    mkdir /tmp

    chmod 1777 /tmp

    mount /tmp

    cd /oldtmp

    cp -a $(/bin/ls -A) /tmp

    # Do this after the next reboot:

    rm -ri /oldtmp

    vii) What is the exact find command which will find the names of all files and directories in /etc that have been modified in the past 24 hours?

    viii) What is the purpose of the -print0 find option, and why should you use it in a production-quality script?

    ix) What are the matching options for tar and cpio, to make an archive of the files found by find?

    x) Backup /home using dump. Use a level 0 dump. Since we don’t want to shut the system down to single user mode (or unmount /home). What are the exact commands you used?

    xi) Completely backup /etc using a compressed tar archive. What is the exact command(s) you used for this?

    xii) Completely backup /etc using a cpio archive. Now compress the resulting archive using either gzip or bzip2, whichever method you used for the tar archive in the previous step. What are the exact commands you used for this step?

    xiii) Which archive is smaller, the tar or the cpio archive of /etc, and by how much? Do you think the difference is significant?

    xiv) For each of the two archives, compute the MD5 checksum and store it in a file /tmp/name-of-archive.md5.

    xv) Copy the tar archive backup of /etc along with the matching MD5 checksum file, to your home directory on the YborStudent.hccfl.edu server using scp command. What is the exact

    command(s) you used? Before running this command, check your quota on YborStudent and make sure you won’t go over your hard limit!

    xvi) Copy the cpio archive backup of /etc, along with the matching MD5 checksum file, to your home directory on the YborStudent.hccfl.edu server using rsync command. What is the exact command(s) you used? (Note by default a modern rsync uses a secure SSH tunnel, the same as scp.) Before running this command, check your quota on YborStudent and make sure you won’t go over your hard limit!

    xvii) Describe briefly what the following command does, and list the meaning of each option used in your own words:

    rsync -HavRuzc /var/www/html/ example.com:/var/www/html/

    Now log into YborStudent and verify the integrity of the backup copies, using the MD5 checksum files.

    xviii) What are the exact commands to do that, and what are the results?

    xix) Still logged on YborStudent, extract the file /etc/group to your home directory from the tar archive. Then extract the file /etc/hosts to your home directory from the cpio archive. What are the exact commands needed for this? Be careful not to try to extract the absolute pathname or you will attempt to over-write /etc/group. (Don’t worry, you don’t have permission to do that!)

    xx) When done, delete both archives.
    Reply Link
    ravindrapatil January 12, 2015, 5:52 pm

    Hi
    I need to take backup on hp tape drive.
    Please share the procedure of backup the directory using wtar
    Reply Link
    Georg March 21, 2016, 3:20 pm

    Thank you so much guys. Helping me out again and again.. :)
    Reply Link
    Bruno July 28, 2016, 2:25 pm

    How to start writing after the last tar? (mt -f /dev/st1 eom) Is not workind!!! Plz help!!!!
    Reply Link

Security: Are you a robot or human?

Leave a Comment

Name

Email

Comment
Receive Email Notifications?
Or, you can subscribe without commenting.

You can use these HTML tags and attributes: <strong> <em> <pre> <code> <a href="" title="">

   Tagged with: /dev/st0, backup directory, linux how to read tape, linux mt command, linux mt tape, linux multiple tape backup, linux tape backup, mt command, scsi tape device, ssh session, tape, tar backup to tape drive, tar command, tar command lto tape, tar to tape, tar xzf command


   Perpetual PC's

   Web Site Design.       Networks. 	

   Commands and references ( GNU / linux kernel 2.4.18-3 and 2.4.18-14 )   
   Linux is a registered trademark of Linus Torvalds


   The commands with their most common usage are in brackets like this: [ command ].
   Don't type the brackets, just what is inside of them.

   Back to the index page




mt - control magnetic tape drive operation

   SYNOPSIS
          mt [-h] [-f device] operation [count] [arguments...]

 DESCRIPTION
          This  manual  page  documents the tape control program mt.  mt performs
          the given operation, which must be one of the  tape  operations  listed
          below,  on a tape drive. The commands can also be listed by running the
          program with the -h option. The version of mt is printed with the -v or
          --version  option.  The path of the tape device on which to operate can
          be given with the -f or -t option.  If  neither  of  those  options  is
          given,  and  the  environment variable TAPE is set, it is used.  Other-
          wise, a default device defined in the file  /usr/include/sys/mtio.h  is
          used.

          Some  operations optionally take an argument or repeat count, which can
          be given after the operation name and defaults to 1. The postfix k ,  M
          ,  or  G  can  be used to give counts in units of 1024, 1024 * 1024, or
          1024 * 1024 * 1024, respectively.

          The available operations are listed below.   Unique  abbreviations  are
          accepted.   Not all operations are available on all systems, or work on
          all types of tape drives.

          fsf    Forward space count files.  The tape is positioned on the  first
                 block of the next file.

          fsfm   Forward  space  count files.  The tape is positioned on the last
                 block of the previous file.

          bsf    Backward space count files.  The tape is positioned on the  last
                 block of the previous file.

          bsfm   Backward space count files.  The tape is positioned on the first
                 block of the next file.

          asf    The tape is positioned at the beginning of the count file. Posi-
                 tioning  is  done  by  first rewinding the tape and then spacing
                 forward over count filemarks.

          fsr    Forward space count records.

          bsr    Backward space count records.

          fss    (SCSI tapes) Forward space count setmarks.

          bss    (SCSI tapes) Backward space count setmarks.

          eod, seod
                 Space to end of valid data.  Used on  streamer  tape  drives  to
                 append data to the logical end of tape.

          rewind Rewind the tape.

          offline, rewoffl, eject
                 Rewind the tape and, if applicable, unload the tape.

          retension
                 Rewind  the  tape,  then  wind  it  to the end of the reel, then
                 rewind it again.

          weof, eof
                 Write count EOF marks at current position.

          wset   (SCSI tapes) Write count setmarks at current position (only SCSI
                 tape).

          erase  Erase the tape.

          status Print  status  information  about the tape unit. (If the density
                 code is "no translation" in the status  output,  this  does  not
                 affect working of the tape drive.)

          seek   (SCSI  tapes)  Seek to the count block on the tape.  This opera-
                 tion is available on some Tandberg  and  Wangtek  streamers  and
                 some  SCSI-2  tape  drives. The block address should be obtained
                 from a tell call earlier.

          tell   (SCSI tapes) Tell the current block on tape.  This operation  is
                 available on some Tandberg and Wangtek streamers and some SCSI-2
                 tape drives.

          setpartition
                 (SCSI tapes) Switch to the partition determined by  count.   The
                 default  data  partition of the tape is numbered zero. Switching
                 partition is available only  if  enabled  for  the  device,  the
                 device  supports  multiple partitions, and the tape is formatted
                 with multiple partitions.

          partseek
                 (SCSI tapes) The tape position is set to block count in the par-
                 tition  given by the argument after count. The default partition
                 is zero.

          mkpartition
                 (SCSI tapes) Format the tape with one (count  is  zero)  or  two
                 partitions  (count  gives  the  size  of the second partition in
                 megabytes). The tape drive must be able  to  format  partitioned
                 tapes with initiator-specified partition size and partition sup-
                 port must be enabled for the drive.

          load   (SCSI tapes) Send the load command to the tape drive. The drives
                 usually  load  the  tape  when  a new cartridge is inserted. The
                 argument count can usually be omitted.  Some  HP  changers  load
                 tape n if the count 10000 + n is given (a special funtion in the
                 Linux st driver).

          lock   (SCSI tapes) Lock the tape drive door.

          unlock (SCSI tapes) Unlock the tape drive door.

          setblk (SCSI tapes) Set the block size of the drive to count bytes  per
                 record.

          setdensity
                 (SCSI  tapes)  Set  the  tape density code to count.  The proper
                 codes to use with each drive should be looked up from the  drive
                 documentation.

          densities
                 (SCSI  tapes)  Write explanation of some common density codes to
                 standard output.

          drvbuffer
                 (SCSI tapes) Set the tape drive  buffer  code  to  number.   The
                 proper  value  for  unbuffered  operation  is  zero and "normal"
                 buffered operation one. The meanings  of  other  values  can  be
                 found  in  the  drive  documentation or, in the case of a SCSI-2
                 drive, from the SCSI-2 standard.

          compression
                 (SCSI tapes) The compression within the drive can be switched on
                 or  off  using the MTCOMPRESSION ioctl. Note that this method is
                 not  supported  by  all  drives  implementing  compression.  For
                 instance,  the  Exabyte  8 mm drives use density codes to select
                 compression.

          stoptions
                 (SCSI tapes) Set the driver options bits for the device  to  the
                 defined  values. Allowed only for the superuser. The bits can be
                 set  either  by  ORing   the   option   bits   from   the   file
                 /usr/include/linux/mtio.h  to  count,  or by using the following
                 keywords (as many keywords can be used on the same line as  nec-
                 essary, unambiguous abbreviations allowed):

                 buffer-writes  buffered writes enabled

                 async-writes   asynchronous writes enabled

                 read-ahead     read-ahead for fixed block size

                 debug          debugging (if compiled into driver)

                 two-fms        write two filemarks when file closed

                 fast-eod       space directly to eod (and lose file number)

                 no-wait        don`t wait until rewind, etc. complete

                 auto-lock      automatically lock/unlock drive door

                 def-writes     the block size and density are for writes

                 can-bsr        drive can space backwards as well

                 no-blklimits   drive doesn`t support read block limits

                 can-partitions drive can handle partitioned tapes

                 scsi2logical   seek  and tell use SCSI-2 logical block addresses
                                instead of device dependent addresses

                 sysv           enable the System V semantics

          stsetoptions
                 (SCSI tapes) Set selected driver options bits.  The  methods  to
                 specify  the  bits  to set are given above in the description of
                 stoptions.  Allowed only for the superuser.

          stclearoptions
                 (SCSI tapes) Clear selected driver option bits.  The methods  to
                 specify  the  bits  to  clear  are given above in description of
                 stoptions.  Allowed only for the superuser.

          stwrthreshold
                 (SCSI tapes) The write threshold for the tape device is  set  to
                 count  kilobytes. The value must be smaller than or equal to the
                 driver buffer size. Allowed only for the superuser.

          defblksize
                 (SCSI tapes) Set the default block size of the device  to  count
                 bytes.  The value -1 disables the default block size.  The block
                 size set by setblk overrides the default until  a  new  tape  is
                 inserted.  Allowed only for the superuser.

          defdensity
                 (SCSI tapes) Set the default density code. The value -1 disables
                 the default density. The density set by setdensity overrides the
                 default until a new tape is inserted. Allowed only for the supe-
                 ruser.

          defdrvbuffer
                 (SCSI tapes) Set the default drive buffer  code.  The  value  -1
                 disables  the  default  drive buffer code. The drive buffer code
                 set by drvbuffer overrides the  default  until  a  new  tape  is
                 inserted. Allowed only for the superuser.

          defcompression
                 (SCSI  tapes)  Set  the  default compression state. The value -1
                 disables the default compression. The compression state  set  by
                 compression  overrides the default until a new tape is inserted.
                 Allowed only for the superuser.

          sttimeout
                 sets the normal timeout for the device. The value  is  given  in
                 seconds. Allowed only for the superuser.

          stlongtimeout
                 sets the long timeout for the device. The value is given in sec-
                 onds. Allowed only for the superuser.

          stsetcln
                 set the cleaning request interpretation parameters.

          mt exits with a status of 0 if the operation succeeded, 1 if the opera-
          tion or device name given was invalid, or 2 if the operation failed.








          =============================================================

          /dev/st0

          和

          /dev/nst0

          的区别



          在

          sles(SUSE Linux Enterprise Server)9

          里，常用磁带机设备有两组

          /dev/st[0-

          9]

          和

          /dev/nst[0-9]

          ，数字表示磁带机的数目，如果只有一个磁带机，那就是



          /dev/st0

          和

          /dev/nst0

          。这个是一个非常重要的概念，只有清晰理解了这些不同名

          字的设备的区别，才能正确使用相关的命令。





          假设我们的系统里面只有一个磁带机设备，那么就有两个设备文件：

          /dev/st0

          和

          /dev/nst0

          。这两个设备都是这台磁带机的设备名，

          /dev /st0

          是回卷设备，每次

          操作完成之后，磁带机都会自动回卷到磁带的开头。这时候如果进行备份操作则会

          覆盖磁带中的数据信息，而不是将新数据附在磁带数据



          结束处。

          /dev/nst0

          是非

          回卷设备，每次操作完成之后，磁带机的磁头都会停留在当前位置，随后的备份操

          作将被添加到上次备份结束以后的地方。但是用



          非回卷设备是无法自动回卷磁带

          的，如果要完成备份和恢复的操作还需要使用

          mt

          命令来对磁带进行操作。下面分

          别对两种设备的操作方法做简单的介绍。





          一

          .

          回卷设备

          /dev/st0





          由于回卷设备会自动回卷磁带，所以使用

          /dev/st0

          只能保存一个归档文件，任何

          新写入的文件都会覆盖原来的文件，但是这种设备的使用方法比较简单。磁



          带备

          份主要使用

          tar

          命令





          1.

          备份文件到磁带



          #tar cvf /dev/st0 filename1 filename2

          例：备份

          /etc

          下的文件到磁带机



          #tar cvf /dev/st0 /etc/*



          2.

          查看磁带中备份文件



          #tar tvf /dev/st0



          3.

          恢复磁带中备份文件



          #tar xvf /dev/st0



          二

          .

          非回卷设备

          /dev/nst0





          非回卷设备不会自动回卷磁带，所以使用

          /dev/nst0

          可以在磁带上保存多个归档文

          件，但是备份必须使用

          mt

          命令来控制磁带转动来结合

          tar

          命令使用，



          操作上相对

          比较复杂。





          mt

          命令最重要的功能就是定位磁带，在使用非回卷设备的时候需要使用

          mt

          命令来

          定位磁带才能正常的使用

          tar

          命令进行备份和恢复。

          mt

          详细的用法可以参考

           man

          手册，下面介绍几个最常用的用法。

          mt

          的命令格式：



          mt -f

          设备名



          操作



          -f

          参数后面跟着一个设备名，就是磁带设备的名字，例如

          /dev/nst0

          。



          除了设备名这个参数外，

          mt

          有一个必须有的参数，就是操作，最常用的操作有：



          status

          检查磁带机状态



          fsf n

          前进

          n

          个文件



          bsf n

          后退

          n

          个文件
