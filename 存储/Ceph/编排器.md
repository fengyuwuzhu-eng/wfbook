# 编排器

[TOC]

## 概述

作为存储管理员，可以使用 Ceph 编排器和 Cephadm 实用程序来发现 Ceph 存储集群中的设备和创建服务。

Ceph 存储编排器是管理器模块，主要充当 Ceph 存储集群与 Rook 和 Cephadm 等部署工具之间的桥梁，以获得统一体验。还与 Ceph 命令行界面和 Ceph 控制面板集成。

以下是 Ceph 编排器的工作流图：

![Ceph 编排器](../../Image/c/ceph-orchestrators.png)

## Ceph Storage Orchestrator 类型

主要有三种类型：

- **编排器 CLI** 

  是编排器中使用的常见 API，包含一组可以实施的命令。这些 API 还提供通用命令行界面(CLI)，以利用外部编排服务编排 `ceph-mgr` 模块。

  以下是 Ceph 编排器所用的命名法： 				

  - Host ：这是物理主机的主机名，而不是容器内的 pod 名称、DNS 名称、容器名称或主机名。 						
  - 服务类型：这是服务的类型，如 nfs、mds、osd、mon、rgw、mgr 和 iscsi。 						
  - 服务 ：由 Ceph 存储集群提供的功能服务，如监控服务、管理器服务、OSD 服务、Ceph 对象网关服务和 NFS 服务。 						
  - 守护进程：由一个或多个主机（如 Ceph 对象网关服务）部署的服务的特定实例可以具有在三个不同的主机上运行的不同 Ceph 对象网关守护进程。 						

- **Cephadm Orchestrator**

  这是一个 Ceph 编排器模块，它不依赖于 Rook 或 Ansible 等外部工具，而是通过建立 SSH 连接并发出显式管理命令来管理集群中的节点。此模块可用于进行 天一操作和第二天操作。

  建议使用 Cephadm Orchestrator 在不利用任何部署框架（如 Ansible）的情况下安装 Ceph 存储集群。其理念是为管理器守护进程提供对 SSH  配置和密钥的访问权限，以便连接到集群中的所有节点以执行任何管理操作，例如创建存储设备清单、部署和更换 OSD，或启动和停止 Ceph  守护进程。此外，Cephadm Orchestrator 将部署由 `systemd` 管理的容器镜像，以允许独立升级并置服务。

  此编排器还可能突出显示一个工具，该工具封装了所有必要的操作，以管理基于当前主机上的容器镜像服务的部署，包括引导运行 Ceph 监控器和 Ceph 管理器的最小集群的命令。

- **rook 编排器**

  Rook 是一个编配工具，它使用 Kubernetes Rook 操作器管理 Kubernetes 集群内运行的 Ceph 存储集群。rook  模块提供 Ceph 的编排器框架和 Rook 之间的集成。rook 是 Kubernetes 的开源原生云存储操作器。

  rook 遵循"operator"模型，其中在 Kubernetes 中定义自定义资源定义 (CRD) 对象来描述 Ceph  存储集群及其所需状态，rook operator 守护进程在控制循环中运行，将当前集群状态与所需状态进行比较，并采取措施进行聚合。描述 Ceph 所需状态的主要对象是 Ceph 存储集群 CRD，其中包括有关 OSD 应使用哪些设备的信息、应运行的 monitor 数，以及应使用的  Ceph 版本的信息。rook 定义几个其他 CRD 来描述 RBD 池和 CephFS 文件系统等。

  Rook 编排器模块是在 `ceph-mgr` 守护进程中运行的粘合器模块，通过在 Kubernetes 中更改 Ceph 存储集群来描述所需的集群状态来实施 Ceph 编排 API。Rook 集群的 `ceph-mgr` 守护进程作为 Kubernetes pod 运行，因此 rook 模块可以在没有任何显式配置的情况下连接到 Kubernetes API。 				