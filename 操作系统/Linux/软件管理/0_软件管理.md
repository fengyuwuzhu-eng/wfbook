# 软件管理

[TOC]

## 概论

软件包管理器公布之前，要想在 Linux 系统中安装软件，只能采取编译源码包的方式。所以，早期安装软件是一件非常困难、耗费耐心的事情，而且大多数的服务程序仅仅提供自身的源代码，还需要运维人员编译代码后自行解决软件之间的依赖关系。

早期的 Linux 系统在安装、升级、卸载服务程序时还要考虑到其他程序、库的依赖关系，所以在进行校验、安装、卸载、查询、升级等软件操作时难度都非常大。

## 软件包管理器

### apt-get

大多数基于 Debian 的系统通常会使用 apt-get 来安装软件包和升级。

```bash
apt-get update
apt-get upgrade

# 清除相关命令
apt-get clean
# 清除遗留在 /var/cache 中的已取回的包文件的本地仓库。
# 清除的目录是 /var/cache/apt/archives/ 和 /var/cache/apt/archives/partial/ 。
# 留在 /var/cache/apt/archives 中的是 lock 文件和 partial 子目录。
# 通常用于根据需要清除磁盘空间，一般作为定期计划维护的一部分。

apt-get autoclean
# 类似于 apt-get clean ，会清除已检索包文件的本地仓库，但只会删除不会再下载且几乎无用的文件。有助于防止缓存过大。

apt-get autoremove
# 将删除自动安装的软件包，因为某些其他软件包需要它们，但是在删除了其他软件包之后，而不再需要它们。有时会在升级时建议运行此命令。
# 要删除的软件包通常称为“未使用的依赖项”。实际上，一个好的做法是在卸载软件包后使用 autoremove ，以确保不会留下不需要的文件。
```

### dpkg

Debian 包管理器。

#### 语法

```bash
dpkg -[command] [.deb package name]

# 安装/升级软件
# 如果软件已经安装了，就会升级它。
dpkg -i package.deb

# 从文件夹里安装软件
# 会安装 /opt/software 目录下的所有以 .deb 为后缀的软件。
dpkg -iR /opt/software

# 显示已安装软件列表，同时显示软件版本和描述信息。
dpkg -l

# 查看指定的已安装软件，同时会显示软件版本和描述信息。
dpkg -l atom

# 查看软件安装目录
dpkg -L atom

# 查看 deb 包内容
dpkg -c atom-amd64.deb

# 显示软件的详细信息，如软件名、软件类别、版本、维护者、软件架构、依赖的软件、软件描述等等
dpkg -s atom
 
# 查看文件属于哪个软件
dpkg -S /usr/bin/atom

# 移除/删除软件，但不删除配置文件。
dpkg -r atom

# 清除软件，包括配置文件在内的所有文件。
dpkg -P atom

# 帮助
dpkg -help
```

#### 相关文件的位置

```bash
/var/lib/dpkg
# 这个文件包含了被 dpkg 命令（install、remove 等）所修改的包的信息。

/var/lib/dpkg/status
# 这个文件包含了可用包的列表
```

### DNF（Dandified Yum）

发现 Yum 虽然解决了软件的依赖关系问题，但仍然还是存在分析不准确、内存占用量大、不能多人同时安装软件等硬伤。在 2015 年随着 Fedora 22 系统的发布，红帽给了一个新的选择— DNF 。DNF 实际上就是解决了上述问题的 Yum 软件仓库的提升版，行业内称之为 Yum v4 版本。

作为 Yum 软件仓库 v3 的接替者，DNF 特别友好地继承了原有的命令格式，且使用习惯上也保持了一致。

The `dnf` command allows the management of packages by  comparing those installed on the system with those in the repositories  defined on the server. It also automatically installs dependencies, if  they are also present in the repositories.

The dnf command allows you to install a package by specifying only the short name.

```
dnf [install][remove][list all][search][info] package
```

Example:

```
[root]# dnf install tree
```

Only the short name of the package is required.

| Option                    | Description                                   |
| ------------------------- | --------------------------------------------- |
| `install`                 | Installs the package.                         |
| `remove`                  | Uninstall the package.                        |
| `list all`                | Lists the packages already in the repository. |
| `search`                  | Search for a package in the repository.       |
| `provides */command_name` | Search for a command.                         |
| `info`                    | Displays the package information.             |

The `dnf list` command lists all the packages installed on the system and present in the repository. It accepts several parameters:

| Parameter   | Description                                                  |
| ----------- | ------------------------------------------------------------ |
| `all`       | Lists the installed packages and then those available on the repositories. |
| `available` | Lists only the packages available for installation.          |
| `updates`   | Lists packages that can be upgraded.                         |
| `obsoletes` | Lists the packages made obsolete by higher versions available. |
| `recent`    | Lists the latest packages added to the repository.           |

Example of a search for the `semanage` command:

```
[root]# dnf provides */semanage
```



The DNF manager relies on one or more configuration files to target the repositories containing the RPM packages.

These files are located in `/etc/yum.repos.d/` and must end with `.repo` in order to be used by DNF.

Example:

```
/etc/yum.repos.d/Rocky-BaseOS.repo
```

Each `.repo` file consists of at least the following information, one directive per line.

Example:

```ini
[baseos] # Short name of the repository
name=Rocky Linux $releasever - BaseOS # Short name of the repository #Detailed name
mirrorlist=http://mirrors.rockylinux.org/mirrorlist?arch=$basearch&repo=BaseOS-$releasever # http address of a list or mirror
#baseurl=http://dl.rockylinux.org/$contentdir/$releasever/BaseOS/$basearch/os/ # http address for direct access
gpgcheck=1 # Repository requiring a signature
enabled=1 # Activated =1, or not activated =0
gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-rockyofficial # GPG public key path
```

By default, the `enabled` directive is absent which means that the repository is enabled. To disable a repository, you must specify the `enabled=0` directive.	

​		

## 2.1. 软件仓库

​				Red Hat Enterprise Linux 9 内容使通过两个主要存储仓库分发的：**BaseOS** 和 **AppStream**。基本 RHEL 安装需要 BaseOS 和 AppStream 内容集，所有 RHEL 订阅都可以使用。有关安装说明，请参阅[执行标准 RHEL 9 安装](https://access.redhat.com/documentation/zh-cn/red_hat_enterprise_linux/9/html/performing_a_standard_rhel_9_installation/index)文档。 		

- BaseOS

  ​							BaseOS 存储库中的内容由底层操作系统功能的核心组件组成，其为所有安装提供基础。此内容采用 RPM 格式，它的支持条款与之前 Red Hat Enterprise Linux 版本中的条款相似。 					

- AppStream

  ​							AppStream 仓库的内容包括额外的用户空间应用程序、运行时语言和数据库来支持各种工作负载和使用案例。 					

- CodeReady Linux Builder

  ​							CodeReady Linux Builder 存储库在所有 RHEL 订阅中可用。它为开发人员提供了额外的软件包。不支持包括在 CodeReady Linux Builder 存储库中的软件包。 					

**其他资源**

- ​						[执行标准 RHEL 9 安装](https://access.redhat.com/documentation/zh-cn/red_hat_enterprise_linux/9/html/performing_a_standard_rhel_9_installation/index) 				
- ​						[软件包清单](https://access.redhat.com/documentation/zh-cn/red_hat_enterprise_linux/9/html-single/package_manifest/index) 				

## 2.2. 应用程序流

​				用户空间组件的多个版本会以 Application Streams（应用程序流）的形式提供，其更新频率会比核心操作系统软件包的更新频率更快。这为自定义 RHEL 提供了更大的灵活性，而不影响平台或特定部署的基本稳定性。 		

​				每个 Application Stream 组件都有特定的生命周期，它与 RHEL 9 或更短的生命周期相同。有关 RHEL 生命周期信息，请查看 [Red Hat Enterprise Linux](https://access.redhat.com/support/policy/updates/errata) 生命周期和 [Red Hat Enterprise Linux 应用程序流生命周期](https://access.redhat.com/support/policy/updates/rhel-app-streams-life-cycle)。 		

​				Application Streams 以以下格式提供： 		

- ​						熟悉的 RPM 格式 				
- ​						作为名为模块的 RPM 格式的扩展 				
- ​						作为 Software Collections 				
- ​						作为 Flatpaks。 				

​				RHEL 9 提供了初始的 Application Stream 版本，可以使用传统的 `dnf install` 命令作为 RPM 软件包安装，这改进了 Application Streams 体验。 		

注意

​					某些初始 Application Streams (RPM 格式的初始 Application Streams) 的生命周期比 Red Hat Enterprise Linux 9 短。 			

​				一些额外的 Application Stream 版本将作为模块发布，并在将来的次版本的 RHEL 9 版本中带有较短的生命周期。 		

​				决定您要安装的应用程序流的版本，并确保首先检查 [Red Hat Enterprise Linux Application Stream Lifecycle](https://access.redhat.com/support/policy/updates/rhel-app-streams-life-cycle)。 		

注意

​					不是所有模块都是 Application Streams。模块依赖关系不被视为 Application Streams。 			

**其他资源**

- ​						[Red Hat Enterprise Linux 生命周期](https://access.redhat.com/support/policy/updates/errata) 				
- ​						[Red Hat Enterprise Linux Application Streams Life Cycle](https://access.redhat.com/support/policy/updates/rhel-app-streams-life-cycle) 				
- ​						[Red Hat Enterprise Linux 9:应用程序兼容性指南](https://access.redhat.com/articles/rhel9-abi-compatibility) 				
- ​						[软件包清单](https://access.redhat.com/documentation/zh-cn/red_hat_enterprise_linux/9/html-single/package_manifest/index) 				

## 2.3. Modules

​				模块是一组代表组件且通常一起安装的 RPM 软件包。典型的模块包含应用的软件包、应用特定依赖项库的软件包、应用文档的软件包，以及帮助程序实用程序的软件包。 		

## 2.4. 模块流

​				模块流是可以作为 AppStream 物理存储库中的虚拟存储库的过滤器。模块流代表 AppStream 组件的版本。每个流都单独接收更新。 		

​				模块流可以是活跃的或者不活跃的。有效流可让系统访问特定模块流中的 RPM 软件包，以便安装相应的组件版本。如果用户操作显式启用了流，则流会活跃。 		

​				给定时间点上只能激活一个特定模块的流。因此，系统中只能安装一个组件版本。不同的容器可以使用不同的版本。 		

​				每个模块都可以具有默认流。在 RHEL 9 中，没有定义默认流，但您可以配置自己的默认流，如 [配置自定义的默认模块流和配置文件](https://access.redhat.com/documentation/zh-cn/red_hat_enterprise_linux/9/html-single/managing_software_with_the_dnf_tool/index#proc_setting-module-default-streams_assembly_installing-rhel-9-content) 中所述。 		

​				某些模块流依赖于其他模块流。 		

​				要为运行时用户应用程序或开发人员应用程序选择特定的流，请考虑以下几点： 		

- ​						所需功能以及哪个组件版本支持该功能 				
- ​						兼容性 				
- ​						[生命周期](https://access.redhat.com/support/policy/updates/rhel-app-streams-life-cycle)长度和您的更新计划 				

​				有关所有可用模块和流的列表，请查看[软件包清单](https://access.redhat.com/documentation/zh-cn/red_hat_enterprise_linux/9/html-single/package_manifest/index)。有关每个组件的更改，请查看 [发行注记](https://access.redhat.com/documentation/zh-cn/red_hat_enterprise_linux/9)。 		

**其他资源**

- ​						[模块依赖关系和流更改](https://access.redhat.com/documentation/zh-cn/red_hat_enterprise_linux/9/html-single/managing_software_with_the_dnf_tool/index#con_modular-dependencies-and-stream-changes_assembly_managing-versions-of-application-stream-content) 				

## 2.5. 模块配置集

​				配置集（profile）是为特定用例一起安装的推荐软件包列表，比如服务器、客户端、开发、最小安装或其他用例。这些软件包列表可以包含模块流以外的软件包，通常是来自 BaseOS 存储库或流依赖项的软件包。 		

​				使用配置集安装软件包是为方便用户提供的一次性操作。它不会阻止安装或卸载该模块提供的任何软件包。您还可以使用同一模块流的多个配置集安装软件包，而无需进一步准备步骤。 		

​				每个模块流可以有任何数量的配置集，包括没有。对于任何给定模块流，其某些配置集可以被标记为 *default*，并在没有显式指定配置集时用于配置集安装操作。但是，对于一个模块需要有一个默认配置集不是必须的。 		

例 2.1. nodejs 模块配置集

​					提供 **Node.js** 运行时环境的 `nodejs` 模块为安装提供以下配置集： 			

- ​							`common` - 生产环境就绪的软件包。 					

  ​							这是默认配置文件。 					

- ​							`development` - 对 **Node.js** 进行修改所需的软件包。 					

- ​							`minimal` - 提供 **Node.js** 运行时环境的最小软件包集合。 					

- ​							`s2i` - 创建 **Node.js** Source-to-Image (S2I) Linux 容器所需的软件包。 					

# 第 3 章 配置 DNF

​			**DNF** 及相关工具的配置信息保存在 `/etc/dnf/dnf.conf` 文件中。此文件包含一个必须的 `[main]` 部分，它可让您设置具有全局效果的 **DNF** 选项。 	

​			在以下部分中，了解如何使用 `/etc/dnf/dnf.conf` 配置文件配置 **DNF** ： 	

- ​					[查看当前的 **DNF** 配置](https://access.redhat.com/documentation/zh-cn/red_hat_enterprise_linux/9/html-single/managing_software_with_the_dnf_tool/index#proc_viewing-the-current-yum-configurations_assembly_configuring-yum)。 			
- ​					[设置 **DNF** `[main\]` 选项](https://access.redhat.com/documentation/zh-cn/red_hat_enterprise_linux/9/html-single/managing_software_with_the_dnf_tool/index#proc_setting-yum-main-options_assembly_configuring-yum)。 			
- ​					[使用 **DNF** 插件。](https://access.redhat.com/documentation/zh-cn/red_hat_enterprise_linux/9/html-single/managing_software_with_the_dnf_tool/index#assembly_using-yum-plug-ins_assembly_configuring-yum) 			

## 3.1. 查看当前的 DNF 配置

​				要显示当前的 **DNF** 配置，请完成以下步骤。 		

**流程**

- ​						要显示在 `/etc/dnf/dnf.conf` 文件的 `[main]` 部分指定的全局 **DNF** 选项的当前值，请使用： 				

  

  ```none
  # dnf config-manager --dump
  ```

## 3.2. 设置 DNF 主选项

​				`/etc/dnf/dnf.conf` 配置文件包含一个 `[main]` 部分。本节中的键值对会影响 **DNF** 的运行方式并对待存储库。 		

​				您可以在 `/etc/dnf/dnf.conf` 中的 `[main]` 部分标题下添加附加选项。 		

​				有关可用 `[main]` 选项的完整列表，请查看 `dnf.conf(5)` man page 的 `[main] OPTIONS` 部分。 		

## 3.3. 使用 DNF 插件

​				**DNF** 提供扩展和增强操作的插件。默认安装某些插件。 		

### 3.3.1. 管理 DNF 插件

​					插件配置文件总是包含一个 `[main]` 部分，`enabled=` 选项控制在运行 `dnf` 命令时插件是否启用。如果缺少这个选项，您可以手动将其添加到该文件中。 			

​					每个安装的插件可能在 `/etc/dnf/plugins/` 目录中拥有自己的配置文件。您可以在这些文件中启用或禁用特定插件选项。 			

### 3.3.2. 启用和禁用 DNF 插件

​					在 **DNF** 工具中，插件会被默认加载。 			

​					要修改 **DNF** 插件的加载，并启用或禁用特定的 **DNF** 插件，请完成以下步骤。 			

**流程**

- ​							要禁用或启用 **DNF** 插件的加载，请确保 `/etc/dnf/dnf.conf` 文件的 `[main]` 部分有以 `plugins=` 开头的行。 					

  1. ​									要禁用 **DNF** 插件的加载，将 `plugins=` 的值设置为 `0。` 							

     重要

     ​										**不建议**禁用所有插件。某些插件提供重要的 **DNF** 服务和命令。特别是 **product-id** 和 **subscription-manager** 插件，它们为基于证书的 `内容发布网络` (**CDN**)提供支持。全局禁用插件作为方便选项提供，建议仅在诊断 **DNF** 时存在潜在问题。 								

  2. ​									要启用 **DNF** 插件的加载，请将 `plugins=` 的值设置为 `1`。 							

- ​							要禁用特定命令的所有 **DNF** 插件，请在该命令中附加 `--noplugins` 选项。例如，为 `update` 命令禁用 **DNF** 插件： 					

  

  ```none
  # dnf --noplugins update
  ```

- ​							要在一个命令中禁用特定的 **DNF** 插件，请在命令中附加 `--disableplugin=*plugin-name*` 选项。例如，要为 `update` 命令禁用特定的 **DNF** 插件： 					

  

  ```none
  # dnf update --disableplugin=plugin-name
  ```

  ​							使用插件的名称替换 *plugin-name*。 					

- ​							要为单个命令启用特定的 **DNF** 插件，请在命令中附加 `--enableplugin=*plugin-name*` 选项。例如，要为 `update` 命令启用特定的 **DNF** 插件： 					

  

  ```none
  # dnf update --enableplugin=plugin-name
  ```

  ​							使用插件的名称替换 *plugin-name*。 					

# 第 4 章 搜索 RHEL 9 内容

​			在以下部分中，了解如何使用 **DNF** 查找和检查 Red Hat Enterprise Linux 9 中 AppStream 和 BaseOS 存储仓库中的内容： 	

- ​					[搜索提供所需内容的软件包](https://access.redhat.com/documentation/zh-cn/red_hat_enterprise_linux/9/html-single/managing_software_with_the_dnf_tool/index#proc_searching-for-software-packages_assembly_searching-for-rhel-9-content)。 			
- ​					[列出已安装的和可用的包](https://access.redhat.com/documentation/zh-cn/red_hat_enterprise_linux/9/html-single/managing_software_with_the_dnf_tool/index#proc_listing-software-packages_assembly_searching-for-rhel-9-content)。 			
- ​					[列出启用和禁用的存储库](https://access.redhat.com/documentation/zh-cn/red_hat_enterprise_linux/9/html-single/managing_software_with_the_dnf_tool/index#proc_listing-repositories_assembly_searching-for-rhel-9-content)。 			
- ​					[显示有关已安装的和可用软件包的信息](https://access.redhat.com/documentation/zh-cn/red_hat_enterprise_linux/9/html-single/managing_software_with_the_dnf_tool/index#proc_displaying-package-information_assembly_searching-for-rhel-9-content)。 			
- ​					[列出已安装的和可用的软件包组](https://access.redhat.com/documentation/zh-cn/red_hat_enterprise_linux/9/html-single/managing_software_with_the_dnf_tool/index#proc_listing-package-groups_assembly_searching-for-rhel-9-content)。 			
- ​					[列出可用的模块并查找有关它们的详细信息](https://access.redhat.com/documentation/zh-cn/red_hat_enterprise_linux/9/html-single/managing_software_with_the_dnf_tool/index#proc_listing-available-modules_assembly_searching-for-rhel-9-content)。 			
- ​					[在 `dnf` 输入中指定全局表达式](https://access.redhat.com/documentation/zh-cn/red_hat_enterprise_linux/9/html-single/managing_software_with_the_dnf_tool/index#proc_specifying-global-expressions-in-yum-input_assembly_searching-for-rhel-9-content)。 			

## 4.1. 搜索软件包

​				要查找提供特定应用程序或其他内容的软件包，请完成以下步骤。 		

**流程**

- ​						要搜索软件包，使用： 				

  

  ```none
  $ dnf search term
  ```

  ​						使用与该软件包相关的术语替换 *term*。 				

  ​						请注意，`dnf search` 命令返回与软件包名称和摘要中的术语匹配。这样可加快搜索速度，您可以搜索您不知道名称但您了解相关术语的软件包。 				

- ​						要在软件包描述中包含匹配名，请使用： 				

  

  ```none
  $ dnf search --all term
  ```

  ​						用您要在软件包名称、概述或描述中搜索的术语替换 *term*。 				

  ​						请注意，`dnf search --all` 命令会进行更详细但速度较慢的搜索。 				

- ​						搜索软件包及其版本或文件： 				

  

  ```none
  $ dnf repoquery name
  ```

  ​						使用您要搜索的软件包或文件的名称替换 *name*。 				

- ​						搜索软件包提供、二进制文件或文件： 				

  

  ```none
  $ dnf provides name
  ```

  ​						使用您要搜索的软件包、二进制或文件的名称替换 *name*。 				

## 4.2. 列出软件包

​				要列出已安装的软件包和用于安装的软件包，请完成以下步骤。 		

**流程**

- ​						要列出所有已安装的和可用软件包的信息，请使用： 				

  

  ```none
  $ dnf list --all
  ```

- ​						要列出安装在您的系统中的所有软件包，请使用： 				

  

  ```none
  $ dnf list --installed
  ```

  ​						或者： 				

  

  ```none
  $ dnf repoquery --installed
  ```

- ​						要列出所有已启用的仓库中用于安装的所有软件包，请使用： 				

  

  ```none
  $ dnf list --available
  ```

  ​						或者： 				

  

  ```none
  $ dnf repoquery
  ```

注意

​					您可以通过将全局表达式附加为参数来过滤结果。如需了解更多详细信息，请参阅 [在 `dnf` 输入中指定全局表达式](https://access.redhat.com/documentation/zh-cn/red_hat_enterprise_linux/9/html-single/managing_software_with_the_dnf_tool/index#proc_specifying-global-expressions-in-yum-input_assembly_searching-for-rhel-9-content)。 			

## 4.3. 列出软件仓库

​				要列出系统上启用和禁用的存储库，请完成以下步骤。 		

**流程**

- ​						要列出您系统中所有启用的库，请使用： 				

  

  ```none
  $ dnf repolist
  ```

- ​						要列出系统中所有禁用的软件仓库，请使用： 				

  

  ```none
  $ dnf repolist --disabled
  ```

- ​						要列出启用和禁用的存储库，请使用： 				

  

  ```none
  $ dnf repolist --all
  ```

- ​						要列出有关存储库的附加信息，请使用： 				

  

  ```none
  $ dnf repoinfo
  ```

注意

​					您可以通过将 ID 或库名称作为参数传递或附加全局表达式来过滤结果。如需了解更多详细信息，请参阅 [在 `dnf` 输入中指定全局表达式](https://access.redhat.com/documentation/zh-cn/red_hat_enterprise_linux/9/html-single/managing_software_with_the_dnf_tool/index#proc_specifying-global-expressions-in-yum-input_assembly_searching-for-rhel-9-content)。 			

## 4.4. 显示软件包信息

​				要显示系统上可用的软件包或已安装的软件包的信息，请完成以下步骤。 		

**流程**

- ​						要显示一个或多个可用软件包的信息，请使用： 				

  

  ```none
  $ dnf info package-name
  ```

  ​						使用软件包名称替换 *package-name*。 				

  ​						或者： 				

  

  ```none
  $ dnf repoquery --info package-name
  ```

  ​						使用软件包名称替换 *package-name*。 				

- ​						要显示安装在您的系统中的一个或多个软件包的信息，请使用： 				

  

  ```none
  $ dnf repoquery --info --installed package-name
  ```

  ​						使用软件包名称替换 *package-name*。 				

注意

​					您可以通过将全局表达式附加为参数来过滤结果。如需了解更多详细信息，请参阅 [在 `dnf` 输入中指定全局表达式](https://access.redhat.com/documentation/zh-cn/red_hat_enterprise_linux/9/html-single/managing_software_with_the_dnf_tool/index#proc_specifying-global-expressions-in-yum-input_assembly_searching-for-rhel-9-content)。 			

## 4.5. 列出软件包组

​				要列出安装在系统上的软件包组或用于安装的软件包组，请完成以下步骤。 		

**流程**

- ​						要查看已安装的和可用组的数量，请使用： 				

  

  ```none
  $ dnf group summary
  ```

- ​						要列出所有安装的和可用的组，请使用： 				

  

  ```none
  $ dnf group list
  ```

  ​						请注意，您可以通过为 `dnf group list` 命令添加命令行选项（`--hidden`、--`available`）来过滤结果。更多可用选项请查看 man page。 				

- ​						要列出特定组群中包含的强制和可选软件包，请使用： 				

  

  ```none
  $ dnf group info group-name
  ```

  ​						用组群的名称替换 *group-name*。 				

注意

​					您可以通过将全局表达式附加为参数来过滤结果。如需了解更多详细信息，请参阅 [在 `dnf` 输入中指定全局表达式](https://access.redhat.com/documentation/zh-cn/red_hat_enterprise_linux/9/html-single/managing_software_with_the_dnf_tool/index#proc_specifying-global-expressions-in-yum-input_assembly_searching-for-rhel-9-content)。 			

## 4.6. 列出可用模块及其内容

​				要查找哪些模块可用及其详情，请完成以下步骤。 		

**流程**

- ​						列出您的系统可用的模块流： 				

  

  ```none
  $ dnf module list
  ```

  ​						此命令的输出列出了单独行中的名称、流、配置集和概述的模块流。 				

- ​						显示模块详情，包括描述、所有配置集列表以及所有提供的软件包列表： 				

  

  ```none
  $ dnf module info module-name
  ```

- ​						列出这些软件包由每个模块配置集安装： 				

  

  ```none
  $ dnf module info --profile module-name
  ```

- ​						显示模块的当前状态，包括启用的流和安装的配置集： 				

  

  ```none
  $ dnf module list module-name
  ```

- ​						要查找哪些模块、流和配置集提供特定的软件包： 				

  

  ```none
  $ dnf module provides package
  ```

  ​						如果软件包不在任何模块之外，这个命令的输出就为空。 				

例 4.1. 查找模块详情

​					以下示例说明了如何列出可用的模块以及如何获有关取 `nodejs` 模块内容的信息。 			

注意

​						本例中的输出已被编辑为 brevity。实际输出可能包含比这里显示的更多的信息。 				

1. ​							列出可用模块： 					

   

   ```none
   $ dnf module list
   (...)
   rhel-AppStream
   Name        Stream  Profiles    Summary
   
   maven       3.8     common [d]  Java project management and project comprehension tool
   nodejs      18      common [d], Javascript runtime
                       development,
                       minimal,
                       s2i
   php         8.1     common [d],  PHP scripting language
                       devel,
                       minimal
   ruby        3.1     common [d]   An interpreter of object-oriented scripting language
   
   Hint: [d]efault, [e]nabled, [x]disabled, [i]nstalled
   ```

2. ​							检查 `nodejs` 模块的详情： 					

   

   ```none
   $ dnf module info nodejs
   
   Name             : nodejs
   Stream           : 18
   Version          : 9010020220808155010
   Context          : rhel9
   Architecture     : x86_64
   Profiles         : common [d], development, minimal, s2i
   Default profiles : common
   Repo             : rhel-AppStream
   Summary          : Javascript runtime
   Description      : (...)
   (...)
   
   Hint: [d]efault, [e]nabled, [x]disabled, [i]nstalled, [a]ctive
   ```

   ​							如果没有指定任何流，`dnf` 会列出所有可用的流。 					

3. ​							检查 `nodejs` 模块的流 `18` 中的配置集： 					

   

   ```none
   $ dnf module info --profile nodejs:18
   (...)
   Name        : nodejs:18:9010020220808155010:rhel9:x86_64
   common      : nodejs
               : npm
   development : nodejs
               : nodejs-devel
               : npm
   minimal     : nodejs
   s2i         : nodejs
               : nodejs-nodemon
               : npm
   ```

   ​							请注意，每个配置集会安装不同的软件包集合，包括它们的依赖项。 					

4. ​							使用其 `common` 配置集安装 `nodejs:18` 模块流： 					

   

   ```none
   # dnf module install nodejs:18/common
   (...)
   Dependencies resolved.
   ================================================================================
   Package          Architecture  Version
      Repository       Size
   ================================================================================
   Installing group/module packages:
   nodejs           x86_64        1:18.7.0-1.module+el9.1.0+16284+4fdefb2f
      rhel-AppStream   12 M
   npm              x86_64        1:8.15.0-1.18.7.0.1.module+el9.1.0+16284+4fdefb2f
      rhel-AppStream   2.2 M
   Installing weak dependencies:
   nodejs-docs      noarch        1:18.7.0-1.module+el9.1.0+16284+4fdefb2f
      rhel-AppStream   7.2 M
   nodejs-full-i18n x86_64        1:18.7.0-1.module+el9.1.0+16284+4fdefb2f
      rhel-AppStream   8.2 M
   Installing module profiles:
   nodejs/common
   Enabling module streams:
   nodejs                         18
   
   Transaction Summary
   ================================================================================
   Install  4 Packages
   
   Total download size: 30 M
   Installed size: 155 M
   Is this ok [y/N]: y
   (...)
   ```

5. ​							检查 `nodejs` 模块的当前状态： 					

   

   ```none
   $ dnf module list nodejs
   (...)
   Name       Stream    Profiles                Summary
   nodejs     18 [e]    common [d] [i],         Javascript runtime
                        development,
                        minimal,
                        s2i
   
   Hint: [d]efault, [e]nabled, [x]disabled, [i]nstalled
   ```

   ​							输出显示 `nodejs:18` 流已启用，并且安装了其 `common` 配置集。 					

**其他资源**

- ​						[Modules](https://access.redhat.com/documentation/zh-cn/red_hat_enterprise_linux/9/html-single/managing_software_with_the_dnf_tool/index#con_modules_assembly_distribution-of-content-in-rhel-9) 				
- ​						[模块流](https://access.redhat.com/documentation/zh-cn/red_hat_enterprise_linux/9/html-single/managing_software_with_the_dnf_tool/index#con_module-streams_assembly_distribution-of-content-in-rhel-9) 				
- ​						[模块配置集](https://access.redhat.com/documentation/zh-cn/red_hat_enterprise_linux/9/html-single/managing_software_with_the_dnf_tool/index#con_module-profiles_assembly_distribution-of-content-in-rhel-9) 				

## 4.7. 在 dnf 输入中指定全局表达式

​				`dnf` 命令允许您将一个或多个*全局表达式*附加为参数来过滤结果。当作为参数传递给 `dnf` 命令时，全局表达式必须被转义。 		

**流程**

- ​						要确定将全局表达式传递给 `dnf`，请使用以下方法之一： 				

  - ​								将整个全局表达式用单引号或双引号括起来： 						

    

    ```none
    # dnf provides "*/file-name"
    ```

    ​								用文件名替换 *file-name*。 						

    ​								请注意，*file-name* 必须以 `/` 或 `*/` 字符序列开头，才能提供所需结果。 						

  - ​								在它们前面使用反斜杠(`\`)字符转义通配符字符： 						

    

    ```none
    # dnf provides \*/file-name
    ```

    ​								用文件名替换 *file-name*。 								

# 第 5 章 安装 RHEL 9 内容

​			在以下部分中，了解如何在 Red Hat Enterprise Linux 9 中安装内容： 	

- ​					使用 `dnf` 命令安装[软件包](https://access.redhat.com/documentation/zh-cn/red_hat_enterprise_linux/9/html-single/managing_software_with_the_dnf_tool/index#proc_installing-packages_assembly_installing-rhel-9-content)，[软件包组](https://access.redhat.com/documentation/zh-cn/red_hat_enterprise_linux/9/html-single/managing_software_with_the_dnf_tool/index#proc_installing-package-groups_assembly_installing-rhel-9-content) 或由模块、流和配置文件提供的 [软件包集合](https://access.redhat.com/documentation/zh-cn/red_hat_enterprise_linux/9/html-single/managing_software_with_the_dnf_tool/index#proc_installing-modular-content_assembly_installing-rhel-9-content)。 			
- ​					[运行 RHEL 9 已安装的内容](https://access.redhat.com/documentation/zh-cn/red_hat_enterprise_linux/9/html-single/managing_software_with_the_dnf_tool/index#proc_running-installed-content_assembly_installing-rhel-9-content)。 			
- ​					[配置自定义默认模块流和配置文件](https://access.redhat.com/documentation/zh-cn/red_hat_enterprise_linux/9/html-single/managing_software_with_the_dnf_tool/index#proc_setting-module-default-streams_assembly_installing-rhel-9-content)。 			

## 5.1. 安装软件包

​				要使用 `dnf install` 命令安装软件包，请完成以下步骤。 		

**流程**

- ​						要安装单个软件包，请使用： 				

  

  ```none
  # dnf install package-name
  ```

  ​						使用软件包名称替换 *package-name*。 				

  - ​								如果任何模块流都没有提供软件包，这个流程与在早期版本的 Red Hat Enterprise Linux 上使用的流程一样。 						
  - ​								如果软件包由启用的模块流提供，则会在不进一步操作的情况下安装软件包。 						
  - ​								如果软件包由未启用的模块流提供，则必须在安装软件包前手动启用对应的模块流。 						

- ​						要同时安装多个软件包及其依赖软件包，请使用： 				

  

  ```none
  # dnf install package-name-1 package-name-2
  ```

  ​						使用软件包名称替换 *package-name-1* 和 *package-name-2*。 				

- ​						当在一个 *multilib* 系统（AMD64、Intel 64 机器）中安装软件包时，您可以指定软件包的构架，方法是将其附加到软件包名称中： 				

  

  ```none
  # dnf install package-name.arch
  ```

  ​						使用软件包的名称和构架替换 *package-name.arch*。 				

- ​						如果您知道要安装的二进制代码的名称，但不知道软件包名，则可以使用到这个二进制代码的路径作为一个参数： 				

  

  ```none
  # dnf install /usr/sbin/binary-file
  ```

  ​						使用二进制文件路径替换 `*/usr/sbin/binary-file*`。 				

  ​						`dnf` 搜索软件包列表，找到提供 `*/usr/sbin/binary-file*` 的软件包，并提示您是否安装该软件包。 				

- ​						要从本地目录中安装之前下载的软件包，请使用： 				

  

  ```none
  # dnf install /path/
  ```

  ​						使用到该软件包的路径替换 */path/*。 				

**其他资源**

- ​						[安装模块化内容](https://access.redhat.com/documentation/zh-cn/red_hat_enterprise_linux/9/html-single/managing_software_with_the_dnf_tool/index#proc_installing-modular-content_assembly_installing-rhel-9-content) 				

## 5.2. 安装软件包组

​				要使用 `dnf group install` 命令按组名称或 groupID 安装软件包组，请完成以下步骤。 		

**流程**

- ​						要根据组名称安装软件包组，请使用： 				

  

  ```none
  # dnf group install group-name
  ```

  ​						使用组群或者环境组群的完整名称替换  *group-name*。 				

- ​						要根据 groupID 安装软件包组，请使用： 				

  

  ```none
  # dnf group install groupID
  ```

  ​						使用组 ID 替换 *groupID*。 				

## 5.3. 安装模块化内容

​				在 RHEL 9 中，不会预定义默认模块流。您必须在安装软件包前启用所需的流。 		

​				要使用 `dnf module install` 命令安装模块流或配置文件提供的模块内容，请完成以下步骤。 		

**先决条件**

- ​						您没有任何从同一模块的另一个流安装的软件包。 				

**流程**

- ​						要安装所选模块流，请使用： 				

  

  ```none
  # dnf module install module-name:stream
  ```

  ​						所选流会自动启用。如果为流定义了默认配置集，则会自动安装此配置集。 				

  ​						或者： 				

  1. ​								启用模块流： 						

     

     ```none
     # dnf module enable module-name:stream
     ```

     ​								将 *module-name* 和 *stream* 替换为模块和流的名称。现在，模块流会被启用，但没有安装任何软件包。 						

  2. ​								安装启用的活跃模块流： 						

     

     ```none
     # dnf module install module-name
     ```

- ​						要安装所选模块流的配置集，请使用： 				

  

  ```none
  # dnf module install module-name:stream/profile
  ```

  ​						这启用了流并为模块的给定流（版本）和配置集（目的）安装推荐的软件包集合。 				

例 5.1. 安装应用程序流

​					以下是如何从特定流，即 **Node.js** 版本 `18` 安装应用程序的示例。 			

1. ​							列出提供 `nodejs` 软件包的模块，以查看可用的流： 					

   

   ```none
   $ dnf module list nodejs
   (...)
   rhel-AppStream
   Name        Stream  Profiles          Summary
   nodejs      18      common [d],       Javascript runtime
                       development,
                       minimal,
                       s2i
   
   Hint: [d]efault, [e]nabled, [x]disabled, [i]nstalled
   ```

   ​							输出显示 `nodejs` 模块可用，其流为 `18`。 					

2. ​							在流 `18` 中安装 `nodejs` 模块提供的软件包： 					

   

1. ```none
   # dnf module install nodejs:18
   (...)
   Dependencies resolved.
   ========================================================================================
    Package           Architecture        Version
   Repository           Size
   ========================================================================================
   Installing group/module packages:
    nodejs            x86_64              1:18.7.0-1.module+el9.1.0+16284+4fdefb2f
   rhel-AppStream       12 M
    npm               x86_64              1:8.15.0-1.18.7.0.1.module+el9.1.0+16284+4fdefb2f
   rhel-AppStream       2.2 M
   Installing weak dependencies:
    nodejs-docs       noarch              1:18.7.0-1.module+el9.1.0+16284+4fdefb2f
   rhel-AppStream       7.2 M
    nodejs-full-i18n  x86_64              1:18.7.0-1.module+el9.1.0+16284+4fdefb2f
   rhel-AppStream       8.2 M
   Installing module profiles:
    nodejs/common
   Enabling module streams:
    nodejs                                18
   
   Transaction Summary
   ========================================================================================
   Install  4 Packages
   
   Total download size: 30 M
   Installed size: 155 M
   Is this ok [y/N]: y
   (...)
   Complete!
   ```

   ​							因为没有指定安装配置集，所以使用默认的配置集 `common`。 					

2. ​							验证已安装的 **Node.js** 版本： 					

   

   ```none
   $ node -v
   v18.7.0
   ```

**其他资源**

- ​						[Modules](https://access.redhat.com/documentation/zh-cn/red_hat_enterprise_linux/9/html-single/managing_software_with_the_dnf_tool/index#con_modules_assembly_distribution-of-content-in-rhel-9) 				
- ​						[模块流](https://access.redhat.com/documentation/zh-cn/red_hat_enterprise_linux/9/html-single/managing_software_with_the_dnf_tool/index#con_module-streams_assembly_distribution-of-content-in-rhel-9) 				
- ​						[模块配置集](https://access.redhat.com/documentation/zh-cn/red_hat_enterprise_linux/9/html-single/managing_software_with_the_dnf_tool/index#con_module-profiles_assembly_distribution-of-content-in-rhel-9) 				

## 5.4. 运行安装的内容

​				在从 RHEL 9 软件仓库安装内容后，通常会启用新命令。如果命令源自由一个模块启用的 RPM 软件包，则使用 命令的体验应没有不同。 		

**流程**

- ​						要运行新命令，直接输入它们： 				

  

  ```none
  $ command
  ```

  ​						使用您要运行的命令的名称替换 *command*。 				

注意

​					在 RHEL 9 中，GCC Toolset 打包为 Software Collection。要从打包为 Software Collection 的组件运行命令，请使用： 			



```none
$ scl enable collection 'command'
```

​					使用 Software Collection 的名称替换 *collection*。 			

​					如需更多信息，请参阅 [使用 GCC Toolset](https://access.redhat.com/documentation/zh-cn/red_hat_enterprise_linux/9/html/developing_c_and_cpp_applications_in_rhel_9/assembly_additional-toolsets-for-development-rhel-9_developing-applications#gcc-toolset_assembly_additional-toolsets-for-development-rhel-9)。 			

## 5.5. 配置自定义默认模块流和配置集

​				在 RHEL 9 中，在包含模块的仓库中没有定义默认流。您可以通过在 `/etc/dnf/modules.defaults.d/` 目录中创建配置文件来配置默认流和配置集。 		

​				当您定义自定义默认流时，您可以在不首先启用流的情况下从该流安装软件包，而无需在安装模块时指定流。 		

​				当您定义自定义默认配置集时，当您安装为其定义的模块流时，会自动选择此配置集。 		

​				要通过 `/etc/dnf/modules.defaults.d/` 目录配置默认流和配置文件，请完成以下步骤。 		

**先决条件**

- ​						您了解了 [ *活动模块流*的概念](https://access.redhat.com/documentation/zh-cn/red_hat_enterprise_linux/9/html-single/managing_software_with_the_dnf_tool/index#con_module-streams_assembly_distribution-of-content-in-rhel-9)。 				

**流程**

- ​						在 `/etc/dnf/modules.defaults.d/` drop-in 目录中创建 YAML 配置文件。 				

  

  ```none
  document: modulemd-defaults
  version: 1
  data:
    module: <module>
    stream: "<stream>"
     profiles:
         '<stream>': [<profile>]
         '<stream>': [<profile>]
  ...
  ```

  ​						上面的输出代表了在编写此文档时 `<module>` 模块的默认定义。查看模块元数据格式的[上游规格](https://github.com/fedora-modularity/libmodulemd/tree/main/yaml_specs)。 				

例 5.2. 将 nodejs:18 模块流配置为默认流并更改默认配置集

​					以下是如何将 `nodejs` 模块的流 `18` 配置为默认流，将 `minimal` 配置文件配置为作为默认配置文件。 			

1. ​							检查 `nodejs` 模块： 					

   

   ```none
   # dnf module list nodejs
   (...)
   rhel-AppStream
   Name             Stream       Profiles            Summary
   nodejs           18           common [d],         Javascript runtime
                                 development,
                                 minimal,
                                 s2i
   
   Hint: [d]efault, [e]nabled, [x]disabled, [i]nstalled
   ```

   ​							目前，`nodejs:18` 模块流没有设置为默认流，default 配置集是 `common` 配置集。 					

2. ​							通过在 `/etc/dnf/modules.defaults.d/` 目录中的 YAML 文件中实现以下配置，将默认流配置为 `18`，默认配置集设置为 `minimal`。 					

   

   ```none
   document: modulemd-defaults
   version: 1
   data:
     module: nodejs
     stream: "18"
     profiles:
         '18': [minimal]
   ```

3. ​							再次检查 `nodejs` 模块： 					

   

   ```none
   # dnf module list nodejs
   (...)
   rhel-AppStream
   Name        Stream           Profiles          Summary
   nodejs      18 [d]           common,       Javascript runtime
                                development,
                                minimal [d],
                                s2i
   
   Hint: [d]efault, [e]nabled, [x]disabled, [i]nstalled
   ```

   ​							`nodejs:18` 模块流现在被设置为默认流，`minimal` 配置集被设置为这个流的默认配置集。 					

## 5.6. 其他资源

- ​						`dnf(8)` man page 				
- ​						[在 RHEL 9 中安装内容的命令](https://access.redhat.com/documentation/zh-cn/red_hat_enterprise_linux/9/html-single/managing_software_with_the_dnf_tool/index#ref_commands-for-installing-content-in-rhel-9_assembly_yum-commands-list) 				
- ​						[modulemd 元数据 YAML 文件的定义](https://github.com/fedora-modularity/libmodulemd/blob/main/yaml_specs/modulemd_defaults_v1.yaml) 				

# 第 6 章 更新 RHEL 9 内容

​			**DNF** 允许您检查您的系统是否有待处理的更新。您可以列出需要更新的软件包，并选择更新单个软件包、多个软件包或者所有软件包。如果您选择更新的软件包有依赖项，它们也会被更新。 	

​			在以下部分中，了解如何使用 **DNF** 更新 Red Hat Enterprise Linux 9 中的内容： 	

- ​					[检查可用的更新](https://access.redhat.com/documentation/zh-cn/red_hat_enterprise_linux/9/html-single/managing_software_with_the_dnf_tool/index#proc_checking-for-updates_assembly_updating-rhel-9-content)。 			
- ​					[更新单个软件包、软件包组或所有软件包及其依赖项](https://access.redhat.com/documentation/zh-cn/red_hat_enterprise_linux/9/html-single/managing_software_with_the_dnf_tool/index#proc_updating-packages-with-yum_assembly_updating-rhel-9-content)。 			
- ​					[应用安全更新](https://access.redhat.com/documentation/zh-cn/red_hat_enterprise_linux/9/html-single/managing_software_with_the_dnf_tool/index#proc_updating-security-related-packages-with-yum_assembly_updating-rhel-9-content)。 			

## 6.1. 检查更新

​				要使用 `dnf check-update` 命令检查系统上已安装的软件包的可用更新，请完成以下步骤。 		

**流程**

- ​						运行以下命令，以查看系统中安装的软件包是否有可用更新： 				

  

  ```none
  # dnf check-update
  ```

  ​						输出返回有可用更新的软件包及其依赖项列表。 				

## 6.2. 更新软件包

​				要使用 `dnf upgrade` 命令更新单个软件包、软件包组或所有软件包及其依赖项，请完成以下步骤。 		

**流程**

- ​						要更新所有软件包及其依赖项，请使用： 				

  

  ```none
  # dnf upgrade
  ```

- ​						要更新单个软件包，请使用： 				

  

  ```none
  # dnf upgrade package-name
  ```

  ​						使用软件包名称替换 *package-name*。 				

- ​						要更新软件包组，请使用： 				

  

  ```none
  # dnf group upgrade group-name
  ```

  ​						使用软件包组的名称替换 *group-name*。 				

重要

​					当对内核应用更新时，无论是否使用了 `dnf update` 或 `dnf install` 命令，`dnf` 总会安装一个新内核。 			

## 6.3. 更新与安全相关的软件包

​				要使用 `dnf upgrade` 或 `dnf upgrade-minimal` 命令更新与安全相关的软件包，请完成以下步骤。 		

**流程**

- ​						要升级到有安全勘误的最新可用软件包，请使用： 				

  

  ```none
  # dnf upgrade --security
  ```

- ​						要升级到最后一个安全勘误软件包，请使用： 				

  

  ```none
  # dnf upgrade-minimal --security
  ```

# 第 7 章 在 RHEL 9 中自动化软件更新

​			要自动检查并下载软件包更新，您可以使用 `dnf-automatic` 软件包提供的 **DNF Automatic** 工具。 	

​			**DNF Automatic** 是 **DNF** 的替代命令行界面，它适用于使用 systemd 计时器、cron 作业和其他此类工具自动和定期执行。 	

​			**DNF Automatic** 根据需要同步软件包元数据，检查可用的更新，然后根据您配置工具的方式执行以下操作之一： 	

- ​					退出 			
- ​					下载更新的软件包 			
- ​					下载并应用更新 			

​			然后，通过所选的机制（如标准输出或电子邮件）报告操作的结果。 	

​			在以下部分中，了解如何在 Red Hat Enterprise Linux 9 中自动化软件更新： 	

- ​					[安装 **DNF Automatic** 工具](https://access.redhat.com/documentation/zh-cn/red_hat_enterprise_linux/9/html-single/managing_software_with_the_dnf_tool/index#proc_installing-dfn-automatic_assembly_automating-software-updates-in-rhel-9)。 			
- ​					[启用 **DNF Automatic** 工具](https://access.redhat.com/documentation/zh-cn/red_hat_enterprise_linux/9/html-single/managing_software_with_the_dnf_tool/index#proc_enabling-dnf-automatic_assembly_automating-software-updates-in-rhel-9)。 			
- ​					[检查 **DNF Automatic** 配置文件及其部分](https://access.redhat.com/documentation/zh-cn/red_hat_enterprise_linux/9/html-single/managing_software_with_the_dnf_tool/index#con_dnf-automatic-configuration-file_assembly_automating-software-updates-in-rhel-9)。 			
- ​					[检查 `dnf-automatic` systemd 计时器单元](https://access.redhat.com/documentation/zh-cn/red_hat_enterprise_linux/9/html-single/managing_software_with_the_dnf_tool/index#ref_overview-of-the-systemd-timer-units-included-in-the-dnf-automatic-package_assembly_automating-software-updates-in-rhel-9)。 			

## 7.1. 安装 DNF Automatic

​				要在您的系统上安装 **DNF Automatic** 工具，请完成以下步骤。 		

**流程**

- ​						安装 `dnf-automatic` 软件包： 				

  

  ```none
  # dnf install dnf-automatic
  ```

**验证**

- ​						通过确认 `dnf-automatic` 软件包是否存在，来验证安装是否成功： 				

  

  ```none
  # rpm -qi dnf-automatic
  ```

## 7.2. DNF Automatic 配置文件

​				默认情况下，**DNF Automatic** 使用 `/etc/dnf/automatic.conf` 作为其配置文件来定义其行为。 		

​				配置文件被分隔为以下主题部分： 		

- ​						`[commands]` 部分 				

  ​						设置 **DNF Automatic** 的操作模式。 				

- ​						`[emitters]` 部分 				

  ​						定义如何报告 **DNF Automatic** 的结果。 				

- ​						`[command_email]` 部分 				

  ​						为用来发送电子邮件的外部命令提供电子邮件发布程序配置。 				

- ​						`[email]` 部分 				

  ​						提供电子邮件发布程序配置。 				

- ​						`[base]` 部分 				

  ​						覆盖 **DNF** 的主要配置文件中的设置。 				

​				通过 `/etc/dnf/automatic.conf` 文件的默认设置，**DNF Automatic** 检查可用更新，下载它们，并将结果报告为标准输出。 		

警告

​					`[commands]` 部分中的操作模式设置会被 systemd 定时器单元用于除 `dnf-automatic.timer` 之外的所有计时器单元使用的设置覆盖。 			

**其他资源**

- ​						[DNF Automatic 文档](https://dnf.readthedocs.io/en/latest/automatic.html) 				
- ​						`dnf-automatic(8)` man page 				
- ​						[dnf-automatic 软件包中包含的 systemd 计时器单元的概述](https://access.redhat.com/documentation/zh-cn/red_hat_enterprise_linux/9/html-single/managing_software_with_the_dnf_tool/index#ref_overview-of-the-systemd-timer-units-included-in-the-dnf-automatic-package_assembly_automating-software-updates-in-rhel-9) 				

## 7.3. 启用 DNF Automatic

​				要运行 **DNF Automatic**，必须始终启用并启动特定的 systemd 计时器单元。您可以使用 `dnf-automatic` 软件包中提供的计时器单元，或者您可以根据需要编写您自己的计时器单元。 		

​				要在您的系统上启用 **DNF Automatic**，请完成以下步骤。 		

**先决条件**

- ​						您可以通过修改 `/etc/dnf/automatic.conf` 配置文件来指定 **DNF Automatic** 的行为。 				

**流程**

- ​						要选择、启用并启动 **下载** 可用更新的 systemd 计时器单元，请使用： 				

  

  ```none
  # systemctl enable dnf-automatic-download.timer
  
  # systemctl start dnf-automatic-download.timer
  ```

- ​						要选择、启用并启动一个用来 **下载并安装** 可用更新的 systemd 计时器单元，请使用： 				

  

  ```none
  # systemctl enable dnf-automatic-install.timer
  ```

  

  ```none
  # systemctl start dnf-automatic-install.timer
  ```

- ​						要选择、启用并启动 **报告** 可用更新的 systemd 计时器单元，请使用： 				

  

  ```none
  # systemctl enable dnf-automatic-notifyonly.timer
  ```

  

  ```none
  # systemctl start dnf-automatic-notifyonly.timer
  ```

- ​						要选择、启用并启动一个 systemd 计时器单元，该单元 **下载**、**下载并安装**，或者 **报告** 可用更新，请使用： 				

  

  ```none
  # systemctl enable dnf-automatic.timer
  ```

  

  ```none
  # systemctl start dnf-automatic.timer
  ```

- ​						（可选）使用 `--now` 选项在一个命令中选择、启用并启动 systemd 计时器单元。例如： 				

  

  ```none
  # systemctl enable --now dnf-automatic-download.timer
  ```

注意

​					您还可以从命令行或自定义脚本直接执行 `/usr/bin/dnf-automatic` 文件来运行 **DNF Automatic**。 			

**验证**

- ​						验证计时器是否已启用： 				

  

  ```none
  # systemctl status <systemd timer unit>
  ```

**其他资源**

- ​						`dnf-automatic(8)` man page 				
- ​						[dnf-automatic 软件包中包含的 systemd 计时器单元的概述](https://access.redhat.com/documentation/zh-cn/red_hat_enterprise_linux/9/html-single/managing_software_with_the_dnf_tool/index#ref_overview-of-the-systemd-timer-units-included-in-the-dnf-automatic-package_assembly_automating-software-updates-in-rhel-9) 				
- ​						[DNF Automatic 配置文件](https://access.redhat.com/documentation/zh-cn/red_hat_enterprise_linux/9/html-single/managing_software_with_the_dnf_tool/index#con_dnf-automatic-configuration-file_assembly_automating-software-updates-in-rhel-9) 				

## 7.4. dnf-automatic 软件包中包含的 systemd 计时器单元概述

​				systemd 定时器单元具有优先权，并在下载和应用更新时覆盖 `/etc/dnf/automatic.conf` 配置文件中的设置。 		

​				例如，如果您在 `/etc/dnf/automatic.conf` 配置文件中设置了 `download_updates = yes`，但您已激活了 `dnf-automatic-notifyonly.timer 单元`，则不会下载软件包。 		

​				`dnf-automatic` 软件包包括以下 systemd 计时器单元： 		

表 7.1. dnf-automatic 软件包中包含的 systemd 计时器

| 计时器单元                       | 功能                                                         | 覆盖 `/etc/dnf/automatic.conf` 文件中的设置？ |
| -------------------------------- | ------------------------------------------------------------ | --------------------------------------------- |
| `dnf-automatic-download.timer`   | 下载软件包以便进行更新。 						 						  							备注：这个计时器单元没有安装更新的软件包。要执行安装，您必须运行 `dnf update` 命令。 | 是                                            |
| `dnf-automatic-install.timer`    | 下载并安装更新的软件包。                                     | 是                                            |
| `dnf-automatic-notifyonly.timer` | 只下载存储库数据，以保持存储库缓存最新状态，并通知您是否有可用的更新。 						 						  							备注：这个计时器单元没有下载或安装更新的软件包。 | 是                                            |
| `dnf-automatic.timer`            | 此计时器在下载和应用更新时的行为是由 `/etc/dnf/automatic.conf` 配置文件中的设置指定。 						 						  							默认行为与 `dnf-automatic-download.timer` 单元相同：它会下载软件包，但不安装它们。 | 否                                            |

**其他资源**

- ​						`dnf-automatic(8)` man page 				
- ​						[DNF Automatic 配置文件](https://access.redhat.com/documentation/zh-cn/red_hat_enterprise_linux/9/html-single/managing_software_with_the_dnf_tool/index#con_dnf-automatic-configuration-file_assembly_automating-software-updates-in-rhel-9) 				

# 第 8 章 删除 RHEL 9 内容

​			在以下部分中，了解如何使用 **DNF** 删除 Red Hat Enterprise Linux 9 中的内容： 	

- ​					[删除软件包](https://access.redhat.com/documentation/zh-cn/red_hat_enterprise_linux/9/html-single/managing_software_with_the_dnf_tool/index#proc_removing-installed-packages-with-yum_assembly_removing-rhel-9-content)。 			
- ​					[删除软件包组](https://access.redhat.com/documentation/zh-cn/red_hat_enterprise_linux/9/html-single/managing_software_with_the_dnf_tool/index#proc_removing-package-groups-with-yum_assembly_removing-rhel-9-content)。 			
- ​					[从模块流或配置文件中删除安装的内容](https://access.redhat.com/documentation/zh-cn/red_hat_enterprise_linux/9/html-single/managing_software_with_the_dnf_tool/index#assembly_removing-installed-modular-content_assembly_removing-rhel-9-content)。 			
  - ​							[从所选的配置文件中删除软件包](https://access.redhat.com/documentation/zh-cn/red_hat_enterprise_linux/9/html-single/managing_software_with_the_dnf_tool/index#proc_removing-packages-from-an-installed-profile-with-yum_assembly_removing-installed-modular-content)。 					
  - ​							[从所的选模块流中删除所有软件包](https://access.redhat.com/documentation/zh-cn/red_hat_enterprise_linux/9/html-single/managing_software_with_the_dnf_tool/index#proc_removing-all-packages-from-a-module-stream-with-yum_assembly_removing-installed-modular-content)。 					

## 8.1. 删除安装的软件包

​				要使用 `dnf remove` 命令删除系统上安装的软件包，请完成以下步骤。 		

**流程**

- ​						要删除某个软件包以及所有未使用的依赖软件包，请使用： 				

  

  ```none
  # dnf remove package-name
  ```

  ​						使用软件包名称替换 *package-name*。 				

- ​						要同时删除多个软件包及其未使用的依赖项，请使用： 				

  

  ```none
  # dnf remove package-name-1 package-name-2
  ```

  ​						使用软件包名称替换 *package-name-1* 和 *package-name-2*。 				

注意

​					`dnf` 命令将软件包与其他依赖软件包一起删除。 			

## 8.2. 删除软件包组

​				要使用 `dnf group remove` 命令按组名称或 groupID 删除软件包组，请完成以下步骤。 		

**流程**

- ​						要根据组群名称删除软件包组，请使用： 				

  

  ```none
  # dnf group remove group-name
  ```

  ​						使用组群的全名替换 *group-name*。 				

- ​						要通过 groupID 删除软件包组，请使用： 				

  

  ```none
  # dnf group remove groupID
  ```

  ​						使用组 ID 替换 *groupID*。 				

## 8.3. 删除安装的模块内容

​				当删除安装的模块内容时，您可以从 [所选配置集](https://access.redhat.com/documentation/zh-cn/red_hat_enterprise_linux/9/html-single/managing_software_with_the_dnf_tool/index#proc_removing-packages-from-an-installed-profile-with-yum_assembly_removing-installed-modular-content) 或 [整个流中删除软件包](https://access.redhat.com/documentation/zh-cn/red_hat_enterprise_linux/9/html-single/managing_software_with_the_dnf_tool/index#proc_removing-all-packages-from-a-module-stream-with-yum_assembly_removing-installed-modular-content)。 		

重要

​					**DNF** 会尝试删除所有名称与安装配置集或流的软件包对应的软件包，包括其依赖软件包。在进行操作前，务必检查要删除的软件包列表，特别是您是否在系统中启用了自定义软件仓库。 			

### 8.3.1. 从安装的配置集中删除软件包

​					当您删除安装有配置集的软件包时，所有名称与配置集安装的软件包相对应的软件包都会被删除。这包括其依赖项，但被其他配置集所需的软件包除外。 			

​					要从所选配置文件中删除软件包，请完成以下步骤。 			

**先决条件**

- ​							已使用 `dnf module install *module-name:stream/profile*` 命令安装了所选配置文件，或使用 `dnf install *module-name:stream 命令*` 安装为默认配置文件。 					
- ​							您了解[模块化依赖关系的解析](https://access.redhat.com/documentation/zh-cn/red_hat_enterprise_linux/9/html-single/managing_software_with_the_dnf_tool/index#con_modular-dependencies-and-stream-changes_assembly_managing-versions-of-application-stream-content)。 					

**流程**

1. ​							卸载属于所选配置集的软件包： 					

   

   ```none
   # dnf module remove module-name:stream/profile
   ```

   ​							将 *module-name*、*stream* 和 *profile* 替换为您要卸载的模块、流和配置集。 					

   ​							或者，从流中的所有安装配置集中卸载软件包： 					

   

   ```none
   # dnf module remove module-name:stream
   ```

   ​							这些操作不会从不属于任何配置集的流中删除软件包。 					

2. ​							在进行删除事务前，请检查 `Removing:` 和 `Removing unused dependencies:` 中的软件包列表。 					

​					要从所选流中删除所有软件包，请按照 [8.3.2 节 "删除模块流中的所有软件包"](https://access.redhat.com/documentation/zh-cn/red_hat_enterprise_linux/9/html-single/managing_software_with_the_dnf_tool/index#proc_removing-all-packages-from-a-module-stream-with-yum_assembly_removing-installed-modular-content) 中的说明操作。 			

例 8.1. 从所选配置集中删除软件包

​						以下是如何删除属于 `nodejs:18` 模块流的 `development` 配置文件的软件包及其依赖项的一个示例。 				

注意

​							本例中的输出已被编辑为 brevity。实际输出可能包含比这里显示的更多的信息。 					

1. ​								安装 `nodejs:18` 模块流，包括所有可用的配置集： 						

   

1. ```none
   # dnf module install nodejs:18/*
   (...)
   Dependencies resolved.
   ===================================================================================
   Package          Architecture   Version
     Repository       Size
   ===================================================================================
   Installing group/module packages:
   nodejs           x86_64         1:18.7.0-1.module+el9.1.0+16284+4fdefb2f
     rhel-AppStream   12 M
   nodejs-devel     x86_64         1:18.7.0-1.module+el9.1.0+16284+4fdefb2f
     rhel-AppStream   202 k
   nodejs-nodemon   noarch         2.0.15-1.module+el9.1.0+15718+e52ec601
     rhel-AppStream   762 k
   npm              x86_64         1:8.15.0-1.18.7.0.1.module+el9.1.0+16284+4fdefb2f
     rhel-AppStream   2.2 M
   Installing dependencies:
   brotli           x86_64         1.0.9-6.el9
     rhel-AppStream   314 k
   brotli-devel     x86_64         1.0.9-6.el9
     rhel-AppStream   36 k
   ...
   Installing weak dependencies:
   nodejs-docs      noarch         1:18.7.0-1.module+el9.1.0+16284+4fdefb2f
     rhel-AppStream   7.2 M
   nodejs-full-i18n x86_64         1:18.7.0-1.module+el9.1.0+16284+4fdefb2f
     rhel-AppStream   8.2 M
   Installing module profiles:
   nodejs/common
   nodejs/development
   nodejs/minimal
   nodejs/s2i
   
   Transaction Summary
   ===================================================================================
   Install  31 Packages
   
   Total download size: 36 M
   Installed size: 165 M
   Is this ok [y/N]: y
   (...)
   Complete!
   ```

2. ​								检查安装的配置集： 						

   

   ```none
   $ dnf module info nodejs
   ...
   Name             : nodejs
   Stream           : 18 [e] [a]
   Version          : 9010020221009220316
   Context          : rhel9
   Architecture     : x86_64
   Profiles         : common [d] [i], development [i], minimal [i], s2i [i]
   Default profiles : common
   Repo             : rhel-AppStream
   ...
   Hint: [d]efault, [e]nabled, [x]disabled, [i]nstalled, [a]ctive
   ```

   ​								所有配置集都如输出中显示。 						

3. ​								从 `development` 配置集及其依赖软件包中删除软件包： 						

   

   ```none
   # dnf module remove nodejs:18/development
   (...)
   Dependencies resolved.
   ========================================================================
   Package          Architecture   Version
     Repository       Size
   ========================================================================
   Removing:
   nodejs-devel     x86_64         1:18.7.0-1.module+el9.1.0+16284+4fdefb2f
     @rhel-AppStream  950 k
   Removing unused dependencies:
   brotli           x86_64         1.0.9-6.el9
     @rhel-AppStream  754 k
   brotli-devel     x86_64         1.0.9-6.el9
     @rhel-AppStream  55 k
   ...
   Disabling module profiles:
   nodejs/development
   
   Transaction Summary
   ========================================================================
   Remove  26 Packages
   
   Freed space: 8.3 M
   Is this ok [y/N]: y
   ```

4. ​								在移除后检查安装的配置集： 						

   

   ```none
   $ dnf module info nodejs
   ...
   Name             : nodejs
   Stream           : 18 [e] [a]
   Version          : 9010020221009220316
   Context          : rhel9
   Architecture     : x86_64
   Profiles         : common [d] [i], development, minimal [i], s2i [i]
   Default profiles : common
   Repo             : rhel-AppStream
   Summary          : Javascript runtime
   ...
   Hint: [d]efault, [e]nabled, [x]disabled, [i]nstalled, [a]ctive
   ```

   ​								除当前安装 `development` 外的所有配置集。 						

### 8.3.2. 从模块流中删除所有软件包

​					当您删除使用模块流安装的软件包时，所有名称与流安装的软件包对应的软件包都会被删除。这包括其依赖项，但其他模块所需的软件包除外。 			

​					要从所选模块流中删除所有软件包，请完成以下步骤。 			

**先决条件**

- ​							已启用模块流，并至少已安装了流中的一些软件包。 					
- ​							您了解[模块化依赖关系的解析](https://access.redhat.com/documentation/zh-cn/red_hat_enterprise_linux/9/html-single/managing_software_with_the_dnf_tool/index#con_modular-dependencies-and-stream-changes_assembly_managing-versions-of-application-stream-content)。 					

**流程**

1. ​							从所选流中删除所有软件包： 					

   

   ```none
   # dnf module remove --all module-name:stream
   ```

   ​							使用您要卸载的模块和流替换 *module-name* 和 *stream*。 					

2. ​							在进行删除事务前，请检查 `Removing:` 和 `Removing unused dependencies:` 中的软件包列表。 					

3. ​							（可选）重置或禁用流。 					

​					如果您只想从所选配置集中删除软件包，请参阅 [Section 8.3.1."从已安装的配置集中移动软件包"](https://access.redhat.com/documentation/zh-cn/red_hat_enterprise_linux/9/html-single/managing_software_with_the_dnf_tool/index#proc_removing-packages-from-an-installed-profile-with-yum_assembly_removing-installed-modular-content)。 			

例 8.2. 从整个流中删除软件包

​						以下是如何从 `nodejs:18` 模块流中删除所有软件包的一个示例。 				

注意

​							本例中的输出已被编辑为 brevity。实际输出可能包含比这里显示的更多的信息。 					

1. ​								安装 `nodejs:18` 模块流，包括所有可用的配置集： 						

   

```none
# dnf module install nodejs:18/*
(...)
Dependencies resolved.
===================================================================================
Package          Architecture   Version
  Repository       Size
===================================================================================
Installing group/module packages:
nodejs           x86_64         1:18.10.0-3.module+el9.1.0+16866+0fab0697
  rhel-AppStream   13 M
nodejs-devel     x86_64         1:18.10.0-3.module+el9.1.0+16866+0fab0697
  rhel-AppStream   203 k
nodejs-nodemon   noarch         2.0.15-1.module+el9.1.0+15718+e52ec601
  rhel-AppStream   762 k
npm              x86_64         1:8.19.2-1.18.10.0.3.module+el9.1.0+16866+0fab0697
  rhel-AppStream   2.2 M
Installing dependencies:
brotli           x86_64         1.0.9-6.el9
  rhel-AppStream   314 k
brotli-devel     x86_64         1.0.9-6.el9
  rhel-AppStream   36 k
...
Installing weak dependencies:
nodejs-docs      noarch         1:18.10.0-3.module+el9.1.0+16866+0fab0697
  rhel-AppStream   7.3 M
nodejs-full-i18n x86_64         1:18.10.0-3.module+el9.1.0+16866+0fab0697
  rhel-AppStream   8.2 M
Installing module profiles:
nodejs/common
nodejs/development
nodejs/minimal
nodejs/s2i
Enabling module streams:
nodejs                        18

Transaction Summary
===================================================================================
Install  31 Packages

Total download size: 37 M
Installed size: 167 M
Is this ok [y/N]: y
```

​								从 `nodejs:18` 模块流中删除所有软件包： 						

1. ```none
   # dnf module remove --all nodejs:18
   (...)
   Dependencies resolved.
   ===================================================================================
   Package          Architecture   Version
     Repository       Size
   ===================================================================================
   Removing:
   nodejs           x86_64         1:18.10.0-3.module+el9.1.0+16866+0fab0697
     @rhel-AppStream  43 M
   nodejs-devel     x86_64         1:18.10.0-3.module+el9.1.0+16866+0fab0697
     @rhel-AppStream  953 k
   nodejs-docs      noarch         1:18.10.0-3.module+el9.1.0+16866+0fab0697
     @rhel-AppStream  78 M
   nodejs-full-i18n x86_64         1:18.10.0-3.module+el9.1.0+16866+0fab0697
     @rhel-AppStream  29 M
   nodejs-nodemon   noarch         2.0.15-1.module+el9.1.0+15718+e52ec601
     @rhel-AppStream  2.0 M
   nodejs-packaging noarch         2021.06-4.module+el9.1.0+15718+e52ec601
     @rhel-AppStream  41 k
   npm              x86_64         1:8.19.2-1.18.10.0.3.module+el9.1.0+16866+0fab0697
     @rhel-AppStream  6.9 M
   Removing unused dependencies:
   brotli           x86_64         1.0.9-6.el9
     @rhel-AppStream  754 k
   brotli-devel     x86_64         1.0.9-6.el9
     @rhel-AppStream  55 k
   ...
   Disabling module profiles:
   nodejs/common
   nodejs/development
   nodejs/minimal
   nodejs/s2i
   
   
   Transaction Summary
   ===================================================================================
   Remove  31 Packages
   
   Freed space: 167 M
   Is this ok [y/N]: y
   ```

2. ​								在移除后检查 `nodejs` 模块： 						

   

   ```none
   $ dnf module info nodejs
   ...
   Name             : nodejs
   Stream           : 18 [e] [a]
   Version          : 9010020221009220316
   Context          : rhel9
   Architecture     : x86_64
   Profiles         : common [d], development, minimal, s2i
   Default profiles : common
   ...
   Hint: [d]efault, [e]nabled, [x]disabled, [i]nstalled, [a]ctive
   ```

   ​								当前没有安装 **Node.js** 模块流。 						

**其他资源**

- ​							[重置模块流](https://access.redhat.com/documentation/zh-cn/red_hat_enterprise_linux/9/html-single/managing_software_with_the_dnf_tool/index#proc_resetting-module-streams_assembly_managing-versions-of-application-stream-content) 					
- ​							[禁用一个模块的所有流](https://access.redhat.com/documentation/zh-cn/red_hat_enterprise_linux/9/html-single/managing_software_with_the_dnf_tool/index#proc_disabling-all-streams-of-a-module_assembly_managing-versions-of-application-stream-content) 					

## 8.4. 其他资源

- ​						[在 RHEL 9 中删除内容的命令](https://access.redhat.com/documentation/zh-cn/red_hat_enterprise_linux/9/html-single/managing_software_with_the_dnf_tool/index#ref_commands-for-removing-content-in-rhel-9_assembly_yum-commands-list) 				

# 第 9 章 处理软件包管理历史记录

​			使用 `dnf history` 命令，您可以查看以下信息： 	

- ​					**DNF** 事务的时间线 			
- ​					事务发生的日期和时间 			
- ​					受事务影响的软件包数量 			
- ​					事务是成功还是被中止 			
- ​					如果在事务间更改了 RPM 数据库 			

​			您还可以使用 `dnf history` 命令来撤销或重做事务。 	

​			在以下部分中，了解如何使用 `dnf history` 命令处理软件包管理历史记录： 	

- ​					[列出最新的事务、所选软件包的最新操作，以及特定事务的详细信息](https://access.redhat.com/documentation/zh-cn/red_hat_enterprise_linux/9/html-single/managing_software_with_the_dnf_tool/index#proc_listing-transactions-with-yum_assembly_handling-package-management-history)。 			
- ​					使用 `dnf history undo` 和 `dnf history rollback` 命令 [恢复 **DNF** 事务](https://access.redhat.com/documentation/zh-cn/red_hat_enterprise_linux/9/html-single/managing_software_with_the_dnf_tool/index#reverting-dnf-transactions_assembly_handling-package-management-history) ： 			
  - ​							[恢复单个 **DNF** 事务](https://access.redhat.com/documentation/zh-cn/red_hat_enterprise_linux/9/html-single/managing_software_with_the_dnf_tool/index#reverting-a-single-dnf-transaction-using-dnf-history-undo_reverting-dnf-transactions)。 					
  - ​							[恢复在指定的事务和最后一个事务之间执行的所有 **DNF**事务](https://access.redhat.com/documentation/zh-cn/red_hat_enterprise_linux/9/html-single/managing_software_with_the_dnf_tool/index#reverting-multiple-dnf-transactions-using-dnf-history-rollback_reverting-dnf-transactions)。 					
- ​					[重复选择的或最后的事务](https://access.redhat.com/documentation/zh-cn/red_hat_enterprise_linux/9/html-single/managing_software_with_the_dnf_tool/index#proc_repeating-transactions-with-yum_assembly_handling-package-management-history)。 			

## 9.1. 列出事务

​				要列出最新的 **DNF** 事务、所选软件包的最新操作以及特定事务的详情，请完成以下步骤。 		

**流程**

- ​						要显示所有最新的 **DNF** 事务列表，请使用： 				

  

  ```none
  # dnf history
  ```

- ​						要显示所选软件包的最新操作列表，请使用： 				

  

  ```none
  # dnf history list package-name
  ```

  ​						使用软件包名称替换 *package-name*。 				

- ​						要显示特定事务的详情，请使用： 				

  

  ```none
  # dnf history info transactionID
  ```

  ​						用事务的 ID 替换 *transactionID*。 				

注意

​					您可以通过附加全局表达式来过滤命令输出。如需了解更多详细信息，请参阅 [在 `dnf` 输入中指定全局表达式](https://access.redhat.com/documentation/zh-cn/red_hat_enterprise_linux/9/html-single/managing_software_with_the_dnf_tool/index#proc_specifying-global-expressions-in-yum-input_assembly_searching-for-rhel-9-content)。 			

## 9.2. 恢复 DNF 事务

​				在 RHEL 9 中，您可以以两种方式恢复 **DNF** 事务： 		

- ​						使用 `dnf history undo` 命令恢复单个 **DNF** 事务。 				
- ​						使用 `dnf history rollback` 命令恢复在指定事务和最后一个事务之间执行的所有 **DNF** 事务。 				

重要

​					请谨慎使用 `dnf history undo` 和 `dnf history rollback` 命令。不支持将 RHEL 软件包，特别是`selinux`, `selinux-policy-*`, `kernel`, `glibc` (`glibc` 的依赖项，如 `gcc`) 软件包，降级到旧版本。因此，不建议将系统降级为次版本（例如，从 RHEL 9.1 到 RHEL 9.0），因为这可能会使系统处于不irsired 状态。 			

### 9.2.1. 使用 dnf history undo 恢复单个 DNF 事务

​					您可以使用 `dnf history undo` 命令恢复在单个事务中执行的步骤。 			

​					如果事务安装了新的软件包，`dnf history undo` 会卸载它。如果事务卸载了软件包，`dnf history undo` 会将其重新安装。如果旧的软件包可用，`dnf history undo` 命令还会尝试将所有更新的软件包降级到之前的版本。 			

注意

​						如果旧的软件包版本不可用，则使用 `dnf history undo` 命令降级会失败。 				

​					要使用 `dnf history undo` 命令恢复单个事务，请完成以下步骤。 			

**流程**

1. ​							确定您要恢复的事务的 ID： 					

   

   ```none
   # dnf history
   ```

2. ​							可选：通过显示其详情来验证您要恢复的事务： 					

   

   ```none
   # dnf history info transaction_id
   ```

   ​							使用您要恢复的事务的 ID 替换 *transaction_id*。 					

3. ​							恢复事务： 					

   

   ```none
   # dnf history undo transaction_id
   ```

   ​							使用您要恢复的事务的 ID 替换 *transaction_id*。 					

例 9.1. 使用 dnf history undo 命令恢复单个 DNF 事务

​						以下是如何使用 `dnf history undo` 命令恢复 `unzip` 软件包的安装事务的一个示例。 				

1. ​								安装 `unzip` 软件包： 						

   

   ```none
   # dnf install unzip
   Dependencies resolved.
   ==========================================================================
    Package          Architecture      Version          Repository      Size
   ==========================================================================
   Installing:
    unzip            x86_64            6.0-56.el9       rhel            186 k
   
   Transaction Summary
   ==========================================================================
   Install  1 Package
   
   Total download size: 186 k
   Installed size: 392 k
   Is this ok [y/N]: y
   ```

2. ​								确定您要恢复的事务 ID： 						

   

   ```none
   # dnf history
   ID | Command line     | Date and time     | Action(s)      | Altered
   --------------------------------------------------------------------
   13 | install zip      | 2022-11-03 10:49  | Install        |    1
   12 | install unzip    | 2022-11-03 10:49  | Install        |    1
   ```

3. ​								恢复事务： 						

   

   ```none
   # dnf history undo 12
   ```

### 9.2.2. 使用 dnf history rollback 恢复多个 DNF 事务

​					您可以使用 `dnf history rollback` 命令恢复在指定事务和最后一个事务之间执行的所有 **DNF** 事务。请注意，事务 ID 指定的事务将保持不变。 			

​					要使用 `dnf history rollback` 命令恢复多个事务，请完成以下步骤。 			

**流程**

1. ​							确定您要恢复到的状态的事务 ID： 					

   

   ```none
   # dnf history
   ```

2. ​							恢复指定的事务： 					

   

   ```none
   # dnf history rollback transaction_id
   ```

   ​							使用您要恢复到的状态的事务 ID 替换 *transaction_id*。 					

   ​							或者，要恢复事务历史记录中的所有事务，请使用事务 ID **1**： 					

   

   ```none
   # dnf history rollback 1
   ```

例 9.2. 使用 dnf history rollback 命令恢复多个 DNF 事务

​						以下是如何使用 `dnf history rollback` 命令回滚 `unzip` 和 `zip` 软件包的两个安装事务的一个示例。 				

1. ​								安装 `unzip` 软件包： 						

   

   ```none
   # dnf install unzip
   Dependencies resolved.
   ========================================================================
    Package          Architecture      Version         Repository     Size
   ========================================================================
   Installing:
    unzip            x86_64            6.0-56.el9      rhel           186 k
   
   Transaction Summary
   ========================================================================
   Install  1 Package
   
   Total download size: 186 k
   Installed size: 392 k
   Is this ok [y/N]: y
   ```

2. ​								安装 `wget` 软件包： 						

   

   ```none
   # dnf install wget
   Dependencies resolved.
   ========================================================================
    Package        Architecture      Version           Repository     Size
   ========================================================================
   Installing:
    wget           x86_64            1.21.1-7.el9      rhel           794 k
   
   Transaction Summary
   ========================================================================
   Install  1 Package
   
   Total download size: 794 k
   Installed size: 3.1 M
   Is this ok [y/N]: y
   ```

3. ​								确定您要恢复到的状态的事务 ID： 						

   

   ```none
   # dnf history 
   ID | Command line     | Date and time     | Action(s)   | Altered
   ------------------------------------------------------------------
   14 | install wget     | 2022-11-03 10:49  | Install     |    1
   13 | install unzip    | 2022-11-03 10:49  | Install     |    1
   12 | install vim-X11  | 2022-11-03 10:20  | Install     |  171 EE
   ```

4. ​								恢复最后两个事务： 						

   

   ```none
   # dnf history rollback 12
   ```

   ​								此操作卸载 `wget` 和 `unzip` 软件包，但会保留 `vim-X11` 软件包。 						

## 9.3. 重复事务

​				您可以使用 `dnf history redo` 命令在事务期间重复执行的步骤。 		

​				要重复所选事务或最后一个 **DNF** 事务，请完成以下步骤。 		

**流程**

- ​						要重复特定的事务，请使用： 				

  

  ```none
  # dnf history redo transactionID
  ```

  ​						用事务的 ID 替换 *transactionID*。 				

- ​						要重复最后的事务，请使用： 				

  

  ```none
  # dnf history redo last
  ```

# 第 10 章 管理自定义软件存储库

​			您可以在 `/etc/dnf/dnf.conf` 文件或 `/etc/yum.repos.d/` 目录中的 `.repo` 文件中配置软件仓库。 	

​			**DNF** 及相关工具的配置信息保存在 `/etc/dnf/dnf.conf` 文件中。此文件包含 `[main]` 部分，可以包含一个或多个 `[repository]` 部分，可用于设置特定存储库的选项。您在 `/etc/dnf/dnf.conf` 文件的单独 `[repository]` 部分定义的值会覆盖 `[main]` 部分中设置的值。 	

​			但是，建议在 `/etc/yum.repos.d/` 目录中的新或现有 `.repo` 文件中定义单独的软件仓库。 	

​			在以下部分中，了解如何使用 **DNF** 管理自定义软件存储库： 	

- ​					[设置 `[repository\]` 部分选项](https://access.redhat.com/documentation/zh-cn/red_hat_enterprise_linux/9/html-single/managing_software_with_the_dnf_tool/index#proc_setting-yum-repository-options_assembly_managing-custom-software-repositories)。 			
- ​					[定义一个新的 **DNF** 存储库](https://access.redhat.com/documentation/zh-cn/red_hat_enterprise_linux/9/html-single/managing_software_with_the_dnf_tool/index#proc_adding-a-yum-repository_assembly_managing-custom-software-repositories)。 			
- ​					[启用一个添加到您系统中的 **DNF** 存储库](https://access.redhat.com/documentation/zh-cn/red_hat_enterprise_linux/9/html-single/managing_software_with_the_dnf_tool/index#proc_enabling-a-yum-repository_assembly_managing-custom-software-repositories)。 			
- ​					[禁用一个添加到您系统中的 **DNF** 存储库](https://access.redhat.com/documentation/zh-cn/red_hat_enterprise_linux/9/html-single/managing_software_with_the_dnf_tool/index#proc_disabling-a-yum-repository_assembly_managing-custom-software-repositories)。 			

## 10.1. 设置 DNF 软件仓库选项

​				`/etc/dnf/dnf.conf` 配置文件包含 `[*repository*]` 部分，其中 *repository* 是唯一的存储库 ID。`[*repository*]` 部分允许您定义独立的 **DNF** 软件仓库。 		

注意

​					不要给出红帽软件仓库使用的自定义软件仓库名称以避免冲突。 			

​				有关可用 `[*repository*]` 选项的完整列表，请查看 `dnf.conf(5)` man page 的 `[*repository*] OPTIONS` 部分。 		

## 10.2. 添加 DNF 软件仓库

​				要定义新存储库，您可以： 		

- ​						在 `/etc/dnf/dnf.conf` 文件中添加 `[*repository*]` 部分。 				

- ​						在 `/etc/yum.repos.d/` 目录中的 `.repo` 文件中添加 `[*repository*]` 部分。 				

  ​						安装 RPM 或软件管理工具（例如，订阅管理器）可以提供自己的 `.repo` 文件。 				

注意

​					在 `.repo` 文件中定义您的仓库而不是 `/etc/dnf/dnf.conf`，因为此目录中具有 `.repo` 文件扩展名的所有文件都可由 `dnf` 读取。 			

​				要使用 `dnf config-manager` 命令将一个 **DNF** 存储库添加到系统中，请完成以下步骤。 		

**流程**

- ​						在您的系统中添加软件仓库： 				

  

  ```none
  # dnf config-manager --add-repo repository_URL
  ```

  ​						使用指向库的 URL 替换 *repository_url*。 				

警告

​					从基于证书的 `Content Delivery Network` (**CDN**)以外的未验证或不信任的源获取并安装软件包具有潜在的安全风险，并可能导致安全性、稳定性、兼容性和可维护性问题。 			

## 10.3. 启用 DNF 软件仓库

​				要使用 `dnf config-manager` 命令启用添加到您系统中的 **DNF** 存储库，请完成以下步骤。 		

**流程**

- ​						启用存储库： 				

  

  ```none
  # dnf config-manager --enable repositoryID
  ```

  ​						使用唯一的存储库 ID 替换 *repositoryID*。 				

**其他资源**

​					[列出软件仓库](https://access.redhat.com/documentation/zh-cn/red_hat_enterprise_linux/9/html-single/managing_software_with_the_dnf_tool/index#proc_listing-repositories_assembly_searching-for-rhel-9-content) 			

## 10.4. 禁用 DNF 软件仓库

​				要使用 `dnf config-manager` 命令禁用添加到您系统中的 **DNF** 存储库，请完成以下步骤。 		

**流程**

- ​						禁用软件仓库： 				

  

  ```none
  # dnf config-manager --disable repositoryID
  ```

  ​						使用唯一的存储库 ID 替换 *repositoryID*。 				

**其他资源**

​					[列出软件仓库](https://access.redhat.com/documentation/zh-cn/red_hat_enterprise_linux/9/html-single/managing_software_with_the_dnf_tool/index#proc_listing-repositories_assembly_searching-for-rhel-9-content) 			

# 第 11 章 管理应用程序流内容版本

​			AppStream 仓库的内容可以在多个版本中提供，对应于模块流。 	

​			在以下部分中，了解更改现有启用的模块流时必须执行的操作： 	

- ​					[模块依赖关系规则](https://access.redhat.com/documentation/zh-cn/red_hat_enterprise_linux/9/html-single/managing_software_with_the_dnf_tool/index#con_modular-dependencies-and-stream-changes_assembly_managing-versions-of-application-stream-content). 			
- ​					[模块和非模块化依赖关系的交互](https://access.redhat.com/documentation/zh-cn/red_hat_enterprise_linux/9/html-single/managing_software_with_the_dnf_tool/index#con_interaction-of-modular-and-non-modular-dependencies_assembly_managing-versions-of-application-stream-content). 			
- ​					[将模块重置为其初始状态](https://access.redhat.com/documentation/zh-cn/red_hat_enterprise_linux/9/html-single/managing_software_with_the_dnf_tool/index#proc_resetting-module-streams_assembly_managing-versions-of-application-stream-content)。 			
- ​					[完全禁用模块及其所有流](https://access.redhat.com/documentation/zh-cn/red_hat_enterprise_linux/9/html-single/managing_software_with_the_dnf_tool/index#proc_disabling-all-streams-of-a-module_assembly_managing-versions-of-application-stream-content)。 			

## 11.1. 模块依赖关系和流更改

​				 传统上，提供内容的软件包依赖于其他软件包，并且通常指定所需的依赖项版本。对于模块中包含的软件包，此机制也会应用这个机制，但将软件包及其特定版本分组到模块和流中可以进一步的限制。另外，模块流可以声明与其他模块流的依赖关系，独立于其包含的软件包并提供它们。 		

​				在使用软件包或模块操作后，所有底层已安装软件包的所有依赖项树都必须满足软件包声明的所有条件。另外，必须满足所有模块流依赖项。 		

​				因此： 		

- ​						启用模块流可能需要启用更多模块流。 				
- ​						安装模块流配置集或从流安装软件包需要启用更多模块流并安装其他软件包。 				
- ​						禁用模块流可能需要禁用其他模块流。不会自动删除任何软件包。 				
- ​						删除软件包可能需要删除其他软件包。如果模块提供了这些软件包，则模块流仍然启用，以准备进一步安装，即使这些流中没有安装这些软件包。这会镜像未使用的 **DNF** 存储库的行为。 				

## 11.2. 模块化和非模块化依赖项的交互

​				[模块依赖关系](https://access.redhat.com/documentation/zh-cn/red_hat_enterprise_linux/9/html-single/managing_software_with_the_dnf_tool/index#con_modular-dependencies-and-stream-changes_assembly_managing-versions-of-application-stream-content) 是常规 RPM 依赖项之上的额外层。模块依赖关系与存储库间可能存在的依赖关系的行为相似。这意味着安装不同的软件包需要同时解析 RPM 依赖项和模块依赖关系。 		

​				系统将始终保留模块和流选择，除非明确指示要更改它们。模块软件包将接收目前启用的模块流中包含的提供此软件包的更新，但不会升级到另一流中包含的版本。 		

## 11.3. 重置模块流

​				重置模块是一种操作，它会将所有流返回至初始状态（不启用或禁用）。如果模块有一个配置的默认流，则此流会因为重置模块而变为活动状态。 		

​				要使用 `dnf module reset` 命令将模块流重置为其初始状态，请完成以下步骤。 		

**流程**

- ​						重置模块状态： 				

  

  ```none
  # dnf module reset module-name
  ```

  ​						模块返回到初始状态。已启用的流和安装的配置集的信息会被清除，但没有删除安装的内容。 				

## 11.4. 禁用一个模块的所有流

​				具有默认流的模块始终会激活一个流。当无法访问所有模块流中的内容时，可以禁用整个模块。 		

​				要使用 `dnf module disable` 命令禁用模块的所有流，请完成以下步骤。 		

**先决条件**

- ​						您了解了 [ *活动模块流*的概念](https://access.redhat.com/documentation/zh-cn/red_hat_enterprise_linux/9/html-single/managing_software_with_the_dnf_tool/index#con_module-streams_assembly_distribution-of-content-in-rhel-9)。 				

**流程**

- ​						禁用模块： 				

  

  ```none
  # dnf module disable module-name
  ```

  ​						`dnf` 命令要求确认，然后禁用该模块及其所有流。所有模块流都不再活跃。没有安装的内容被删除。 				

# 附录 A. DNF 命令列表

​			在以下部分中，检查用于列出、安装和删除 Red Hat Enterprise Linux 9 上内容的 **DNF** 命令。 	

## A.1. 在 RHEL 9 中列出内容的命令

​				以下是在 Red Hat Enterprise Linux 9 中查找内容及其详情的常用 **DNF** 命令： 		

| 命令                                                         | 描述                                                         |
| ------------------------------------------------------------ | ------------------------------------------------------------ |
| `dnf search *term*`                                          | 使用与软件包相关的术语搜索软件包。                           |
| `dnf repoquery *package*`                                    | 为所选软件包及其版本搜索启用的 **DNF** 存储库。              |
| `dnf list`                                                   | 列出所有已安装的和可用的软件包信息。                         |
| `dnf list --installed` 						 						  							`dnf repoquery --installed` | 列出系统上安装的所有软件包。                                 |
| `dnf list --available` 						 						  							`dnf repoquery` | 列出用于安装的所有已启用的存储库中的所有软件包。             |
| `dnf repolist`                                               | 列出系统上所有启用的存储库。                                 |
| `dnf repolist --disabled`                                    | 列出系统上所有禁用的存储库。                                 |
| `dnf repolist --all`                                         | 列出启用和禁用的存储库。                                     |
| `dnf repoinfo`                                               | 列出有关存储库的其他信息。                                   |
| `dnf info *package-name*` 						 						  							`dnf repoquery --info *package_name*` | 显示可用软件包的详细信息。                                   |
| `dnf repoquery --info --installed *package_name*`            | 显示系统上安装的软件包的详情。                               |
| `dnf module list`                                            | 列出模块及其当前状态。                                       |
| `dnf module info *module-name*`                              | 显示模块的详细信息。                                         |
| `dnf module list *module-name*`                              | 显示模块的当前状态。                                         |
| `dnf module info --profile *module-name*`                    | 显示与所选模块的可用配置文件关联的软件包。                   |
| `dnf module info --profile *module-name:stream*`             | 使用指定流显示与模块的可用配置为念关联的软件包。             |
| `dnf module provides *package*`                              | 确定哪些模块、流和配置集提供软件包。 						 						  							请注意，如果软件包在任何模块外可用，这个命令的输出为空。 |
| `dnf group summary`                                          | 查看已安装的和可用的组的数量。                               |
| `dnf group list`                                             | 列出所有已安装的和可用的组。                                 |
| `dnf group info *group-name*`                                | 列出特定组中包含的强制的和可选的软件包。                     |

## A.2. 在 RHEL 9 中安装内容的命令

​				以下是在 Red Hat Enterprise Linux 9 中安装内容的常用 **DNF** 命令： 		

| 命令                                                         | 描述                                                         |
| ------------------------------------------------------------ | ------------------------------------------------------------ |
| `dnf install *package-name*`                                 | 安装软件包。 						 						  							如果软件包由模块流提供，`dnf` 将解析所需的模块流，并在安装此软件包时自动启用它。这也会以递归方式对所有软件包依赖项进行。如果更多模块流满足要求，则使用默认模块流。 |
| `dnf install *package-name-1* *package-name-2*`              | 同时安装多个软件包及其依赖项。                               |
| `dnf install *package-name.arch*`                            | 在 *multilib* 系统(AMD64、Intel 64 机器)上安装软件包时，通过将其追加到软件包名称来指定软件包的架构。 |
| `dnf install */usr/sbin/binary-file*`                        | 通过将二进制路径用作参数来安装二进制文件。                   |
| `dnf install */path/*`                                       | 从本地目录安装之前下载的软件包。                             |
| `dnf install *package-url*`                                  | 使用软件包 URL 安装远程软件包。                              |
| `dnf module enable *module-name:stream*`                     | 使用特定流启用模块。 						 						  							请注意，运行这个命令不会安装任何 RPM 软件包。 |
| `dnf module install *module-name:stream*` 						 						  							`dnf install @*module-name:stream*` | 从特定的模块流安装默认配置集。 						 						  							请注意，运行这个命令还会启用指定的流。 |
| `dnf module install *module-name:stream/profile*` 						 						  							`dnf install @*module-name:stream/profile*` | 使用特定流安装所选配置文件。                                 |
| `dnf group install *group-name*`                             | 按组名称安装软件包组。                                       |
| `dnf group install *groupID*`                                | 按 groupID 安装软件包组。                                    |

## A.3. 在 RHEL 9 中删除内容的命令

​				以下是删除 Red Hat Enterprise Linux 9 中内容的常用 **DNF** 命令： 		

| 命令                                             | 描述                                                         |
| ------------------------------------------------ | ------------------------------------------------------------ |
| `dnf remove *package-name*`                      | 删除特定软件包以及所有依赖的软件包。                         |
| `dnf remove *package-name-1* *package-name-2*`   | 同时删除多个软件包及其未使用的依赖项。                       |
| `dnf group remove group-name`                    | 按组名称删除软件包组。                                       |
| `dnf group remove *groupID*`                     | 按 groupID 删除软件包组。                                    |
| `dnf module remove --all *module-name:stream*`   | 从指定的流中删除所有软件包。 						 						  							请注意，运行此命令可从系统中删除关键软件包。 |
| `dnf module remove *module-name:stream/profile*` | 从安装的配置文件删除软件包。                                 |
| `dnf module remove *module-name:stream*`         | 从指定流中的所有安装的配置文件删除软件                       |

### Pacman

### RPM（RedHat Package Manager）

RPM（红帽软件包管理器），有点像Windows系统中的控制面板，会建立统一的数据库，详细记录软件信息并能够自动分析依赖关系。

RPM 软件包的命名规则：

![](../../../Image/s/software-001.png)

| 命令                  | 作用                                         |
| --------------------- | -------------------------------------------- |
| rpm -ivh filename.rpm | 安装软件                                     |
| rpm -Uvh filename.rpm | 升级软件                                     |
| rpm -e filename.rpm   | 卸载软件                                     |
| rpm -qpi filename.rpm | 查询软件描述信息                             |
| rpm -qpl filename.rpm | 列出软件文件信息                             |
| rpm -qf filename      | 查询文件属于哪个RPM                          |
| -h                    | Displays a progress bar.                     |
| -v                    | Informs about the progress of the operation. |
| --test                | Tests the command without executing it.      |

The `rpm` command also allows you to query the system package database by adding the `-q` option.

It is possible to execute several types of queries to obtain  different information about the installed packages. The RPM database is  located in the directory `/var/lib/rpm`.

Example:

```
[root]# rpm -qa
```

This command queries all the packages installed on the system.

```
rpm -q [-a][-i][-l] package [-f] file
```

Example:

```
[root]# rpm -qil package
[root]# rpm -qf /path/to/file
```

| Option           | Description                                                  |
| ---------------- | ------------------------------------------------------------ |
| `-a`             | Lists all packages installed on the system.                  |
| `-i __package__` | Displays the package information.                            |
| `-l __package__` | Lists the files contained in the package.                    |
| `-f`             | Shows the name of the package containing the specified file. |
| `--last`         | The list of packages is given by installation date (the last installed packages appear first). |

!!! Warning After the `-q` option, the package name must be exact. Metacharacters (wildcards) are not supported.

!!! Tip However, it is possible to list all installed packages and filter with the `grep` command.

Example: list the last installed packages:

```
sudo rpm -qa --last | head
NetworkManager-config-server-1.26.0-13.el8.noarch Mon 24 May 2021 02:34:00 PM CEST
iwl2030-firmware-18.168.6.1-101.el8.1.noarch  Mon 24 May 2021 02:34:00 PM CEST
iwl2000-firmware-18.168.6.1-101.el8.1.noarch  Mon 24 May 2021 02:34:00 PM CEST
iwl135-firmware-18.168.6.1-101.el8.1.noarch   Mon 24 May 2021 02:34:00 PM CEST
iwl105-firmware-18.168.6.1-101.el8.1.noarch   Mon 24 May 2021 02:34:00 PM CEST
iwl100-firmware-39.31.5.1-101.el8.1.noarch    Mon 24 May 2021 02:34:00 PM CEST
iwl1000-firmware-39.31.5.1-101.el8.1.noarch   Mon 24 May 2021 02:34:00 PM CEST
alsa-sof-firmware-1.5-2.el8.noarch            Mon 24 May 2021 02:34:00 PM CEST
iwl7260-firmware-25.30.13.0-101.el8.1.noarch  Mon 24 May 2021 02:33:59 PM CEST
iwl6050-firmware-41.28.5.1-101.el8.1.noarch   Mon 24 May 2021 02:33:59 PM CEST
```

Example: list the installation history of the kernel:

```
sudo rpm -qa --last kernel
kernel-4.18.0-305.el8.x86_64                  Tue 25 May 2021 06:04:56 AM CEST
kernel-4.18.0-240.22.1.el8.x86_64             Mon 24 May 2021 02:33:35 PM CEST
```

Example: list all installed packages with a specific name using `grep`:

```
sudo dnf list installed | grep httpd
centos-logos-httpd.noarch           80.5-2.el8                              @baseos      
httpd.x86_64                        2.4.37-30.module_el8.3.0+561+97fdbbcc   @appstream   
httpd-filesystem.noarch             2.4.37-30.module_el8.3.0+561+97fdbbcc   @appstream   
httpd-tools.x86_64                  2.4.37-30.module_el8.3.0+561+97fdbbcc   @appstream
```

### urpmi

### Yum

Yellow dog Updater Modified

尽管 RPM 能够帮助用户查询软件之间的依赖关系，但问题还是要自己来解决，而有些大型软件可能与数十个程序都有依赖关系，在这种情况下安装软件依然很繁琐。Yum 软件仓库是为了进一步降低软件安装难度和复杂度而设计的技术。Yum 软件仓库可以根据用户的要求分析出所需软件包及其相关的依赖关系，然后自动从服务器下载软件包并安装到系统。Yum 软件仓库的技术拓扑图如下：

![](../../../Image/y/yum.png)

Yum 软件仓库中的 RPM 软件包可以是由红帽官方发布的，也可以是由第三方发布的，当然也可以是自己编写的。

deltarpm 

增量 RPM 包包含旧版本和新版本的 RPM 包之间的差别。在旧 RPM 上应用增量 RPM 将得到全新的 RPM。不需要旧 RPM 的副本，因为增量 RPM 可以与已安装的 RPM 一起工作。增量 RPM 包的大小甚至比增补程序 RPM 小，这有利于通过因特网传送更新包。缺点是，涉及增量 RPM 的更新操作与使用纯粹 RPM 或增补程序 RPM 进行更新的情况相比，占用的 CPU 周期要长得多。

| 命令                              | 说明                                                 |
| --------------------------------- | ---------------------------------------------------- |
| yum repolist all                  | 列出所有仓库                                         |
| yum list all                      | 列出仓库中所有软件包                                 |
| yum list                          | 列出仓库中所有可安装的软件包                         |
| yum list extras                   | 列出所有已安装，但不在 Yum Repository 内的软件包     |
| yum list installed                | 列出所有已安装的软件包                               |
| yum list updates                  | 列出所有可更新的软件包                               |
| yum list <package_name>           | 列出所指定的软件包                                   |
| yum info                          | 列出所有软件包的信息                                 |
| yum info extras                   | 列出所有已安装，但不在 Yum Repository 内的软件包信息 |
| yum info updates                  | 列出所有可更新的软件包信息                           |
| yum info installed                | 列出所有已安装的软件包信息                           |
| yum info <package_name>           | 查看软件包信息                                       |
| yum install <package_name>        | 安装指定软件包                                       |
| yum provides <package_name>       | 列出软件包提供哪些文件                               |
| yum reinstall <package_name>      | 重新安装软件包                                       |
| yum search <package_name/keyword> | 搜索软件包                                           |
| yum remove <package_name>         | 移除指定软件包                                       |
| yum check-update                  | 列出可更新的软件包                                   |
| yum update                        | 升级所有已安装软件                                   |
| yum update <package_name>         | 升级指定软件                                         |
| yum upgrade                       | 升级软件，连一些过旧即将淘汰的软件也会一并升级       |
| yum grouplist                     | 查看系统中已经安装的和可用的软件组                   |
| yum groupinstall <package_name>   | 安装指定的软件包组                                   |
| yum groupupdate <package_name>    | 更新指定软件组                                       |
| yum groupremove <package_name>    | 移除指定的软件包组                                   |
| yum groupinfo <package_name>      | 查询指定的软件包组信息                               |

**清除YUM缓存**

yum 会把下载的软件包和 header 存储在 cache 中，而不会自动删除。

```bash
#清除缓存目录( /var/cache/yum )下的软件包
yum clean packages

#清除缓存目录( /var/cache/yum )下的 headers
yum clean headers

#清除缓存目录( /var/cache/yum )下旧的 headers
yum clean oldheaders

#清除缓存目录( /var/cache/yum )下的 cache
yum clean cache

#清除缓存目录( /var/cache/yum )下的 metadata
yum clean metadata

#清除缓存目录( /var/cache/yum )下的软件包及旧的 headers
yum clean all
# 相当于
yum clean packages; yum clean oldheaders
```

#### 配置文件

```bash
cat /etc/yum.conf
 
[main]
cachedir=/var/cache/yum            #yum下载的RPM包的缓存目录
keepcache=0                        #缓存是否保存，1保存，0不保存。一般需要保存一些常用而又不容易下载的软件时，就开启这个选项。
debuglevel=2                       #调试级别(0-10)，默认为2(具体调试级别的应用，我也不了解)。
logfile=/var/log/yum.log           #yum的日志文件所在的位置
exactarch=1                        #在更新的时候，是否允许更新不同版本的RPM包，比如是否在i386上更新i686的RPM包。
obsoletes=1                        #这是一个update的参数，具体请参阅yum(8)，简单的说就是相当于upgrade，允许更新陈旧的RPM包。
gpgcheck=1                         #是否检查GPG(GNU Private Guard)，一种密钥方式签名。
plugins=1                          #是否允许使用插件，默认是0不允许，但是我们一般会用yum-fastestmirror这个插件。
installonly_limit=3                #允许保留多少个内核包。
exclude=selinux*                   #屏蔽不想更新的RPM包，可用通配符，多个RPM包之间使用空格分离。
proxy=socks5://192.168.96.213:1080
```

### Zypper

## 其他工具

### package-cleanup

package-cleanup 是一个 Python 开发的命令行工具，专注于清理和管理系统中已安装的 RPM 包。该命令的用途主要体现在维护系统的健康状态，避免因为软件包的冗余、孤立或版本冲突导致的系统问题。

package-cleanup 基于 yum 库，它检索并分析系统中所有的 RPM 包信息，并根据不同的参数执行相应的清理任务。

以下是 package-cleanup 的主要特点及其参数说明：

* `-c  <config file> `           指定配置文件，默认为 /etc/yum.conf 。
* `-y`                                            自动同意所有询问，无需用户干预。
* `--problems`                            列出本地 RPM 数据库中的依赖问题。如果有任何问题，该命令就会退出执行，返回结果1 （常用）
* `--dupes`                                  扫描并列出系统中重复安装的 RPM 包。
* `--cleandupes`                        扫描并删除重复的 RPM 包中的旧版本。
* `--leaves`                                列出与其他 RPM 包没有依赖关系的软件包，即所谓的“叶节点”。
  * --all 同时列出不是library的节点
  * --leaf-regex 包名和正则表达式匹配的软件包被视为叶子节点
  * --exclude-devel 列出叶子节点但不列出开发包

* `--orphans`                              列出在当前软件仓库中不再提供支持的已安装软件包。执行这个命令选项时，等同于 `yum list extras` 。
* `--oldkernels`                        删除旧的内核和内核开发包，并可以通过 `--count` 参数指定保留的内核数量。新版本无此参数。`--keepdevel` 当删除内核包时不删除内核开发包。
* `-h`                                             帮助。
* `-q`, `--quiet`                           不打印不必要的信息。
* -v， --version 报告程序版本

注意事项与最佳实践：

* 谨慎使用：package-cleanup 命令具有强大的清理能力，但在使用时应格外谨慎，确保了解每个参数的作用，避免误删重要文件。
* 备份数据：在执行清理操作之前，建议备份重要数据，以防万一。
* 结合 yum 使用：package-cleanup 是 yum 工具集的一部分，与 yum 配合使用可以更好地管理 RPM 包。
* 定期执行：建议定期使用 package-cleanup 命令检查并清理系统中的冗余和孤立软件包，保持系统的清洁和健康。