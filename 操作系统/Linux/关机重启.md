# Linux 关机和重启

[TOC]

## 概述

正确的关机流程为：sync > shutdown > reboot > halt

sync 将数据由内存同步到硬盘中。

## shutdown

shutdown 会给系统计划一个时间关机。可以被用于停止、关机、重启机器。

可以指定一个时间字符串（通常是 now 或者用 hh:mm 指定小时/分钟）作为第一个参数。额外地，也可以设置一个广播信息在系统关闭前发送给所有已登录的用户。

重要：如果使用了时间参数，系统关机前 5 分钟，会创建 `/run/nologin` 文件，以确保没有人可以再登录。

```bash
shutdown
shutdown now
shutdown 13:20  
shutdown -p now                                          # 关闭机器
shutdown -h now                                          # 停止机器      
shutdown -r 09:35                                        # 在 09:35am 重启机器
shutdown -c                                              # 取消即将进行的关机
shutdown –h 10 ‘This server will shutdown after 10 mins’ # 计算机将在10分钟后关机，并且会显示在登陆用户的当前屏幕中。
shutdown –h 20:25                                        # 系统会在今天20:25关机
shutdown –h +10                                          # 十分钟后关机
```

## halt

通知硬件来停止所有的 CPU 功能，但是仍然保持通电。可以用它使系统处于低层维护状态。注意在有些情况会它会完全关闭系统。

等同于 shutdown –h now 和 poweroff

```bash
halt               # 停止机器
halt -p            # 关闭机器
halt --reboot      # 重启机器
```

## poweroff

poweroff 会发送一个 ACPI 信号来通知系统关机。

```bash
poweroff           # 关闭机器
poweroff --halt    # 停止机器
poweroff --reboot  # 重启机器
```

## reboot

reboot 通知系统重启。

等同于 shutdown –r now 。

```bash
reboot             # 重启机器
reboot --halt      # 停止机器
reboot -p          # 关闭机器
```



 	

## 系统关闭

要关闭系统，可以直接使用 `systemctl` 工具，或者通过 `shutdown` 命令来调用这个工具。

使用 `shutdown` 命令的好处是：

- 支持时间参数

  这对于计划的维护特别有用。此外，用户还有更多时间来对计划的系统关闭的警告做出反应。

- 取消关闭的选项

### shutdown

按照以下流程，您可以使用 `shutdown` 命令来执行各种操作。您可以关闭系统，并在某个时间关闭机器的电源，或者在不关闭机器电源的情况下关闭和停止系统，或者取消等待的关闭。 		

**先决条件**

- ​						切换到 `root` 用户 				

**流程**

- ​						要关闭系统，并在某个时间关闭机器的电源，请使用以下格式的命令： 				

  

  ```none
  shutdown --poweroff hh:mm
  ```

  ​						这里的 *hh:mm* 是 24 小时时钟格式的时间。`/run/nologin` 文件会在系统关闭前 5 分钟创建，以防止新的登录。 				

  ​						当使用时间参数时，可以在命令中附加可选的*壁纸消息*。 				

  ​						另外，要在一段延迟后关闭和停止系统，而不关闭机器的电源，请使用： 				

  

  ```none
  shutdown --halt +m
  ```

  ​						其中 *+m* 是延迟时间（以分钟为单位）。`now` 等同于 `+0`。 				

  ​						要取消等待的关闭，请使用： 				

  

  ```none
  shutdown -c
  ```

### systemctl

​				按照以下流程，您可以使用 `systemctl` 命令来执行各种操作。您可以关闭系统并关闭机器的电源，或者关闭和停止系统而不关闭机器的电源。 		

**先决条件**

- ​						切换到 `root` 用户 				

**流程**

- ​						要关闭系统并关闭机器的电源，请使用以下格式的命令： 				

  

  ```none
  systemctl poweroff
  ```

  ​						另外，要关闭和停止系统而不关闭机器的电源，请使用： 				

  

  ```none
  systemctl halt
  ```

注意

​					默认情况下，运行其中任何一个命令都会导致 systemd 向当前登录到该系统的所有用户发送一条信息性消息。要防止 systemd 发送此消息，请运行所选的带有 `--no-wall` 命令行选项的命令。 			

**其他资源**

- ​						[使用 shutdown 命令来关闭系统](https://access.redhat.com/documentation/zh-cn/red_hat_enterprise_linux/9/html/configuring_basic_system_settings/shutting-down-suspending-and-hibernating-the-system_configuring-basic-system-settings#shutting-down-the-system-using-shutdown-command_shutting-down-suspending-and-hibernating-the-system) 				

## 15.4. 重启系统

​				您可以按照这个流程重启系统。 		

**先决条件**

- ​						切换到 `root` 用户 				

**流程**

- ​						要重启该系统，请运行以下命令： 				

  

  ```none
  systemctl reboot
  ```

注意

​					默认情况下，这个命令会让 systemd 向当前登录到该系统的所有用户发送一条信息性消息。要防止 systemd 发送此消息，请运行带有 `--no-wall` 命令行选项的这个命令。 			

## 15.5. 挂起系统

​				您可以按照这个流程挂起系统。 		

**先决条件**

- ​						切换到 `root` 用户。 				

**流程**

- ​						要挂起该系统，请运行以下命令： 				

  

  ```none
  systemctl suspend
  ```

  ​						该命令在 RAM 中保存系统状态，除了 RAM 模块外，关闭机器中的大多数设备。当您重新打开机器时，系统会从内存中恢复其状态，而无需再次引导。 				

  ​						由于系统状态保存在 RAM 中，而不是保存在硬盘上，因此，从挂起模式恢复系统比从休眠模式恢复要快得多。但是，请注意，暂停的系统状态也容易受到断电的影响。 				

**其他资源**

- ​						[休眠系统](https://access.redhat.com/documentation/zh-cn/red_hat_enterprise_linux/9/html/configuring_basic_system_settings/shutting-down-suspending-and-hibernating-the-system_configuring-basic-system-settings#hibernating-the-system_shutting-down-suspending-and-hibernating-the-system) 				

## 15.6. 休眠系统

​				通过遵循此流程，您可以休眠系统，或者休眠并挂起系统。 		

**先决条件**

- ​						切换到 `root` 用户。 				

**流程**

- ​						要休眠系统，请运行以下命令： 				

  

  ```none
  systemctl hibernate
  ```

  ​						该命令在硬盘驱动器中保存系统状态，并断开机器电源。当您重新打开机器时，系统会从保存的数据中恢复其状态，而无需再次引导。 				

  ​						由于系统状态保存在硬盘上，而不是保存在 RAM 中，因此机器不必保持对 RAM 模块的供电。但是，因此，从休眠模式恢复系统要比将其恢复为挂起模式恢复要慢得多。 				

  ​						另外，要休眠并挂起系统，请运行以下命令： 				

  

  ```none
  systemctl hybrid-sleep
  ```

**其他资源**

- ​						[挂起系统](https://access.redhat.com/documentation/zh-cn/red_hat_enterprise_linux/9/html/configuring_basic_system_settings/shutting-down-suspending-and-hibernating-the-system_configuring-basic-system-settings#suspending-the-system_shutting-down-suspending-and-hibernating-the-system) 				

## 15.7. systemctl 的电源管理命令的概述

​				您可以使用以下 `systemctl` 命令列表来控制系统的电源管理。 		

表 15.1. systemctl 电源管理命令的概述

| `systemctl` 命令         | 描述             |
| ------------------------ | ---------------- |
| `systemctl halt`         | 关闭系统。       |
| `systemctl poweroff`     | 关闭系统。       |
| `systemctl reboot`       | 重启该系统。     |
| `systemctl suspend`      | 挂起系统。       |
| `systemctl hibernate`    | 休眠系统。       |
| `systemctl hybrid-sleep` | 休眠并挂起系统。 |

