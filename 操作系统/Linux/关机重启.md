# Linux 关机和重启

[TOC]

## 概述

正确的关机流程为：sync > shutdown > reboot > halt

sync 将数据由内存同步到硬盘中。

## 关闭系统

### shutdown

shutdown 会给系统计划一个时间关机。可以被用于停止、关机、重启机器。

可以指定一个时间字符串（通常是 now 或者用 hh:mm 指定小时/分钟）作为第一个参数。额外地，也可以设置一个广播信息在系统关闭前发送给所有已登录的用户。

重要：如果使用了时间参数，系统关机前 5 分钟，会创建 `/run/nologin` 文件，以确保没有人可以再登录。

```bash
shutdown
shutdown now
shutdown 13:20  
shutdown -p now                                          # 关闭机器
shutdown --poweroff hh:mm                                # hh:mm 是 24 小时时钟格式的时间。
shutdown -h now                                          # 停止机器，而不关闭机器的电源
shutdown –h +10                                          # 十分钟后关机
shutdown --halt +m                                       # 延迟 m 分钟，停止机器，而不关闭机器的电源。now 等同于 +0 。
shutdown -c                                              # 取消即将进行的关机
shutdown –h 10 ‘This server will shutdown after 10 mins’ # 计算机将在10分钟后关机，并且会显示在登陆用户的当前屏幕中。
shutdown –h 20:25                                        # 系统会在今天20:25关机
```

### halt

通知硬件来停止所有的 CPU 功能，但是仍然保持通电。可以用它使系统处于低层维护状态。注意在有些情况会它会完全关闭系统。

等同于 `shutdown –h now` 和 `poweroff`

```bash
halt               # 停止机器
halt -p            # 关闭机器
```

### poweroff

会发送一个 ACPI 信号来通知系统关机。

```bash
poweroff           # 关闭机器
poweroff --halt    # 停止机器
```

### systemctl

要关闭系统，可以直接使用 `systemctl` 工具，或者通过 `shutdown` 命令来调用这个工具。

使用 `shutdown` 命令的好处是：

- 支持时间参数

  这对于计划的维护特别有用。此外，用户还有更多时间来对计划的系统关闭的警告做出反应。

- 取消关闭的选项

要关闭系统并关闭机器的电源

```bash
systemctl poweroff
```

要关闭和停止系统而不关闭机器的电源

```bash
systemctl halt
```

> 注意：
>
> 默认情况下，运行其中任何一个命令都会导致 systemd 向当前登录到该系统的所有用户发送一条信息性消息。要防止 systemd 发送此消息，请运行所选的带有 `--no-wall` 命令行选项的命令。

## 重启系统

### shutdown

```bash
shutdown -r 09:35                                        # 在 09:35am 重启机器
shutdown -r now											 # 立即重启系统
```



### halt

```bash
halt --reboot      # 重启机器
```



### poweroff

```bash
poweroff --reboot  # 重启机器
```



### reboot

通知系统重启。

等同于 `shutdown –r now` 。

```bash
reboot             # 重启机器
reboot --halt      # 停止机器
reboot -p          # 关闭机器
```

### systemctl

```bash
systemctl reboot
```

> 注意：
>
> 默认情况下，这个命令会让 systemd 向当前登录到该系统的所有用户发送一条信息性消息。要防止 systemd 发送此消息，请运行带有 `--no-wall` 命令行选项的这个命令。

## 挂起系统

```bash
systemctl suspend
```

该命令在 RAM 中保存系统状态，除了 RAM 模块外，关闭机器中的大多数设备。当重新打开机器时，系统会从内存中恢复其状态，而无需再次引导。

由于系统状态保存在 RAM 中，而不是保存在硬盘上，因此，从挂起模式恢复系统比从休眠模式恢复要快得多。但是，请注意，暂停的系统状态也容易受到断电的影响。

## 休眠系统

```bash
systemctl hibernate
```

该命令在硬盘驱动器中保存系统状态，并断开机器电源。当重新打开机器时，系统会从保存的数据中恢复其状态，而无需再次引导。 

由于系统状态保存在硬盘上，而不是保存在 RAM 中，因此机器不必保持对 RAM 模块的供电。但是，因此，从休眠模式恢复系统要比将其恢复为挂起模式恢复要慢得多。

另外，要休眠并挂起系统，请运行以下命令：

```bash
systemctl hybrid-sleep		
```

## systemctl 的电源管理命令

| `systemctl` 命令         | 描述             |
| ------------------------ | ---------------- |
| `systemctl halt`         | 关闭系统。       |
| `systemctl poweroff`     | 关闭系统。       |
| `systemctl reboot`       | 重启该系统。     |
| `systemctl suspend`      | 挂起系统。       |
| `systemctl hibernate`    | 休眠系统。       |
| `systemctl hybrid-sleep` | 休眠并挂起系统。 |

