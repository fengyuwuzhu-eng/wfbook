## Install Exim4 安装 Exim4

To install [Exim4](https://www.exim.org/), run the following command:
若要安装 Exim4，请运行以下命令：

```bash
sudo apt install exim4
```

## Configure Exim4 配置 Exim4

To configure Exim4, run the following command:
要配置 Exim4，请运行以下命令：

```bash
sudo dpkg-reconfigure exim4-config
```

This displays a “wizard” user interface for configuring the software. For  example, in Exim4 the configuration files are split amongst multiple  files by default; if you wish to have them in one file you can configure this via the user interface.
这将显示用于配置软件的“向导”用户界面。例如，在 Exim4 中，配置文件默认在多个文件中拆分;如果您希望将它们放在一个文件中，您可以通过用户界面进行配置。

All configurable parameters from the user interface are stored in the `/etc/exim4/update-exim4.conf.conf` file. To re-configure the software you can either re-run the wizard, or manually edit this file using your preferred editor.
用户界面中的所有可配置参数都存储在 `/etc/exim4/update-exim4.conf.conf` 文件中。若要重新配置软件，可以重新运行向导，也可以使用首选编辑器手动编辑此文件。

Once you are finished, you can run the following command to generate the master configuration file:
完成后，您可以运行以下命令来生成主配置文件：

```bash
sudo update-exim4.conf
```

The master configuration file is stored in `/var/lib/exim4/config.autogenerated`.
主配置文件存储在 `/var/lib/exim4/config.autogenerated` 中。

> **Warning**: 警告：
>  You should never manually edit the master configuration file, `/var/lib/exim4/config.autogenerated`, because it is updated automatically every time you run `update-exim4.conf`. Any changes you make to this file will be lost during future updates.
> 切勿手动编辑主配置文件， `/var/lib/exim4/config.autogenerated` 因为每次运行 `update-exim4.conf` 时都会自动更新 。您对此文件所做的任何更改都将在将来的更新中丢失。

## Start the Exim4 daemon 启动 Exim4 守护程序

The following command will start the Exim4 daemon:
以下命令将启动 Exim4 守护程序：

```bash
sudo service exim4 start
```

## SMTP authentication SMTP 身份验证

Exim4 can be configured to use SMTP-AUTH with Transport Layer Security (TLS)  and Simple Authentication and Security Layer (SASL).
Exim4 可以配置为使用具有传输层安全性 （TLS） 和简单身份验证和安全层 （SASL） 的 SMTP-AUTH。

First, enter the following into a terminal prompt to create a certificate for use with TLS:
首先，在终端提示符中输入以下内容，以创建用于 TLS 的证书：

```bash
sudo /usr/share/doc/exim4-base/examples/exim-gencert
```

Configure Exim4 for TLS by editing the `/etc/exim4/conf.d/main/03_exim4-config_tlsoptions` file and adding the following:
通过编辑 `/etc/exim4/conf.d/main/03_exim4-config_tlsoptions` 文件并添加以下内容来配置 TLS 的 Exim4：

```plaintext
MAIN_TLS_ENABLE = yes
```

Next, configure Exim4 to use the `saslauthd` daemon for authentication by editing `/etc/exim4/conf.d/auth/30_exim4-config_examples` – uncomment the `plain_saslauthd_server` and `login_saslauthd_server` sections:
接下来，将 Exim4 配置为通过编辑 `/etc/exim4/conf.d/auth/30_exim4-config_examples` 使用 `saslauthd` 守护程序进行身份验证 – 取消 `plain_saslauthd_server` 注释 和 `login_saslauthd_server` 部分：

```plaintext
plain_saslauthd_server:
  driver = plaintext
  public_name = PLAIN
  server_condition = ${if saslauthd{{$auth2}{$auth3}}{1}{0}}
  server_set_id = $auth2
  server_prompts = :
  .ifndef AUTH_SERVER_ALLOW_NOTLS_PASSWORDS
  server_advertise_condition = ${if eq{$tls_cipher}{}{}{*}}
  .endif

login_saslauthd_server:
  driver = plaintext
  public_name = LOGIN
  server_prompts = "Username:: : Password::"
  # don't send system passwords over unencrypted connections
  server_condition = ${if saslauthd{{$auth1}{$auth2}}{1}{0}}
  server_set_id = $auth1
  .ifndef AUTH_SERVER_ALLOW_NOTLS_PASSWORDS
  server_advertise_condition = ${if eq{$tls_cipher}{}{}{*}}
  .endif
```

To enable outside mail clients to connect to the new server, a new user  needs to be added into Exim4 by using the following commands:
若要使外部邮件客户端能够连接到新服务器，需要使用以下命令将新用户添加到 Exim4 中：

```bash
sudo /usr/share/doc/exim4-base/examples/exim-adduser
```

Protect the new password files with the following commands:
使用以下命令保护新密码文件：

```bash
sudo chown root:Debian-exim /etc/exim4/passwd
sudo chmod 640 /etc/exim4/passwd
```

Finally, update the Exim4 configuration and restart the service:
最后，更新 Exim4 配置并重新启动服务：

```bash
sudo update-exim4.conf
sudo systemctl restart exim4.service
```

## Configure SASL 配置 SASL

To configure `saslauthd` to provide authentication for Exim4, first install the `sasl2-bin` package by running this command at a terminal prompt:
若要配置 `saslauthd` 为为 Exim4 提供身份验证，请首先通过在终端提示符下运行以下命令来安装 `sasl2-bin` 软件包：

```bash
sudo apt install sasl2-bin
```

To configure `saslauthd`, edit the `/etc/default/saslauthd` configuration file and set:
要配置 `saslauthd` ，请编辑 `/etc/default/saslauthd` 配置文件并设置：

```plaintext
START=yes
```

Next, to make Exim4 use the `saslauthd` service, the *Debian-exim* user needs to be part of the *sasl* group:
接下来，要使 Exim4 使用该 `saslauthd` 服务，Debian-exim 用户需要成为 sasl 组的一部分：

```bash
sudo adduser Debian-exim sasl
```

Finally, start the `saslauthd` service:
最后，启动 `saslauthd` 服务：

```bash
sudo service saslauthd start
```

Exim4 is now configured with SMTP-AUTH using TLS and SASL authentication.
Exim4 现在使用 TLS 和 SASL 身份验证配置了 SMTP-AUTH。

## References 引用

- See [exim.org](http://www.exim.org/) for more information.
  有关详细信息，请参阅 exim.org。
- Another resource is the [Exim4 Ubuntu Wiki](https://help.ubuntu.com/community/Exim4) page.
  另一个资源是 Exim4 Ubuntu Wiki 页面。
- Further resources to [set up mailman3 with Exim4](https://mailman.readthedocs.io/en/latest/src/mailman/docs/mta.html#exim).
  使用 Exim4 设置 mailman3 的更多资源。

------