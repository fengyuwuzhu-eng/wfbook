# DNS

DNS ( Domain Name System )，作用是把主机名解析为IP地址

域名系统作为一个层次结构和分布式数据库，包含各种类型的数据，包括主机和域名。

## DNS 的阶层架构与 TLD

在整个 DNS 系统的最上方一定是 . (小数点)。这个 DNS 服务器 (称为 root)，最早以前它底下管理的就只有 (1)com, edu, gov, mil, org, .net 这种特殊领域以及 (2)以国家为分类的第二层的主机名称。这两者称为 Top Level Domains (TLDs) 。 
一般最上层域名称为 (Generic TLDs, gTLD)

国家最上层域名称为 (Country code TLDs, ccTLD)

## 域名含义

| 名称 | 代表意义         |
| ---- | ---------------- |
| com  | 公司、行号、企业 |
| org  | 组织、机构       |
| edu  | 教育单位         |
| gov  | 政府单位         |
| net  | 网络、通讯       |
| mil  | 军事单位         |

## 查询方式

**迭代查询：** 服务器与服务器之间的查询。本地域名服务器向根域名服务器的查询通常是采用迭代查询（反复查询）。当根域名服务器收到本地域名服务器的迭代查询请求报文时，要么给出所要查询的IP地址，要么告诉本地域名服务器下一步应向那个域名服务器进行查询。然后让本地域名服务器进行后续的查询。 

**递归查询：** 客户端与服务器之间的查询。主机向本地域名服务器的查询一般都是采用递归查询。如果主机所询问的本地域名服务器不知道被查询域名的 IP 地址，那么本地域名服务器就以 DNS 客户的身份，向其他根域名服务器继续发出查询请求报文。最后会给客户端一个准确的返回结果，无论是成功与否。

## 解析类型

    正向解析：由 FQDN 解析到 IP 地址；
    反向解析：由 IP 地址解析到 FQDN；

名称解析方式：

    hosts文件（etc/hosts）
    dns
    广播
    解析缓存
    wins（windows 中）等

## DNS服务器类型

> 负责至少解析一个域

　　　主名称服务器

　　　辅助名称服务器

> 不负责域解析

　　　缓存名称服务器

## 主-辅DNS服务器

- 主DNS：维护所负责解析的域数据库的那台服务器；读写操作均可执行；
- 从DNS：从主DNS服务器那里或其它的从DNS那里复制一份解析库；但只能进行读操作；

### 复制操作的实施方式

1. 序列号：serial，也即是数据库的版本号，主服务器数据内容发生变化时，其版本号要递增；
2. 刷新时间间隔：refresh，从服务器每隔多久向主服务器检查序列号更新情况；
3. 重试时间间隔：retry，从服务器从主服务器请求同步解析库失败时，再次发起尝试请求的时间间隔；应小于刷新时间间隔；
4. 过期时长：expire，从服务器始终联系不到主服务器时，多久之后放弃从主服务器同步数据；停止提供服务；
5. 否定答案的缓存时长；minimum

### 区域传送

- 全量传送：axfr，传送整个数据库；
- 增量传送：lxfr，仅传送变化的数据；

## 资源记录

资源记录(Resource Record)：简称rr；常用的资源记录类型有：A, AAAA, PTR, SOA, MX, CNAME, NS；

- SOA：起始授权记录；一个区域解析库有且只能有一个SOA记录，而且必须放在第一条；
- NS：域名服务记录；一个区域解析库可以有多个NS记录；其中一个为主的；
- A：地址记录，FQDN —> IP
- AAAA：地址记录，FQDN —> IPv6
- MX：邮件交换器；优先级0-99，数字越小优先级越高；
- CNAME：别名记录；
- PTR：地址记录，IP —> FQDN；