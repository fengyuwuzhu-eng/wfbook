# 复制

**Table of Contents 目录**

- [19.1 Configuring Replication 19.1 配置复制](https://dev.mysql.com/doc/refman/8.4/en/replication-configuration.html)

  

- [19.2 Replication Implementation 19.2 复制实现](https://dev.mysql.com/doc/refman/8.4/en/replication-implementation.html)

  

- [19.3 Replication Security 19.3 复制安全性](https://dev.mysql.com/doc/refman/8.4/en/replication-security.html)

  

- [19.4 Replication Solutions 19.4 复制解决方案](https://dev.mysql.com/doc/refman/8.4/en/replication-solutions.html)

  

- [19.5 Replication Notes and Tips 19.5 复制说明和提示](https://dev.mysql.com/doc/refman/8.4/en/replication-notes.html)

  



​    Replication enables data from one MySQL database server (known as a    source) to be copied to one or more MySQL database servers (known as    replicas). Replication is asynchronous by default; replicas do not    need to be connected permanently to receive updates from a source.    Depending on the configuration, you can replicate all databases,    selected databases, or even selected tables within a database.  
复制允许将来自一个 MySQL 数据库服务器（称为源）的数据复制到一个或多个 MySQL 数据库服务器（称为副本）。默认情况下，复制是异步的;副本不需要永久连接即可从源接收更新。根据配置，您可以复制数据库中的所有数据库、选定的数据库，甚至数据库中的选定表。

​    Advantages of replication in MySQL include: 
MySQL 中复制的优势包括：

- ​        Scale-out solutions - spreading the load among multiple replicas        to improve performance. In this environment, all writes and        updates must take place on the source server. Reads, however,        may take place on one or more replicas. This model can improve        the performance of writes (since the source is dedicated to        updates), while dramatically increasing read speed across an        increasing number of replicas.      
  横向扩展解决方案 - 在多个副本之间分配负载以提高性能。在此环境中，所有写入和更新都必须在源服务器上进行。但是，读取可能发生在一个或多个副本上。此模型可以提高写入性能（因为源专用于更新），同时显著提高越来越多的副本的读取速度。
- ​        Data security - because the replica can pause the replication        process, it is possible to run backup services on the replica        without corrupting the corresponding source data.      
  数据安全性 - 由于副本可以暂停复制过程，因此可以在副本上运行备份服务，而不会损坏相应的源数据。
- ​        Analytics - live data can be created on the source, while the        analysis of the information can take place on the replica        without affecting the performance of the source.      
  分析 - 可以在源上创建实时数据，而可以在副本上进行信息分析，而不会影响源的性能。
- ​        Long-distance data distribution - you can use replication to        create a local copy of data for a remote site to use, without        permanent access to the source. 
  远距离数据分发 - 您可以使用复制创建数据的本地副本供远程站点使用，而无需永久访问源。

​    For information on how to use replication in such scenarios, see    [Section 19.4, “Replication Solutions”](https://dev.mysql.com/doc/refman/8.4/en/replication-solutions.html).  
有关如何在此类情况下使用复制的信息，请参见[第 19.4 节 “复制解决方案”。](https://dev.mysql.com/doc/refman/8.4/en/replication-solutions.html)

​    MySQL 8.4 supports different methods of replication.    The traditional method is based on replicating events from the    source's binary log, and requires the log files and positions in    them to be synchronized between source and replica. The newer method    based on global transaction    identifiers (GTIDs) is transactional and therefore does    not require working with log files or positions within these files,    which greatly simplifies many common replication tasks. Replication    using GTIDs guarantees consistency between source and replica as    long as all transactions committed on the source have also been    applied on the replica. For more information about GTIDs and    GTID-based replication in MySQL, see    [Section 19.1.3, “Replication with Global Transaction Identifiers”](https://dev.mysql.com/doc/refman/8.4/en/replication-gtids.html). For information on using binary    log file position based replication, see    [Section 19.1, “Configuring Replication”](https://dev.mysql.com/doc/refman/8.4/en/replication-configuration.html).  
MySQL 8.4 支持不同的复制方法。传统方法基于从源的二进制日志中复制事件，并要求在源和副本之间同步日志文件和其中的位置。基于全局事务标识符 （GTID） 的较新方法是事务性的，因此不需要使用日志文件或这些文件中的位置，这大大简化了许多常见的复制任务。使用 GTID  进行复制可以保证源和副本之间的一致性，只要在源上提交的所有事务也已应用于副本。有关 MySQL 中 GTID 和基于 GTID  的复制的更多信息，请参见[第 19.1.3 节 “使用全局事务标识符进行复制”。](https://dev.mysql.com/doc/refman/8.4/en/replication-gtids.html)有关使用基于二进制日志文件位置的复制的信息，请参见[第 19.1 节 “配置复制”。](https://dev.mysql.com/doc/refman/8.4/en/replication-configuration.html)

​    Replication in MySQL supports different types of synchronization.    The original type of synchronization is one-way, asynchronous    replication, in which one server acts as the source, while one or    more other servers act as replicas. This is in contrast to the    *synchronous* replication which is a    characteristic of NDB Cluster (see [Chapter 25, *MySQL NDB Cluster 8.4*](https://dev.mysql.com/doc/refman/8.4/en/mysql-cluster.html)).    In MySQL 8.4, semisynchronous replication is supported    in addition to the built-in asynchronous replication. With    semisynchronous replication, a commit performed on the source blocks    before returning to the session that performed the transaction until    at least one replica acknowledges that it has received and logged    the events for the transaction; see    [Section 19.4.10, “Semisynchronous Replication”](https://dev.mysql.com/doc/refman/8.4/en/replication-semisync.html). MySQL 8.4 also    supports delayed replication such that a replica deliberately lags    behind the source by at least a specified amount of time; see    [Section 19.4.11, “Delayed Replication”](https://dev.mysql.com/doc/refman/8.4/en/replication-delayed.html). For scenarios where    *synchronous* replication is required, use NDB    Cluster (see [Chapter 25, *MySQL NDB Cluster 8.4*](https://dev.mysql.com/doc/refman/8.4/en/mysql-cluster.html)).  
MySQL 中的复制支持不同类型的同步。原始同步类型是单向异步复制，其中一台服务器充当源，而一个或多个其他服务器充当副本。这与 NDB Cluster 的特征同步复制形成对比（请参见[第 25 章 ，*MySQL NDB Cluster 8.4*](https://dev.mysql.com/doc/refman/8.4/en/mysql-cluster.html)）。在 MySQL 8.4 中，除了内置的异步复制外，还支持半同步复制。使用半同步复制，在返回执行事务的 session 之前对源块执行提交，直到至少一个副本确认它已接收并记录事务的事件;参见[第 19.4.10 节 “半同步复制”。](https://dev.mysql.com/doc/refman/8.4/en/replication-semisync.html)MySQL 8.4 还支持延迟复制，以便副本故意滞后于源至少指定的时间;参见[第 19.4.11 节 “延迟复制”。](https://dev.mysql.com/doc/refman/8.4/en/replication-delayed.html)对于需要*同步*复制的场景，请使用 NDB Cluster（请参见[第 25 章 ，*MySQL NDB Cluster 8.4*](https://dev.mysql.com/doc/refman/8.4/en/mysql-cluster.html)）。

​    There are a number of solutions available for setting up replication    between servers, and the best method to use depends on the presence    of data and the engine types you are using. For more information on    the available options, see [Section 19.1.2, “Setting Up Binary Log File Position Based Replication”](https://dev.mysql.com/doc/refman/8.4/en/replication-howto.html).  
有许多解决方案可用于在服务器之间设置复制，最佳使用方法取决于数据的存在和您使用的引擎类型。有关可用选项的更多信息，请参见[第 19.1.2 节 “设置基于二进制日志文件位置的复制”。](https://dev.mysql.com/doc/refman/8.4/en/replication-howto.html)

​    There are two core types of replication format, Statement Based    Replication (SBR), which replicates entire SQL statements, and Row    Based Replication (RBR), which replicates only the changed rows. You    can also use a third variety, Mixed Based Replication (MBR). For    more information on the different replication formats, see    [Section 19.2.1, “Replication Formats”](https://dev.mysql.com/doc/refman/8.4/en/replication-formats.html).  
复制格式有两种核心类型，基于语句的复制 （SBR） 和基于行的复制 （RBR） ，它只复制更改的行。您还可以使用第三种类型，即基于混合的复制 （MBR）。有关不同复制格式的更多信息，请参见[第 19.2.1 节 “复制格式”。](https://dev.mysql.com/doc/refman/8.4/en/replication-formats.html)

​    Replication is controlled through a number of different options and    variables. For more information, see    [Section 19.1.6, “Replication and Binary Logging Options and Variables”](https://dev.mysql.com/doc/refman/8.4/en/replication-options.html). Additional security measures    can be applied to a replication topology, as described in    [Section 19.3, “Replication Security”](https://dev.mysql.com/doc/refman/8.4/en/replication-security.html).  
复制是通过许多不同的选项和变量来控制的。有关更多信息，请参见[第 19.1.6 节 “复制和二进制日志记录选项和变量”。](https://dev.mysql.com/doc/refman/8.4/en/replication-options.html)其他安全措施可以应用于复制拓扑，如[第 19.3 节 “复制安全性”](https://dev.mysql.com/doc/refman/8.4/en/replication-security.html)中所述。

​    You can use replication to solve a number of different problems,    including performance, supporting the backup of different databases,    and as part of a larger solution to alleviate system failures. For    information on how to address these issues, see    [Section 19.4, “Replication Solutions”](https://dev.mysql.com/doc/refman/8.4/en/replication-solutions.html).  
您可以使用复制来解决许多不同的问题，包括性能、支持不同数据库的备份，以及作为缓解系统故障的更大解决方案的一部分。有关如何解决这些问题的信息，请参见[第 19.4 节 “复制解决方案”。](https://dev.mysql.com/doc/refman/8.4/en/replication-solutions.html)

​    For notes and tips on how different data types and statements are    treated during replication, including details of replication    features, version compatibility, upgrades, and potential problems    and their resolution, see [Section 19.5, “Replication Notes and Tips”](https://dev.mysql.com/doc/refman/8.4/en/replication-notes.html). For    answers to some questions often asked by those who are new to MySQL    Replication, see [Section A.14, “MySQL 8.4 FAQ: Replication”](https://dev.mysql.com/doc/refman/8.4/en/faqs-replication.html).  
有关在复制过程中如何处理不同数据类型和语句的注释和提示，包括复制功能、版本兼容性、升级和潜在问题及其解决方法的详细信息，请参见[第 19.5 节 “复制注释和提示”。](https://dev.mysql.com/doc/refman/8.4/en/replication-notes.html)有关 MySQL 复制新手经常问的一些问题的答案，请参见[第 A.14 节 “MySQL 8.4 常见问题解答：复制”。](https://dev.mysql.com/doc/refman/8.4/en/faqs-replication.html)

​    For detailed information on the implementation of replication, how    replication works, the process and contents of the binary log,    background threads and the rules used to decide how statements are    recorded and replicated, see    [Section 19.2, “Replication Implementation”](https://dev.mysql.com/doc/refman/8.4/en/replication-implementation.html). 
有关复制的实现、复制的工作原理、二进制日志的过程和内容、后台线程以及用于决定如何记录和复制语句的规则的详细信息，请参见[第 19.2 节 “复制实现”。](https://dev.mysql.com/doc/refman/8.4/en/replication-implementation.html)

## 19.1 Configuring Replication 19.1 配置复制

- [19.1.1 Binary Log File Position Based Replication Configuration Overview 19.1.1. 基于二进制文件位置的复制配置概述](https://dev.mysql.com/doc/refman/8.4/en/binlog-replication-configuration-overview.html)
- [19.1.2 Setting Up Binary Log File Position Based Replication 19.1.2 设置基于二进制日志文件位置的复制](https://dev.mysql.com/doc/refman/8.4/en/replication-howto.html)
- [19.1.3 Replication with Global Transaction Identifiers 19.1.3 使用全局事务标识符进行复制](https://dev.mysql.com/doc/refman/8.4/en/replication-gtids.html)
- [19.1.4 Changing GTID Mode on Online Servers 19.1.4 更改在线服务器上的 GTID 模式](https://dev.mysql.com/doc/refman/8.4/en/replication-mode-change-online.html)
- [19.1.5 MySQL Multi-Source Replication 19.1.5 MySQL 多源复制](https://dev.mysql.com/doc/refman/8.4/en/replication-multi-source.html)
- [19.1.6 Replication and Binary Logging Options and Variables 19.1.6 复制和二进制日志记录选项和变量](https://dev.mysql.com/doc/refman/8.4/en/replication-options.html)
- [19.1.7 Common Replication Administration Tasks 19.1.7 常见复制管理任务](https://dev.mysql.com/doc/refman/8.4/en/replication-administration.html)

​    This section describes how to configure the different types of    replication available in MySQL and includes the setup and    configuration required for a replication environment, including    step-by-step instructions for creating a new replication    environment. The major components of this section are: 
本节介绍如何配置 MySQL 中可用的不同类型的复制，并包括复制环境所需的设置和配置，包括创建新复制环境的分步说明。本节的主要组成部分是：

- ​        For a guide to setting up two or more servers for replication        using binary log file positions,        [Section 19.1.2, “Setting Up Binary Log File Position Based Replication”](https://dev.mysql.com/doc/refman/8.4/en/replication-howto.html), deals with the        configuration of the servers and provides methods for copying        data between the source and replicas.      
  有关使用二进制日志文件位置设置两个或多个服务器以进行复制的指南，[第 19.1.2 节 “设置基于二进制日志文件位置的复制”](https://dev.mysql.com/doc/refman/8.4/en/replication-howto.html)介绍了服务器的配置，并提供了在源和副本之间复制数据的方法。
- ​        For a guide to setting up two or more servers for replication        using GTID transactions, [Section 19.1.3, “Replication with Global Transaction Identifiers”](https://dev.mysql.com/doc/refman/8.4/en/replication-gtids.html),        deals with the configuration of the servers.      
  有关使用 GTID 事务设置两个或多个服务器以进行复制的指南，[第 19.1.3 节 “使用全局事务标识符进行复制”](https://dev.mysql.com/doc/refman/8.4/en/replication-gtids.html)介绍了服务器的配置。
- ​        Events in the binary log are recorded using a number of formats.        These are referred to as statement-based replication (SBR) or        row-based replication (RBR). A third type, mixed-format        replication (MIXED), uses SBR or RBR replication automatically        to take advantage of the benefits of both SBR and RBR formats        when appropriate. The different formats are discussed in        [Section 19.2.1, “Replication Formats”](https://dev.mysql.com/doc/refman/8.4/en/replication-formats.html).      
  二进制日志中的事件使用多种格式进行记录。这些称为基于语句的复制 （SBR） 或基于行的复制 （RBR）。第三种类型是混合格式复制 （MIXED），它在适当时自动使用 SBR 或 RBR 复制，以充分利用 SBR 和 RBR 格式的优势。不同的格式在[第 19.2.1 节 “复制格式”](https://dev.mysql.com/doc/refman/8.4/en/replication-formats.html)中讨论。
- ​        Detailed information on the different configuration options and        variables that apply to replication is provided in        [Section 19.1.6, “Replication and Binary Logging Options and Variables”](https://dev.mysql.com/doc/refman/8.4/en/replication-options.html).      
  [第 19.1.6 节 “复制和二进制日志记录选项和变量”](https://dev.mysql.com/doc/refman/8.4/en/replication-options.html)中提供了有关适用于复制的不同配置选项和变量的详细信息。
- ​        Once started, the replication process should require little        administration or monitoring. However, for advice on common        tasks that you may want to execute, see        [Section 19.1.7, “Common Replication Administration Tasks”](https://dev.mysql.com/doc/refman/8.4/en/replication-administration.html). 
  一旦开始，复制过程应该只需要很少的管理或监控。但是，有关您可能要执行的常见任务的建议，请参见[第 19.1.7 节 “常见复制管理任务”。](https://dev.mysql.com/doc/refman/8.4/en/replication-administration.html)

### 19.1.1 Binary Log File Position Based Replication Configuration Overview 19.1.1. 基于二进制文件位置的复制配置概述

​      This section describes replication between MySQL servers based on      the binary log file position method, where the MySQL instance      operating as the source (where the database changes take place)      writes updates and changes as “events” to the binary      log. The information in the binary log is stored in different      logging formats according to the database changes being recorded.      Replicas are configured to read the binary log from the source and      to execute the events in the binary log on the replica's local      database.    
本节介绍基于二进制日志文件位置方法的 MySQL 服务器之间的复制，其中作为源（发生数据库更改的位置）运行的 MySQL 实例将更新和更改作为“事件”写入二进制日志。二进制日志中的信息根据所记录的数据库更改以不同的日志记录格式存储。副本配置为从源读取二进制日志，并在副本的本地数据库上执行二进制日志中的事件。

​      Each replica receives a copy of the entire contents of the binary      log. It is the responsibility of the replica to decide which      statements in the binary log should be executed. Unless you      specify otherwise, all events in the source's binary log are      executed on the replica. If required, you can configure the      replica to process only events that apply to particular databases      or tables. 
每个副本都会收到二进制日志的全部内容的副本。副本负责决定应执行二进制日志中的哪些语句。除非你另有指定，否则源的二进制日志中的所有事件都在副本上执行。如果需要，您可以将副本配置为仅处理适用于特定数据库或表的事件。

Important 重要

​        You cannot configure the source to log only certain events. 
您不能将源配置为仅记录某些事件。

​      Each replica keeps a record of the binary log coordinates: the      file name and position within the file that it has read and      processed from the source. This means that multiple replicas can      be connected to the source and executing different parts of the      same binary log. Because the replicas control this process,      individual replicas can be connected and disconnected from the      server without affecting the source's operation. Also, because      each replica records the current position within the binary log,      it is possible for replicas to be disconnected, reconnect and then      resume processing.    
每个副本都保留二进制日志坐标的记录：它从源读取和处理的文件中的文件名和位置。这意味着多个副本可以连接到源并执行同一二进制日志的不同部分。由于副本控制此过程，因此可以连接和断开各个副本与服务器的连接，而不会影响源的操作。此外，由于每个副本都记录了二进制日志中的当前位置，因此副本可以断开连接、重新连接，然后恢复处理。

​      The source and each replica must be configured with a unique ID      (using the [`server_id`](https://dev.mysql.com/doc/refman/8.4/en/replication-options.html#sysvar_server_id) system      variable). In addition, each replica must be configured with      information about the source's host name, log file name, and      position within that file. These details can be controlled from      within a MySQL session using a [`CHANGE       REPLICATION SOURCE TO`](https://dev.mysql.com/doc/refman/8.4/en/change-replication-source-to.html) statement on the replica. The      details are stored within the replica's connection metadata      repository (see [Section 19.2.4, “Relay Log and Replication Metadata Repositories”](https://dev.mysql.com/doc/refman/8.4/en/replica-logs.html)). 
源和每个副本都必须配置唯一 ID（使用 [`server_id`](https://dev.mysql.com/doc/refman/8.4/en/replication-options.html#sysvar_server_id) 系统变量）。此外，每个副本都必须配置有关源的主机名、日志文件名和在该文件中的位置的信息。这些详细信息可以在 MySQL 会话中使用副本上的[ `CHANGE       REPLICATION SOURCE TO` ](https://dev.mysql.com/doc/refman/8.4/en/change-replication-source-to.html)语句进行控制。详细信息存储在副本的连接元数据存储库中（请参见[第 19.2.4 节 “中继日志和复制元数据存储库”）。](https://dev.mysql.com/doc/refman/8.4/en/replica-logs.html)

### 19.1.2 Setting Up Binary Log File Position Based Replication 19.1.2 设置基于二进制日志文件位置的复制

- [19.1.2.1 Setting the Replication Source Configuration 19.1.2.1 设置复制源配置](https://dev.mysql.com/doc/refman/8.4/en/replication-howto-masterbaseconfig.html)
- [19.1.2.2 Setting the Replica Configuration 19.1.2.2 设置副本配置](https://dev.mysql.com/doc/refman/8.4/en/replication-howto-slavebaseconfig.html)
- [19.1.2.3 Creating a User for Replication 19.1.2.3 创建用于复制的用户](https://dev.mysql.com/doc/refman/8.4/en/replication-howto-repuser.html)
- [19.1.2.4 Obtaining the Replication Source Binary Log Coordinates 19.1.2.4 获取复制源二进制日志坐标](https://dev.mysql.com/doc/refman/8.4/en/replication-howto-masterstatus.html)
- [19.1.2.5 Choosing a Method for Data Snapshots 19.1.2.5 选择数据快照方法](https://dev.mysql.com/doc/refman/8.4/en/replication-snapshot-method.html)
- [19.1.2.6 Setting Up Replicas 19.1.2.6 设置副本](https://dev.mysql.com/doc/refman/8.4/en/replication-setup-replicas.html)
- [19.1.2.7 Setting the Source Configuration on the Replica 19.1.2.7 在副本上设置源配置](https://dev.mysql.com/doc/refman/8.4/en/replication-howto-slaveinit.html)
- [19.1.2.8 Adding Replicas to a Replication Environment 19.1.2.8 将副本添加到复制环境](https://dev.mysql.com/doc/refman/8.4/en/replication-howto-additionalslaves.html)

​      This section describes how to set up a MySQL server to use binary      log file position based replication. There are a number of      different methods for setting up replication, and the exact method      to use depends on how you are setting up replication, and whether      you already have data in the database on the source that you want      to replicate. 
本节介绍如何设置 MySQL 服务器以使用基于二进制日志文件位置的复制。设置复制的方法有很多种，具体使用的方法取决于您设置复制的方式，以及要复制的源上的数据库中是否已经有数据。

Tip 提示

​        To deploy multiple instances of MySQL, you can use [InnoDB Cluster](https://dev.mysql.com/doc/mysql-shell/8.4/en/mysql-innodb-cluster.html) which enables you to easily administer a group of MySQL server instances in [MySQL Shell](https://dev.mysql.com/doc/mysql-shell/8.4/en/). InnoDB Cluster wraps MySQL Group Replication in a programmatic  environment that enables you easily deploy a cluster of MySQL instances  to achieve high availability. In addition, InnoDB Cluster interfaces  seamlessly with [MySQL Router](https://dev.mysql.com/doc/mysql-router/8.4/en/), which enables your applications to connect to the cluster without  writing your own failover process. For similar use cases that do not  require high availability, however, you can use [InnoDB ReplicaSet](https://dev.mysql.com/doc/mysql-shell/8.4/en/mysql-innodb-replicaset.html). Installation instructions for MySQL Shell can be found [here](https://dev.mysql.com/doc/mysql-shell/8.4/en/mysql-shell-install.html). 
要部署多个 MySQL 实例，您可以使用 [InnoDB Cluster](https://dev.mysql.com/doc/mysql-shell/8.4/en/mysql-innodb-cluster.html)，它使您能够在 [MySQL Shell](https://dev.mysql.com/doc/mysql-shell/8.4/en/) 中轻松管理一组 MySQL 服务器实例。InnoDB Cluster 将 MySQL 组复制包装在编程环境中，使您能够轻松部署 MySQL 实例集群以实现高可用性。此外，InnoDB Cluster 与 [MySQL Router](https://dev.mysql.com/doc/mysql-router/8.4/en/) 无缝连接，这使您的应用程序无需编写自己的故障转移过程即可连接到集群。但是，对于不需要高可用性的类似使用案例，您可以使用 [InnoDB ReplicaSet](https://dev.mysql.com/doc/mysql-shell/8.4/en/mysql-innodb-replicaset.html)。[可在此处](https://dev.mysql.com/doc/mysql-shell/8.4/en/mysql-shell-install.html)找到 MySQL Shell 的安装说明。

​      There are some generic tasks that are common to all setups: 
有一些通用任务是所有设置通用的：

- ​          On the source, you must ensure that binary logging is enabled,          and configure a unique server ID. This might require a server          restart. See          [Section 19.1.2.1, “Setting the Replication Source Configuration”](https://dev.mysql.com/doc/refman/8.4/en/replication-howto-masterbaseconfig.html).        
  在源上，您必须确保启用二进制日志记录，并配置唯一的服务器 ID。这可能需要重新启动服务器。参见[第 19.1.2.1 节 “设置复制源配置”。](https://dev.mysql.com/doc/refman/8.4/en/replication-howto-masterbaseconfig.html)
- ​          On each replica that you want to connect to the source, you          must configure a unique server ID. This might require a server          restart. See          [Section 19.1.2.2, “Setting the Replica Configuration”](https://dev.mysql.com/doc/refman/8.4/en/replication-howto-slavebaseconfig.html).        
  在要连接到源的每个副本上，必须配置唯一的服务器 ID。这可能需要重新启动服务器。参见[第 19.1.2.2 节 “设置副本配置”。](https://dev.mysql.com/doc/refman/8.4/en/replication-howto-slavebaseconfig.html)
- ​          Optionally, create a separate user for your replicas to use          during authentication with the source when reading the binary          log for replication. See          [Section 19.1.2.3, “Creating a User for Replication”](https://dev.mysql.com/doc/refman/8.4/en/replication-howto-repuser.html).        
  （可选）为副本创建一个单独的用户，以便在读取二进制日志进行复制时与源进行身份验证时使用。参见[第 19.1.2.3 节 “创建用于复制的用户”。](https://dev.mysql.com/doc/refman/8.4/en/replication-howto-repuser.html)
- ​          Before creating a data snapshot or starting the replication          process, on the source you should record the current position          in the binary log. You need this information when configuring          the replica so that the replica knows where within the binary          log to start executing events. See          [Section 19.1.2.4, “Obtaining the Replication Source Binary Log Coordinates”](https://dev.mysql.com/doc/refman/8.4/en/replication-howto-masterstatus.html).        
  在创建数据快照或启动复制过程之前，您应该在源上记录二进制日志中的当前位置。在配置副本时，您需要此信息，以便副本知道在二进制日志中的哪个位置开始执行事件。参见[第 19.1.2.4 节 “获取复制源二进制日志坐标”。](https://dev.mysql.com/doc/refman/8.4/en/replication-howto-masterstatus.html)
- ​          If you already have data on the source and want to use it to          synchronize the replica, you need to create a data snapshot to          copy the data to the replica. The storage engine you are using          has an impact on how you create the snapshot. When you are          using [`MyISAM`](https://dev.mysql.com/doc/refman/8.4/en/myisam-storage-engine.html), you must stop          processing statements on the source to obtain a read-lock,          then obtain its current binary log coordinates and dump its          data, before permitting the source to continue executing          statements. If you do not stop the execution of statements,          the data dump and the source status information become          mismatched, resulting in inconsistent or corrupted databases          on the replicas. For more information on replicating a          [`MyISAM`](https://dev.mysql.com/doc/refman/8.4/en/myisam-storage-engine.html) source, see          [Section 19.1.2.4, “Obtaining the Replication Source Binary Log Coordinates”](https://dev.mysql.com/doc/refman/8.4/en/replication-howto-masterstatus.html). If you are          using [`InnoDB`](https://dev.mysql.com/doc/refman/8.4/en/innodb-storage-engine.html), you do not need a          read-lock and a transaction that is long enough to transfer          the data snapshot is sufficient. For more information, see          [Section 17.19, “InnoDB and MySQL Replication”](https://dev.mysql.com/doc/refman/8.4/en/innodb-and-mysql-replication.html).        
  如果源上已有数据，并且想要使用它来同步副本，则需要创建数据快照以将数据复制到副本。您使用的存储引擎会影响您创建快照的方式。当您使用 [`MyISAM`](https://dev.mysql.com/doc/refman/8.4/en/myisam-storage-engine.html) 时，必须停止处理源上的语句以获取读锁，然后获取其当前的二进制日志坐标并转储其数据，然后才能允许源继续执行语句。如果不停止语句的执行，数据转储和源状态信息会不匹配，从而导致副本上的数据库不一致或损坏。有关复制 [`MyISAM`](https://dev.mysql.com/doc/refman/8.4/en/myisam-storage-engine.html) 源的更多信息，请参见[第 19.1.2.4 节 “获取复制源二进制对数坐标”。](https://dev.mysql.com/doc/refman/8.4/en/replication-howto-masterstatus.html)如果您使用的是 [`InnoDB`](https://dev.mysql.com/doc/refman/8.4/en/innodb-storage-engine.html)，则不需要读锁，并且足够长的事务足以传输数据快照。有关更多信息，请参见[第 17.19 节 “ InnoDB 和 MySQL 复制”。](https://dev.mysql.com/doc/refman/8.4/en/innodb-and-mysql-replication.html)
- ​          Configure the replica with settings for connecting to the          source, such as the host name, login credentials, and binary          log file name and position. See          [Section 19.1.2.7, “Setting the Source Configuration on the Replica”](https://dev.mysql.com/doc/refman/8.4/en/replication-howto-slaveinit.html).        
  使用连接到源的设置（例如主机名、登录凭证以及二进制日志文件名和位置）配置副本。参见[第 19.1.2.7 节 “在副本上设置 Source Configuration”。](https://dev.mysql.com/doc/refman/8.4/en/replication-howto-slaveinit.html)
- ​          Implement replication-specific security measures on the          sources and replicas as appropriate for your system. See          [Section 19.3, “Replication Security”](https://dev.mysql.com/doc/refman/8.4/en/replication-security.html). 
  根据您的系统，在源和副本上实施特定于复制的安全措施。参见[第 19.3 节 “复制安全性”。](https://dev.mysql.com/doc/refman/8.4/en/replication-security.html)

Note 注意

​        Certain steps within the setup process require the        [`SUPER`](https://dev.mysql.com/doc/refman/8.4/en/privileges-provided.html#priv_super) privilege. If you do not        have this privilege, it might not be possible to enable        replication. 
设置过程中的某些步骤需要 [`SUPER`](https://dev.mysql.com/doc/refman/8.4/en/privileges-provided.html#priv_super) 权限。如果您没有此权限，则可能无法启用复制。

​      After configuring the basic options, select your scenario: 
配置基本选项后，选择您的方案：

- ​          To set up replication for a fresh installation of a source and          replicas that contain no data, see          [Section 19.1.2.6.1, “Setting Up Replication with New Source and Replicas”](https://dev.mysql.com/doc/refman/8.4/en/replication-setup-replicas.html#replication-howto-newservers).        
  要为不包含数据的源和副本的全新安装设置复制，请参见[第 19.1.2.6.1 节 “使用新的源和副本设置复制”。](https://dev.mysql.com/doc/refman/8.4/en/replication-setup-replicas.html#replication-howto-newservers)
- ​          To set up replication of a new source using the data from an          existing MySQL server, see          [Section 19.1.2.6.2, “Setting Up Replication with Existing Data”](https://dev.mysql.com/doc/refman/8.4/en/replication-setup-replicas.html#replication-howto-existingdata).        
  要使用现有 MySQL 服务器中的数据设置新源的复制，请参见[第 19.1.2.6.2 节 “使用现有数据设置复制”。](https://dev.mysql.com/doc/refman/8.4/en/replication-setup-replicas.html#replication-howto-existingdata)
- ​          To add replicas to an existing replication environment, see          [Section 19.1.2.8, “Adding Replicas to a Replication Environment”](https://dev.mysql.com/doc/refman/8.4/en/replication-howto-additionalslaves.html). 
  要将副本添加到现有复制环境，请参见[第 19.1.2.8 节 “将副本添加到复制环境”。](https://dev.mysql.com/doc/refman/8.4/en/replication-howto-additionalslaves.html)

​      Before administering MySQL replication servers, read this entire      chapter and try all statements mentioned in      [Section 15.4.1, “SQL Statements for Controlling Source Servers”](https://dev.mysql.com/doc/refman/8.4/en/replication-statements-source.html), and      [Section 15.4.2, “SQL Statements for Controlling Replica Servers”](https://dev.mysql.com/doc/refman/8.4/en/replication-statements-replica.html). Also familiarize      yourself with the replication startup options described in      [Section 19.1.6, “Replication and Binary Logging Options and Variables”](https://dev.mysql.com/doc/refman/8.4/en/replication-options.html). 
在管理 MySQL 复制服务器之前，请阅读整章并尝试[第 15.4.1 节 “用于控制源服务器的 SQL 语句”](https://dev.mysql.com/doc/refman/8.4/en/replication-statements-source.html)和[第 15.4.2 节 “用于控制副本服务器的 SQL 语句”](https://dev.mysql.com/doc/refman/8.4/en/replication-statements-replica.html)中提到的所有语句。此外，请熟悉[第 19.1.6 节 “复制和二进制日志记录选项和变量”](https://dev.mysql.com/doc/refman/8.4/en/replication-options.html)中描述的复制启动选项。

#### 19.1.2.1 Setting the Replication Source Configuration 19.1.2.1 设置复制源配置

​        To configure a source to use binary log file position based        replication, you must ensure that binary logging is enabled, and        establish a unique server ID.      
要将源配置为使用基于二进制日志文件位置的复制，必须确保启用二进制日志记录，并建立唯一的服务器 ID。

​        Each server within a replication topology must be configured        with a unique server ID, which you can specify using the        [`server_id`](https://dev.mysql.com/doc/refman/8.4/en/replication-options.html#sysvar_server_id) system variable. This        server ID is used to identify individual servers within the        replication topology, and must be a positive integer between 1        and (232)−1. The default        [`server_id`](https://dev.mysql.com/doc/refman/8.4/en/replication-options.html#sysvar_server_id) value is 1; you can        change this at runtime by issuing a statement like this one:      
复制拓扑中的每个服务器都必须配置唯一的服务器 ID，您可以使用 [`server_id`](https://dev.mysql.com/doc/refman/8.4/en/replication-options.html#sysvar_server_id) 系统变量指定该 ID。此服务器 ID 用于标识复制拓扑中的单个服务器，并且必须是介于 1 和 （232）−1 之间的正整数。默认 [`server_id`](https://dev.mysql.com/doc/refman/8.4/en/replication-options.html#sysvar_server_id) 值为 1;您可以在运行时通过发出如下语句来更改此设置：

```sql
SET GLOBAL server_id = 2;
```

​        Organization and selection of the server IDs is arbitrary, as        long as each server ID is different from every other server ID        in use by any other server in the replication topology. Note        that if a value of 0 was set previously for the server ID, you        must restart the server to initialize the source with your new        nonzero server ID. Otherwise, a server restart is not needed        when you change the server ID, unless you make other        configuration changes that require it.      
服务器 ID 的组织和选择是任意的，只要每个服务器 ID 与复制拓扑中任何其他服务器使用的所有其他服务器 ID 不同。请注意，如果之前为服务器 ID  设置了值 0，则必须重新启动服务器以使用新的非零服务器 ID 初始化源。否则，在更改服务器 ID  时不需要重新启动服务器，除非您进行其他需要它的配置更改。

​        Binary logging is required on the source because the binary log        is the basis for replicating changes from the source to its        replicas. Binary logging is enabled by default (the        [`log_bin`](https://dev.mysql.com/doc/refman/8.4/en/replication-options-binary-log.html#sysvar_log_bin) system variable is set        to ON). The [`--log-bin`](https://dev.mysql.com/doc/refman/8.4/en/replication-options-binary-log.html#option_mysqld_log-bin) option        tells the server what base name to use for binary log files. It        is recommended that you specify this option to give the binary        log files a non-default base name, so that if the host name        changes, you can easily continue to use the same binary log file        names (see [Section B.3.7, “Known Issues in MySQL”](https://dev.mysql.com/doc/refman/8.4/en/known-issues.html)). If binary logging        was previously disabled on the source using the        [`--skip-log-bin`](https://dev.mysql.com/doc/refman/8.4/en/replication-options-binary-log.html#option_mysqld_log-bin)        option, you must restart the server without this option to        enable it. 
源上需要二进制日志记录，因为二进制日志是将更改从源复制到其副本的基础。默认情况下，二进制日志记录处于启用状态（[`log_bin`](https://dev.mysql.com/doc/refman/8.4/en/replication-options-binary-log.html#sysvar_log_bin)系统变量设置为 ON）。[`--log-bin`](https://dev.mysql.com/doc/refman/8.4/en/replication-options-binary-log.html#option_mysqld_log-bin) 选项告诉服务器用于二进制日志文件的基本名称。建议您指定此选项，为二进制日志文件提供非默认基本名称，以便在主机名更改时，您可以轻松地继续使用相同的二进制日志文件名（参见[第 B.3.7 节 “MySQL 中的已知问题”）。](https://dev.mysql.com/doc/refman/8.4/en/known-issues.html)如果之前使用 [`--skip-log-bin`](https://dev.mysql.com/doc/refman/8.4/en/replication-options-binary-log.html#option_mysqld_log-bin) 选项在源上禁用了二进制日志记录，则必须在没有此选项的情况下重新启动服务器才能启用它。

Note 注意

​          The following options also have an impact on the source: 
以下选项也会对源产生影响：

- ​              For the greatest possible durability and consistency in a              replication setup using              [`InnoDB`](https://dev.mysql.com/doc/refman/8.4/en/innodb-storage-engine.html) with transactions, you              should use              `innodb_flush_log_at_trx_commit=1` and              `sync_binlog=1` in the source's              `my.cnf` file.            
  为了在使用 [`InnoDB`](https://dev.mysql.com/doc/refman/8.4/en/innodb-storage-engine.html) 与事务的复制设置中获得最大的持久性和一致性，您应该在源的 `my.cnf` 文件中使用 `innodb_flush_log_at_trx_commit=1` and `sync_binlog=1` 。
- ​              Ensure that the              [`skip_networking`](https://dev.mysql.com/doc/refman/8.4/en/server-system-variables.html#sysvar_skip_networking) system              variable is not enabled on the source. If networking has              been disabled, the replica cannot communicate with the              source and replication fails. 
  确保未在源上启用 [`skip_networking`](https://dev.mysql.com/doc/refman/8.4/en/server-system-variables.html#sysvar_skip_networking) 系统变量。如果已禁用联网，则副本无法与源通信，并且复制将失败

#### 19.1.2.2 Setting the Replica Configuration 19.1.2.2 设置副本配置

​        Each replica must have a unique server ID, as specified by the        [`server_id`](https://dev.mysql.com/doc/refman/8.4/en/replication-options.html#sysvar_server_id) system variable. If        you are setting up multiple replicas, each one must have a        unique [`server_id`](https://dev.mysql.com/doc/refman/8.4/en/replication-options.html#sysvar_server_id) value that        differs from that of the source and from any of the other        replicas. If the replica's server ID is not already set, or the        current value conflicts with the value that you have chosen for        the source or another replica, you must change it.      
每个副本必须具有唯一的服务器 ID，由 [`server_id`](https://dev.mysql.com/doc/refman/8.4/en/replication-options.html#sysvar_server_id) 系统变量指定。如果要设置多个副本，则每个副本都必须具有唯一的 [`server_id`](https://dev.mysql.com/doc/refman/8.4/en/replication-options.html#sysvar_server_id)值，该值不同于源和任何其他副本的值。如果副本的服务器 ID 尚未设置，或者当前值与您为源或其他副本选择的值冲突，则必须更改它。

​        The default [`server_id`](https://dev.mysql.com/doc/refman/8.4/en/replication-options.html#sysvar_server_id) value is        1. You can change the [`server_id`](https://dev.mysql.com/doc/refman/8.4/en/replication-options.html#sysvar_server_id)        value dynamically by issuing a statement like this:      
默认 [`server_id`](https://dev.mysql.com/doc/refman/8.4/en/replication-options.html#sysvar_server_id) 值为 1。您可以通过发出如下语句来动态更改 [`server_id`](https://dev.mysql.com/doc/refman/8.4/en/replication-options.html#sysvar_server_id) 值：

```sql
SET GLOBAL server_id = 21;
```

​        Note that a value of 0 for the server ID prevents a replica from        connecting to a source. If that server ID value (which was the        default in earlier releases) was set previously, you must        restart the server to initialize the replica with your new        nonzero server ID. Otherwise, a server restart is not needed        when you change the server ID, unless you make other        configuration changes that require it. For example, if binary        logging was disabled on the server and you want it enabled for        your replica, a server restart is required to enable this.      
请注意，服务器 ID 的值为 0 会阻止副本连接到源。如果之前设置了该服务器 ID 值（在早期版本中为默认值），则必须重新启动服务器以使用新的非零服务器 ID 初始化副本。否则，在更改服务器 ID  时不需要重新启动服务器，除非您进行其他需要它的配置更改。例如，如果在服务器上禁用了二进制日志记录，并且您希望为副本启用二进制日志记录，则需要重新启动服务器才能启用此功能。

​        If you are shutting down the replica server, you can edit the        `[mysqld]` section of the configuration file to        specify a unique server ID. For example:      
如果要关闭副本服务器，则可以编辑配置文件的 `[mysqld]` 部分以指定唯一的服务器 ID。例如：

```ini
[mysqld]
server-id=21
```

​        Binary logging is enabled by default on all servers. A replica        is not required to have binary logging enabled for replication        to take place. However, binary logging on a replica means that        the replica's binary log can be used for data backups and crash        recovery. Replicas that have binary logging enabled can also be        used as part of a more complex replication topology. For        example, you might want to set up replication servers using this        chained arrangement:      
默认情况下，所有服务器上都启用了二进制日志记录。副本不需要启用二进制日志记录即可进行复制。但是，副本上的二进制日志记录意味着副本的二进制日志可用于数据备份和崩溃恢复。启用了二进制日志记录的副本也可以用作更复杂的复制拓扑的一部分。例如，您可能希望使用此链接安排设置复制服务器：

```none
A -> B -> C
```

​        Here, `A` serves as the source for the replica        `B`, and `B` serves as the        source for the replica `C`. For this to work,        `B` must be both a source        *and* a replica. Updates received from        `A` must be logged by `B` to        its binary log, in order to be passed on to        `C`. In addition to binary logging, this        replication topology requires the system variable        [`log_replica_updates`](https://dev.mysql.com/doc/refman/8.4/en/replication-options-binary-log.html#sysvar_log_replica_updates) to be        enabled. With replica updates enabled, the replica writes        updates that are received from a source and performed by the        replica's SQL thread to the replica's own binary log.        `log_replica_updates` is enabled by default.      
此处，`A` 充当副本 `B` 的源，`B` 充当副本 `C` 的源。为此，`B` 必须同时是源*和*副本。从 `A` 接收的更新必须由 `B` 记录到其二进制日志中，以便传递给 `C`。除了二进制日志记录之外，此复制拓扑还需要启用系统变量 [`log_replica_updates`](https://dev.mysql.com/doc/refman/8.4/en/replication-options-binary-log.html#sysvar_log_replica_updates)。启用副本更新后，副本将从源接收并由副本的 SQL 线程执行的更新写入副本自己的二进制日志。`默认情况下，log_replica_updates` 处于启用状态。

​        If you need to disable binary logging or replica update logging        on a replica, you can do this by specifying the        [`--skip-log-bin`](https://dev.mysql.com/doc/refman/8.4/en/replication-options-binary-log.html#option_mysqld_log-bin)        and [`--log-replica-updates=OFF`](https://dev.mysql.com/doc/refman/8.4/en/replication-options-binary-log.html#sysvar_log_replica_updates)        options for the replica. If you decide to re-enable these        features on the replica, remove the relevant options and restart        the server. 
如果需要在副本上禁用二进制日志记录或副本更新日志记录，可以通过为副本指定 [`--skip-log-bin`](https://dev.mysql.com/doc/refman/8.4/en/replication-options-binary-log.html#option_mysqld_log-bin) 和 [`--log-replica-updates=OFF`](https://dev.mysql.com/doc/refman/8.4/en/replication-options-binary-log.html#sysvar_log_replica_updates) 选项来实现。如果您决定在副本上重新启用这些功能，请删除相关选项并重新启动服务器。

#### 19.1.2.3 Creating a User for Replication 19.1.2.3 创建用于复制的用户

​        Each replica connects to the source using a MySQL user name and        password, so there must be a user account on the source that the        replica can use to connect. The user name is specified by the        `SOURCE_USER` option of the        [`CHANGE REPLICATION SOURCE TO`](https://dev.mysql.com/doc/refman/8.4/en/change-replication-source-to.html)        statement when you set up a replica. Any account can be used for        this operation, providing it has been granted the        [`REPLICATION SLAVE`](https://dev.mysql.com/doc/refman/8.4/en/privileges-provided.html#priv_replication-slave) privilege. You        can choose to create a different account for each replica, or        connect to the source using the same account for each replica.      
每个副本都使用 MySQL 用户名和密码连接到源，因此源上必须有一个副本可用于连接的用户帐户。在设置副本时，用户名由 [`CHANGE REPLICATION SOURCE TO`](https://dev.mysql.com/doc/refman/8.4/en/change-replication-source-to.html) 语句的 `SOURCE_USER` 选项指定。任何账户都可以用于此操作，前提是它已被授予 [`REPLICATION SLAVE`](https://dev.mysql.com/doc/refman/8.4/en/privileges-provided.html#priv_replication-slave) 权限。您可以选择为每个副本创建不同的账户，或者为每个副本使用相同的账户连接到源。

​        Although you do not have to create an account specifically for        replication, you should be aware that the replication user name        and password are stored in plain text in the replica's        connection metadata repository        `mysql.slave_master_info` (see        [Section 19.2.4.2, “Replication Metadata Repositories”](https://dev.mysql.com/doc/refman/8.4/en/replica-logs-status.html)). Therefore, you may want        to create a separate account that has privileges only for the        replication process, to minimize the possibility of compromise        to other accounts.      
虽然您不必专门为复制创建帐户，但您应该知道复制用户名和密码以纯文本形式存储在副本的连接元数据存储库`mysql.slave_master_info`中（请参见[第 19.2.4.2 节 “复制元数据存储库”）。](https://dev.mysql.com/doc/refman/8.4/en/replica-logs-status.html)因此，您可能希望创建一个仅具有复制过程权限的单独账户，以最大程度地减少对其他账户的危害。

​        To create a new account, use [`CREATE         USER`](https://dev.mysql.com/doc/refman/8.4/en/create-user.html). To grant this account the privileges required        for replication, use the [`GRANT`](https://dev.mysql.com/doc/refman/8.4/en/grant.html)        statement. If you create an account solely for the purposes of        replication, that account needs only the        [`REPLICATION SLAVE`](https://dev.mysql.com/doc/refman/8.4/en/privileges-provided.html#priv_replication-slave) privilege. For        example, to set up a new user, `repl`, that can        connect for replication from any host within the        `example.com` domain, issue these statements on        the source:      
要创建新账户，请使用 [`CREATE USER`](https://dev.mysql.com/doc/refman/8.4/en/create-user.html)。要授予此账户复制所需的权限，请使用 [`GRANT`](https://dev.mysql.com/doc/refman/8.4/en/grant.html) 语句。如果您创建帐户仅用于复制目的，则该帐户只需要 [`REPLICATION SLAVE`](https://dev.mysql.com/doc/refman/8.4/en/privileges-provided.html#priv_replication-slave) 权限。例如，要设置一个新用户 `repl`，该用户可以连接从 `example.com` 域中的任何主机进行复制，请在源上发出以下语句：

```sql
mysql> CREATE USER 'repl'@'%.example.com' IDENTIFIED BY 'password';
mysql> GRANT REPLICATION SLAVE ON *.* TO 'repl'@'%.example.com';
```

​        See [Section 15.7.1, “Account Management Statements”](https://dev.mysql.com/doc/refman/8.4/en/account-management-statements.html), for more        information on statements for manipulation of user accounts. 
有关操作用户帐户的语句的更多信息，请参见[第 15.7.1 节 “帐户管理声明”。](https://dev.mysql.com/doc/refman/8.4/en/account-management-statements.html)

Important 重要

​          To connect to the source using a user account that          authenticates with the          `caching_sha2_password` plugin, you must          either set up a secure connection as described in          [Section 19.3.1, “Setting Up Replication to Use Encrypted Connections”](https://dev.mysql.com/doc/refman/8.4/en/replication-encrypted-connections.html), or enable          the unencrypted connection to support password exchange using          an RSA key pair. The `caching_sha2_password`          authentication plugin is the default for new users (see          [Section 8.4.1.2, “Caching SHA-2 Pluggable Authentication”](https://dev.mysql.com/doc/refman/8.4/en/caching-sha2-pluggable-authentication.html)). If          the user account that you create or use for replication (as          specified by the `SOURCE_USER` option) uses          this authentication plugin, and you are not using a secure          connection, you must enable RSA key pair-based password          exchange for a successful connection. 
要使用使用 `caching_sha2_password` 插件进行身份验证的用户帐户连接到源，您必须按照[第 19.3.1 节 “设置复制以使用加密连接”](https://dev.mysql.com/doc/refman/8.4/en/replication-encrypted-connections.html)中所述设置安全连接，或者启用未加密连接以支持使用 RSA 密钥对进行口令交换。`caching_sha2_password` 身份验证插件是新用户的默认设置（参见[第 8.4.1.2 节 “缓存 SHA-2 可插拔身份验证”）。](https://dev.mysql.com/doc/refman/8.4/en/caching-sha2-pluggable-authentication.html)如果您创建或用于复制的用户帐户（由 `SOURCE_USER` 选项指定）使用此身份验证插件，并且您未使用安全连接，则必须启用基于 RSA 密钥对的密码交换才能成功连接。

#### 19.1.2.4 Obtaining the Replication Source Binary Log Coordinates 19.1.2.4 获取复制源二进制日志坐标

​        To configure the replica to start the replication process at the        correct point, you need to note the source's current coordinates        within its binary log. 
要将副本配置为在正确的点启动复制过程，您需要在其二进制日志中记下源的当前坐标。

Warning 警告

​          This procedure uses [`FLUSH TABLES WITH           READ LOCK`](https://dev.mysql.com/doc/refman/8.4/en/flush.html#flush-tables-with-read-lock), which blocks          [`COMMIT`](https://dev.mysql.com/doc/refman/8.4/en/commit.html) operations for          [`InnoDB`](https://dev.mysql.com/doc/refman/8.4/en/innodb-storage-engine.html) tables. 
此过程使用 [ `FLUSH TABLES WITH           READ LOCK` ](https://dev.mysql.com/doc/refman/8.4/en/flush.html#flush-tables-with-read-lock)，它阻止 [`InnoDB`](https://dev.mysql.com/doc/refman/8.4/en/innodb-storage-engine.html) 表的 [`COMMIT`](https://dev.mysql.com/doc/refman/8.4/en/commit.html) 操作。

​        If you are planning to shut down the source to create a data        snapshot, you can optionally skip this procedure and instead        store a copy of the binary log index file along with the data        snapshot. In that situation, the source creates a new binary log        file on restart. The source binary log coordinates where the        replica must start the replication process are therefore the        start of that new file, which is the next binary log file on the        source following after the files that are listed in the copied        binary log index file.      
如果您计划关闭源以创建数据快照，则可以选择跳过此过程，而是将二进制日志索引文件的副本与数据快照一起存储。在这种情况下，源会在重新启动时创建新的二进制日志文件。因此，副本必须开始复制过程的源二进制日志坐标是该新文件的开头，该新文件是源上紧随复制的二进制日志索引文件中列出的文件之后的下一个二进制日志文件。

​        To obtain the source binary log coordinates, follow these steps: 
要获取源二进制对数坐标，请执行以下步骤：

1. ​            Start a session on the source by connecting to it with the            command-line client, and flush all tables and block write            statements by executing the [`FLUSH             TABLES WITH READ LOCK`](https://dev.mysql.com/doc/refman/8.4/en/flush.html#flush-tables-with-read-lock) statement:          
   通过使用命令行客户端连接到源来启动源上的会话，然后通过执行以下[ `FLUSH             TABLES WITH READ LOCK` ](https://dev.mysql.com/doc/refman/8.4/en/flush.html#flush-tables-with-read-lock)语句来刷新所有表和块写入语句：

   ```sql
   mysql> FLUSH TABLES WITH READ LOCK;
   ```

   Warning 警告

   ​              Leave the client from which you issued the              [`FLUSH TABLES`](https://dev.mysql.com/doc/refman/8.4/en/flush.html#flush-tables) statement              running so that the read lock remains in effect. If you              exit the client, the lock is released. 
   保持从中发出 [`FLUSH TABLES`](https://dev.mysql.com/doc/refman/8.4/en/flush.html#flush-tables) 语句的客户端运行，以便读锁定保持有效。如果退出客户端，则会释放锁。

2. ​            In a different session on the source, use the            [`SHOW BINARY LOG STATUS`](https://dev.mysql.com/doc/refman/8.4/en/show-binary-log-status.html)            statement to determine the current binary log file name and            position:          
   在源上的其他会话中，使用 [`SHOW BINARY LOG STATUS`](https://dev.mysql.com/doc/refman/8.4/en/show-binary-log-status.html) 语句确定当前的二进制日志文件名和位置：

   ```sql
   mysql> SHOW BINARY LOG STATUS\G
   *************************** 1. row ***************************
                File: mysql-bin.000003
            Position: 73
        Binlog_Do_DB: test
    Binlog_Ignore_DB: manual, mysql
   Executed_Gtid_Set: 3E11FA47-71CA-11E1-9E33-C80AA9429562:1-5
   1 row in set (0.00 sec)
   ```

   ​            The `File` column shows the name of the log            file and the `Position` column shows the            position within the file. In this example, the binary log            file is `mysql-bin.000003` and the position            is 73. Record these values. You need them later when you are            setting up the replica. They represent the replication            coordinates at which the replica should begin processing new            updates from the source.          
   `File` 列显示日志文件的名称`，Position 列`显示文件中的位置。在此示例中，二进制日志文件为 `mysql-bin.000003`，位置为 73。记录这些值。稍后在设置副本时需要用到它们。它们表示副本应开始处理来自源的新更新的复制坐标。

   ​            If the source has been running previously with binary            logging disabled, the log file name and position values            displayed by [`SHOW BINARY LOG             STATUS`](https://dev.mysql.com/doc/refman/8.4/en/show-binary-log-status.html) or [**mysqldump**](https://dev.mysql.com/doc/refman/8.4/en/mysqldump.html)            [`--source-data`](https://dev.mysql.com/doc/refman/8.4/en/mysqldump.html#option_mysqldump_source-data) are empty.            In that case, the values that you need to use later when            specifying the source's binary log file and position            are the empty string (`''`) and            `4`. 
   如果源之前在禁用二进制日志记录的情况下运行，则 or [**mysqldump**](https://dev.mysql.com/doc/refman/8.4/en/mysqldump.html)[`--source-data`](https://dev.mysql.com/doc/refman/8.4/en/mysqldump.html#option_mysqldump_source-data) 显示的[ `SHOW BINARY LOG             STATUS` ](https://dev.mysql.com/doc/refman/8.4/en/show-binary-log-status.html)日志文件名和位置值为空。在这种情况下，稍后在指定源的二进制日志文件和位置时需要使用的值是空字符串 （`''`） 和 `4`。

​        You now have the information you need to enable the replica to        start reading from the source's binary log in the correct        place to start replication.      
现在，您拥有了使副本能够在正确的位置开始从源的二进制日志中读取以开始复制所需的信息。

​        The next step depends on whether you have existing data on the        source. Choose one of the following options: 
下一步取决于您的源上是否有现有数据。选择以下选项之一：

- ​            If you have existing data that needs be to synchronized with            the replica before you start replication, leave the client            running so that the lock remains in place. This prevents any            further changes being made, so that the data copied to the            replica is in synchrony with the source. Proceed to            [Section 19.1.2.5, “Choosing a Method for Data Snapshots”](https://dev.mysql.com/doc/refman/8.4/en/replication-snapshot-method.html).          
  如果您在开始复制之前有需要与副本同步的现有数据，请使客户端保持运行状态，以便锁定保持原位。这可以防止进行任何进一步的更改，以便复制到副本的数据与源同步。请继续执行[第 19.1.2.5 节 “选择数据快照的方法”。](https://dev.mysql.com/doc/refman/8.4/en/replication-snapshot-method.html)
- ​            If you are setting up a new source and replica combination,            you can exit the first session to release the read lock. See            [Section 19.1.2.6.1, “Setting Up Replication with New Source and Replicas”](https://dev.mysql.com/doc/refman/8.4/en/replication-setup-replicas.html#replication-howto-newservers) for how to            proceed. 
  如果要设置新的源和副本组合，则可以退出第一个会话以释放读锁定。有关如何继续操作，请参见[第 19.1.2.6.1 节 “使用新源和副本设置复制”。](https://dev.mysql.com/doc/refman/8.4/en/replication-setup-replicas.html#replication-howto-newservers)

#### 19.1.2.5 Choosing a Method for Data Snapshots 19.1.2.5 选择数据快照方法

​        If the source database contains existing data it is necessary to        copy this data to each replica. There are different ways to dump        the data from the source database. The following sections        describe possible options.      
如果源数据库包含现有数据，则需要将此数据复制到每个副本。有多种方法可以转储源数据库中的数据。以下部分介绍了可能的选项。

​        To select the appropriate method of dumping the database, choose        between these options: 
要选择转储数据库的适当方法，请在以下选项之间进行选择：

- ​            Use the [**mysqldump**](https://dev.mysql.com/doc/refman/8.4/en/mysqldump.html) tool to create a dump            of all the databases you want to replicate. This is the            recommended method, especially when using            [`InnoDB`](https://dev.mysql.com/doc/refman/8.4/en/innodb-storage-engine.html).          
  使用 [**mysqldump**](https://dev.mysql.com/doc/refman/8.4/en/mysqldump.html) 工具创建要复制的所有数据库的转储。这是推荐的方法，尤其是在使用 [`InnoDB`](https://dev.mysql.com/doc/refman/8.4/en/innodb-storage-engine.html) 时。
- ​            If your database is stored in binary portable files, you can            copy the raw data files to a replica. This can be more            efficient than using [**mysqldump**](https://dev.mysql.com/doc/refman/8.4/en/mysqldump.html) and            importing the file on each replica, because it skips the            overhead of updating indexes as the            `INSERT` statements are replayed. With            storage engines such as [`InnoDB`](https://dev.mysql.com/doc/refman/8.4/en/innodb-storage-engine.html)            this is not recommended.          
  如果数据库存储在二进制可移植文件中，则可以将原始数据文件复制到副本。这可能比使用 [**mysqldump**](https://dev.mysql.com/doc/refman/8.4/en/mysqldump.html) 并在每个副本上导入文件更有效，因为它在重放 `INSERT` 语句时跳过了更新索引的开销。对于存储引擎（如 [`InnoDB`](https://dev.mysql.com/doc/refman/8.4/en/innodb-storage-engine.html)），不建议这样做。
- ​            Use MySQL Server's clone plugin to transfer all the data            from an existing replica to a clone. For instructions to use            this method, see [Section 7.6.7.7, “Cloning for Replication”](https://dev.mysql.com/doc/refman/8.4/en/clone-plugin-replication.html). 
  使用 MySQL Server 的克隆插件将所有数据从现有副本传输到克隆。有关使用此方法的说明，请参见[第 7.6.7.7 节 “克隆以进行复制”。](https://dev.mysql.com/doc/refman/8.4/en/clone-plugin-replication.html)

Tip 提示

​          To deploy multiple instances of MySQL, you can use [InnoDB Cluster](https://dev.mysql.com/doc/mysql-shell/8.4/en/mysql-innodb-cluster.html) which enables you to easily administer a group of MySQL server instances in [MySQL Shell](https://dev.mysql.com/doc/mysql-shell/8.4/en/). InnoDB Cluster wraps MySQL Group Replication in a programmatic  environment that enables you easily deploy a cluster of MySQL instances  to achieve high availability. In addition, InnoDB Cluster interfaces  seamlessly with [MySQL Router](https://dev.mysql.com/doc/mysql-router/8.4/en/), which enables your applications to connect to the cluster without  writing your own failover process. For similar use cases that do not  require high availability, however, you can use [InnoDB ReplicaSet](https://dev.mysql.com/doc/mysql-shell/8.4/en/mysql-innodb-replicaset.html). Installation instructions for MySQL Shell can be found [here](https://dev.mysql.com/doc/mysql-shell/8.4/en/mysql-shell-install.html). 
要部署多个 MySQL 实例，您可以使用 [InnoDB Cluster](https://dev.mysql.com/doc/mysql-shell/8.4/en/mysql-innodb-cluster.html)，它使您能够在 [MySQL Shell](https://dev.mysql.com/doc/mysql-shell/8.4/en/) 中轻松管理一组 MySQL 服务器实例。InnoDB Cluster 将 MySQL 组复制包装在编程环境中，使您能够轻松部署 MySQL 实例集群以实现高可用性。此外，InnoDB Cluster 与 [MySQL Router](https://dev.mysql.com/doc/mysql-router/8.4/en/) 无缝连接，这使您的应用程序无需编写自己的故障转移过程即可连接到集群。但是，对于不需要高可用性的类似使用案例，您可以使用 [InnoDB ReplicaSet](https://dev.mysql.com/doc/mysql-shell/8.4/en/mysql-innodb-replicaset.html)。[可在此处](https://dev.mysql.com/doc/mysql-shell/8.4/en/mysql-shell-install.html)找到 MySQL Shell 的安装说明。

##### 19.1.2.5.1 Creating a Data Snapshot Using mysqldump 19.1.2.5.1 使用 mysqldump 创建数据快照

​          To create a snapshot of the data in an existing source          database, use the [**mysqldump**](https://dev.mysql.com/doc/refman/8.4/en/mysqldump.html) tool. Once the          data dump has been completed, import this data into the          replica before starting the replication process.        
要在现有源数据库中创建数据的快照，请使用 [**mysqldump**](https://dev.mysql.com/doc/refman/8.4/en/mysqldump.html) 工具。数据转储完成后，在开始复制过程之前将此数据导入到副本中。

​          The following example dumps all databases to a file named          `dbdump.db`, and includes the          [`--source-data`](https://dev.mysql.com/doc/refman/8.4/en/mysqldump.html#option_mysqldump_source-data) option which          automatically appends the [`CHANGE           REPLICATION SOURCE TO`](https://dev.mysql.com/doc/refman/8.4/en/change-replication-source-to.html) statement required on the          replica to start the replication process:        
以下示例将所有数据库转储到名为 `dbdump.db` 的文件中，并包含 [`--source-data`](https://dev.mysql.com/doc/refman/8.4/en/mysqldump.html#option_mysqldump_source-data) 选项，该选项会自动在副本上附加启动复制过程所需的[ `CHANGE           REPLICATION SOURCE TO` ](https://dev.mysql.com/doc/refman/8.4/en/change-replication-source-to.html)语句：

```terminal
$> mysqldump --all-databases --source-data > dbdump.db
```

Note 注意

​            If you do not use            [`--source-data`](https://dev.mysql.com/doc/refman/8.4/en/mysqldump.html#option_mysqldump_source-data), then it is            necessary to lock all tables in a separate session manually.            See [Section 19.1.2.4, “Obtaining the Replication Source Binary Log Coordinates”](https://dev.mysql.com/doc/refman/8.4/en/replication-howto-masterstatus.html). 
如果您不使用 [`--source-data`](https://dev.mysql.com/doc/refman/8.4/en/mysqldump.html#option_mysqldump_source-data)，则必须手动锁定单独会话中的所有表。参见[第 19.1.2.4 节 “获取复制源二进制日志坐标”。](https://dev.mysql.com/doc/refman/8.4/en/replication-howto-masterstatus.html)

​          It is possible to exclude certain databases from the dump          using the [**mysqldump**](https://dev.mysql.com/doc/refman/8.4/en/mysqldump.html) tool. If you want to          choose which databases to include in the dump, do not use          [`--all-databases`](https://dev.mysql.com/doc/refman/8.4/en/mysqldump.html#option_mysqldump_all-databases). Choose one          of these options: 
可以使用 [**mysqldump**](https://dev.mysql.com/doc/refman/8.4/en/mysqldump.html) 工具从转储中排除某些数据库。如果要选择要包含在转储中的数据库，请不要使用 [`--all-databases`](https://dev.mysql.com/doc/refman/8.4/en/mysqldump.html#option_mysqldump_all-databases)。选择以下选项之一：

- ​              Exclude all the tables in the database using              [`--ignore-table`](https://dev.mysql.com/doc/refman/8.4/en/mysqldump.html#option_mysqldump_ignore-table) option.                           
  使用 [`--ignore-table`](https://dev.mysql.com/doc/refman/8.4/en/mysqldump.html#option_mysqldump_ignore-table) 选项排除数据库中的所有表。
- ​              Name only those databases which you want dumped using the              [`--databases`](https://dev.mysql.com/doc/refman/8.4/en/mysqldump.html#option_mysqldump_databases) option. 
  使用 [`--databases`](https://dev.mysql.com/doc/refman/8.4/en/mysqldump.html#option_mysqldump_databases) 选项仅命名要转储的那些数据库。

Note 注意

​            By default, if GTIDs are in use on the source            ([`gtid_mode=ON`](https://dev.mysql.com/doc/refman/8.4/en/replication-options-gtids.html#sysvar_gtid_mode)),            [**mysqldump**](https://dev.mysql.com/doc/refman/8.4/en/mysqldump.html) includes the GTIDs from the            [`gtid_executed`](https://dev.mysql.com/doc/refman/8.4/en/replication-options-gtids.html#sysvar_gtid_executed) set on the            source in the dump output to add them to the            [`gtid_purged`](https://dev.mysql.com/doc/refman/8.4/en/replication-options-gtids.html#sysvar_gtid_purged) set on the            replica. If you are dumping only specific databases or            tables, it is important to note that the value that is            included by [**mysqldump**](https://dev.mysql.com/doc/refman/8.4/en/mysqldump.html) includes the GTIDs            of all transactions in the            [`gtid_executed`](https://dev.mysql.com/doc/refman/8.4/en/replication-options-gtids.html#sysvar_gtid_executed) set on the            source, even those that changed suppressed parts of the            database, or other databases on the server that were not            included in the partial dump. Check the description for            mysqldump's `--set-gtid-purged` option to            find the outcome of the default behavior for the MySQL            Server versions you are using, and how to change the            behavior if this outcome is not suitable for your situation. 
默认情况下，如果在源 （[`gtid_mode=ON）`](https://dev.mysql.com/doc/refman/8.4/en/replication-options-gtids.html#sysvar_gtid_mode) 上使用 GTID，[**则 mysqldump**](https://dev.mysql.com/doc/refman/8.4/en/mysqldump.html) 会在转储输出中包含源上设置的[`gtid_executed`](https://dev.mysql.com/doc/refman/8.4/en/replication-options-gtids.html#sysvar_gtid_executed)中的 GTID，以将它们添加到副本上设置的 [`gtid_purged`](https://dev.mysql.com/doc/refman/8.4/en/replication-options-gtids.html#sysvar_gtid_purged) 中。如果仅转储特定数据库或表，请务必注意 [**mysqldump**](https://dev.mysql.com/doc/refman/8.4/en/mysqldump.html) 包含的值包括源上[`gtid_executed`](https://dev.mysql.com/doc/refman/8.4/en/replication-options-gtids.html#sysvar_gtid_executed)集中的所有事务的 GTID，甚至是那些更改了数据库的隐藏部分的事务，或服务器上未包含在部分转储中的其他数据库。检查 mysqldump 的 `--set-gtid-purged` 选项的描述，以查找您正在使用的 MySQL Server 版本的默认行为的结果，以及如果此结果不适合您的情况，如何更改行为。

​          For more information, see [Section 6.5.4, “mysqldump — A Database Backup Program”](https://dev.mysql.com/doc/refman/8.4/en/mysqldump.html).        
有关详细信息，请参阅[第 6.5.4 节 “mysqldump — 数据库备份程序”。](https://dev.mysql.com/doc/refman/8.4/en/mysqldump.html)

​          To import the data, either copy the dump file to the replica,          or access the file from the source when connecting remotely to          the replica. 
要导入数据，请将转储文件复制到副本，或者在远程连接到副本时从源访问该文件。

##### 19.1.2.5.2 Creating a Data Snapshot Using Raw Data Files 19.1.2.5.2 使用原始数据文件创建数据快照

​          This section describes how to create a data snapshot using the          raw files which make up the database.                      Employing this method with a table using a storage engine that          has complex caching or logging algorithms requires extra steps          to produce a perfect “point in time” snapshot:          the initial copy command could leave out cache information and          logging updates, even if you have acquired a global read lock.          How the storage engine responds to this depends on its crash          recovery abilities.        
本节介绍如何使用构成数据库的原始文件创建数据快照。将此方法与使用具有复杂缓存或日志记录算法的存储引擎的 table 一起使用需要额外的步骤来生成完美的“时间点”快照：即使您已获得全局读取锁，初始 copy 命令也可能会遗漏缓存信息和日志记录更新。存储引擎如何响应此情况取决于其崩溃恢复能力。

​          If you use [`InnoDB`](https://dev.mysql.com/doc/refman/8.4/en/innodb-storage-engine.html) tables, you can          use the **mysqlbackup** command from the MySQL Enterprise Backup          component to produce a consistent snapshot. This command          records the log name and offset corresponding to the snapshot          to be used on the replica. MySQL Enterprise Backup is a commercial product that          is included as part of a MySQL Enterprise subscription. See          [Section 32.1, “MySQL Enterprise Backup Overview”](https://dev.mysql.com/doc/refman/8.4/en/mysql-enterprise-backup.html) for detailed          information.        
如果您使用 [`InnoDB`](https://dev.mysql.com/doc/refman/8.4/en/innodb-storage-engine.html) 表，则可以使用 MySQL Enterprise Backup 组件中的 **mysqlbackup** 命令生成一致的快照。该命令记录副本上使用的快照对应的日志名称和偏移量。MySQL Enterprise Backup 是包含在 MySQL Enterprise 订阅中的商业产品。有关详细信息，请参见[第 32.1 节 “ MySQL Enterprise Backup 概述”。](https://dev.mysql.com/doc/refman/8.4/en/mysql-enterprise-backup.html)

​                     This method also does not work reliably if the source and          replica have different values for          [`ft_stopword_file`](https://dev.mysql.com/doc/refman/8.4/en/server-system-variables.html#sysvar_ft_stopword_file),          [`ft_min_word_len`](https://dev.mysql.com/doc/refman/8.4/en/server-system-variables.html#sysvar_ft_min_word_len), or          [`ft_max_word_len`](https://dev.mysql.com/doc/refman/8.4/en/server-system-variables.html#sysvar_ft_max_word_len) and you are          copying tables having full-text indexes.        
如果源和副本具有不同的 [`ft_stopword_file`](https://dev.mysql.com/doc/refman/8.4/en/server-system-variables.html#sysvar_ft_stopword_file)、[`ft_min_word_len`](https://dev.mysql.com/doc/refman/8.4/en/server-system-variables.html#sysvar_ft_min_word_len) 或 [`ft_max_word_len`](https://dev.mysql.com/doc/refman/8.4/en/server-system-variables.html#sysvar_ft_max_word_len) 值，并且您正在复制具有全文索引的表，则此方法也无法可靠地工作。

​          Assuming the above exceptions do not apply to your database,          use the [cold backup](https://dev.mysql.com/doc/refman/8.4/en/glossary.html#glos_cold_backup)          technique to obtain a reliable binary snapshot of          `InnoDB` tables: do a          [slow shutdown](https://dev.mysql.com/doc/refman/8.4/en/glossary.html#glos_slow_shutdown) of the          MySQL Server, then copy the data files manually.        
假设上述例外情况不适用于您的数据库，请使用[冷备份](https://dev.mysql.com/doc/refman/8.4/en/glossary.html#glos_cold_backup)技术获取 `InnoDB` 表的可靠二进制快照：[缓慢关闭](https://dev.mysql.com/doc/refman/8.4/en/glossary.html#glos_slow_shutdown) MySQL 服务器，然后手动复制数据文件。

​          To create a raw data snapshot of          [`MyISAM`](https://dev.mysql.com/doc/refman/8.4/en/myisam-storage-engine.html) tables when your MySQL          data files exist on a single file system, you can use standard          file copy tools such as **cp** or          **copy**, a remote copy tool such as          **scp** or **rsync**, an          archiving tool such as **zip** or          **tar**, or a file system snapshot tool such as          **dump**. If you are replicating only certain          databases, copy only those files that relate to those tables.          For `InnoDB`, all tables in all databases are          stored in the [system           tablespace](https://dev.mysql.com/doc/refman/8.4/en/glossary.html#glos_system_tablespace) files, unless you have the          [`innodb_file_per_table`](https://dev.mysql.com/doc/refman/8.4/en/innodb-parameters.html#sysvar_innodb_file_per_table) option          enabled.        
当您的 MySQL 数据文件存在于单个文件系统上时，要创建 [`MyISAM`](https://dev.mysql.com/doc/refman/8.4/en/myisam-storage-engine.html) 表的原始数据快照，您可以使用标准文件复制工具（如 **cp** 或 **copy**）、远程复制工具（如 **scp** 或 **rsync**）、存档工具（如 **zip** 或 **tar**）或文件系统快照工具（如 **dump**）.如果仅复制某些数据库，请仅复制与这些表相关的文件。对于 `InnoDB`，所有数据库中的所有表都存储在[系统表空间](https://dev.mysql.com/doc/refman/8.4/en/glossary.html#glos_system_tablespace)文件中，除非您启用了 [`innodb_file_per_table`](https://dev.mysql.com/doc/refman/8.4/en/innodb-parameters.html#sysvar_innodb_file_per_table) 选项。

​          The following files are not required for replication: 
复制不需要以下文件：

- ​              Files relating to the `mysql` database.            
  与 `mysql` 数据库相关的文件。
- ​              The replica's connection metadata repository file              `master.info`, if used; the use of this              file is now deprecated (see              [Section 19.2.4, “Relay Log and Replication Metadata Repositories”](https://dev.mysql.com/doc/refman/8.4/en/replica-logs.html)).            
  副本的连接元数据存储库文件 `master.info`（如果使用）;现在不推荐使用此文件（参见[第 19.2.4 节 “中继日志和复制元数据存储库”）。](https://dev.mysql.com/doc/refman/8.4/en/replica-logs.html)
- ​              The source's binary log files, with the exception of the              binary log index file if you are going to use this to              locate the source binary log coordinates for the replica.            
  源的二进制日志文件，但二进制日志索引文件除外，如果您要使用它来查找副本的源二进制日志坐标。
- ​              Any relay log files. 任何中继日志文件。

​          Depending on whether you are using `InnoDB`          tables or not, choose one of the following:        
根据您是否使用 `InnoDB` 表，选择以下选项之一：

​          If you are using [`InnoDB`](https://dev.mysql.com/doc/refman/8.4/en/innodb-storage-engine.html) tables,          and also to get the most consistent results with a raw data          snapshot, shut down the source server during the process, as          follows: 
如果您使用的是 [`InnoDB`](https://dev.mysql.com/doc/refman/8.4/en/innodb-storage-engine.html) 表，并且为了通过原始数据快照获得最一致的结果，请在此过程中关闭源服务器，如下所示：

1. ​              Acquire a read lock and get the source's status. See              [Section 19.1.2.4, “Obtaining the Replication Source Binary Log Coordinates”](https://dev.mysql.com/doc/refman/8.4/en/replication-howto-masterstatus.html).            
   获取读锁并获取源的状态。参见[第 19.1.2.4 节 “获取复制源二进制日志坐标”。](https://dev.mysql.com/doc/refman/8.4/en/replication-howto-masterstatus.html)

2. ​              In a separate session, shut down the source server:            
   在单独的会话中，关闭源服务器：

   ```terminal
   $> mysqladmin shutdown
   ```

3. ​              Make a copy of the MySQL data files. The following              examples show common ways to do this. You need to choose              only one of them:            
   创建 MySQL 数据文件的副本。以下示例显示了执行此操作的常见方法。您只需选择其中之一：

   ```terminal
   $> tar cf /tmp/db.tar ./data
   $> zip -r /tmp/db.zip ./data
   $> rsync --recursive ./data /tmp/dbdata
   ```

4. ​              Restart the source server. 
   重启源服务器。

​          If you are not using [`InnoDB`](https://dev.mysql.com/doc/refman/8.4/en/innodb-storage-engine.html)          tables, you can get a snapshot of the system from a source          without shutting down the server as described in the following          steps: 
如果您不使用 [`InnoDB`](https://dev.mysql.com/doc/refman/8.4/en/innodb-storage-engine.html) 表，则可以从源获取系统的快照，而无需关闭服务器，如以下步骤所述：

1. ​              Acquire a read lock and get the source's status. See              [Section 19.1.2.4, “Obtaining the Replication Source Binary Log Coordinates”](https://dev.mysql.com/doc/refman/8.4/en/replication-howto-masterstatus.html).            
   获取读锁并获取源的状态。参见[第 19.1.2.4 节 “获取复制源二进制日志坐标”。](https://dev.mysql.com/doc/refman/8.4/en/replication-howto-masterstatus.html)

2. ​              Make a copy of the MySQL data files. The following              examples show common ways to do this. You need to choose              only one of them:            
   创建 MySQL 数据文件的副本。以下示例显示了执行此操作的常见方法。您只需选择其中之一：

   ```terminal
   $> tar cf /tmp/db.tar ./data
   $> zip -r /tmp/db.zip ./data
   $> rsync --recursive ./data /tmp/dbdata
   ```

3. ​              In the client where you acquired the read lock, release              the lock:            
   在获取读锁的客户端中，释放锁：

   ```sql
   mysql> UNLOCK TABLES;
   ```

​          Once you have created the archive or copy of the database,          copy the files to each replica before starting the replication          process. 
创建数据库的存档或副本后，请先将文件复制到每个副本，然后再开始复制过程。

#### 19.1.2.6 Setting Up Replicas 19.1.2.6 设置副本

​        The following sections describe how to set up replicas. Before        you proceed, ensure that you have: 
以下部分介绍如何设置副本。在继续之前，请确保您已：

- ​            Configured the source with the necessary configuration            properties. See            [Section 19.1.2.1, “Setting the Replication Source Configuration”](https://dev.mysql.com/doc/refman/8.4/en/replication-howto-masterbaseconfig.html).          
  使用必要的配置属性配置源。参见[第 19.1.2.1 节 “设置复制源配置”。](https://dev.mysql.com/doc/refman/8.4/en/replication-howto-masterbaseconfig.html)

- ​            Obtained the source status information, or a copy of the            source's binary log index file made during a shutdown for            the data snapshot. See            [Section 19.1.2.4, “Obtaining the Replication Source Binary Log Coordinates”](https://dev.mysql.com/doc/refman/8.4/en/replication-howto-masterstatus.html).          
  获取源状态信息，或在数据快照关闭期间创建的源的二进制日志索引文件的副本。参见[第 19.1.2.4 节 “获取复制源二进制日志坐标”。](https://dev.mysql.com/doc/refman/8.4/en/replication-howto-masterstatus.html)

- ​            On the source, released the read lock:          
  在源上，释放了读取锁：

  ```sql
  mysql> UNLOCK TABLES;
  ```

- ​            On the replica, edited the MySQL configuration. See            [Section 19.1.2.2, “Setting the Replica Configuration”](https://dev.mysql.com/doc/refman/8.4/en/replication-howto-slavebaseconfig.html). 
  在副本上，编辑了 MySQL 配置。参见[第 19.1.2.2 节 “设置副本配置”。](https://dev.mysql.com/doc/refman/8.4/en/replication-howto-slavebaseconfig.html)

​        The next steps depend on whether you have existing data to        import to the replica or not. See        [Section 19.1.2.5, “Choosing a Method for Data Snapshots”](https://dev.mysql.com/doc/refman/8.4/en/replication-snapshot-method.html) for more        information. Choose one of the following: 
后续步骤取决于您是否有要导入到副本的现有数据。有关更多信息，请参见[第 19.1.2.5 节 “选择数据快照的方法”。](https://dev.mysql.com/doc/refman/8.4/en/replication-snapshot-method.html)选择以下选项之一：

- ​            If you do not have a snapshot of a database to import, see            [Section 19.1.2.6.1, “Setting Up Replication with New Source and Replicas”](https://dev.mysql.com/doc/refman/8.4/en/replication-setup-replicas.html#replication-howto-newservers).          
  如果您没有要导入的数据库快照，请参见[第 19.1.2.6.1 节 “使用新的源和副本设置复制”。](https://dev.mysql.com/doc/refman/8.4/en/replication-setup-replicas.html#replication-howto-newservers)
- ​            If you have a snapshot of a database to import, see            [Section 19.1.2.6.2, “Setting Up Replication with Existing Data”](https://dev.mysql.com/doc/refman/8.4/en/replication-setup-replicas.html#replication-howto-existingdata). 
  如果您有要导入的数据库快照，请参见[第 19.1.2.6.2 节 “使用现有数据设置复制”。](https://dev.mysql.com/doc/refman/8.4/en/replication-setup-replicas.html#replication-howto-existingdata)

##### 19.1.2.6.1 Setting Up Replication with New Source and Replicas 19.1.2.6.1 使用新的源和副本设置复制

​          When there is no snapshot of a previous database to import,          configure the replica to start replication from the new          source.        
当没有要导入的先前数据库的快照时，请将副本配置为从新源开始复制。

​          To set up replication between a source and a new replica: 
要在源副本和新副本之间设置复制，请执行以下操作：

1. ​              Start up the replica.             启动副本。
2. ​              Execute a [`CHANGE REPLICATION SOURCE               TO`](https://dev.mysql.com/doc/refman/8.4/en/change-replication-source-to.html) statement on the replica to set the source              configuration. See              [Section 19.1.2.7, “Setting the Source Configuration on the Replica”](https://dev.mysql.com/doc/refman/8.4/en/replication-howto-slaveinit.html). 
   在副本上执行[ `CHANGE REPLICATION SOURCE               TO` ](https://dev.mysql.com/doc/refman/8.4/en/change-replication-source-to.html)语句以设置源配置。参见[第 19.1.2.7 节 “在副本上设置 Source Configuration”。](https://dev.mysql.com/doc/refman/8.4/en/replication-howto-slaveinit.html)

​          Perform these replica setup steps on each replica.        
在每个副本上执行这些副本设置步骤。

​          This method can also be used if you are setting up new servers          but have an existing dump of the databases from a different          server that you want to load into your replication          configuration. By loading the data into a new source, the data          is automatically replicated to the replicas.        
如果要设置新服务器，但具有要从其他服务器加载到复制配置中的其他数据库的现有转储，也可以使用此方法。通过将数据加载到新源中，数据会自动复制到副本。

​          If you are setting up a new replication environment using the          data from a different existing database server to create a new          source, run the dump file generated from that server on the          new source. The database updates are automatically propagated          to the replicas:        
如果要使用其他现有数据库服务器中的数据设置新的复制环境以创建新源，请在新源上运行从该服务器生成的转储文件。数据库更新会自动传播到副本：

```terminal
$> mysql -h source < fulldb.dump
```

##### 19.1.2.6.2 Setting Up Replication with Existing Data 19.1.2.6.2 使用现有数据设置复制

​          When setting up replication with existing data, transfer the          snapshot from the source to the replica before starting          replication. The process for importing data to the replica          depends on how you created the snapshot of data on the source. 
使用现有数据设置复制时，请先将快照从源传输到副本，然后再开始复制。将数据导入副本的过程取决于您在源上创建数据快照的方式。

Tip 提示

​            To deploy multiple instances of MySQL, you can use [InnoDB Cluster](https://dev.mysql.com/doc/mysql-shell/8.4/en/mysql-innodb-cluster.html) which enables you to easily administer a group of MySQL server instances in [MySQL Shell](https://dev.mysql.com/doc/mysql-shell/8.4/en/). InnoDB Cluster wraps MySQL Group Replication in a programmatic  environment that enables you easily deploy a cluster of MySQL instances  to achieve high availability. In addition, InnoDB Cluster interfaces  seamlessly with [MySQL Router](https://dev.mysql.com/doc/mysql-router/8.4/en/), which enables your applications to connect to the cluster without  writing your own failover process. For similar use cases that do not  require high availability, however, you can use [InnoDB ReplicaSet](https://dev.mysql.com/doc/mysql-shell/8.4/en/mysql-innodb-replicaset.html). Installation instructions for MySQL Shell can be found [here](https://dev.mysql.com/doc/mysql-shell/8.4/en/mysql-shell-install.html). 
要部署多个 MySQL 实例，您可以使用 [InnoDB Cluster](https://dev.mysql.com/doc/mysql-shell/8.4/en/mysql-innodb-cluster.html)，它使您能够在 [MySQL Shell](https://dev.mysql.com/doc/mysql-shell/8.4/en/) 中轻松管理一组 MySQL 服务器实例。InnoDB Cluster 将 MySQL 组复制包装在编程环境中，使您能够轻松部署 MySQL 实例集群以实现高可用性。此外，InnoDB Cluster 与 [MySQL Router](https://dev.mysql.com/doc/mysql-router/8.4/en/) 无缝连接，这使您的应用程序无需编写自己的故障转移过程即可连接到集群。但是，对于不需要高可用性的类似使用案例，您可以使用 [InnoDB ReplicaSet](https://dev.mysql.com/doc/mysql-shell/8.4/en/mysql-innodb-replicaset.html)。[可在此处](https://dev.mysql.com/doc/mysql-shell/8.4/en/mysql-shell-install.html)找到 MySQL Shell 的安装说明。

Note 注意

​            If the replication source server or existing replica that            you are copying to create the new replica has any scheduled            events, ensure that these are disabled on the new replica            before you start it. If an event runs on the new replica            that has already run on the source, the duplicated operation            causes an error. The Event Scheduler is controlled by the            [`event_scheduler`](https://dev.mysql.com/doc/refman/8.4/en/server-system-variables.html#sysvar_event_scheduler) system            variable (default `ON`), so events that are            active on the original server run by default when the new            replica starts up. To stop all events from running on the            new replica, set the            [`event_scheduler`](https://dev.mysql.com/doc/refman/8.4/en/server-system-variables.html#sysvar_event_scheduler) system            variable to `OFF` or            `DISABLED` on the new replica.            Alternatively, you can use the [`ALTER             EVENT`](https://dev.mysql.com/doc/refman/8.4/en/alter-event.html) statement to set individual events to            `DISABLE` or `DISABLE ON            REPLICA` to prevent them from running on the new            replica. You can list the events on a server using the            [`SHOW`](https://dev.mysql.com/doc/refman/8.4/en/show.html) statement or the            Information Schema [`EVENTS`](https://dev.mysql.com/doc/refman/8.4/en/information-schema-events-table.html)            table. For more information, see            [Section 19.5.1.16, “Replication of Invoked Features”](https://dev.mysql.com/doc/refman/8.4/en/replication-features-invoked.html). 
如果要复制以创建新副本的复制源服务器或现有副本具有任何计划事件，请确保在启动新副本之前在新副本上禁用这些事件。如果事件在已在源上运行的新副本上运行，则复制的操作将导致错误。Event Scheduler 由 [`event_scheduler`](https://dev.mysql.com/doc/refman/8.4/en/server-system-variables.html#sysvar_event_scheduler) 系统变量（默认`为 ON）`控制，因此当新副本启动时，默认情况下会运行原始服务器上处于活动状态的事件。要停止所有事件在新副本上运行，请在新副本上将 [`event_scheduler`](https://dev.mysql.com/doc/refman/8.4/en/server-system-variables.html#sysvar_event_scheduler) 系统变量设置为 `OFF` 或 `DISABLED`。或者，您可以使用 [`ALTER EVENT`](https://dev.mysql.com/doc/refman/8.4/en/alter-event.html) 语句将单个事件设置为 `DISABLE` 或 `DISABLE ON            REPLICA` 阻止它们在新副本上运行。您可以使用 [`SHOW`](https://dev.mysql.com/doc/refman/8.4/en/show.html) 语句或 Information Schema [`EVENTS`](https://dev.mysql.com/doc/refman/8.4/en/information-schema-events-table.html) 表列出服务器上的事件。有关更多信息，请参见[第 19.5.1.16 节 “调用的功能的复制”。](https://dev.mysql.com/doc/refman/8.4/en/replication-features-invoked.html)

​          As an alternative to creating a new replica in this way, MySQL          Server's clone plugin can be used to transfer all the data and          replication settings from an existing replica to a clone. For          instructions to use this method, see          [Section 7.6.7.7, “Cloning for Replication”](https://dev.mysql.com/doc/refman/8.4/en/clone-plugin-replication.html).        
作为以这种方式创建新副本的替代方法，MySQL Server 的克隆插件可用于将所有数据和复制设置从现有副本传输到克隆。有关使用此方法的说明，请参见[第 7.6.7.7 节 “克隆以进行复制”。](https://dev.mysql.com/doc/refman/8.4/en/clone-plugin-replication.html)

​          Follow this procedure to set up replication with existing          data: 
按照以下过程设置使用现有数据的复制：

1. ​              If you used MySQL Server's clone plugin to create a clone              from an existing replica (see              [Section 7.6.7.7, “Cloning for Replication”](https://dev.mysql.com/doc/refman/8.4/en/clone-plugin-replication.html)), the data is              already transferred. Otherwise, import the data to the              replica using one of the following methods. 
   如果您使用 MySQL Server 的克隆插件从现有副本创建克隆（请参阅[第 7.6.7.7 节 “克隆以进行复制”](https://dev.mysql.com/doc/refman/8.4/en/clone-plugin-replication.html)），则数据已经传输。否则，请使用以下方法之一将数据导入到副本中。

   1. ​                  If you used [**mysqldump**](https://dev.mysql.com/doc/refman/8.4/en/mysqldump.html), start the                  replica server, ensuring that replication does not                  start by starting the server with                  [`--skip-replica-start`](https://dev.mysql.com/doc/refman/8.4/en/replication-options-replica.html#option_mysqld_skip-replica-start).                  Then import the dump file:                
      如果您使用了 [**mysqldump**](https://dev.mysql.com/doc/refman/8.4/en/mysqldump.html)，请启动副本服务器，确保复制不会通过使用 [`--skip-replica-start`](https://dev.mysql.com/doc/refman/8.4/en/replication-options-replica.html#option_mysqld_skip-replica-start) 启动服务器来启动。然后导入转储文件：

      ```terminal
      $> mysql < fulldb.dump
      ```

   2. ​                  If you created a snapshot using the raw data files,                  extract the data files into your replica's data                  directory. For example:                
      如果您使用原始数据文件创建了快照，请将数据文件提取到副本的数据目录中。例如：

      ```terminal
      $> tar xvf dbdump.tar
      ```

      ​                  You may need to set permissions and ownership on the                  files so that the replica server can access and modify                  them. Then start the replica server, ensuring that                  replication does not start by using                  [`--skip-replica-start`](https://dev.mysql.com/doc/refman/8.4/en/replication-options-replica.html#option_mysqld_skip-replica-start). 
      您可能需要设置文件的权限和所有权，以便副本服务器可以访问和修改它们。然后启动副本服务器，确保复制不会使用 [`--skip-replica-start`](https://dev.mysql.com/doc/refman/8.4/en/replication-options-replica.html#option_mysqld_skip-replica-start) 启动。

2. ​              Configure the replica with the replication coordinates              from the source. This tells the replica the binary log              file and position within the file where replication needs              to start. Also, configure the replica with the login              credentials and host name of the source. For more              information on the [`CHANGE REPLICATION               SOURCE TO`](https://dev.mysql.com/doc/refman/8.4/en/change-replication-source-to.html) statement required, see              [Section 19.1.2.7, “Setting the Source Configuration on the Replica”](https://dev.mysql.com/doc/refman/8.4/en/replication-howto-slaveinit.html).            
   使用源中的复制坐标配置副本。这会告诉副本二进制日志文件和文件中需要开始复制的位置。此外，使用源的登录凭证和主机名配置副本。有关 required [ `CHANGE REPLICATION               SOURCE TO` ](https://dev.mysql.com/doc/refman/8.4/en/change-replication-source-to.html) 语句的更多信息，请参见[第 19.1.2.7 节 “在副本上设置源配置”。](https://dev.mysql.com/doc/refman/8.4/en/replication-howto-slaveinit.html)

3. ​              Start the replication threads by issuing a              [`START REPLICA`](https://dev.mysql.com/doc/refman/8.4/en/start-replica.html) statement. 
   通过发出 [`START REPLICA`](https://dev.mysql.com/doc/refman/8.4/en/start-replica.html) 语句来启动复制线程。

​          After you have performed this procedure, the replica connects          to the source and replicates any updates that have occurred on          the source since the snapshot was taken. Error messages are          issued to the replica's error log if it is not able to          replicate for any reason.        
执行此过程后，副本将连接到源并复制自拍摄快照以来源上发生的任何更新。如果副本由于任何原因无法复制，则会向副本的错误日志发出错误消息。

​          The replica uses information logged in its connection metadata          repository and applier metadata repository to keep track of          how much of the source's binary log it has processed. By          default, these repositories are tables named          `slave_master_info` and          `slave_relay_log_info` in the          `mysql` database. Do *not*          remove or edit these tables unless you know exactly what you          are doing and fully understand the implications. Even in that          case, it is preferred that you use the          [`CHANGE REPLICATION SOURCE TO`](https://dev.mysql.com/doc/refman/8.4/en/change-replication-source-to.html)          statement to change replication parameters. The replica uses          the values specified in the statement to update the          replication metadata repositories automatically. See          [Section 19.2.4, “Relay Log and Replication Metadata Repositories”](https://dev.mysql.com/doc/refman/8.4/en/replica-logs.html), for more information. 
副本使用其连接元数据存储库和应用程序元数据存储库中记录的信息来跟踪它已处理的源二进制日志的数量。默认情况下，这些存储库是 `mysql` 数据库中名为 `slave_master_info` 和 `slave_relay_log_info` 的表。除非您确切地知道自己在做什么并完全了解其含义，*否则不要*删除或编辑这些表。即使在这种情况下，最好使用 [`CHANGE REPLICATION SOURCE TO`](https://dev.mysql.com/doc/refman/8.4/en/change-replication-source-to.html) 语句来更改复制参数。副本使用语句中指定的值自动更新复制元数据存储库。有关更多信息，请参见[第 19.2.4 节 “中继日志和复制元数据存储库”。](https://dev.mysql.com/doc/refman/8.4/en/replica-logs.html)

Note 注意

​            The contents of the replica's connection metadata repository            override some of the server options specified on the command            line or in `my.cnf`. See            [Section 19.1.6, “Replication and Binary Logging Options and Variables”](https://dev.mysql.com/doc/refman/8.4/en/replication-options.html), for more details. 
副本的连接元数据存储库的内容将覆盖在命令行或 `my.cnf` 中指定的某些服务器选项。有关更多详细信息，请参见[第 19.1.6 节 “复制和二进制日志记录选项和变量”。](https://dev.mysql.com/doc/refman/8.4/en/replication-options.html)

​          A single snapshot of the source suffices for multiple          replicas. To set up additional replicas, use the same source          snapshot and follow the replica portion of the procedure just          described. 
源的单个快照足以用于多个副本。要设置其他副本，请使用相同的源快照并按照刚才描述的过程的副本部分进行操作。

[MySQL 8.4 参考手册](https://dev.mysql.com/doc/refman/8.4/en/) / [...](https://dev.mysql.com/doc/refman/8.4/en/replication-howto-slaveinit.html) / 在副本上设置源配置

#### 19.1.2.7 Setting the Source Configuration on the Replica 19.1.2.7 在副本上设置源配置

​        To set up the replica to communicate with the source for        replication, configure the replica with the necessary connection        information. To do this, on the replica, execute the following        [`CHANGE REPLICATION SOURCE TO`](https://dev.mysql.com/doc/refman/8.4/en/change-replication-source-to.html)        statement, replacing the option values with the actual values        relevant to your system:      
要将副本设置为与源通信以进行复制，请使用必要的连接信息配置副本。为此，请在副本上执行以下 [`CHANGE REPLICATION SOURCE TO`](https://dev.mysql.com/doc/refman/8.4/en/change-replication-source-to.html) 语句，将选项值替换为与系统相关的实际值：

```sql
mysql> CHANGE REPLICATION SOURCE TO
    ->     SOURCE_HOST='source_host_name',
    ->     SOURCE_USER='replication_user_name',
    ->     SOURCE_PASSWORD='replication_password',
    ->     SOURCE_LOG_FILE='recorded_log_file_name',
    ->     SOURCE_LOG_POS=recorded_log_position;
```

Note 注意

​          Replication cannot use Unix socket files. You must be able to          connect to the source MySQL server using TCP/IP. 
复制不能使用 Unix 套接字文件。您必须能够使用 TCP/IP 连接到源 MySQL 服务器。

​        The [`CHANGE REPLICATION SOURCE TO`](https://dev.mysql.com/doc/refman/8.4/en/change-replication-source-to.html)        statement has other options as well. For example, it is possible        to set up secure replication using SSL. For a full list of        options, and information about the maximum permissible length        for the string-valued options, see        [Section 15.4.2.2, “CHANGE REPLICATION SOURCE TO Statement”](https://dev.mysql.com/doc/refman/8.4/en/change-replication-source-to.html). 
[`CHANGE REPLICATION SOURCE TO`](https://dev.mysql.com/doc/refman/8.4/en/change-replication-source-to.html) 语句还有其他选项。例如，可以使用 SSL 设置安全复制。有关选项的完整列表以及有关字符串值选项的最大允许长度的信息，请参见[第 15.4.2.2 节 “CHANGE REPLICATION SOURCE TO STATEMENT”。](https://dev.mysql.com/doc/refman/8.4/en/change-replication-source-to.html)

Important 重要

​          As noted in [Section 19.1.2.3, “Creating a User for Replication”](https://dev.mysql.com/doc/refman/8.4/en/replication-howto-repuser.html), if          you are not using a secure connection and the user account          named in the `SOURCE_USER` option          authenticates with the          `caching_sha2_password` plugin (the default          in MySQL 8.4), you must specify the          `SOURCE_PUBLIC_KEY_PATH` or          `GET_SOURCE_PUBLIC_KEY` option in the          [`CHANGE REPLICATION SOURCE TO`](https://dev.mysql.com/doc/refman/8.4/en/change-replication-source-to.html)          statement to enable RSA key pair-based password exchange. 
如[第 19.1.2.3 节 “创建用于复制的用户”](https://dev.mysql.com/doc/refman/8.4/en/replication-howto-repuser.html)中所述，如果您未使用安全连接，并且 `SOURCE_USER` 选项中指定的用户帐户使用 `caching_sha2_password` 插件（MySQL 8.4 中的默认值）进行身份验证，则必须在 [`CHANGE REPLICATION SOURCE TO`](https://dev.mysql.com/doc/refman/8.4/en/change-replication-source-to.html) 语句中指定 `SOURCE_PUBLIC_KEY_PATH` 或 `GET_SOURCE_PUBLIC_KEY` 选项以启用基于 RSA 密钥对的密码交换。

#### 19.1.2.8 Adding Replicas to a Replication Environment 19.1.2.8 将副本添加到复制环境

​        You can add another replica to an existing replication        configuration without stopping the source server. To do this,        you can set up the new replica by copying the data directory of        an existing replica, and giving the new replica a different        server ID (which is user-specified) and server UUID (which is        generated at startup). 
您可以在不停止源服务器的情况下将另一个副本添加到现有复制配置中。为此，您可以通过复制现有副本的数据目录，并为新副本提供不同的服务器 ID（用户指定）和服务器 UUID（在启动时生成）来设置新副本。

Note 注意

​          If the replication source server or existing replica that you          are copying to create the new replica has any scheduled          events, ensure that these are disabled on the new replica          before you start it. If an event runs on the new replica that          has already run on the source, the duplicated operation causes          an error. The Event Scheduler is controlled by the          [`event_scheduler`](https://dev.mysql.com/doc/refman/8.4/en/server-system-variables.html#sysvar_event_scheduler) system          variable, which defaults to `ON`, so events          that are active on the original server run by default when the          new replica starts up. To stop all events from running on the          new replica, set the          [`event_scheduler`](https://dev.mysql.com/doc/refman/8.4/en/server-system-variables.html#sysvar_event_scheduler) system          variable to `OFF` or          `DISABLED` on the new replica. Alternatively,          you can use the [`ALTER EVENT`](https://dev.mysql.com/doc/refman/8.4/en/alter-event.html)          statement to set individual events to          `DISABLE` or `DISABLE ON          REPLICA` to prevent them from running on the new          replica. You can list the events on a server using the          [`SHOW`](https://dev.mysql.com/doc/refman/8.4/en/show.html) statement or the          Information Schema [`EVENTS`](https://dev.mysql.com/doc/refman/8.4/en/information-schema-events-table.html) table.          For more information, see          [Section 19.5.1.16, “Replication of Invoked Features”](https://dev.mysql.com/doc/refman/8.4/en/replication-features-invoked.html). 
如果要复制以创建新副本的复制源服务器或现有副本具有任何计划事件，请确保在启动新副本之前在新副本上禁用这些事件。如果事件在已在源上运行的新副本上运行，则复制的操作将导致错误。事件调度程序由 [`event_scheduler`](https://dev.mysql.com/doc/refman/8.4/en/server-system-variables.html#sysvar_event_scheduler) 系统变量控制，该变量默认为 `ON，`因此当新副本启动时，默认情况下，原始服务器上处于活动状态的事件将运行。要停止所有事件在新副本上运行，请在新副本上将 [`event_scheduler`](https://dev.mysql.com/doc/refman/8.4/en/server-system-variables.html#sysvar_event_scheduler) 系统变量设置为 `OFF` 或 `DISABLED`。或者，您可以使用 [`ALTER EVENT`](https://dev.mysql.com/doc/refman/8.4/en/alter-event.html) 语句将单个事件设置为 `DISABLE` 或 `DISABLE ON REPLICA`，以防止它们在新副本上运行。您可以使用 [`SHOW`](https://dev.mysql.com/doc/refman/8.4/en/show.html) 语句或 Information Schema [`EVENTS`](https://dev.mysql.com/doc/refman/8.4/en/information-schema-events-table.html) 表列出服务器上的事件。有关更多信息，请参见[第 19.5.1.16 节 “调用的功能的复制”。](https://dev.mysql.com/doc/refman/8.4/en/replication-features-invoked.html)

​        As an alternative to creating a new replica in this way, MySQL        Server's clone plugin can be used to transfer all the data and        replication settings from an existing replica to a clone. For        instructions to use this method, see        [Section 7.6.7.7, “Cloning for Replication”](https://dev.mysql.com/doc/refman/8.4/en/clone-plugin-replication.html).      
作为以这种方式创建新副本的替代方法，MySQL Server 的克隆插件可用于将所有数据和复制设置从现有副本传输到克隆。有关使用此方法的说明，请参见[第 7.6.7.7 节 “克隆以进行复制”。](https://dev.mysql.com/doc/refman/8.4/en/clone-plugin-replication.html)

​        To duplicate an existing replica without cloning, follow these        steps: 
要复制现有副本而不进行克隆，请执行以下步骤：

1. ​            Stop the existing replica and record the replica status            information, particularly the source binary log file and            relay log file positions. You can view the replica status            either in the Performance Schema replication tables (see            [Section 29.12.11, “Performance Schema Replication Tables”](https://dev.mysql.com/doc/refman/8.4/en/performance-schema-replication-tables.html)), or            by issuing [`SHOW REPLICA             STATUS`](https://dev.mysql.com/doc/refman/8.4/en/show-replica-status.html) as follows:          
   停止现有副本并记录副本状态信息，特别是源二进制日志文件和中继日志文件位置。您可以在性能模式复制表中查看副本状态（请参见[第 29.12.11 节 “性能模式复制表”](https://dev.mysql.com/doc/refman/8.4/en/performance-schema-replication-tables.html)），也可以通过发出[ `SHOW REPLICA             STATUS` ](https://dev.mysql.com/doc/refman/8.4/en/show-replica-status.html)如下方式来查看：

   ```sql
   mysql> STOP REPLICA;
   mysql> SHOW REPLICA STATUS\G
   ```

2. ​            Shut down the existing replica:          
   关闭现有副本：

   ```terminal
   $> mysqladmin shutdown
   ```

3. ​            Copy the data directory from the existing replica to the new            replica, including the log files and relay log files. You            can do this by creating an archive using            **tar** or `WinZip`, or by            performing a direct copy using a tool such as            **cp** or **rsync**. 
   将数据目录从现有副本复制到新副本，包括日志文件和中继日志文件。您可以通过使用 **tar** 或 `WinZip` 创建存档，或者使用 **cp** 或 **rsync** 等工具执行直接复制来实现此目的。

   Important 重要

   - ​                  Before copying, verify that all the files relating to                  the existing replica actually are stored in the data                  directory. For example, the `InnoDB`                  system tablespace, undo tablespace, and redo log might                  be stored in an alternative location.                  `InnoDB` tablespace files and                  file-per-table tablespaces might have been created in                  other directories. The binary logs and relay logs for                  the replica might be in their own directories outside                  the data directory. Check through the system variables                  that are set for the existing replica and look for any                  alternative paths that have been specified. If you                  find any, copy these directories over as well.                
     在复制之前，请验证与现有副本相关的所有文件是否确实存储在 data 目录中。例如，`InnoDB` 系统表空间、撤消表空间和重做日志可能存储在备用位置。`InnoDB` 表空间文件和每个表文件表空间可能已在其他目录中创建。副本的二进制日志和中继日志可能位于数据目录之外的各自目录中。检查为现有副本设置的系统变量，并查找已指定的任何替代路径。如果找到任何目录，也请复制这些目录。
   - ​                  During copying, if files have been used for the                  replication metadata repositories (see                  [Section 19.2.4, “Relay Log and Replication Metadata Repositories”](https://dev.mysql.com/doc/refman/8.4/en/replica-logs.html)), ensure that you also                  copy these files from the existing replica to the new                  replica. If tables have been used for the repositories                  (the default, the tables are in the data directory.                
     在复制过程中，如果文件已用于复制元数据存储库（请参见[第 19.2.4 节 “中继日志和复制元数据存储库”](https://dev.mysql.com/doc/refman/8.4/en/replica-logs.html)），请确保还将这些文件从现有副本复制到新副本。如果已将 tables 用于存储库（默认值，则 tables 位于 data 目录中。
   - ​                  After copying, delete the                  `auto.cnf` file from the copy of                  the data directory on the new replica, so that the new                  replica is started with a different generated server                  UUID. The server UUID must be unique. 
     复制后，从新副本上的数据目录副本中删除 `auto.cnf` 文件，以便使用生成的其他服务器 UUID 启动新副本。服务器 UUID 必须是唯一的。

   ​            A common problem that is encountered when adding new            replicas is that the new replica fails with a series of            warning and error messages like these:          
   添加新副本时遇到的一个常见问题是，新副本失败，并显示一系列警告和错误消息，如下所示：

   ```none
   071118 16:44:10 [Warning] Neither --relay-log nor --relay-log-index were used; so
   replication may break when this MySQL server acts as a replica and has his hostname
   changed!! Please use '--relay-log=new_replica_hostname-relay-bin' to avoid this problem.
   071118 16:44:10 [ERROR] Failed to open the relay log './old_replica_hostname-relay-bin.003525'
   (relay_log_pos 22940879)
   071118 16:44:10 [ERROR] Could not find target log during relay log initialization
   071118 16:44:10 [ERROR] Failed to initialize the master info structure
   ```

   ​            This situation can occur if the            [`relay_log`](https://dev.mysql.com/doc/refman/8.4/en/replication-options-replica.html#sysvar_relay_log) system variable            is not specified, as the relay log files contain the host            name as part of their file names. This is also true of the            relay log index file if the            [`relay_log_index`](https://dev.mysql.com/doc/refman/8.4/en/replication-options-replica.html#sysvar_relay_log_index) system            variable is not used. For more information about these            variables, see [Section 19.1.6, “Replication and Binary Logging Options and Variables”](https://dev.mysql.com/doc/refman/8.4/en/replication-options.html).          
   如果未指定 [`relay_log`](https://dev.mysql.com/doc/refman/8.4/en/replication-options-replica.html#sysvar_relay_log) 系统变量，则可能会发生这种情况，因为中继日志文件包含主机名作为其文件名的一部分。如果未使用 [`relay_log_index`](https://dev.mysql.com/doc/refman/8.4/en/replication-options-replica.html#sysvar_relay_log_index) 系统变量，则 relay log index 文件也是如此。有关这些变量的更多信息，请参见[第 19.1.6 节 “复制和二进制日志记录选项和变量”。](https://dev.mysql.com/doc/refman/8.4/en/replication-options.html)

   ​            To avoid this problem, use the same value for            [`relay_log`](https://dev.mysql.com/doc/refman/8.4/en/replication-options-replica.html#sysvar_relay_log) on the new            replica that was used on the existing replica. If this            option was not set explicitly on the existing replica, use            `*`existing_replica_hostname`*-relay-bin`.            If this is not possible, copy the existing replica's relay            log index file to the new replica and set the            [`relay_log_index`](https://dev.mysql.com/doc/refman/8.4/en/replication-options-replica.html#sysvar_relay_log_index) system            variable on the new replica to match what was used on the            existing replica. If this option was not set explicitly on            the existing replica, use            `*`existing_replica_hostname`*-relay-bin.index`.            Alternatively, if you have already tried to start the new            replica after following the remaining steps in this section            and have encountered errors like those described previously,            then perform the following steps: 
   要避免此问题，请对新副本上的 [`relay_log`](https://dev.mysql.com/doc/refman/8.4/en/replication-options-replica.html#sysvar_relay_log) 使用与现有副本上相同的值。如果未在现有副本上显式设置此选项，请使用 `*`existing_replica_hostname`*-relay-bin` 。如果无法做到这一点，请将现有副本的中继日志索引文件复制到新副本，并在新副本上设置 [`relay_log_index`](https://dev.mysql.com/doc/refman/8.4/en/replication-options-replica.html#sysvar_relay_log_index) 系统变量以匹配现有副本上使用的变量。如果未在现有副本上显式设置此选项，请使用 `*`existing_replica_hostname`*-relay-bin.index` 。或者，如果您在执行本节中的其余步骤后已尝试启动新副本，并且遇到了前面描述的错误，请执行以下步骤：

   1. ​                If you have not already done so, issue                [`STOP REPLICA`](https://dev.mysql.com/doc/refman/8.4/en/stop-replica.html) on the new                replica.              
      如果尚未执行此操作，请在新副本上发出 [`STOP REPLICA`](https://dev.mysql.com/doc/refman/8.4/en/stop-replica.html)。

      ​                If you have already started the existing replica again,                issue [`STOP REPLICA`](https://dev.mysql.com/doc/refman/8.4/en/stop-replica.html) on the                existing replica as well.              
      如果您已经再次启动了现有副本，则还要对现有副本发出 [`STOP REPLICA`](https://dev.mysql.com/doc/refman/8.4/en/stop-replica.html)。

   2. ​                Copy the contents of the existing replica's relay log                index file into the new replica's relay log index file,                making sure to overwrite any content already in the                file.              
      将现有副本的中继日志索引文件的内容复制到新副本的中继日志索引文件中，确保覆盖文件中已有的任何内容。

   3. ​                Proceed with the remaining steps in this section. 
      继续执行本节中的其余步骤。

4. ​            When copying is complete, restart the existing replica.          
   复制完成后，重新启动现有副本。

5. ​            On the new replica, edit the configuration and give the new            replica a unique server ID (using the            [`server_id`](https://dev.mysql.com/doc/refman/8.4/en/replication-options.html#sysvar_server_id) system variable)            that is not used by the source or any of the existing            replicas.          
   在新副本上，编辑配置并为新副本提供源或任何现有副本未使用的唯一服务器 ID（使用 [`server_id`](https://dev.mysql.com/doc/refman/8.4/en/replication-options.html#sysvar_server_id) 系统变量）。

6. ​            Start the new replica server, ensuring that replication does            not start yet by specifying            [`--skip-replica-start`](https://dev.mysql.com/doc/refman/8.4/en/replication-options-replica.html#option_mysqld_skip-replica-start). Use the            Performance Schema replication tables or issue            [`SHOW REPLICA STATUS`](https://dev.mysql.com/doc/refman/8.4/en/show-replica-status.html) to            confirm that the new replica has the correct settings when            compared with the existing replica. Also display the server            ID and server UUID and verify that these are correct and            unique for the new replica.          
   通过指定 [`--skip-replica-start`](https://dev.mysql.com/doc/refman/8.4/en/replication-options-replica.html#option_mysqld_skip-replica-start) 启动新的副本服务器，确保复制尚未启动。使用 Performance Schema 复制表或发出 [`SHOW REPLICA STATUS`](https://dev.mysql.com/doc/refman/8.4/en/show-replica-status.html) 以确认与现有副本相比，新副本具有正确的设置。此外，显示服务器 ID 和服务器 UUID，并验证它们对于新副本是否正确且唯一。

7. ​            Start the replica threads by issuing a            [`START REPLICA`](https://dev.mysql.com/doc/refman/8.4/en/start-replica.html) statement. The            new replica now uses the information in its connection            metadata repository to start the replication process. 
   通过发出 [`START REPLICA`](https://dev.mysql.com/doc/refman/8.4/en/start-replica.html) 语句来启动副本线程。新副本现在使用其连接元数据存储库中的信息来启动复制过程。