## 数据库

### 创建

要创建一个新的数据库，需要使用 postgres 用户，数据库名为`mydb`，有 3 种方法：

* `CREATE DATABASE` SQL 语句。
* `createdb` 命令。
* 使用 pgAdmin 工具。

```sql
mydb=# CREATE DATABASE mydb;

$ createdb mydb
```

如果不产生任何响则表示该步骤成功。   

PostgreSQL允许在一个站点上创建任意数量的数据库。 数据库名必须是以字母开头并且小于 63 个字符长。一个方便的做法是创建和你当前用户名同名的数据库。许多工具假设该数据库名为缺省数据库名。 要创建这样的数据库，只需要键入：

```bash
$ createdb
```

#### createdb

createdb 是一个 SQL 命令 `CREATE DATABASE` 的封装。

```bash
createdb [option...] [dbname [description]]

# dbname       要创建的数据库名。
# description  关于新创建的数据库相关的说明。
# options      参数可选项，可以是以下值：
#   -D tablespace  指定数据库默认表空间。
#   -e             将 createdb 生成的命令发送到服务端。
#   -E encoding    指定数据库的编码。
#   -l locale      指定数据库的语言环境。
#   -T template    指定创建此数据库的模板。
#   --help         显示 createdb 命令的帮助信息。
#   -h host        指定服务器的主机名。
#   -p port        指定服务器监听的端口，或者 socket 文件。
#   -U username    连接数据库的用户名。
#   -w             忽略输入密码。
#   -W             连接时强制要求输入密码。
```

示例：

```bash
$ cd /Library/PostgreSQL/11/bin/
$ createdb -h localhost -p 5432 -U postgres mydb
password ******
```

### 删除

PostgreSQL 删除数据库可以用以下三种方式：

- 使用 `DROP DATABASE` SQL 语句来删除。会删除数据库的系统目录项并且删除包含数据的文件目录。只能由超级管理员或数据库拥有者执行。

  ```sql
  DROP DATABASE [ IF EXISTS ] name
  # IF EXISTS  如果数据库不存在则发出提示信息，而不是错误信息。
  # name       要删除的数据库的名称。
  
  postgres=# DROP DATABASE mydb;
  ```

- 使用 dropdb 命令来删除。

  是 DROP DATABASE 的包装器。用于删除 PostgreSQL 数据库。只能由超级管理员或数据库拥有者执行。

  ```bash
  dropdb [connection-option...] [option...] dbname
  
  # dbname	要删除的数据库名。
  # options	参数可选项，可以是以下值：
  # 	-e						显示 dropdb 生成的命令并发送到数据库服务器。
  #	-i 						在做删除的工作之前发出一个验证提示。
  #	-V 						打印 dropdb 版本并退出。
  #	--if-exists 			如果数据库不存在则发出提示信息，而不是错误信息。
  #	--help 					显示有关 dropdb 命令的帮助信息。
  #	-h host 				指定运行服务器的主机名。
  #	-p port 				指定服务器监听的端口，或者 socket 文件。
  #	-U username 			连接数据库的用户名。
  #	-w 						连接时忽略输入密码。
  #	-W 						连接时强制要求输入密码。
  #	--maintenance-db=dbname	删除数据库时指定连接的数据库，默认为 postgres，如果它不存在则使用 template1。
  ```

  示例：

  ```bash
  dropdb -h localhost -p 5432 -U postgres mydb
  ```

- 使用 pgAdmin 工具。

**注意：**删除数据库要谨慎操作，一旦删除，所有信息都会消失。这个动作将在物理上把所有与该数据库相关的文件都删除并且不可取消。   

### 访问

可以通过以下方式访问：     

- 运行 PostgreSQL 的交互式终端程序，被称为 `psql`。

  ```bash
  ============= 1 =============
  psql
  postgres=# \l	        #查看数据库列表
                               List of databases
     Name    |  Owner   | Encoding | Collate | Ctype |   Access privileges   
  -----------+----------+----------+---------+-------+-----------------------
   postgres  | postgres | UTF8     | C       | C     | 
   mydb      | postgres | UTF8     | C       | C     | 
   template0 | postgres | UTF8     | C       | C     | =c/postgres          +
             |          |          |         |       | postgres=CTc/postgres
   template1 | postgres | UTF8     | C       | C     | =c/postgres          +
             |          |          |         |       | postgres=CTc/postgres
  (4 rows)
  
  postgres=# \c mydb      #进入数据库
  mydb=#
  
  ============= 2 =============
  psql mydb
  
  psql (14.4)
  Type "help" for help.
  
  mydb=#
  mydb=>
  ```

- 使用一种图形化前端工具，比如 `pgAdmin` 或者带 `ODBC` 或 `JDBC` 支持的办公套件来创建和管理数据库。      

- 使用多种绑定发行的语言中的一种写一个自定义的应用。

如果不提供数据库名字，那么它的缺省值就是你的用户账号名字。

### 内部命令

`psql` 程序有一些不属于 SQL 命令的内部命令。以反斜线开头，“`\`” 。 欢迎信息中列出了一些这种命令。

```bash
General
  \copyright             show PostgreSQL usage and distribution terms
  \crosstabview [COLUMNS] execute query and display results in crosstab
  \errverbose            show most recent error message at maximum verbosity
  \g [(OPTIONS)] [FILE]  execute query (and send results to file or |pipe);
                         \g with no arguments is equivalent to a semicolon
  \gdesc                 describe result of query, without executing it
  \gexec                 execute query, then execute each value in its result
  \gset [PREFIX]         execute query and store results in psql variables
  \gx [(OPTIONS)] [FILE] as \g, but forces expanded output mode
  \q                     退出 psql
  \watch [SEC]           execute query every SEC seconds

# 帮助
  \? [commands]          show help on backslash commands
  \? options             show help on psql command-line options
  \? variables           show help on special variables
  \h [NAME]              help on syntax of SQL commands, * for all commands
  \help

Query Buffer
  \e [FILE] [LINE]       edit the query buffer (or file) with external editor
  \ef [FUNCNAME [LINE]]  edit function definition with external editor
  \ev [VIEWNAME [LINE]]  edit view definition with external editor
  \p                     show the contents of the query buffer
  \r                     reset (clear) the query buffer
  \s [FILE]              display history or save it to file
  \w FILE                write query buffer to file

Input/Output
  \copy ...              perform SQL COPY with data stream to the client host
  \echo [-n] [STRING]    write string to standard output (-n for no newline)
  \i FILE                execute commands from file
  \ir FILE               as \i, but relative to location of current script
  \o [FILE]              send all query results to file or |pipe
  \qecho [-n] [STRING]   write string to \o output stream (-n for no newline)
  \warn [-n] [STRING]    write string to standard error (-n for no newline)

Conditional
  \if EXPR               begin conditional block
  \elif EXPR             alternative within current conditional block
  \else                  final alternative within current conditional block
  \endif                 end conditional block

Informational
  (options: S = show system objects, + = additional detail)
  \d[S+]                 list tables, views, and sequences
  \d[S+]  NAME           describe table, view, sequence, or index
  \da[S]  [PATTERN]      list aggregates
  \dA[+]  [PATTERN]      list access methods
  \dAc[+] [AMPTRN [TYPEPTRN]]  list operator classes
  \dAf[+] [AMPTRN [TYPEPTRN]]  list operator families
  \dAo[+] [AMPTRN [OPFPTRN]]   list operators of operator families
  \dAp[+] [AMPTRN [OPFPTRN]]   list support functions of operator families
  \db[+]  [PATTERN]      list tablespaces
  \dc[S+] [PATTERN]      list conversions
  \dC[+]  [PATTERN]      list casts
  \dd[S]  [PATTERN]      show object descriptions not displayed elsewhere
  \dD[S+] [PATTERN]      list domains
  \ddp    [PATTERN]      list default privileges
  \dE[S+] [PATTERN]      list foreign tables
  \des[+] [PATTERN]      list foreign servers
  \det[+] [PATTERN]      list foreign tables
  \deu[+] [PATTERN]      list user mappings
  \dew[+] [PATTERN]      list foreign-data wrappers
  \df[anptw][S+] [FUNCPTRN [TYPEPTRN ...]]
                         list [only agg/normal/procedure/trigger/window] functions
  \dF[+]  [PATTERN]      list text search configurations
  \dFd[+] [PATTERN]      list text search dictionaries
  \dFp[+] [PATTERN]      list text search parsers
  \dFt[+] [PATTERN]      list text search templates
  \dg[S+] [PATTERN]      list roles
  \di[S+] [PATTERN]      list indexes
  \dl                    list large objects, same as \lo_list
  \dL[S+] [PATTERN]      list procedural languages
  \dm[S+] [PATTERN]      list materialized views
  \dn[S+] [PATTERN]      list schemas
  \do[S+] [OPPTRN [TYPEPTRN [TYPEPTRN]]]
                         list operators
  \dO[S+] [PATTERN]      list collations
  \dp     [PATTERN]      list table, view, and sequence access privileges
  \dP[itn+] [PATTERN]    list [only index/table] partitioned relations [n=nested]
  \drds [ROLEPTRN [DBPTRN]] list per-database role settings
  \dRp[+] [PATTERN]      list replication publications
  \dRs[+] [PATTERN]      list replication subscriptions
  \ds[S+] [PATTERN]      list sequences
  \dt[S+] [PATTERN]      list tables
  \dT[S+] [PATTERN]      list data types
  \du[S+] [PATTERN]      list roles
  \dv[S+] [PATTERN]      list views
  \dx[+]  [PATTERN]      list extensions
  \dX     [PATTERN]      list extended statistics
  \dy[+]  [PATTERN]      list event triggers
  \l[+]   [PATTERN]      list databases
  \sf[+]  FUNCNAME       show a function's definition
  \sv[+]  VIEWNAME       show a view's definition
  \z      [PATTERN]      same as \dp

Formatting
  \a                     toggle between unaligned and aligned output mode
  \C [STRING]            set table title, or unset if none
  \f [STRING]            show or set field separator for unaligned query output
  \H                     toggle HTML output mode (currently off)
  \pset [NAME [VALUE]]   set table output option
                         (border|columns|csv_fieldsep|expanded|fieldsep|
                         fieldsep_zero|footer|format|linestyle|null|
                         numericlocale|pager|pager_min_lines|recordsep|
                         recordsep_zero|tableattr|title|tuples_only|
                         unicode_border_linestyle|unicode_column_linestyle|
                         unicode_header_linestyle)
  \t [on|off]            show only rows (currently off)
  \T [STRING]            set HTML <table> tag attributes, or unset if none
  \x [on|off|auto]       toggle expanded output (currently off)

Connection
  \c[onnect] {[DBNAME|- USER|- HOST|- PORT|-] | conninfo}
                         connect to new database (currently "mydb")
  \conninfo              display information about current connection
  \encoding [ENCODING]   show or set client encoding
  \password [USERNAME]   securely change the password for a user

Operating System
  \cd [DIR]              change the current working directory
  \setenv NAME [VALUE]   set or unset environment variable
  \timing [on|off]       toggle timing of commands (currently off)
  \! [COMMAND]           execute command in shell or start interactive shell

Variables
  \prompt [TEXT] NAME    prompt user to set internal variable
  \set [NAME [VALUE]]    set internal variable, or list all if no parameters
  \unset NAME            unset (delete) internal variable

Large Objects
  \lo_export LOBOID FILE
  \lo_import FILE [COMMENT]
  \lo_list
  \lo_unlink LOBOID      large object operations
```

## 