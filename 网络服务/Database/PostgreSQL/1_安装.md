  # 安装

[TOC]

## 概述

PostgreSQL可以由任何非特权用户安装， 并不需要超级用户（root）的权限。

## 从二进制安装

PostgreSQL 以二进制软件包的形式提供给当今大多数常见的操作系统。如果可用，这是系统用户安装 PostgreSQL 的推荐方法。仅建议 PostgreSQL 的开发或扩展人员从源代码构建。

有关提供二进制软件包的平台的更新列表，请访问 PostgreSQL 网站上的 https://www.postgresql.org/download/ 并遵循特定平台的说明。 

```bash
# CentOS 8
dnf install -y https://download.postgresql.org/pub/repos/yum/reporpms/EL-8-x86_64/pgdg-redhat-repo-latest.noarch.rpm
dnf -qy module disable postgresql
dnf install -y postgresql14-server

/usr/pgsql-14/bin/postgresql-14-setup initdb

systemctl enable postgresql-14
systemctl start postgresql-14

# CentOS 7
yum install -y https://download.postgresql.org/pub/repos/yum/reporpms/EL-7-x86_64/pgdg-redhat-repo-latest.noarch.rpm
yum install -y postgresql14-server
/usr/pgsql-14/bin/postgresql-14-setup initdb

systemctl enable postgresql-14
systemctl start postgresql-14

# Ubuntu
sudo apt-get install postgresql postgresql-client 
```

## 从源代码安装

### 简单版

```bash
./configure
make
su
make install
adduser postgres
mkdir /usr/local/pgsql/data
chown postgres /usr/local/pgsql/data
su - postgres
/usr/local/pgsql/bin/initdb -D /usr/local/pgsql/data
/usr/local/pgsql/bin/pg_ctl -D /usr/local/pgsql/data -l logfile start

/usr/local/pgsql/bin/createdb test
/usr/local/pgsql/bin/psql test
```

### 完全版  

#### 要求

一般说来，一个现代的与 Unix 兼容的平台应该就能运行 PostgreSQL 。

编译 PostgreSQL 需要下列软件包：

- 要求 GNU make 版本 3.80 或以上；其他的 make 程序或更老的 GNU make 版本将*不会*工作（GNU make 有时以名字 `gmake` 安装）。要测试 GNU make 可以输入：

  ```bash
  make --version
  ```

- ​      你需要一个ISO/ANSI C 编译器（至少是 C99兼容的）。我们推荐使用最近版本的GCC，不过，众所周知的是PostgreSQL可以利用许多不同厂商的不同编译器进行编译。     

- ​      除了gzip和bzip2之外，我们还需要tar来解包源代码发布。     

- ​                   默认时将自动使用GNU Readline库。它允许psql（PostgreSQL的命令行 SQL 解释器）记住你输入的每一个命令并且允许你使用箭头键来找回和编辑之前的命令。如果你不想用它，那么你必需给`configure`声明`--without-readline`选项。作为一种可选方案，你常常可以使用 BSD许可证的`libedit`库，它最初是在NetBSD上开发的。`libedit`库是GNU Readline兼容的， 如果没有发现`libreadline`或者`configure`使用了`--with-libedit-preferred`选项，都会使用这个库。如果你使用的是一个基于包的 Linux 发布，那么要注意你需要`readline`和`readline-devel`两个包，特别是如果这两个包在你的版本里是分开的时候。     

- ​             默认的时候将使用zlib压缩库。 如果你不想使用它，那么你必须给`configure`声明`--without-zlib`选项。使用这个选项关闭了在pg_dump和pg_restore中对压缩归档的支持。     

  

   下列包是可选的。在默认配置的时候并不要求它们，但是如果打开了一些编译选项之后就需要它们了，如下文所解释的：    

- ​      要编译服务器端编程语言PL/Perl，你需要一个完整的      Perl安装，包括`libperl`      库和头文件。   所需的最低版本是Perl 5.8.3。   因为PL/Perl是一个共享库，            `libperl`库在大多数平台上也必须是一个共享库。最近的版本的      Perl好像已经默认这样做了，但是早先的版本可不是      这样的，而且这总是一种在站点上安装 Perl 的选择。如果选择了编译      PL/Perl但是它却找不到一个共享的      `libperl`，那么`configure`将会失败。      在这种情况下，你将不得不重新手工编译并且安装Perl      以便能编译PL/Perl。在      Perl的配置处理过程中，需要一个共享库。     

  ​      如果你想更多地使用PL/Perl，      你应当保证Perl安装在编译时启用了      `usemultiplicity`选项（`perl -V`将会显示是否是这样）。     

- ​      要编译PL/Python服务器端编程语言， 你需要一个Python的安装，包括头文件和distutils模块。最低的版本要求是Python 2.6。如果是版本3.1或更高版本，则支持Python 3，      如果使用 Python 3 请参考[第 46.1 节](http://www.postgres.cn/docs/14/plpython-python23.html)     

  ​      因为PL/Python将以共享库的方式编译，             `libpython`库在大多数平台上也必须是一个共享库。      在默认的从源码安装Python时不是这样的，      而是在很多操作系统发布中有一个共享库可用。如果选择了编译      PL/Python但找不到一个共享的      `libpython`，`configure`将      会失败。这可能意味着你不得不安装额外的包或者（部分）重编译      Python安装以提供这个共享库。      在从源码编译时，请用`--enable-shared`标志运行      Python的配置脚本。     

- ​      如果你想编译PL/Tcl过程语言，       你当然需要安装Tcl，要求的最低版本是      Tcl 8.4。     

- ​      要打开本地语言支持（NLS），也就是说， 用英语之外的语言显示程序的消息，你需要一个Gettext API的实现。有些操作系统内置了这些（例如Linux、NetBSD、Solaris）， 对于其它系统，你可以从https://www.gnu.org/software/gettext/下载一个额外的包。如果你在使用GNU C 库里面的Gettext实现， 那么你就额外需要GNU Gettext包，因为我们需要里面的几个工具程序。对于任何其它的实现，你应该不需要它。     

- ​      如果您想支持加密的客户端连接，则需要OpenSSL，在没有`/dev/urandom`的平台上(Windows除外)，还需要 OpenSSL作为随机数生成器。最低的版本要求是1.0.1。     

- ​      如果你想支持使用Kerberos、OpenLDAP和/或PAM服务的认证，那你需要相应的包。     

- ​          如果你想支持数据压缩， 则需要LZ4, 参见          [default_toast_compression](http://www.postgres.cn/docs/14/runtime-config-client.html#GUC-DEFAULT-TOAST-COMPRESSION).         

- ​      要编译PostgreSQL文档，有一些独立的要求集，请见      [第 J.2 节](http://www.postgres.cn/docs/14/docguide-toolsets.html)。     

  

   如果你正从Git树而不是使用发布的源代码包进行编译，或者你想做服务器端开发， 那么你还需要下面的包：    

- ​                               如果你需要从 Git 检出中编译，或者你修改了实际的扫描器和分析器的定义文件， 那么你需要 GNU Flex和Bison。 如果你需要它们，那么确保自己拿到的是Flex 2.5.31 或更新的版本， 以及Bison 1.875 或者更新的版本。不能使用其他lex和yacc程序。     
- ​             如果需要从 Git 检出中编译，或者你修改了任何使用 Perl 脚本的编译步骤的输入文件，那么你需要Perl 5.8.3或以后的版本。如果你在 Windows 上编译，你在任何情况下都需要Perl。运行一些测试套件时也需要Perl。     

  

   如果你需要获取GNU包，你可以在你的本地GNU镜像站点 （看看 https://www.gnu.org/prep/ftp或[ftp://ftp.gnu.org/gnu/](ftp://ftp.gnu.org/gnu/)找到它们。  

   还要检查一下你是否有足够的磁盘空间。你将大概需要近 350 MB 用于存放编译过程中的源码树和大约 40 MB 用于安装目录。   一个空数据库集簇大概需要 35 MB。一个数据库所占的空间大约是存储同样数据的平面文件所占空间的五倍。   如果你要运行回归测试，还临时需要额外的 300 MB。请用`df`命令检查剩余磁盘空间。  

##  获取源码

   PostgreSQL 14.1 源代码可以从我们的官方网站 https://www.postgresql.org/download/的下载区中获得。你将得到一个名为`postgresql-14.1.tar.gz`或`postgresql-14.1.tar.bz2`的文件。在你获取文件之后，解压缩它：

```
gunzip postgresql-14.1.tar.gz
tar xf postgresql-14.1.tar
```

   （如果你得到的是`.bz2`文件，请用`bunzip2`代替`gunzip`。   另外，请注意，大多数现代版本的`tar`可以直接解压缩压缩档案，因此您实际上不需要单独的`gunzip`或`bunzip2`步骤。）。这样将在当前目录创建一个目录`postgresql-14.1`， 里面是PostgreSQL源代码。进入这个目录完成安装过程的其他步骤。  

   你也可以直接从版本控制库中获得源代码，参见[附录 I](http://www.postgres.cn/docs/14/sourcerepo.html)。  

[9.3](http://www.postgres.cn/docs/9.3/install-procedure.html) [9.4](http://www.postgres.cn/docs/9.4/install-procedure.html) [9.5](http://www.postgres.cn/docs/9.5/install-procedure.html) [9.6](http://www.postgres.cn/docs/9.6/install-procedure.html) [10](http://www.postgres.cn/docs/10/install-procedure.html) [11](http://www.postgres.cn/docs/11/install-procedure.html) [12](http://www.postgres.cn/docs/12/install-procedure.html) [13](http://www.postgres.cn/docs/13/install-procedure.html) 14

[阿里云PostgreSQL](https://www.aliyun.com/product/rds/postgresql) [问题报告](https://github.com/postgres-cn/pgdoc-cn/issues/new) [纠错本页面](https://github.com/postgres-cn/pgdoc-cn/edit/14/postgresql/doc/src/sgml/installation.sgml)



| 17.4. 安装过程                                               |                                                            |                       |                                                     |                                                            |
| ------------------------------------------------------------ | ---------------------------------------------------------- | --------------------- | --------------------------------------------------- | ---------------------------------------------------------- |
| [上一页](http://www.postgres.cn/docs/14/install-getsource.html) | [上一级](http://www.postgres.cn/docs/14/installation.html) | 第 17 章 从源代码安装 | [起始页](http://www.postgres.cn/docs/14/index.html) | [下一页](http://www.postgres.cn/docs/14/install-post.html) |

------

## 17.4. 安装过程

- [17.4.1. `configure` 选项](http://www.postgres.cn/docs/14/install-procedure.html#CONFIGURE-OPTIONS)
- [17.4.2. `configure` 环境变量](http://www.postgres.cn/docs/14/install-procedure.html#CONFIGURE-ENVVARS)

1. **配置**

   

   ​    安装过程的第一步就是为你的系统配置源代码树并选择你喜欢的选项。这个工作是通过运行`configure`脚本实现的，对于默认安装，你只需要简单地输入：

   ```
   ./configure
   ```

   ​    该脚本将运行一些测试来决定一些系统相关的变量， 并检测你的操作系统的特殊设置，并且最后将在编译树中创建一些文件以记录它找到了什么。   

   ​    如果你想保持编译目录的独立，你也可以在一个源码树之外的目录中运行`configure` ，然后在那里构建。这个过程也被称为一个*VPATH*编译。做法如下：

   ```
   mkdir build_dir
   cd build_dir
   /path/to/source/tree/configure [options go here]
   make
   ```

      

   ​    默认设置将编译服务器和辅助程序，还有只需要 C 编译器的所有客户端程序和接口。默认时所有文件都将安装到`/usr/local/pgsql`。   

   ​    您可以通过向`configure`提供一个或多个命令行选项来自定义构建和安装过程。    通常，您会自定义安装位置或构建的一组可选功能。`configure`有大量的选项，    在[第 17.4.1 节](http://www.postgres.cn/docs/14/install-procedure.html#CONFIGURE-OPTIONS)中有描述。   

   ​    此外，`configure`响应某些环境变量，如[第 17.4.2 节](http://www.postgres.cn/docs/14/install-procedure.html#CONFIGURE-ENVVARS)中所述。    这些提供了自定义配置的其他方法。   

2. **Build**

   ​    要开始构建，请键入：

   ```
   make
   make all
   ```

   ​    （记得使用GNU make。）    构建将需要几分钟时间，具体取决于您的硬件。   

      如果您想构建可以构建的所有内容，包括文档（HTML 和手册页）和附加模块（`contrib`），请改为键入：

   ```
   make world
   ```

     

      如果您想构建可以构建的所有内容，和附加模块，除了文档，请改为键入：

   ```
   make world-bin
   ```

      

   ​    如果要从另一个 makefile 调用构建而不是手动调用，则必须取消设置`MAKELEVEL`或将其设置为零，例如：

   ```
   build-postgresql:
           $(MAKE) -C postgresql MAKELEVEL=0 all
   ```

   ​    不这样做可能会导致奇怪的错误消息，通常是关于缺少头文件。   

3. **回归测试**

   

   ​    如果您想在安装之前测试新构建的服务器，您可以在此时运行回归测试。    回归测试是一个测试套件，用于验证PostgreSQL    是否以开发人员期望的方式在您的机器上运行。输入：

   ```
   make check
   ```

   ​    （这不会以 root 身份运行；以非特权用户身份进行。）有关解释测试结果的详细信息，    请参阅[第 33 章](http://www.postgres.cn/docs/14/regress.html)。您可以在以后的任何时间通过发出相同的命令重复此测试。   

4. **安装文件**

   ### 注意

   ​     如果您要升级现有系统，请务必阅读[第 19.6 节](http://www.postgres.cn/docs/14/upgrading.html)，其中包含有关升级集群的说明。    

   ​    要安装PostgreSQL，请输入：

   ```
   make install
   ```

   ​    这会将文件安装到[步骤 1](http://www.postgres.cn/docs/14/install-procedure.html#CONFIGURE)中指定的目录中。    确保您具有写入该区域的适当权限。通常，您需要以 root 身份执行此步骤。    或者，您可以提前创建目标目录并安排授予适当的权限。   

   ​    要安装文档（HTML 和手册页），请输入：

   ```
   make install-docs
   ```

      

   ​    如果您构建了上面的文档，请输入：

   ```
   make install-world
   ```

   ​    这也会安装文档。   

   ​       如果您构建除上述文档之外的所有内容，请输入：   

   ```
      make install-world-bin
      
   ```

   ​      

   ​    您可以使用`make install-strip`而不是    `make install`来剥离安装的可执行文件和库。这将节省一些空间。    如果您使用调试支持构建，剥离将有效地移除调试支持，因此只有在不再需要调试时才应该这样做。    `install-strip`试图做一个合理的工作来节省空间，    但它不知道如何从可执行文件中去除每个不需要的字节，所以如果你想节省所有的磁盘空间，    你可能可以，你将不得不做手工工作。   

   ​    标准安装提供客户端应用程序开发以及服务器端程序开发所需的所有头文件，例如用 C 编写的自定义函数或数据类型。   

   **仅客户端安装：.**      如果只想安装客户端应用程序和接口库，则可以使用以下命令：

   ```
   make -C src/bin install
   make -C src/include install
   make -C src/interfaces install
   make -C doc install
   ```

   ​    `src/bin`有一些仅供服务器使用的二进制文件，但它们很小。    

**卸载：.**     要撤消安装，请使用命令`make uninstall`。但是，这不会删除任何创建的目录。   

**清理：.**     安装后，您可以通过使用命令`make clean`从源树中删除构建的文件来释放磁盘空间。    这将保留`configure`程序生成的文件，以便您稍后可以使用`make`重建所有内容。    要将代码树重置为分发时的状态，请使用`make distclean`。如果要在同一源代码树中为多个平台构建，    则必须执行此操作并为每个平台重新配置。（或者，为每个平台使用单独的构建树，以便源树保持不变。）   

   如果您执行构建然后发现您的`configure`选项错误，或者如果您更改了`configure`调查的任何内容（例如，软件升级），那么在重新配置和重建之前执行`make distclean`是个好主意。 没有这个，您对配置选择的更改可能不会传播到他们需要的任何地方。  

### 17.4.1. `configure` 选项



​    `configure`的命令行选项解释如下。 这个列表并不详尽（使用`./configure --help`    来获得一个）。此处未涵盖的选项适用于交叉编译等高级用例，并记录在标准Autoconf文档中。   

#### 17.4.1.1. 安装位置

​      这些选项控制`make install`将放置文件的位置。      `--prefix`选项在大多数情况下就足够了。      如果您有特殊需要，可以使用本节中描述的其他选项自定义安装子目录。 但是请注意，更改不同子目录的相对位置可能会使安装不可重定位，这意味着您将无法在安装后移动它。      （`man`和`doc` 位置不受此限制的影响。）      对于可重定位安装，您可能需要使用`--disable-rpath`选项稍后描述。     

- `--prefix=*`PREFIX`*`

  ​         把所有文件装在目录*`PREFIX`*中而不是`/usr/local/pgsql`中。 实际的文件会安装到数个子目录中；没有一个文件会直接安装到*`PREFIX`*目录里。        

- `--exec-prefix=*`EXEC-PREFIX`*`

  ​         你可以把体系相关的文件安装到一个不同的前缀下（*`EXEC-PREFIX`*），而不是*`PREFIX`*中设置的地方。 这样做可以比较方便地在不同主机之间共享体系相关的文件。 如果你省略这些，那么*`EXEC-PREFIX`*就会被设置为等于 *`PREFIX`*并且体系相关和体系无关的文件都会安装到同一棵目录树下，这也可能是你想要的。        

- `--bindir=*`DIRECTORY`*`

  ​         为可执行程序指定目录。默认是`*`EXEC-PREFIX`*/bin`， 通常也就是`/usr/local/pgsql/bin`。        

- `--sysconfdir=*`DIRECTORY`*`

  ​         用于各种各样配置文件的目录，默认为`*`PREFIX`*/etc`。        

- `--libdir=*`DIRECTORY`*`

  ​         设置安装库和动态装载模块的目录。默认是`*`EXEC-PREFIX`*/lib`。        

- `--includedir=*`DIRECTORY`*`

  ​         C 和 C++ 头文件的目录。默认是`*`PREFIX`*/include`。        

- `--datarootdir=*`DIRECTORY`*`

  ​         设置多种只读数据文件的根目录。这只为后面的某些选项设置默认值。默认值为`*`PREFIX`*/share`。        

- `--datadir=*`DIRECTORY`*`

  ​         设置被安装的程序使用的只读数据文件的目录。默认值为`*`DATAROOTDIR`*`。注意这不会对你的数据库文件被放置的位置产生任何影响。        

- `--localedir=*`DIRECTORY`*`

  ​         设置安装区域数据的目录，特别是消息翻译目录文件。默认值为`*`DATAROOTDIR`*/locale`。        

- `--mandir=*`DIRECTORY`*`

  ​         PostgreSQL自带的手册页将安装到这个目录，它们被安装在相应的`man*`x`*`子目录里。 默认是`*`DATAROOTDIR`*/man`。        

- `--docdir=*`DIRECTORY`*`

  ​         设置安装文档文件的根目录，“man”页不包含在内。这只为后续选项设置默认值。这个选项的默认值为`*`DATAROOTDIR`*/doc/postgresql`。        

- `--htmldir=*`DIRECTORY`*`

  ​         PostgreSQL的HTML格式的文档将被安装在这个目录中。默认值为`*`DATAROOTDIR`*`。        

### 注意

​       为了让PostgreSQL能够安装在一些共享的安装位置（例如`/usr/local/include`）， 同时又不至于和系统其它部分产生名字空间干扰，我们特别做了一些处理。 首先，安装脚本会自动给`datadir`、`sysconfdir`和`docdir`后面附加上“`/postgresql`”字符串， 除非展开的完整路径名已经包含字符串“`postgres`”或者“`pgsql`”。 例如，如果你选择`/usr/local`作为前缀， 那么文档将安装在`/usr/local/doc/postgresql`，但如果前缀是`/opt/postgres`， 那么它将被放到`/opt/postgres/doc`。客户接口的公共 C 头文件安装到了`includedir`，并且是名字空间无关的。内部的头文件和服务器头文件都安装在`includedir`下的私有目录中。参考每种接口的文档获取关于如何访问头文件的信息。最后，如果合适，那么也会在`libdir`下创建一个私有的子目录用于动态可装载的模块。      

#### 17.4.1.2. PostgreSQL 特性

​     本节中描述的选项支持构建默认情况下未构建的各种PostgreSQL功能。     其中大部分是非默认的，只是因为它们需要额外的软件，如[第 17.2 节](http://www.postgres.cn/docs/14/install-requirements.html)中所述。    

- `--enable-nls[=*`LANGUAGES`*]`

  ​         打开本地语言支持（NLS），也就是以非英文显示程序消息的能力。*`LANGUAGES`*是一个空格分隔的语言代码列表， 表示你想支持的语言。例如`--enable-nls='de fr'` （你提供的列表和实际支持的列表之间的交集将会自动计算出来）。如果你没有声明一个列表，那么就会安装所有可用的翻译。                 要使用这个选项，你需要一个Gettext API 的实现。        

- `--with-perl`

  ​         制作PL/Perl服务器端编程语言。        

- `--with-python`

  ​         制作PL/Python服务器端编程语言。        

- `--with-tcl`

  ​         制作PL/Tcl服务器编程语言。        

- `--with-tclconfig=*`DIRECTORY`*`

  ​         Tcl 安装文件`tclConfig.sh`，其中里面包含编译与 Tcl 接口的模块的配置信息。该文件通常可以自动地在一个众所周知的位置找到，但是如果你需要一个不同版本的 Tcl，         您可以指定在其中查找`tclConfig.sh`的目录。        

- `--with-icu`

  ​         构建时支持ICU         库，从而能够使用 ICU 整理功能（请参阅         [第 24.2 节](http://www.postgres.cn/docs/14/collation.html))。 这需要安装ICU4C包。         ICU4C的最低要求版本目前是 4.2。                 默认情况下，pkg-config         将用于查找所需的编译选项。ICU4C4.6 及更高版本支持此功能。         对于旧版本，或者如果pkg-config 不可用，可以将变量`ICU_CFLAGS`         和`ICU_LIBS`指定为`configure`，就像在这个例子中： `./configure ... --with-icu ICU_CFLAGS='-I/some/where/include' ICU_LIBS='-L/some/where/lib -licui18n -licuuc -licudata' `         （如果ICU4C在编译器的默认搜索路径中，         那么您仍然需要指定非空字符串以避免使用pkg-config，         例如，`ICU_CFLAGS=' '`。）        

- `--with-llvm`

  ​         支持基于LLVM的JIT编译         （请参阅[第 32 章](http://www.postgres.cn/docs/14/jit.html)）。          这需要安装LLVM库。         当前LLVM的最低要求版本是3.9。                `llvm-config`        可用于查找所需的编译选项。`llvm-config`会在`PATH`        上搜索所有受支持版本的`llvm-config-$major-$minor`。        如果这不会产生所需的程序，请使用`LLVM_CONFIG`指定正确的        `llvm-config`的路径。例如： `./configure ... --with-llvm LLVM_CONFIG='/path/to/llvm/bin/llvm-config' `                 LLVM支持需要兼容的`clang`编译器         （必要时使用`CLANG`环境变量指定）和有效的C++编译器         （必要时使用使用`CXX`环境变量指定）。        

- `--with-lz4`

  ​                支持 LZ4 压缩构建。                使用 LZ4 压缩表数据。               

- `--with-ssl=*`LIBRARY`*`              

  ​         编译SSL（加密）连接支持。唯一支持的*`LIBRARY`*是 `openssl`。这个选项需要安装OpenSSL包。`configure`将会检查所需的头文件和库以确保你的 OpenSSL安装足以让配置继续下去。        

- `--with-openssl`

  ​               相当于以前的 `--with-ssl=openssl`.              

- `--with-gssapi`

  ​         构建支持 GSSAPI 身份验证。在许多系统上，GSSAPI 系统（通常是 Kerberos 安装的一部分）         并未安装在默认搜索的位置（例如，`/usr/include`、         `/usr/lib`)，因此除此选项外，您还必须使用选项         `--with-includes`和`--with-libraries`。         `configure`将检查所需的头文件和库，以确保您的 GSSAPI 安装足够，然后再继续。        

- `--with-ldap`

  ​         为认证和连接参数查找编译LDAP支持         （详见[第 34.18 节](http://www.postgres.cn/docs/14/libpq-ldap.html)和[第 21.10 节](http://www.postgres.cn/docs/14/auth-ldap.html)）。在 Unix 上，这需要安装OpenLDAP包。在 Windows 上将使用默认的WinLDAP库。`configure`将会检查所需的头文件和库以确保你的 OpenLDAP安装足以让配置继续下去。        

- `--with-pam`

  ​         使用PAM（可插拔身份验证模块）支持构建。        

- `--with-bsd-auth`

  ​         使用 BSD 身份验证支持构建。（BSD 身份验证框架目前仅在 OpenBSD 上可用。）        

- `--with-systemd`

  ​         编译对systemd         服务通知的支持。如果服务器是在systemd         机制下被启动，这可以提高集成度，否则不会有影响         否则，; 参考 [第 19.3 节](http://www.postgres.cn/docs/14/server-start.html) 查看更多信息         。要使用这个选项，必须安装libsystemd         以及相关的头文件。        

- `--with-bonjour`

  ​         构建支持 Bonjour 自动服务发现。这需要您的操作系统支持 Bonjour。推荐在 macOS 上使用。        

- `--with-uuid=*`LIBRARY`*`

  ​         使用指定的 UUID 库编译[uuid-ossp](http://www.postgres.cn/docs/14/uuid-ossp.html)模块（提供生成 UUID 的函数）。                  *`LIBRARY`*必须是下列之一：                   `bsd`，用来使用 FreeBSD、NetBSD 和一些其他 BSD 衍生系统           中的 UUID 函数                     `e2fs`，用来使用`e2fsprogs`项目创建的 UUID 库，           这个库出现在大部分的 Linux 系统和 macOS 中，并且也能找到用于其他平台的           版本                     `ossp`，用来使用[OSSP UUID library](http://www.ossp.org/pkg/lib/uuid/)          

- `--with-ossp-uuid`

  ​         `--with-uuid=ossp`的已废弃的等效选项。        

- `--with-libxml`

  ​         使用 libxml2 构建，启用 SQL/XML 支持。 此功能需要 Libxml2 版本 2.6.23 或更高版本。                 为了检测所需的编译器和链接器选项，PostgreSQL 将查询`pkg-config`，如果它已安装并且知道 libxml2。         否则，libxml2 安装的程序`xml2-config`将在找到时使用。         首选使用`pkg-config`，因为它可以更好地处理多架构安装。                 要使用位于不寻常位置的 libxml2 安装，您可以设置与`pkg-config`相关的环境变量（请参阅其文档），或将环境变量`XML2_CONFIG`设置为指向 到属于 libxml2 安装的`xml2-config`程序，或设置变量`XML2_CFLAGS`         和`XML2_LIBS`。 （如果安装了`pkg-config`，那么要覆盖它的 libxml2 位置的想法，您必须设置`XML2_CONFIG`或同时设置`XML2_CFLAGS`和`XML2_LIBS`到非空字符串。）        

- `--with-libxslt`

  ​         使用 libxslt 构建，使[xml2](http://www.postgres.cn/docs/14/xml2.html)模块能够执行 XML 的 XSL 转换。         `--with-libxml`也必须指定。        

#### 17.4.1.3. Anti-Features

​     本节中描述的选项允许禁用默认构建的某些PostgreSQL功能，     但如果所需的软件或系统功能不可用，则可能需要关闭这些功能。除非确实有必要，否则不建议使用这些选项。    

- `--without-readline`

  ​         防止使用Readline库（以及libedit）。         此选项禁用psql中的命令行编辑和历史记录。        

- `--with-libedit-preferred`

  ​         赞成使用 BSD 许可的libedit库而不是 GPL 许可的Readline。 仅当您安装了两个库时，此选项才有意义； 这种情况下的默认设置是使用Readline。        

- `--without-zlib`

  ​                  防止使用Zlib库。这将禁用对pg_dump         和pg_restore中压缩档案的支持。        

- `--disable-spinlocks`

  ​         即便PostgreSQL对于该平台没有 CPU 自旋锁支持，也允许编译成功。自旋锁支持的缺乏会导致非常差的性能，因此这个选项只有当编译终端或者通知你该平台缺乏自旋锁支持时才应被使用。如果在你的平台上要求使用该选项来编译PostgreSQL，请将此问题报告给PostgreSQL的开发者。        

- `--disable-atomics`

  ​         禁用 CPU 原子操作。 此选项在缺少此类操作的平台上不起作用。 在具有它们的平台上，这将导致性能不佳。 此选项仅用于调试或进行性能比较。        

- `--disable-thread-safety`

  ​         禁用客户端库的线程安全性。这会阻止libpq和ECPG程序中的并发线程安全地控制它们私有的连接句柄。仅在线程支持不足的平台上使用它。        

#### 17.4.1.4. 构建过程详细信息

- `--with-includes=*`DIRECTORIES`*`

  ​         *`DIRECTORIES`*是一个以冒号分隔的目录列表，这些目录将被添加到编译器搜索头文件的列表中。         如果您在非标准位置安装了可选包（例如 GNUReadline），则必须使用此选项，并且可能还必须使用相应的`--with-libraries`选项。                 例子：`--with-includes=/opt/gnu/include:/usr/sup/include`.        

- `--with-libraries=*`DIRECTORIES`*`

  ​         *`DIRECTORIES`*是用于搜索库的以冒号分隔的目录列表。         如果您在非标准位置安装了软件包，您可能必须使用此选项（以及相应的`--with-includes`选项）。         installed in non-standard locations.                 例子：`--with-libraries=/opt/gnu/lib:/usr/sup/lib`.        

- `--with-system-tzdata=*`DIRECTORY`*`              

  ​         PostgreSQL包含它自己的时区数据库，它被用于日期和时间操作。这个时区数据库实际上是和 IANA 时区数据库相兼容的，后者在很多操作系统如 FreeBSD、Linux和Solaris上都有提供，因此再次安装它可能是冗余的。当这个选项被使用时，将不会使用*`DIRECTORY`*中系统提供的时区数据库，而是使用包括在 PostgreSQL 源码发布中的时区数据库。*`DIRECTORY`*必须被指定为一个绝对路径。`/usr/share/zoneinfo`在某些操作系统上是一个很有可能的路径。注意安装例程将不会检测不匹配或错误的时区数据。如果你使用这个选项，建议你运行回归测试来验证你指定的时区数据能正常地工作在PostgreSQL中。                 这个选项主要针对那些很了解他们的目标操作系统的二进制包发布者。使用这个选项主要优点是不管何时当众多本地夏令时规则之一改变时，  PostgreSQL 包不需要被升级。另一个优点是如果时区数据库文件在安装时不需要被编译， PostgreSQL 可以被更直接地交叉编译。        

- `--with-extra-version=*`STRING`*`

  ​         将*`STRING`*附加到 PostgreSQL 版本号。 例如，您可以使用它来标记从未发布的 Git 快照构建的二进制文件或包含带有额外版本字符串的自定义补丁，例如`git describe`标识符或分发包版本号。        

- `--disable-rpath`

  ​         不要标记PostgreSQL的可执行文件以表明它们应该在安装的库目录中搜索共享库（请参阅`--libdir`）。         在大多数平台上，此标记使用库目录的绝对路径，因此如果您稍后重新定位安装将无济于事。但是，您随后需要为可执行文件提供一些其他方式来查找共享库。         通常这需要配置操作系统的动态链接器来搜索库目录； 有关更多详细信息，请参阅[第 17.5.1 节](http://www.postgres.cn/docs/14/install-post.html#INSTALL-POST-SHLIBS)。        

#### 17.4.1.5. 杂项

​     使用`--with-pgport`调整默认端口号是相当常见的，尤其是对于测试版本。     本节中的其他选项仅建议高级用户使用。    

- `--with-pgport=*`NUMBER`*`

  ​         将*`NUMBER`*设置为服务器和客户端的默认端口号。默认为 5432。         以后可以随时更改端口，但是如果您在此处指定它，那么服务器和客户端都将编译相同的默认值，这会非常方便。         通常选择非默认值的唯一理由是如果您打算在同一台机器上运行多个PostgreSQL服务器。        

- `--with-krb-srvnam=*`NAME`*`

  ​         GSSAPI 使用的 Kerberos 服务主体的默认名称。`postgres`是默认值。         通常没有理由更改它，除非您是为 Windows 环境构建的，在这种情况下，它必须设置为大写`POSTGRES`。        

- `--with-segsize=*`SEGSIZE`*`

  ​         设置*segment size*，以千兆字节为单位。大表被分成多个操作系统文件，每个文件的大小等于段的大小。         这避免了许多平台上存在的文件大小限制问题。默认段大小 1 GB 在所有支持的平台上都是安全的。         如果您的操作系统支持“largefile”（现在大多数都支持），您可以使用更大的段大小。         这有助于减少处理非常大的表时消耗的文件描述符的数量。但请注意不要选择大于您的平台和您打算使用的文件系统支持的值。         您可能希望使用的其他工具，例如tar，也可以设置可用文件大小的限制。         建议（虽然不是绝对要求）此值是 2 的幂。         请注意，更改此值会破坏磁盘数据库兼容性，这意味着您不能使用`pg_upgrade`升级到具有不同段大小。        

- `--with-blocksize=*`BLOCKSIZE`*`

  ​         设置*block size*，以千字节为单位。这是表中的存储和 I/O          默认值为 8 KB，适用于大多数情况； 但其他值在特殊情况下可能有用。         该值必须是 1 到 32（千字节）之间的 2 的幂。         请注意，更改此值会破坏磁盘数据库兼容性，这意味着您不能使用`pg_upgrade`升级到具有不同块大小的构建。        

- `--with-wal-blocksize=*`BLOCKSIZE`*`

  ​         设置*WAL block size*，以千字节为单位。这是 WAL 日志中的存储和 I/O 单元。         默认值为 8 KB，适用于大多数情况； 但其他值在特殊情况下可能有用。该值必须是 1 到 64（千字节）之间的 2 的幂。         请注意，更改此值会破坏磁盘数据库兼容性，这意味着您不能使用`pg_upgrade`升级到具有不同 WAL 块大小的构建。        

#### 17.4.1.6. Developer Options

​     本节中的大多数选项仅适用于开发或调试PostgreSQL。     除了`--enable-debug`之外，不建议将它们用于生产版本，这对于在遇到错误的不幸事件中启用详细的错误报告非常有用。     在支持 DTrace 的平台上，在生产中使用`--enable-dtrace`也可能是合理的。    

​     在构建将用于在服务器内部开发代码的安装时，建议至少使用选项`--enable-debug`     和`--enable-cassert`。    

- `--enable-debug`

  ​         把所有程序和库以带有调试符号的方式编译。这意味着你可以通过一个调试器运行程序来分析问题。  这样做显著增大了最后安装的可执行文件的大小，并且在非 GCC 的编译器上，这么做通常还要关闭编译器优化，  这些都导致速度的下降。但是，如果有这些符号的话，就可以非常有效地帮助定位可能发生问题的位置。目前，我们只是在你使用 GCC  的情况下才建议在生产安装中使用这个选项。但是如果你正在进行开发工作，或者正在使用 beta 版本，那么你就应该总是打开它。        

- `--enable-cassert`

  ​         打开在服务器中的*assertion*检查， 它会检查许多“不可能发生”的条件。它对于代码开发的用途而言是无价之宝， 不过这些测试可能会显著地降低服务器的速度。并且，打开这个测试不会提高你的系统的稳定性！  这些断言检查并不是按照严重性分类的，因此一些相对无害的小故障也可能导致服务器重启 — 只要它触发了一次断言失败。  目前，我们不推荐在生产环境中使用这个选项，但是如果你在做开发或者在使用 beta 版本的时候应该打开它。        

- `--enable-tap-tests`

  ​         使用 Perl TAP 工具启用测试。 这需要 Perl 安装和 Perl 模块`IPC::Run`。         有关详细信息，请参阅[第 33.4 节](http://www.postgres.cn/docs/14/regress-tap.html)。        

- `--enable-depend`

  ​          打开自动倚赖性跟踪。如果打开这个选项，那么制作文件（makefile）将设置为在任何头文件被修改的时候都将重新编译所有受影响的目标文件。  如果你在做开发的工作，那么这个选项很有用，但是如果你只是想编译一次并且安装，那么这就是浪费时间。 目前，这个选项只对 GCC 有用。        

- `--enable-coverage`

  ​         如果使用 GCC，则所有程序和库都使用代码覆盖测试工具进行编译。 运行时，它们会在构建目录中生成带有代码覆盖率指标的文件。         有关详细信息，请参阅[第 33.5 节](http://www.postgres.cn/docs/14/regress-coverage.html)         for more information。此选项仅适用于 GCC 和进行开发工作时。        

- `--enable-profiling`

  ​         如果使用 GCC，则会编译所有程序和库，以便对其进行分析。         在后端退出时，将创建一个子目录，其中包含包含配置文件数据的`gmon.out`文件。         此选项仅用于 GCC 和进行开发工作时。        

- `--enable-dtrace`

  ​                  为PostgreSQL编译对动态跟踪工具 DTrace 的支持。         详见[第 28.5 节](http://www.postgres.cn/docs/14/dynamic-trace.html)。                 要指向`dtrace`程序，必须设置环境变量`DTRACE`。这通常是必需的，因为`dtrace`通常被安装在`/usr/sbin`中，该路径可能不在你的`PATH`中。                 `dtrace`程序的附加命令行选项可以在环境变量`DTRACEFLAGS`中指定。在 Solaris 上，要在一个64位二进制中包括 DTrace，你必须指定`DTRACEFLAGS="-64"`。例如，使用 GCC 编译器： `./configure CC='gcc -m64' --enable-dtrace DTRACEFLAGS='-64' ... `         使用 Sun 的编译器： `./configure CC='/opt/SUNWspro/bin/cc -xtarget=native64' --enable-dtrace DTRACEFLAGS='-64' ... `        

### 17.4.2. `configure` 环境变量



​     除了上面描述的普通命令行选项之外，`configure`响应许多环境变量。     您可以在`configure`命令行上指定环境变量，例如：

```
./configure CC=/opt/bin/gcc CFLAGS='-O2 -pipe'
```

​     在这种用法中，环境变量与命令行选项几乎没有什么不同。 您还可以预先设置此类变量：

```
export CC=/opt/bin/gcc
export CFLAGS='-O2 -pipe'
./configure
```

​     这种用法很方便，因为许多程序的配置脚本以类似的方式响应这些变量。    

​     这些环境变量中最常用的是`CC`和`CFLAGS`。如果你喜欢用那些和`configure`选取的不同的 C 编译器，那么你可以你的环境变量`CC`设置为你选择的程序。默认时，只要`gcc`可以使用，`configure`将选择它， 或者是该平台的默认（通常是`cc`）。类似地，你可以用`CFLAGS`变量覆盖默认编译器标志。    

​     下面是可以以这种方式设置的有效变量的列表：      

- `BISON`

  ​         Bison程序        

- `CC`

  ​         C编译器        

- `CFLAGS`

  ​         传递给 C 编译器的选项        

- `CLANG`

  ​         `clang`程序的路径，用于处理使用`-with-llvm`         进行编译时内联的源代码。        

- `CPP`

  ​         C 预处理器        

- `CPPFLAGS`

  ​         传递给 C 预处理器的选项        

- `CXX`

  ​         C++编译器        

- `CXXFLAGS`

  ​         传给C++编译器的选项        

- `DTRACE`

  ​         `dtrace`程序的位置        

- `DTRACEFLAGS`

  ​         传递给`dtrace`程序的选项        

- `FLEX`

  ​         Flex程序        

- `LDFLAGS`

  ​         链接可执行程序或共享库时使用的选项        

- `LDFLAGS_EX`

  ​         只用于链接可执行程序的附加选项        

- `LDFLAGS_SL`

  ​         只用于链接共享库的附加选项        

- `LLVM_CONFIG`

  ​         `llvm-config`程序用于查找         LLVM安装。        

- `MSGFMT`

  ​         用于本地语言支持的`msgfmt`程序        

- `PERL`

  ​         Perl 解释器的全路径名称。这将被用来决定编译 PL/Perl 时的依赖性。        

- `PYTHON`

  ​         Python 解释器程序。这将被用来决定编译 PL/Python 时的依赖性。另外这里指定的是 Python 2 还是 Python 3 （或者是隐式选择）决定了 PL/Python 语言的哪一种变种将成为可用的。         详见[第 46.1 节](http://www.postgres.cn/docs/14/plpython-python23.html)。         如果未设置，则按以下顺序探测：`python python3 python2`。                 

- `TCLSH`

  ​         Tcl 解释器程序。 这将用于确定构建 PL/Tcl 的依赖关系。         如果未设置，则按此顺序探测以下内容：`tclsh tcl tclsh8.6 tclsh86 tclsh8.5 tclsh85 tclsh8.4 tclsh84`。        

- `XML2_CONFIG`

  ​         用于定位 libxml2 安装的`xml2-config`程序。        

​    

​     有时候，将编译器标志事后添加到由`configure`选择的集合中非常有用。  一个重要的例子是，gcc的`-Werror`  选项不能包含在传递给`configure`的`CFLAGS`中，  因为它会中断许多`configure`的内置测试。要添加这样的标志，  在运行`make`时将它们包含在`COPT`环境变量中。  将`COPT`的内容添加到由`configure`设置的 `CFLAGS`和`LDFLAGS`中。例如，你可以这样做

```
make COPT='-Werror'
```

​     或者

```
export COPT='-Werror'
make
```

​    

### 注意

​      如果在使用 GCC，最好使用至少`-O1`的优化级别来编译，因为不使用优化（`-O0`）会禁用某些重要的编译器警告（例如使用未经初始化的变量）。但是，非零的优化级别会使调试更复杂，因为在编译好的代码中步进通常将不能和源代码行一一对应。如果你在尝试调试优化过的代码时觉得困惑，将感兴趣的特定文件使用`-O0`编译。一种简单的方式是传递一个选项给make：`make PROFILE=-O0 file.o`。     

​      `COPT`和`PROFILE`环境变量同样由PostgreSQL    makefile实际处理。要使用哪个是一个性能问题，但是开发者的共同习惯是将    `PROFILE`用于一次性的标识调整，而始终保持设置`COPT`。     

------

| [上一页](http://www.postgres.cn/docs/14/install-getsource.html) | [上一级](http://www.postgres.cn/docs/14/installation.html) | [下一页](http://www.postgres.cn/docs/14/install-post.html) |
| ------------------------------------------------------------ | ---------------------------------------------------------- | ---------------------------------------------------------- |
| 17.3. 获取源码                                               | [起始页](http://www.postgres.cn/docs/14/index.html)        | 17.5. 安装后设置                                           |

[![img](http://www.postgres.cn/docs/pic/tailbar.jpg)](https://www.aliyun.com/product/rds/postgresql)

##  安装后设置

- [17.5.1. 共享库](http://www.postgres.cn/docs/14/install-post.html#INSTALL-POST-SHLIBS)
- [17.5.2. 环境变量](http://www.postgres.cn/docs/14/install-post.html#id-1.6.4.9.3)

### 17.5.1. 共享库



​    在一些有共享库的系统里，你需要告诉你的系统如何找到新安装的共享库。那些并*不*是必须做这个工作的系统包括 FreeBSD、HP-UX、Linux、NetBSD、OpenBSD和Solaris。   

​    设置共享库的搜索路径的方法因平台而异， 但是最广泛使用的方法是设置环境变量`LD_LIBRARY_PATH`，例如在 Bourne shells （`sh`、`ksh`、`bash`、`zsh`）中：

```
LD_LIBRARY_PATH=/usr/local/pgsql/lib
export LD_LIBRARY_PATH
```

​    或者在`csh`或`tcsh`中：

```
setenv LD_LIBRARY_PATH /usr/local/pgsql/lib
```

​    把`/usr/local/pgsql/lib`换成你在[步骤 1](http://www.postgres.cn/docs/14/install-procedure.html#CONFIGURE)时设置的`--libdir`。 你应该把这些命令放到 shell 启动文件，如`/etc/profile`或`~/.bash_profile`中。 和这个方法相关的一些注意事项和很好的信息可以在http://xahlee.info/UnixResource_dir/_/ldpath.html找到。   

​    在有些系统上，更好的方法可能是在编译*之前*设置环境变量`LD_RUN_PATH`。   

​    在Cygwin上，把库目录放在`PATH`中或者把`.dll`文件移动到`bin`目录。   

​    如果有疑问，请参考你的系统的手册页（可能是`ld.so`或`rld`）。 如果稍后你收到下面这样的消息：

```
psql: error in loading shared libraries
libpq.so.2.1: cannot open shared object file: No such file or directory
```

​    那么这一步就是必须的了。这个只需关注一下就是了。   

​        如果你用的系统是Linux，并且你还有 root 权限，那么你可以在安装之后运行：

```
/sbin/ldconfig /usr/local/pgsql/lib
```

​    （或者等效的目录）以便让运行时链接器更快地找到共享库。请参考`ldconfig`的手册页获取更多信息。在FreeBSD、NetBSD和OpenBSD上，命令是：

```
/sbin/ldconfig -m /usr/local/pgsql/lib
```

​    我们不知道其它的系统有等效的命令。   

### 17.5.2. 环境变量



​    如果你安装到`/usr/local/pgsql`或者其他默认不在搜索路径中的地方， 那你应该在你的`PATH`环境变量里面增加一个 `/usr/local/pgsql/bin`（或者是你在[步骤 1](http://www.postgres.cn/docs/14/install-procedure.html#CONFIGURE)时给选项`--bindir`设置的任何值） 。严格来说，这些都不是必须的，但这么做可以让你使用PostgreSQL更方便。   

​    要做这些事情，把下面几行加到你的 shell 启动文件，如`~/.bash_profile`（如果想影响所有用户就放在`/etc/profile`）：

```
PATH=/usr/local/pgsql/bin:$PATH
export PATH
```

​    如果你用的是`csh`或者`tcsh`，那么用这条命令：

```
set path = ( /usr/local/pgsql/bin $path )
```

   

​        为了让你的系统找得到man文档，你需要加类似下面的一行到一个shell启动文件里 （除非你安装到了默认搜索的位置）：

```
MANPATH=/usr/local/pgsql/share/man:$MANPATH
export MANPATH
```

   

​    环境变量`PGHOST`和`PGPORT`为客户端应用指定了数据库服务器的主机和端口， 它们会覆盖编译时的默认项。如果你想从远程运行客户端应用， 那么为每个准备使用该数据库的用户都设置`PGHOST`将会非常方便。但这不是必须的，而且大部分客户端程序也可以通过命令行选项替换这些设置。   

## 平台支持

   如果代码包含规定要工作在一个平台（即一种 CPU 架构和操作系统的结合）上并且它最近已经被验证能在该平台上编译并通过其回归测试，PostgreSQL开发社区才会认为该平台是被支持的。目前，大部分平台兼容性的测试都是由[PostgreSQL 编译农场](https://buildfarm.postgresql.org/)的测试机器自动完成的。如果你对在一个并没有出现在编译农场中的平台上运行PostgreSQL感兴趣，但是代码确实能够工作或者能被修改得工作，我们强烈鼓励你建立一个编译农场成员机器，这样进一步的兼容性可以被确认。  

   通常，PostgreSQL被期望能在这些 CPU 架构上工作：x86、  x86_64、IA64、PowerPC、PowerPC 64、S/390、S/390x、Sparc、Sparc  64、ARM、MIPS、MIPSEL和PA-RISC。存在对 M68K、M32R  和 VAX  的代码支持，但是这些架构上并没有近期测试的报告。通常也可以在一个为支持的 CPU 类型上通过使用`--disable-spinlocks`配置来进行编译，但是性能将会比较差。  

   PostgreSQL被期望能在这些操作系统上工作： Linux（所有最近的发布）、Windows（XP及以上）、   FreeBSD、OpenBSD、NetBSD、macOS、AIX、HP/UX 和 Solaris。其他类 Unix 系统可能也可以工作，但是目前没有被测试。在大部分情况下，一个给定操作系统所支持的所有 CPU 架构都能工作。查找下文的[第 17.7 节](http://www.postgres.cn/docs/14/installation-platform-notes.html)来看是否有与你的操作系统相关的信息，特别是使用一个老的系统时更应该这样做。  

   如果你在一个平台上有安装问题，并且该平台根据最近的编译农场结果已经可以被支持，请将问题报告给`<pgsql-bugs@lists.postgresql.org>`。如果你有兴趣将PostgreSQL移植到一个新的平台，`<pgsql-hackers@lists.postgresql.org>`是一个合适的讨论它的地方。  

## 平台相关的说明

- [17.7.1. AIX](http://www.postgres.cn/docs/14/installation-platform-notes.html#INSTALLATION-NOTES-AIX)
- [17.7.2. Cygwin](http://www.postgres.cn/docs/14/installation-platform-notes.html#INSTALLATION-NOTES-CYGWIN)
- [17.7.3. macOS](http://www.postgres.cn/docs/14/installation-platform-notes.html#INSTALLATION-NOTES-MACOS)
- [17.7.4. MinGW/原生 Windows](http://www.postgres.cn/docs/14/installation-platform-notes.html#INSTALLATION-NOTES-MINGW)
- [17.7.5. Solaris](http://www.postgres.cn/docs/14/installation-platform-notes.html#INSTALLATION-NOTES-SOLARIS)

   这一节提供了考虑 PostgreSQL 安装和设置的附加平台相关的话题。确保阅读安装指导，特别是[第 17.2 节](http://www.postgres.cn/docs/14/install-requirements.html)。   同样，检查关于回归测试结果解释的[第 33 章](http://www.postgres.cn/docs/14/regress.html)。  

   这里没有覆盖的平台不存在平台相关的安装问题。  

### 17.7.1. AIX



​    PostgreSQL 能在 AIX 上工作，但是AIX 6.1以前的版本有各种问题并且不推荐使用。你可以使用 GCC 或本地 IBM 编译器`xlc`。   

#### 17.7.1.1. 内存管理

​     AIX 的特别之处在于它的内存管理。你可能有一个装备有好多个吉字节空闲 RAM 的服务器，但是在运行应用时仍然会得到内存不足或者地址空间错误。一个例子是加载扩展会因为罕见的错误失败。例如，作为 PostgreSQL 安装的拥有者运行：

```
=# CREATE EXTENSION plperl;
ERROR:  could not load library "/opt/dbs/pgsql/lib/plperl.so": A memory address is not in the address space for the process.
```

​    作为拥有 PostgreSQL 安装的组中的非拥有者运行：

```
=# CREATE EXTENSION plperl;
ERROR:  could not load library "/opt/dbs/pgsql/lib/plperl.so": Bad address
```

​     另一个例子是 PostgreSQL 服务器日志中的内存不足错误，每次内存分配接近或者超过 256 MB 时都会失败。    

​     所有这些问题的总体成因是服务器进程所用的寻址空间和内存模型。默认情况下，所有在 AIX  上编译的二进制都是32位。这并不依赖于硬件类型或使用的内核。这些32位进程被限制在 4GB 的内存中，并被使用几种模型之一安排成 256 MB  的段。该默认值允许在堆中低于 256 MB，因为它和栈共享一个单独的段。    

​     在`plperl`的例子中，检查你的 umask 和你的 PostgreSQL  安装中的二进制的权限。这个例子中涉及的二进制是32位的并且被用模式 750 而不是 755  安装。由于这种方式的权限设置，只有所有者或拥有组的成员可以载入该库。因为它不是所有人可读的，载入器将该对象放在进程的堆中而不是它应该被放入的共享库段中。    

​     这个问题的“理想的”解决方案是使用 PostgreSQL 的64位编译，但是这不是总是实用的，因为有32位处理器的系统可以编译64位二进制但是却不能运行它。    

​     如果想要一个 32 位二进制，在开始 PostgreSQL 服务器之前将`LDR_CNTRL`设置为`MAXDATA=0x*`n`*0000000`，其中 1 <= n <= 8，并且尝试不同的值以及`postgresql.conf`设置来找一个能让你满意的配置。这种`LDR_CNTRL`的使用告诉 AIX 你希望服务器留出`MAXDATA`字节给堆，以 256 MB 的段分配。当你找到了一个可工作的配置时，`ldedit`可以被用来修改二进制，这样它们默认使用想要的堆尺寸。PostgreSQL 也可以被重新编译，传递`configure  LDFLAGS="-Wl,-bmaxdata:0x*`n`*0000000"`来达到相同的效果。    

​     对于一个 64 位编译，设置`OBJECT_MODE`为 64 并且传递`CC="gcc -maix64"`和`LDFLAGS="-Wl,-bbigtoc"`给`configure`（给`xlc`的选项可能不同）。如果你省略`OBJECT_MODE`的输出，你的编译可能会因为链接器错误而失败。当`OBJECT_MODE`被设置时，它告诉 AIX 的编译工具（如`ar`、`as`和`ld`）默认要处理哪些对象类型。    

​     默认情况下，过量使用页面空间的情况可能会发生。不过我们还没有看到过，当进程用尽内存并且出现了过量使用时 AIX  会杀死进程。我们见到过的最接近于此的是 fork 失败，其原因是系统觉得已经没有足够的内存给另一个进程。和 AIX  的很多其他部分一样，如果这成为了一个问题，页面空间分配方法和耗尽内存导致的杀死在系统范围或进程范围是可以配置的。    

### 17.7.2. Cygwin



​    PostgreSQL 可以使用 Cygwin 来编译，它是用于 Windows 的一个类 Linux 环境，但是这种方法不如原生 Windows 编译见[第 18 章](http://www.postgres.cn/docs/14/install-windows.html)）并且我们已经不再推荐在 Cygwin 下运行一个服务器。   

​    在从源代码编译时，按照UNIX风格安装过程进行（即`./configure;    make`; 等；只要注意下列 Cygwin 相关的区别：     

- ​       将你的路径设置为使用 Cygwin 的 bin 目录并且把它放在 Windows 工具的前面。这将帮助避免很多编译的问题。      

- ​       不支持`adduser`命令；使用 Windows NT、2000 或 XP 上的用户管理应用来替代。否则，跳过这一步。      

- ​       不支持`su`命令；在 Windows NT、2000 或 XP 上使用 ssh 来模拟 su。否则，跳过这一步。      

- ​       不支持 OpenSSL。      

- ​       为共享内存支持启动`cygserver`。要这样做，输入命令`/usr/sbin/cygserver &`。这个程序在你启动 PostgreSQL 服务器或初始化一个数据集簇（`initdb`）时的任何时刻都需要被运行。默认的`cygserver`配置可能需要被更改（例如增加`SEMMNS`）来防止 PostgreSQL 因为缺少系统资源而失败。      

- ​        在某些不使用 C 区域的系统上编译可能会失败。要修复这个问题，通过在边以前`export LANG=C.utf8`把区域设置为 C，并且在安装完 PostgreSQL 之后把区域恢复成之前的设置。      

- ​       并行回归测试（`make check`）可能产生虚假的回归测试错误，这是由于溢出的`listen()`连接缓冲区，它会导致连接拒绝错误或挂起。你可以使用`MAX_CONNECTIONS`来限制连接数：

  ```
  make MAX_CONNECTIONS=5 check
  ```

  ​       （在某些系统上你可以有大约 10 个同时连接。）      

   

​    可以把`cygserver` PostgreSQL 服务器安装为 Windows NT 服务。关于如何这样做的信息，请参考包含在 Cygwin 上 PostgreSQL 二进制包中的`README`文档。它被安装在目录`/usr/share/doc/Cygwin`中。   

### 17.7.3. macOS



​     在 macOS源码构建PostgreSQL    ，你需要安装Apple的命令行开发工具，这可以通过

```
xcode-select --install
```

​    （请注意，将出现一个 GUI 对话窗口以供确认）。您也可以安装也可以不安装 Xcode。   

​    在最新的macOS版本中，有必要将“sysroot”    路径嵌入用于查找某些系统头文件的include选项中。这导致configure    脚本的输出会有所不同，具体取决于在configure期间使用的SDK版本。        在简单的情况下，这应该不会造成任何问题，但是，如果您要尝试在与构建服务器代码不同    的计算机上构建扩展程序，则可能需要强制使用其他sysroot路径。为此，需要设置    `PG_SYSROOT`，例如：

```
make PG_SYSROOT=/desired/path all
```

​    要在您的计算机上找到合适的路径，请运行

```
xcrun --show-sdk-path
```

​    请注意，实际上不建议使用与构建核心服务器不同的sysroot版本构建扩展。    在最坏的情况下，它可能导致难以调试的ABI不一致。   

​    您还可以在配置时选择非默认的sysroot路径，通过在    configure中指定`PG_SYSROOT`：

```
./configure ... PG_SYSROOT=/desired/path
```

​    这主要是对其他一些macOS版本进行交叉编译的时候有用。 不能保证产生的可执行文件能在当前主机上运行。   

​    要完全禁止该选项`-isysroot`，使用

```
./configure ... PG_SYSROOT=none
```

​    (任何不存在的路径名都可以使用)。 如果你想用一个非苹果的编译器来构建，这可能是有用的，但要注意这种情况没有被PostgreSQL的开发者测试或支持。   

   macOS的“系统完整性保护”（SIP）    功能破坏了`make check`，因为它阻止通过    设置所需的`DYLD_LIBRARY_PATH`传递给被测试的可执行文件。       您可以通过在`make check`之前执行`make install`来解决此问题。   不过，大多数PostgreSQL开发人员关闭了SIP。   

### 17.7.4. MinGW/原生 Windows



​    用于 Windows 的 PostgreSQL 可以使用 MinGW 编译，它是一个用于微软操作系统的类 Unix 的编译环境。也可以使用微软的Visual C++编译器套件来编译。    MinGW 编译步骤使用本章中描述的正常编译系统；而  Visual C++ 编译的工作完全不同并且在[第 18 章](http://www.postgres.cn/docs/14/install-windows.html)/中描述。   

​    原生 Windows 移植要求一个 Windows 2000 或更高的 32 或 64 位版本。早期的操作系统没有足够的基础设施（但  Cygwin可以用在它们之上）。类 Unix 的编译工具 MinGW 和 MSYS（一个 Unix 工具集合，用于运行如`configure`之类的 shell 脚本）可以从http://www.mingw.org/下载。运行结果二进制两者都需要，它们只在创建二进制时需要。   

​     要使用 MinGW 编译 64 位二进制，从http://mingw-w64.sourceforge.net/安装 64 位工具。把它放在`PATH`中的 bin 目录，并且使用`--host=x86_64-w64-mingw32`选项运行`configure`.   

​    在你安装完所有的东西之后，我们建议你在`CMD.EXE`下运行psql，因为 MSYS 控制台有缓冲问题。   

#### 17.7.4.1. 在 Windows 上收集崩溃转储

​     如果 PostgreSQL 在 Windows 上崩溃，它有能力产生minidumps，这可以被用来追踪崩溃发生的原因，这与 Unix 上的核心转储相似。这些转储可以被使用Windows Debugger Tools或Visual Studio读取。要启用在 Windows 上的转储生成，可在集簇数据目录下创建一个名为`crashdumps`的子目录。转储将被写入到这个目录，转储的名字基于崩溃进程的标识符和崩溃的当前时间来确定。    

### 17.7.5. Solaris



​    PostgreSQL 在 Solaris 上得到了很好的支持。你的操作系统越新，你将会碰到更少的问题。   

#### 17.7.5.1. 要求的工具

​     你可以使用 GCC 或 Sun 的编译器套件进行编译。为了更好的代码优化，我们强烈推荐在 SPARC 架构下使用 Sun 的编译器。如果你正在使用 Sun 的编译器，注意不要选择`/usr/ucb/cc`；而是使用`/opt/SUNWspro/bin/cc`。    

​     你可以从https://www.oracle.com/technetwork/server-storage/solarisstudio/downloads/下载 Sun Studio。很多 GNU 工具都被整合到了 Solaris 10，或者它们在 Solaris companion CD 中。如果你需要用于老版本 Solaris 的包，你可以在http://www.sunfreeware.com找到这些工具。如果你想要源码，在https://www.gnu.org/prep/ftp上找找。    

#### 17.7.5.2. configure 抱怨一个失败的测试程序

​     如果`configure`抱怨一个失败的测试程序，可能的情况是运行时链接器无法找到某些库，可能是libz、libreadline或某些其他非标准库如 libssl。要向它指出正确的位置，在`configure`命令行上设置`LDFLAGS`环境变量，例如：

```
configure ... LDFLAGS="-R /usr/sfw/lib:/opt/sfw/lib:/usr/local/lib"
```

​     更多信息可见ld手册页。    

#### 17.7.5.3. 为最优性能编译

​     在 SPARC 架构上，我们强烈推荐使用 Sun Studio来编译。尝试使用`-xO5`优化标志来生成显著加快的二进制。不要使用任何修改浮点操作和`errno`处理（例如`-fast`）行为的标志。    

​     如果你没有理由要使用 SPARC 上的 64 位二进制，最好用 32 位版本。64 位操作较慢并且 64 位二进制比其 32  位变体要慢。在另一方面，AMD64 CPU 家族上的32 位代码不是原生的，所以在那个 CPU 族中 32 位代码要明显地更慢。    

#### 17.7.5.4. 用 DTrace 来跟踪 PostgreSQL

​     是的，可以使用 DTrace。详见[第 28.5 节](http://www.postgres.cn/docs/14/dynamic-trace.html)。    

​     如果你看到`postgres`可执行程序的链接中断并且报出下面的错误消息：

```
Undefined                       first referenced
 symbol                             in file
AbortTransaction                    utils/probes.o
CommitTransaction                   utils/probes.o
ld: fatal: Symbol referencing errors. No output written to postgres
collect2: ld returned 1 exit status
make: *** [postgres] Error 1
```

​     说明你的 DTrace 安装太旧，无法处理静态函数中的探测。你需要 Solaris 10u4 或更新的版本以使用DTrace。    

## 在Windows上从源代码安装

**目录**

- [18.1. 使用Visual C++或Microsoft Windows SDK构建](http://www.postgres.cn/docs/14/install-windows-full.html)

  [18.1.1. 要求](http://www.postgres.cn/docs/14/install-windows-full.html#id-1.6.5.8.8)[18.1.2. 针对64位Windows的特殊考虑](http://www.postgres.cn/docs/14/install-windows-full.html#id-1.6.5.8.9)[18.1.3. 构建](http://www.postgres.cn/docs/14/install-windows-full.html#id-1.6.5.8.10)[18.1.4. 清理和安装](http://www.postgres.cn/docs/14/install-windows-full.html#id-1.6.5.8.11)[18.1.5. 运行回归测试](http://www.postgres.cn/docs/14/install-windows-full.html#id-1.6.5.8.12)



  对于大部分用户，推荐下载Windows的二进制发布，它在PostgreSQL  的网站 https://www.postgresql.org/download/上作为一个图形化安装包可供下载。从源代码构建的方式只适合于希望开发或者扩展  PostgreSQL的人们。 

  有多种不同的方式可以在Windows上构建PostgreSQL。  用微软工具进行构建的最简单方式是安装  Visual Studio 2019并使用其中包含的编译器。  也可以使用完整的Microsoft Visual C++ 2013 to 2019来构建。  在某些情况中除了编译器还需要安装Windows SDK。 

  也可以使用由MinGW提供的GNU编译器工具来构建PostgreSQL，或者使用适合于旧版本Windows的Cygwin。 

  使用MinGW或Cygwin的构建用到普通构建系统，见[第 17 章](http://www.postgres.cn/docs/14/installation.html)、[第 17.7.4 节](http://www.postgres.cn/docs/14/installation-platform-notes.html#INSTALLATION-NOTES-MINGW)和[第 17.7.2 节](http://www.postgres.cn/docs/14/installation-platform-notes.html#INSTALLATION-NOTES-CYGWIN)。在这些环境下，要产生原生的64位二进制代码，请使用MinGW-w64中的工具。这些工具同样可以被用于在32位和64位 Windows上交叉编译其他主机上的目标，例如Linux和macOS。不推荐将Cygwin用于一个产品服务器，它只应被用于老版本的Windows，因为在这些系统中原生构建无法工作，例如Windows 98。官方的二进制代码使用Visual Studio构建。 

  psql的原生构建不支持命令行编辑。Cygwin构建能支持命令行编辑，因此如果需要在Windows上交互式地使用psql可以用到它。 

##  使用Visual C++或Microsoft Windows SDK构建

- [18.1.1. 要求](http://www.postgres.cn/docs/14/install-windows-full.html#id-1.6.5.8.8)
- [18.1.2. 针对64位Windows的特殊考虑](http://www.postgres.cn/docs/14/install-windows-full.html#id-1.6.5.8.9)
- [18.1.3. 构建](http://www.postgres.cn/docs/14/install-windows-full.html#id-1.6.5.8.10)
- [18.1.4. 清理和安装](http://www.postgres.cn/docs/14/install-windows-full.html#id-1.6.5.8.11)
- [18.1.5. 运行回归测试](http://www.postgres.cn/docs/14/install-windows-full.html#id-1.6.5.8.12)

  PostgreSQL可以使用来自微软的Visual C++编译器套件构建。这些编译器可以来自于Visual Studio、Visual Studio Express或者Microsoft Windows SDK的某些版本。如果你还没有准备好一个Visual Studio环境设置，最简单的方式是使用Visual Studio 2019中的编译器，或者Windows SDK 10中的，两者都可以从微软免费下载。 

  使用微软编译器套件可以编译得到 32 位和 64 位版本。32 位的 PostgreSQL 可以使用  Visual Studio 2013至  Visual Studio 2019（包括精简版）编译，  单独的Windows SDK 8.1a 到 10亦可。  64位PostgreSQL的构建支持  Microsoft Windows SDK版本8.1a 到 10或  Visual Studio 2013及以上版本。  使用Visual Studio 2013至  Visual Studio 2019编译时最低支持  Windows 7和  Windows Server 2008 R2 SP1。    

  使用Visual C++或Platform SDK构建的工具在`src\tools\msvc`目录中。在构建时，请确定在系统路径中没有来自于MinGW或的Cygwin工具。同样，确保所有需要的Visual C++工具都在PATH中。在Visual Studio中，启动Visual Studio Command Prompt。如果你希望构建一个64位版本，你必须使用64位版本的命令，反之亦然。在Microsoft Windows SDK中，启动该SDK在启动菜单中的CMD shell。在最近的SDK版本中你可以使用`setenv`命令改变目标CPU架构、构建类型以及目标OS，例如`setenv /x86 /release /xp`会设置为Windows XP或更高版本上的32位发布构建。使用`/?`来了解`setenv`的其他选项。所有命令应该从`src\tools\msvc`目录运行。 

  在开始构建之前，你还需要编辑文件`config.pl`来反映任何你想改变的配置选项，或者要使用的任何第三方库目录。完整的配置在第一次读取并解析文件`config_default.pl`时确定，然后应用`config.pl`中的任何改变。例如，要制定你的Python安装的位置，将下面的内容放在`config.pl`中：

```
$config->{python} = 'c:\python26';
```

  你只需要指定那些和`config_default.pl`中不同的参数即可。 

  如果你希望设置任何其他环境变量，可创建一个名为`buildenv.pl`的文件并将需要的命令放在其中。例如，要把不在PATH中的bison路径加上，创建一个包含以下内容的文件：

```
$ENV{PATH}=$ENV{PATH} . ';c:\some\where\bison\bin';
```

 

  传递更多的命令行参数到Visual Studio构建命令(msbuild 或 vcbuild):

```
$ENV{MSBFLAGS}="/m";
```

 

### 18.1.1. 要求

   构建PostgreSQL时需要下列附加产品。使用`config.pl`文件来指定这些库所在的目录。    

- Microsoft Windows SDK

  ​      如果你的构建环境中没有一个受支持的Microsoft Windows SDK版本，推荐你升级到最新版（当前版本为10），可从https://www.microsoft.com/download下载。           你必须总是包括SDK中的Windows头文件和库部分。如果你安装的是一个包括Visual C++ 编译器的Windows SDK，构建时不需要Visual Studio。注意在版本8.0a，Windows SDK中不再包括一个完整的命令行构建环境。     

- ActiveState Perl

  ​      ActiveState Perl被用来运行构建生成脚本。MinGW或Cygwin Perl是不符合要求的。AcitveState Perl也必须存在于PATH中。其二进制文件可以从https://www.activestate.com下载（注意：需要版本5.8.3及以上，免费标准发布就足够了）。     

  

   下面的附加产品在开始时并不要求，但是如果要构建完整的包就需要它们。使用`config.pl`文件来指定这些库所在的目录。    

- ActiveState TCL

  ​      用于构建PL/Tcl（注意：要求版本8.4，免费标准发布即可）。     

- Bison和      Flex

  ​      Bison和Flex用来从Git构建，但使用发行文件构建时可以不要求。只有Bison 1.875或2.2及以上才能正常工作。Flex则必须是版本2.5.31或以上。         Bison和Flex    都包括在msys工具套件中，它作为    MinGW编译器套件的一部分可以从    http://www.mingw.org/wiki/MSYS得到。           你将需要把包含`flex.exe`和`bison.exe`      的目录加入到`buildenv.pl`中的PATH环境变量中，      除非它们已经存在于PATH中。在MinGW的情况下，      目录将是MinGW安装目录的`\msys\1.0\bin`子目录。     注意        来自GnuWin32的Bison发布似乎有一个故障，它会导致Bison安装于名称中有空格的目录时发生故障，例如英语安装的默认位置`C:\Program Files\GnuWin32`。考虑将它安装到`C:\GnuWin32`或者在PATH环境设置中使用NTFS段路径名（例如`C:\PROGRA~1\GnuWin32`）。       

- Diff

  ​      Diff是回归测试所需要的，可以从http://gnuwin32.sourceforge.net得到。     

- Gettext

  ​      Gettext用于NLS支持，可以从http://gnuwin32.sourceforge.net得到。注意二进制程序、依赖文件以及开发者文件都需要。     

- MIT Kerberos

  ​      用于 GSSAPI 认证支持。MIT Kerberos可以从http://web.mit.edu/Kerberos/dist/index.html下载。     

- libxml2 and      libxslt

  ​      用于XML支持。二进制文件可以从http://zlatkovic.com/pub/libxml得到，源代码可以从http://xmlsoft.org得到。注意libxml2需要iconv，后者也可以在相同的下载位置得到。     

- LZ4

  ​          用于支持LZ4压缩方法来压缩表数据。二进制文件和源代码可以从          https://github.com/lz4/lz4/releases下载。         

- OpenSSL

  ​      用于SSL支持。二进制文件可以从https://slproweb.com/products/Win32OpenSSL.html下载，源代码可以从https://www.openssl.org下载。     

- ossp-uuid

  ​      用于UUID-OSSP支持（contrib only）。源代码可以从http://www.ossp.org/pkg/lib/uuid/下载。     

- Python

  ​      用于构建PL/Python。二进制文件可以从https://www.python.org下载。     

- zlib

  ​      用于pg_dump和pg_restore中的压缩支持。二进制文件可以从http://www.zlib.net下载。     

  

### 18.1.2. 针对64位Windows的特殊考虑

   在64位Windows上，PostgreSQL只能为x64架构构建，因此无法支持安腾处理器。  

   不支持在同一个构建树中混合32位和64位版本。构建系统会自动检测它运行在32位还是64位环境中，然后相应地构建PostgreSQL。鉴于此，在构建前启动正确的命令提示很重要。  

   要使用服务器端的第三方库如python或OpenSSL，该库*必须*也是64位。在一个64位服务器上载入一个32位库是不被支持的。PostgreSQL支持的一些第三方库可能只有32位版本，在这种情况下它们就不能被用于64位PostgreSQL。  

### 18.1.3. 构建

   要在发行配置中构建PostgreSQL的所有部分（默认），运行命令：

```
build
```

   要在调试配置中构建PostgreSQL的所有部分，运行命令：

```
build DEBUG
```

   要构建单独一个对象，例如psql，运行命令：

```
build psql
build DEBUG psql
```

   要将默认的构建配置改变成调试，将下面的内容放在`buildenv.pl`文件中：

```
$ENV{CONFIG}="Debug";
```

  

   也可以在Visual Studio的图形界面中进行构建。在这种情况下，你需要在命令提示符下运行：

```
perl mkvcbuild.pl
```

   然后在Visual Studio中打开生成的`pgsql.sln`（在源代码树的根目录中）。  

### 18.1.4. 清理和安装

   在大部分时间里，Visual Studio的自动依赖跟踪会处理发生改变的文件。但是如果发生了大量的改变，你也许需要清理整个安装。为此，只要运行`clean.bat`命令，它将会自动清除所有生成的文件。你也可以使用*`dist`*参数运行它，这种情况下它的效果和**`make distclean`**一样，并且会移除flex/bison的输出文件。  

   默认情况下，所有的文件都被写入到名为`debug`或`release`的子目录中。要将这些文件以标准布局进行安装并且生成初始化和使用数据库所需的文件 ，运行命令：

```
install c:\destination\directory
```

  

   如果你想只安装客户端应用和接口库，那么你可以使用这些命令：

```
install c:\destination\directory client
```

  

### 18.1.5. 运行回归测试

   要运行回归测试，确保你已经完成了所有所需部分的构建。另外，确保载入整个系统所需的DLL（例如Perl和Python过程语言所需的DLL）都在系统路径中。如果它们不在路径中，通过`buildenv.pl`文件设置。要运行测试，可以从`src\tools\msvc`目录运行以下命令之一：

```
vcregress check
vcregress installcheck
vcregress plcheck
vcregress contribcheck
vcregress modulescheck
vcregress ecpgcheck
vcregress isolationcheck
vcregress bincheck
vcregress recoverycheck
vcregress upgradecheck
```

   要更改使用的调度方式（默认为并行），在命令行后增加调度方式，如：

```
vcregress check serial
```

   关于回归测试详见[第 33 章](http://www.postgres.cn/docs/14/regress.html)。  

   用`vcregress bincheck`和`vcregress recoverycheck`   分别可以运行客户端程序上的回归测试和恢复测试，这要求   安装了额外的 Perl 模块：   

- IPC::Run

  ​      从编写这份文档时起，`IPC::Run`没有被包括在      ActiveState Perl 安装或者 ActiveState Perl Package      Manager (PPM) 库中。要安装，请从 CPAN （在      https://metacpan.org/release/IPC-Run）下载      `IPC-Run-<version>.tar.gz`源代码归档并且解压。      编辑`buildenv.pl`文件，并且增加一个 PERL5LIB 变量      指向解压得到的归档中的`lib`子目录。例如： `$ENV{PERL5LIB}=$ENV{PERL5LIB} . ';c:\IPC-Run-0.94\lib'; `     

  

​     用`vcregress`运行的TAP测试支持环境变量`PROVE_TESTS`以及`PROVE_FLAGS`，该变量使用给定的命名模式自动扩展。 这些可以在运行 `vcregress`命令前，     在 Windows 终端设置好 :  

```
  set PROVE_FLAGS=--timer --jobs 2
  set PROVE_TESTS=t/020*.pl t/010*.pl
  
```

​     也可以在文件中设置这些参数     `buildenv.pl`:  

```
  $ENV{PROVE_FLAGS}='--timer --jobs 2'
  $ENV{PROVE_TESTS}='t/020*.pl t/010*.pl'
  
```
