# 安装

[TOC]

## 支持的平台

官方支持的操作系统和 JVM 矩阵可在此处获取：[支持矩阵](https://www.elastic.co/support/matrix)。 Elasticsearch 在列出的平台上进行了测试，但它也可能在其他平台上运行。

## 使用专用主机

在生产中，建议在专用主机上运行 Elasticsearch 或将其作为主要服务运行。 Elasticsearch 的一些功能（例如自动 JVM 堆大小调整automatic JVM heap sizing）假设它是主机或容器上唯一的资源密集型应用程序。例如，可以将 Metricbeat 与 Elasticsearch 一起运行以获取集群统计信息，但资源密集型 Logstash 部署应该位于其自己的主机上。

## Elasticsearch 安装包

Elasticsearch 提供以下包格式：

| 格式                              | 说明                                                         |
| --------------------------------- | ------------------------------------------------------------ |
| Linux and MacOS `tar.gz` archives | `tar.gz` 存档可用于安装在任何 Linux 发行版和 MacOS 上。      |
| Windows `.zip` archive            | `zip`存档适合在 Windows 上安装。                             |
| `deb`                             | `deb` 软件包适用于 Debian、Ubuntu 和其他基于 Debian 的系统。Debian 软件包可以从 Elasticsearch 网站或 Debian repository 下载。 |
| `rpm`                             | `rpm` 包适合安装在Red Hat、Centos、SLES、OpenSuSE和其他基于RPM的系统上。 RPM 可以从 Elasticsearch 网站或我们的 RPM 存储库下载。 |

## Elasticsearch 容器镜像

还可以在容器映像内运行 Elasticsearch。

| 格式     | 说明                                              |
| -------- | ------------------------------------------------- |
| `docker` | Docker 容器映像可以从 Elastic Docker 注册表下载。 |

## Java (JVM) 版本

Elasticsearch 使用 Java 构建，并在每个发行版中包含来自 JDK 维护者 (GPLv2+CE) 的 [OpenJDK](https://openjdk.java.net) 捆绑版本。捆绑的 JVM 是推荐的 JVM。

要使用自己的 Java 版本，请设置 `ES_JAVA_HOME` 环境变量。如果必须使用与捆绑的 JVM 不同的 Java 版本，则最好使用 [受支持的](https://www.elastic.co/support/matrix)[Java LTS 版本](https://www.oracle.com/technetwork/java/eol-135779.html) 的最新版本。 Elasticsearch 与某些特定于 OpenJDK 的功能紧密耦合，因此它可能无法与其他 JVM 正常工作。如果使用已知错误的 Java 版本，Elasticsearch 将拒绝启动。

If you use a JVM other than the bundled one, you are responsible for reacting to announcements related to its security issues and bug fixes, and must yourself determine whether each update is necessary or not. 如果您使用捆绑的 JVM 以外的 JVM，则您有责任对其安全问题和错误修复相关的公告做出反应，并且必须自行确定每个更新是否有必要。相比之下，捆绑的 JVM  被视为 Elasticsearch 的一个组成部分，这意味着 Elastic 有责任使其保持最新状态。捆绑 JVM 中的安全问题和错误将被视为  Elasticsearch 本身中的问题和错误。

捆绑的 JVM 位于 Elasticsearch 主目录的 `jdk` 子目录中。如果使用自己的 JVM ，可以删除此目录。

## JVM 和 Java 代理

不要使用附加到 JVM 的第三方 Java 代理。These agents can reduce Elasticsearch performance, including freezing or crashing nodes.这些代理会降低 Elasticsearch 性能，包括冻结或崩溃节点。

## 部署选项

要使用 Elasticsearch，需要一个正在运行的 Elasticsearch 服务实例。可以通过多种方式部署 Elasticsearch：

- [**Local dev**](https://www.elastic.co/guide/en/elasticsearch/reference/current/run-elasticsearch-locally.html): Get started quickly with a minimal local Docker setup. 
  [**本地开发**](https://www.elastic.co/guide/en/elasticsearch/reference/current/run-elasticsearch-locally.html)：通过最少的本地 Docker 设置快速入门。
- [**Elastic Cloud**](https://www.elastic.co/guide/en/cloud/current/ec-getting-started-trial.html): Elasticsearch is available as part of our hosted Elastic Stack  offering, deployed in the cloud with your provider of choice. Elasticsearch 作为我们托管的 Elastic Stack 产品的一部分提供，由您选择的提供商部署在云中。注册[14 天免费试用](https://cloud.elastic.co/registration)。
- [**Elastic Cloud Serverless** (技术预览版)](https://docs.elastic.co/serverless/general/sign-up-trial): Create serverless projects for autoscaled and fully managed Elasticsearch deployments. Sign up for a [14-day free trial](https://cloud.elastic.co/serverless-registration). 为自动扩展和完全托管的 Elasticsearch 部署创建无服务器项目。注册[14 天免费试用](https://cloud.elastic.co/serverless-registration)。

**高级部署选项**

- [**Self-managed**](https://www.elastic.co/guide/en/elasticsearch/reference/current/install-elasticsearch.html#elasticsearch-deployment-options)：在自己的场所安装、配置和运行 Elasticsearch。
- [**Elastic Cloud Enterprise**](https://www.elastic.co/guide/en/cloud-enterprise/current/Elastic-Cloud-Enterprise-overview.html)：Deploy Elastic Cloud on public or private clouds, virtual machines, or your own premises. 在公共云或私有云、虚拟机或您自己的场所上部署 Elastic Cloud。
- [**Elastic Cloud on Kubernetes**](https://www.elastic.co/guide/en/cloud-on-k8s/current/k8s-overview.html)： 在 Kubernetes 上部署 Elastic Cloud。

## 在 Docker 中本地运行 Elasticsearch（无安全性）

**DO NOT USE THESE INSTRUCTIONS FOR PRODUCTION DEPLOYMENTS
请勿将这些说明用于生产部署**

此说明**仅适用于本地开发**。不要将这些说明用于生产部署，因为它们不安全。虽然这种方法方便实验和学习，但永远不应该在生产环境中以这种方式运行服务。

以下命令可帮助您快速启动单节点 Elasticsearch 集群以及 Docker 中的 Kibana。请注意，如果不需要 Kibana UI，则可以跳过这些说明。

### 什么时候会使用这个设置？

如果想快速启动 Elasticsearch（和 Kibana）以进行本地开发或测试，请使用此设置。

例如，可能：

- 想要进行快速测试以了解某个功能的工作原理。
- 遵循需要 Elasticsearch 集群的教程或指南。
- Experiment with the Elasticsearch APIs using different tools, like the  Dev Tools Console, cURL, or an Elastic programming language client. 
  使用不同的工具（例如开发工具控制台、cURL 或 Elastic 编程语言客户端）试验 Elasticsearch API 。
- Quickly spin up an Elasticsearch cluster to test an executable [Python notebook](https://github.com/elastic/elasticsearch-labs/tree/main/notebooks#readme) locally. 
  快速启动 Elasticsearch 集群以在本地测试可执行的 [Python 笔记本](https://github.com/elastic/elasticsearch-labs/tree/main/notebooks#readme) 。

### 先决条件

如果您尚未安装 Docker，[请下载并安装适用于您的操作系统的 Docker Desktop](https://www.docker.com/products/docker-desktop) 。

### 设置环境变量

配置以下环境变量：

```bash
export ELASTIC_PASSWORD="<ES_PASSWORD>"   # password for "elastic" username
export KIBANA_PASSWORD="<KIB_PASSWORD>"   # Used _internally_ by Kibana, must be at least 6 characters long
```

### 创建 Docker 网络

To run both Elasticsearch and Kibana, you’ll need to create a Docker network:
要运行 Elasticsearch 和 Kibana，您需要创建一个 Docker 网络：

```sh
docker network create elastic-net
```

### 运行 Elasticsearch

Start the Elasticsearch container with the following command:
使用以下命令启动 Elasticsearch 容器：

```sh
docker run -p 127.0.0.1:9200:9200 -d --name elasticsearch --network elastic-net \
  -e ELASTIC_PASSWORD=$ELASTIC_PASSWORD \
  -e "discovery.type=single-node" \
  -e "xpack.security.http.ssl.enabled=false" \
  -e "xpack.license.self_generated.type=trial" \
  docker.elastic.co/elasticsearch/elasticsearch:8.15.1
```

### 运行 Kibana（可选）

To run Kibana, you must first set the `kibana_system` password in the Elasticsearch container.
要运行 Kibana，您必须首先在 Elasticsearch 容器中设置`kibana_system`密码。

```sh
# configure the Kibana password in the ES container
curl -u elastic:$ELASTIC_PASSWORD \
  -X POST \
  http://localhost:9200/_security/user/kibana_system/_password \
  -d '{"password":"'"$KIBANA_PASSWORD"'"}' \
  -H 'Content-Type: application/json'
```

Start the Kibana container with the following command:
使用以下命令启动 Kibana 容器：

```sh
docker run -p 127.0.0.1:5601:5601 -d --name kibana --network elastic-net \
  -e ELASTICSEARCH_URL=http://elasticsearch:9200 \
  -e ELASTICSEARCH_HOSTS=http://elasticsearch:9200 \
  -e ELASTICSEARCH_USERNAME=kibana_system \
  -e ELASTICSEARCH_PASSWORD=$KIBANA_PASSWORD \
  -e "xpack.security.enabled=false" \
  -e "xpack.license.self_generated.type=trial" \
  docker.elastic.co/kibana/kibana:8.15.1
```

When you access Kibana, use `elastic` as the username and the password you set earlier for the `ELASTIC_PASSWORD` environment variable.
当您访问 Kibana 时，请使用`elastic`作为用户名和您之前为`ELASTIC_PASSWORD`环境变量设置的密码。

The service is started with a trial license. The trial license enables all  features of Elasticsearch for a trial period of 30 days. After the trial period expires, the license is downgraded to a basic license, which is  free forever. If you prefer to skip the trial and use the basic license, set the value of the `xpack.license.self_generated.type` variable to basic instead. For a detailed feature comparison between the different licenses, refer to our [subscriptions page](https://www.elastic.co/subscriptions).
该服务通过试用许可证启动。试用许可证可在 30 天的试用期内启用 Elasticsearch 的所有功能。试用期满后，许可证将降级为基本许可证，永久免费。如果您希望跳过试用并使用基本许可证，请设置 `xpack.license.self_generated.type` 改为基本变量。有关不同许可证之间的详细功能比较，请参阅我们的[订阅页面](https://www.elastic.co/subscriptions)。

### Connecting to Elasticsearch with language clients 使用语言客户端连接到 Elasticsearch

To connect to the Elasticsearch cluster from a language client, you can use basic authentication with the `elastic` username and the password you set in the environment variable.
要从语言客户端连接到 Elasticsearch 集群，您可以使用`elastic`用户名和在环境变量中设置的密码进行基本身份验证。

您将使用以下连接详细信息：

- **Elasticsearch endpoint**: `http://localhost:9200`
  **Elasticsearch 端点**： `http://localhost:9200`
- **Username**: `elastic`
  **用户名**： `elastic`
- **Password**: `$ELASTIC_PASSWORD` (Value you set in the environment variable) 
  **密码**： `$ELASTIC_PASSWORD` （您在环境变量中设置的值）

For example, to connect with the Python `elasticsearch` client:
例如，要连接Python `elasticsearch`客户端：

```python
import os
from elasticsearch import Elasticsearch

username = 'elastic'
password = os.getenv('ELASTIC_PASSWORD') # Value you set in the environment variable

client = Elasticsearch(
    "http://localhost:9200",
    basic_auth=(username, password)
)

print(client.info())
```

Here’s an example curl command using basic authentication:
以下是使用基本身份验证的示例 curl 命令：

```sh
curl -u elastic:$ELASTIC_PASSWORD \
  -X PUT \
  http://localhost:9200/my-new-index \
  -H 'Content-Type: application/json'
```

### Moving to production 转向生产

This setup is not suitable for production use. For production deployments,  we recommend using our managed service on Elastic Cloud. [Sign up for a free trial](https://cloud.elastic.co/registration) (no credit card required).
此设置不适合生产使用。对于生产部署，我们建议使用 Elastic Cloud 上的托管服务。[注册免费试用](https://cloud.elastic.co/registration)（无需信用卡）。

Otherwise, refer to [Install Elasticsearch](https://www.elastic.co/guide/en/elasticsearch/reference/current/install-elasticsearch.html) to learn about the various options for installing Elasticsearch in a  self-managed production environment, including using Docker.
否则，请参阅[安装 Elasticsearch](https://www.elastic.co/guide/en/elasticsearch/reference/current/install-elasticsearch.html)了解在自我管理的生产环境中安装 Elasticsearch 的各种选项，包括使用 Docker。

## Install Elasticsearch from archive on Linux or MacOS 在 Linux 或 MacOS 上从存档安装 Elasticsearch

[edit 编辑](https://github.com/elastic/elasticsearch/edit/8.15/docs/reference/setup/install/targz.asciidoc)

Elasticsearch is available as a `.tar.gz` archive for Linux and MacOS.
Elasticsearch 以适用于 Linux 和 MacOS 的`.tar.gz`存档形式提供。

This package contains both free and subscription features. [Start a 30-day trial](https://www.elastic.co/guide/en/elasticsearch/reference/current/license-settings.html) to try out all of the features.
该软件包包含免费和订阅功能。[开始 30 天试用](https://www.elastic.co/guide/en/elasticsearch/reference/current/license-settings.html)以尝试所有功能。

The latest stable version of Elasticsearch can be found on the [Download Elasticsearch](https://www.elastic.co/downloads/elasticsearch) page. Other versions can be found on the [Past Releases page](https://www.elastic.co/downloads/past-releases).
Elasticsearch 的最新稳定版本可以在[下载 Elasticsearch](https://www.elastic.co/downloads/elasticsearch)页面上找到。其他版本可以在[过去的版本页面](https://www.elastic.co/downloads/past-releases)上找到。

Elasticsearch includes a bundled version of [OpenJDK](https://openjdk.java.net) from the JDK maintainers (GPLv2+CE). To use your own version of Java, see the [JVM version requirements](https://www.elastic.co/guide/en/elasticsearch/reference/current/install-elasticsearch.html#jvm-version)
Elasticsearch 包含来自 JDK 维护者的[OpenJDK](https://openjdk.java.net)捆绑版本 (GPLv2+CE)。要使用您自己的 Java 版本，请参阅[JVM 版本要求](https://www.elastic.co/guide/en/elasticsearch/reference/current/install-elasticsearch.html#jvm-version)

## Download and install archive for Linux 下载并安装适用于 Linux 的存档

[edit 编辑](https://github.com/elastic/elasticsearch/edit/8.15/docs/reference/setup/install/targz.asciidoc)

The Linux archive for Elasticsearch v8.15.1 can be downloaded and installed as follows:
Elasticsearch v8.15.1 的 Linux 存档可以下载并安装，如下所示：

```sh
wget https://artifacts.elastic.co/downloads/elasticsearch/elasticsearch-8.15.1-linux-x86_64.tar.gz
wget https://artifacts.elastic.co/downloads/elasticsearch/elasticsearch-8.15.1-linux-x86_64.tar.gz.sha512
shasum -a 512 -c elasticsearch-8.15.1-linux-x86_64.tar.gz.sha512 
tar -xzf elasticsearch-8.15.1-linux-x86_64.tar.gz
cd elasticsearch-8.15.1/ 
```

|      | Compares the SHA of the downloaded `.tar.gz` archive and the published checksum, which should output `elasticsearch-{version}-linux-x86_64.tar.gz: OK`. 比较下载的`.tar.gz`存档的 SHA 和发布的校验和，应输出 `elasticsearch-{version}-linux-x86_64.tar.gz: OK` 。 |
| ---- | ------------------------------------------------------------ |
|      | This directory is known as `$ES_HOME`. 该目录称为`$ES_HOME` 。 |

## Download and install archive for MacOS 下载并安装适用于 MacOS 的存档

[edit 编辑](https://github.com/elastic/elasticsearch/edit/8.15/docs/reference/setup/install/targz.asciidoc)

## macOS Gatekeeper warnings macOS Gatekeeper 警告

Apple’s rollout of stricter notarization requirements affected the notarization of the 8.15.1 Elasticsearch artifacts. If macOS displays a dialog when  you first run Elasticsearch that interrupts it, then you need to take an action to allow it to run.
Apple 推出更严格的公证要求影响了 8.15.1 Elasticsearch 工件的公证。如果 macOS 在您首次运行 Elasticsearch 时显示一个中断它的对话框，那么您需要采取措施以允许它运行。

To prevent Gatekeeper checks on the Elasticsearch files, run the following command on the downloaded .tar.gz archive or the directory to which was extracted:
要防止 Gatekeeper 检查 Elasticsearch 文件，请对下载的 .tar.gz 存档或解压到的目录运行以下命令：

```sh
xattr -d -r com.apple.quarantine <archive-or-directory>
```

Alternatively, you can add a security override by following the instructions in the *If you want to open an app that hasn’t been notarized or is from an unidentified developer* section of [Safely open apps on your Mac](https://support.apple.com/en-us/HT202491).
或者，您可以按照[在 Mac 上安全打开](https://support.apple.com/en-us/HT202491)*应用程序的如果要打开未经公证或来自身份不明的开发人员*的应用程序部分中的说明添加安全覆盖。

The MacOS archive for Elasticsearch v8.15.1 can be downloaded and installed as follows:
Elasticsearch v8.15.1 的 MacOS 存档可以下载并安装，如下所示：

```sh
curl -O https://artifacts.elastic.co/downloads/elasticsearch/elasticsearch-8.15.1-darwin-x86_64.tar.gz
curl https://artifacts.elastic.co/downloads/elasticsearch/elasticsearch-8.15.1-darwin-x86_64.tar.gz.sha512 | shasum -a 512 -c - 
tar -xzf elasticsearch-8.15.1-darwin-x86_64.tar.gz
cd elasticsearch-8.15.1/ 
```

|      | Compares the SHA of the downloaded `.tar.gz` archive and the published checksum, which should output `elasticsearch-{version}-darwin-x86_64.tar.gz: OK`. 比较下载的`.tar.gz`存档的 SHA 和发布的校验和，应输出 `elasticsearch-{version}-darwin-x86_64.tar.gz: OK` 。 |
| ---- | ------------------------------------------------------------ |
|      | This directory is known as `$ES_HOME`. 该目录称为`$ES_HOME` 。 |

## Enable automatic creation of system indices 启用系统索引的自动创建

[edit 编辑](https://github.com/elastic/elasticsearch/edit/8.15/docs/reference/setup/install/targz.asciidoc)

Some commercial features automatically create indices within Elasticsearch. By default, Elasticsearch is configured to allow automatic index creation, and no additional steps are required. However, if you have disabled automatic index creation in Elasticsearch, you must configure [`action.auto_create_index`](https://www.elastic.co/guide/en/elasticsearch/reference/current/docs-index_.html#index-creation) in `elasticsearch.yml` to allow the commercial features to create the following indices:
一些商业功能会自动在 Elasticsearch 中创建索引。默认情况下，Elasticsearch 配置为允许自动创建索引，无需执行其他步骤。但是，如果您在Elasticsearch中禁用了自动索引创建，则必须在`elasticsearch.yml`中配置[`action.auto_create_index`](https://www.elastic.co/guide/en/elasticsearch/reference/current/docs-index_.html#index-creation)以允许商业功能创建以下索引：

```yaml
action.auto_create_index: .monitoring*,.watches,.triggered_watches,.watcher-history*,.ml*
```

If you are using [Logstash](https://www.elastic.co/products/logstash) or [Beats](https://www.elastic.co/products/beats) then you will most likely require additional index names in your `action.auto_create_index` setting, and the exact value will depend on your local configuration. If you are unsure of the correct value for your environment, you may consider setting the value to `*` which will allow automatic creation of all indices.
如果您使用的是[Logstash](https://www.elastic.co/products/logstash)或[Beats](https://www.elastic.co/products/beats) ，那么您很可能需要在`action.auto_create_index`设置中添加额外的索引名称，确切的值将取决于您的本地配置。如果您不确定您的环境的正确值，您可以考虑将该值设置为`*` ，这将允许自动创建所有索引。

## Run Elasticsearch from the command line 从命令行运行 Elasticsearch

[edit 编辑](https://github.com/elastic/elasticsearch/edit/8.15/docs/reference/setup/install/targz-start.asciidoc)

Run the following command to start Elasticsearch from the command line:
运行以下命令从命令行启动 Elasticsearch：

```sh
./bin/elasticsearch
```

When starting Elasticsearch for the first time, security features are enabled and configured by default. The following security configuration occurs automatically:
首次启动 Elasticsearch 时，默认情况下会启用并配置安全功能。以下安全配置会自动发生：

- Authentication and authorization are enabled, and a password is generated for the `elastic` built-in superuser. 
  启用认证和授权，并为`elastic`内置超级用户生成密码。
- Certificates and keys for TLS are generated for the transport and HTTP layer, and TLS is enabled and configured with these keys and certificates. 
  为传输层和 HTTP 层生成 TLS 的证书和密钥，并使用这些密钥和证书启用和配置 TLS。
- An enrollment token is generated for Kibana, which is valid for 30 minutes. 
  为 Kibana 生成注册令牌，有效期为 30 分钟。

The password for the `elastic` user and the enrollment token for Kibana are output to your terminal.
`elastic`用户的密码和 Kibana 的注册令牌将输出到您的终端。

We recommend storing the `elastic` password as an environment variable in your shell. Example:
我们建议将`elastic`密码存储为 shell 中的环境变量。例子：

```sh
export ELASTIC_PASSWORD="your_password"
```

If you have password-protected the Elasticsearch keystore, you will be prompted to enter the keystore’s password. See [Secure settings](https://www.elastic.co/guide/en/elasticsearch/reference/current/secure-settings.html) for more details.
如果您对 Elasticsearch 密钥库进行了密码保护，系统将提示您输入密钥库的密码。有关更多详细信息，请参阅[安全设置](https://www.elastic.co/guide/en/elasticsearch/reference/current/secure-settings.html)。

By default Elasticsearch prints its logs to the console (`stdout`) and to the `<cluster name>.log` file within the [logs directory](https://www.elastic.co/guide/en/elasticsearch/reference/current/important-settings.html#path-settings). Elasticsearch logs some information while it is starting, but after it has finished initializing it will continue to run in the foreground and won’t log anything further until something happens that is worth recording. While Elasticsearch is running you can interact with it through its HTTP interface which is on port `9200` by default.
默认情况下，Elasticsearch 将其日志打印到控制台 ( `stdout` ) 和`<cluster` [日志目录](https://www.elastic.co/guide/en/elasticsearch/reference/current/important-settings.html#path-settings)中的 name>.log 文件。 Elasticsearch  在启动时会记录一些信息，但在完成初始化后，它将继续在前台运行，并且不会进一步记录任何内容，直到发生值得记录的事情为止。当  Elasticsearch 运行时，您可以通过其 HTTP 接口（默认情况下位于端口`9200`与其进行交互。

To stop Elasticsearch, press `Ctrl-C`.
要停止 Elasticsearch，请按`Ctrl-C` 。

All scripts packaged with Elasticsearch require a version of Bash that supports arrays and assume that Bash is available at `/bin/bash`. As such, Bash should be available at this path either directly or via a symbolic link.
使用 Elasticsearch 打包的所有脚本都需要支持数组的 Bash 版本，并假设 Bash 在`/bin/bash`中可用。因此，Bash 应该可以直接或通过符号链接在此路径上使用。

### Enroll nodes in an existing cluster 在现有集群中注册节点

[edit 编辑](https://github.com/elastic/elasticsearch/edit/8.15/docs/reference/setup/install/targz-start.asciidoc)

When Elasticsearch starts for the first time, the security auto-configuration process binds the HTTP layer to `0.0.0.0`, but only binds the transport layer to localhost. This intended behavior ensures that you can start a single-node cluster with security enabled by default without any additional configuration.
当 Elasticsearch 第一次启动时，安全自动配置过程将 HTTP 层绑定到`0.0.0.0` ，但仅将传输层绑定到 localhost。此预期行为可确保您无需任何其他配置即可启动默认启用安全性的单节点集群。

Before enrolling a new node, additional actions such as binding to an address other than `localhost` or satisfying bootstrap checks are typically necessary in production clusters. During that time, an auto-generated enrollment token could expire, which is why enrollment tokens aren’t generated automatically.
在注册新节点之前，在生产集群中通常需要执行其他操作，例如绑定到`localhost`以外的地址或满足引导检查。在此期间，自动生成的注册令牌可能会过期，这就是注册令牌不会自动生成的原因。

Additionally, only nodes on the same host can join the cluster without additional configuration. If you want nodes from another host to join your cluster, you need to set `transport.host` to a [supported value](https://www.elastic.co/guide/en/elasticsearch/reference/8.15/modules-network.html#network-interface-values) (such as uncommenting the suggested value of `0.0.0.0`), or an IP address that’s bound to an interface where other hosts can reach it. Refer to [transport settings](https://www.elastic.co/guide/en/elasticsearch/reference/8.15/modules-network.html#transport-settings) for more information.
此外，只有同一主机上的节点才能加入集群，无需额外配置。如果您希望其他主机的节点加入您的集群，则需要将`transport.host`设置为[受支持的值](https://www.elastic.co/guide/en/elasticsearch/reference/8.15/modules-network.html#network-interface-values)（例如取消注释建议值`0.0.0.0` ），或者绑定到其他主机可以访问的接口的 IP 地址它。有关详细信息，请参阅[传输设置](https://www.elastic.co/guide/en/elasticsearch/reference/8.15/modules-network.html#transport-settings)。

To enroll new nodes in your cluster, create an enrollment token with the `elasticsearch-create-enrollment-token` tool on any existing node in your cluster. You can then start a new node with the `--enrollment-token` parameter so that it joins an existing cluster.
要在集群中注册新节点，请使用以下命令创建注册令牌 `elasticsearch-create-enrollment-token` 集群中任何现有节点上的工具。然后，您可以使用`--enrollment-token`参数启动一个新节点，以便它加入现有集群。

1. In a separate terminal from where Elasticsearch is running, navigate to the directory where you installed Elasticsearch and run the [`elasticsearch-create-enrollment-token`](https://www.elastic.co/guide/en/elasticsearch/reference/current/create-enrollment-token.html) tool to generate an enrollment token for your new nodes.
   在运行 Elasticsearch 的单独终端中，导航到安装 Elasticsearch 的目录并运行为新节点生成注册令牌的工具。

   ```sh
   bin/elasticsearch-create-enrollment-token -s node
   ```

   Copy the enrollment token, which you’ll use to enroll new nodes with your Elasticsearch cluster.
   复制注册令牌，您将使用该令牌向 Elasticsearch 集群注册新节点。

2. From the installation directory of your new node, start Elasticsearch and pass the enrollment token with the `--enrollment-token` parameter.
   从新节点的安装目录中，启动 Elasticsearch 并使用`--enrollment-token`参数传递注册令牌。

   ```sh
   bin/elasticsearch --enrollment-token <enrollment-token>
   ```

   Elasticsearch automatically generates certificates and keys in the following directory:
   Elasticsearch 自动在以下目录中生成证书和密钥：

   ```sh
   config/certs
   ```

3. Repeat the previous step for any new nodes that you want to enroll. 
   对要注册的任何新节点重复上一步。

## Check that Elasticsearch is running 检查 Elasticsearch 是否正在运行

[edit 编辑](https://github.com/elastic/elasticsearch/edit/8.15/docs/reference/setup/install/check-running.asciidoc)

You can test that your Elasticsearch node is running by sending an HTTPS request to port `9200` on `localhost`:
您可以通过向`localhost`上的端口`9200`发送 HTTPS 请求来测试您的 Elasticsearch 节点是否正在运行：

```sh
curl --cacert $ES_HOME/config/certs/http_ca.crt -u elastic:$ELASTIC_PASSWORD https://localhost:9200 
```

|      | Ensure that you use `https` in your call, or the request will fail. 确保您在调用中使用`https` ，否则请求将失败。   `--cacert`  Path to the generated `http_ca.crt` certificate for the HTTP layer.  为 HTTP 层生成的`http_ca.crt`证书的路径。 |
| ---- | ------------------------------------------------------------ |
|      |                                                              |

The call returns a response like this:
该调用返回如下响应：

```js
{
  "name" : "Cp8oag6",
  "cluster_name" : "elasticsearch",
  "cluster_uuid" : "AT69_T_DTp-1qgIJlatQqA",
  "version" : {
    "number" : "8.15.1",
    "build_type" : "tar",
    "build_hash" : "f27399d",
    "build_flavor" : "default",
    "build_date" : "2016-03-30T09:51:41.449Z",
    "build_snapshot" : false,
    "lucene_version" : "9.11.1",
    "minimum_wire_compatibility_version" : "1.2.3",
    "minimum_index_compatibility_version" : "1.2.3"
  },
  "tagline" : "You Know, for Search"
}
```

Log printing to `stdout` can be disabled using the `-q` or `--quiet` option on the command line.
可以使用命令行上的`-q`或`--quiet`选项禁用日志打印到`stdout` 。

## Run as a daemon 作为守护进程运行

[edit 编辑](https://github.com/elastic/elasticsearch/edit/8.15/docs/reference/setup/install/targz-daemon.asciidoc)

To run Elasticsearch as a daemon, specify `-d` on the command line, and record the process ID in a file using the `-p` option:
要将 Elasticsearch 作为守护进程运行，请在命令行上指定`-d` ，并使用`-p`选项将进程 ID 记录在文件中：

```sh
./bin/elasticsearch -d -p pid
```

If you have password-protected the Elasticsearch keystore, you will be prompted to enter the keystore’s password. See [Secure settings](https://www.elastic.co/guide/en/elasticsearch/reference/current/secure-settings.html) for more details.
如果您对 Elasticsearch 密钥库进行了密码保护，系统将提示您输入密钥库的密码。有关更多详细信息，请参阅[安全设置](https://www.elastic.co/guide/en/elasticsearch/reference/current/secure-settings.html)。

Log messages can be found in the `$ES_HOME/logs/` directory.
日志消息可以在`$ES_HOME/logs/`目录中找到。

To shut down Elasticsearch, kill the process ID recorded in the `pid` file:
要关闭Elasticsearch，请杀死`pid`文件中记录的进程ID：

```sh
pkill -F pid
```

The Elasticsearch `.tar.gz` package does not include the `systemd` module. To manage Elasticsearch as a service, use the [Debian](https://www.elastic.co/guide/en/elasticsearch/reference/current/starting-elasticsearch.html#start-deb) or [RPM](https://www.elastic.co/guide/en/elasticsearch/reference/current/starting-elasticsearch.html#start-rpm) package instead.
Elasticsearch `.tar.gz`包不包含`systemd`模块。要将 Elasticsearch 作为服务进行管理，请改用[Debian](https://www.elastic.co/guide/en/elasticsearch/reference/current/starting-elasticsearch.html#start-deb)或[RPM](https://www.elastic.co/guide/en/elasticsearch/reference/current/starting-elasticsearch.html#start-rpm)软件包。

## Configure Elasticsearch on the command line 在命令行上配置Elasticsearch

[edit 编辑](https://github.com/elastic/elasticsearch/edit/8.15/docs/reference/setup/install/targz.asciidoc)

Elasticsearch loads its configuration from the `$ES_HOME/config/elasticsearch.yml` file by default. The format of this config file is explained in [*Configuring Elasticsearch*](https://www.elastic.co/guide/en/elasticsearch/reference/current/settings.html).
Elasticsearch 从以下位置加载其配置 `$ES_HOME/config/elasticsearch.yml` 默认文件。[*配置 Elasticsearch*](https://www.elastic.co/guide/en/elasticsearch/reference/current/settings.html)中解释了此配置文件的格式。

Any settings that can be specified in the config file can also be specified on the command line, using the `-E` syntax as follows:
可以在配置文件中指定的任何设置也可以在命令行上指定，使用`-E`语法如下：

```sh
./bin/elasticsearch -d -Ecluster.name=my_cluster -Enode.name=node_1
```

Typically, any cluster-wide settings (like `cluster.name`) should be added to the `elasticsearch.yml` config file, while any node-specific settings such as `node.name` could be specified on the command line.
通常，任何集群范围的设置（如`cluster.name` ）都应添加到`elasticsearch.yml`配置文件中，而任何特定于节点的设置（如`node.name`可以在命令行上指定。

## Connect clients to Elasticsearch 将客户端连接到 Elasticsearch

[edit 编辑](https://github.com/elastic/elasticsearch/edit/8.15/docs/reference/setup/install/connect-clients.asciidoc)

When you start Elasticsearch for the first time, TLS is configured automatically for the HTTP layer. A CA certificate is generated and stored on disk at:
当您第一次启动 Elasticsearch 时，会自动为 HTTP 层配置 TLS。生成 CA 证书并将其存储在磁盘上：

```sh
$ES_HOME/config/certs/http_ca.crt
```

The hex-encoded SHA-256 fingerprint of this certificate is also output to the terminal. Any clients that connect to Elasticsearch, such as the [Elasticsearch Clients](https://www.elastic.co/guide/en/elasticsearch/client/index.html), Beats, standalone Elastic Agents, and Logstash must validate that they trust the certificate that Elasticsearch uses for HTTPS. Fleet Server and Fleet-managed Elastic Agents are automatically configured to trust the CA certificate. Other clients can establish trust by using either the fingerprint of the CA certificate or the CA certificate itself.
该证书的十六进制编码的 SHA-256 指纹也会输出到终端。连接到 Elasticsearch 的任何客户端（例如[Elasticsearch 客户端](https://www.elastic.co/guide/en/elasticsearch/client/index.html)、Beats、独立 Elastic Agent 和 Logstash）必须验证它们是否信任 Elasticsearch 用于 HTTPS  的证书。队列服务器和队列管理的 Elastic Agent 会自动配置为信任 CA 证书。其他客户端可以使用 CA 证书的指纹或 CA  证书本身来建立信任。

If the auto-configuration process already completed, you can still obtain the fingerprint of the security certificate. You can also copy the CA certificate to your machine and configure your client to use it.
如果自动配置过程已经完成，您仍然可以获得安全证书的指纹。您还可以将 CA 证书复制到您的计算机并配置您的客户端以使用它。

#### Use the CA fingerprint 使用CA指纹

[edit 编辑](https://github.com/elastic/elasticsearch/edit/8.15/docs/reference/setup/install/connect-clients.asciidoc)

Copy the fingerprint value that’s output to your terminal when Elasticsearch starts, and configure your client to use this fingerprint to establish trust when it connects to Elasticsearch.
复制 Elasticsearch 启动时输出到终端的指纹值，并将客户端配置为在连接到 Elasticsearch 时使用此指纹建立信任。

If the auto-configuration process already completed, you can still obtain the fingerprint of the security certificate by running the following command. The path is to the auto-generated CA certificate for the HTTP layer.
如果自动配置过程已经完成，您仍然可以通过运行以下命令获取安全证书的指纹。该路径是自动生成的 HTTP 层 CA 证书的路径。

```sh
openssl x509 -fingerprint -sha256 -in config/certs/http_ca.crt
```

The command returns the security certificate, including the fingerprint. The `issuer` should be `Elasticsearch security auto-configuration HTTP CA`.
该命令返回安全证书，包括指纹。 `issuer`为 `Elasticsearch security auto-configuration HTTP CA` 。

```sh
issuer= /CN=Elasticsearch security auto-configuration HTTP CA
SHA256 Fingerprint=<fingerprint>
```

#### Use the CA certificate 使用CA证书

[edit 编辑](https://github.com/elastic/elasticsearch/edit/8.15/docs/reference/setup/install/connect-clients.asciidoc)

If your library doesn’t support a method of validating the fingerprint, the auto-generated CA certificate is created in the following directory on each Elasticsearch node:
如果您的库不支持验证指纹的方法，则会在每个 Elasticsearch 节点上的以下目录中创建自动生成的 CA 证书：

```sh
$ES_HOME/config/certs/http_ca.crt
```

Copy the `http_ca.crt` file to your machine and configure your client to use this certificate to establish trust when it connects to Elasticsearch.
将`http_ca.crt`文件复制到您的计算机，并将客户端配置为在连接到 Elasticsearch 时使用此证书建立信任。

## Directory layout of archives 档案目录布局

[edit 编辑](https://github.com/elastic/elasticsearch/edit/8.15/docs/reference/setup/install/targz.asciidoc)

The archive distributions are entirely self-contained. All files and directories are, by default, contained within `$ES_HOME` — the directory created when unpacking the archive.
存档发行版是完全独立的。默认情况下，所有文件和目录都包含在`$ES_HOME`中 - 解压存档时创建的目录。

This is very convenient because you don’t have to create any directories to start using Elasticsearch, and uninstalling Elasticsearch is as easy as removing the `$ES_HOME` directory. However, it is advisable to change the default locations of the config directory, the data directory, and the logs directory so that you do not delete important data later on.
这非常方便，因为您无需创建任何目录即可开始使用 Elasticsearch，并且卸载 Elasticsearch 就像删除`$ES_HOME`目录一样简单。但是，建议更改 config 目录、数据目录和日志目录的默认位置，以免以后删除重要数据。

| Type 类型         | Description 描述                                             | Default Location 默认位置                                    | Setting 环境   |
| ----------------- | ------------------------------------------------------------ | ------------------------------------------------------------ | -------------- |
| **home 家**       | Elasticsearch home directory or `$ES_HOME` Elasticsearch 主目录或`$ES_HOME` | Directory created by unpacking the archive 通过解压存档创建的目录 |                |
| **bin 垃圾桶**    | Binary scripts including `elasticsearch` to start a node    and `elasticsearch-plugin` to install plugins 二进制脚本，包括启动节点的`elasticsearch`和安装插件的`elasticsearch-plugin` | `$ES_HOME/bin`                                               |                |
| **conf 会议**     | Configuration files including `elasticsearch.yml` 配置文件包括`elasticsearch.yml` | `$ES_HOME/config`                                            | `ES_PATH_CONF` |
| **conf 会议**     | Generated TLS keys and certificates for the transport and HTTP layer. 为传输层和 HTTP 层生成 TLS 密钥和证书。 | `$ES_HOME/config/certs`                                      |                |
| **data 数据**     | The location of the data files of each index / shard allocated    on the node. 节点上分配的每个索引/分片的数据文件的位置。 | `$ES_HOME/data`                                              | `path.data`    |
| **logs 日志**     | Log files location. 日志文件位置。                           | `$ES_HOME/logs`                                              | `path.logs`    |
| **plugins 插件**  | Plugin files location. Each plugin will be contained in a subdirectory. 插件文件位置。每个插件都将包含在一个子目录中。 | `$ES_HOME/plugins`                                           |                |
| **repo 回购协议** | Shared file system repository locations. Can hold multiple locations. A file  system repository can be placed in to any subdirectory of any directory  specified here. 共享文件系统存储库位置。可以容纳多个位置。文件系统存储库可以放置在此处指定的任何目录的任何子目录中。 | Not configured 未配置                                        | `path.repo`    |

### Security certificates and keys 安全证书和密钥

[edit 编辑](https://github.com/elastic/elasticsearch/edit/8.15/docs/reference/setup/install/security-files-reference.asciidoc)

When you install Elasticsearch, the following certificates and keys are generated in the Elasticsearch configuration directory, which are used to connect a Kibana instance to your secured Elasticsearch cluster and to encrypt internode communication. The files are listed here for reference.
安装 Elasticsearch 时，会在 Elasticsearch 配置目录中生成以下证书和密钥，用于将 Kibana 实例连接到安全的 Elasticsearch 集群并加密节点间通信。此处列出了这些文件以供参考。

- `http_ca.crt`

  The CA certificate that is used to sign the certificates for the HTTP layer of this Elasticsearch cluster.  用于签署此 Elasticsearch 集群的 HTTP 层证书的 CA 证书。

- `http.p12`

  Keystore that contains the key and certificate for the HTTP layer for this node.  包含此节点的 HTTP 层的密钥和证书的密钥库。

- `transport.p12`

  Keystore that contains the key and certificate for the transport layer for all the nodes in your cluster.  包含集群中所有节点传输层的密钥和证书的密钥库。

`http.p12` and `transport.p12` are password-protected PKCS#12 keystores. Elasticsearch stores the passwords for these keystores as [secure settings](https://www.elastic.co/guide/en/elasticsearch/reference/current/secure-settings.html). To retrieve the passwords so that you can inspect or change the keystore contents, use the [`bin/elasticsearch-keystore`](https://www.elastic.co/guide/en/elasticsearch/reference/current/elasticsearch-keystore.html) tool.
`http.p12`和`transport.p12`是受密码保护的 PKCS#12 密钥库。 Elasticsearch 将这些密钥库的密码存储为[安全设置](https://www.elastic.co/guide/en/elasticsearch/reference/current/secure-settings.html)。要检索密码以便可以检查或更改密钥库内容，请使用[`bin/elasticsearch-keystore`](https://www.elastic.co/guide/en/elasticsearch/reference/current/elasticsearch-keystore.html)工具。

Use the following command to retrieve the password for `http.p12`:
使用以下命令检索`http.p12`的密码：

```sh
bin/elasticsearch-keystore show xpack.security.http.ssl.keystore.secure_password
```

Use the following command to retrieve the password for `transport.p12`:
使用以下命令检索`transport.p12`的密码：

```sh
bin/elasticsearch-keystore show xpack.security.transport.ssl.keystore.secure_password
```

## Next steps 后续步骤

[edit 编辑](https://github.com/elastic/elasticsearch/edit/8.15/docs/reference/setup/install/next-steps.asciidoc)

You now have a test Elasticsearch environment set up. Before you start serious development or go into production with Elasticsearch, you must do some additional setup:
您现在已经设置了一个测试 Elasticsearch 环境。在开始认真开发或使用 Elasticsearch 投入生产之前，您必须执行一些额外的设置：

- Learn how to [configure Elasticsearch](https://www.elastic.co/guide/en/elasticsearch/reference/current/settings.html). 
  了解如何[配置 Elasticsearch](https://www.elastic.co/guide/en/elasticsearch/reference/current/settings.html) 。
- Configure [important Elasticsearch settings](https://www.elastic.co/guide/en/elasticsearch/reference/current/important-settings.html). 
  配置[重要的 Elasticsearch 设置](https://www.elastic.co/guide/en/elasticsearch/reference/current/important-settings.html)。
- Configure [important system settings](https://www.elastic.co/guide/en/elasticsearch/reference/current/system-config.html). 
  配置[重要的系统设置](https://www.elastic.co/guide/en/elasticsearch/reference/current/system-config.html)。

## Install Elasticsearch with .zip on Windows 在 Windows 上使用 .zip 安装 Elasticsearch

[edit 编辑](https://github.com/elastic/elasticsearch/edit/8.15/docs/reference/setup/install/zip-windows.asciidoc)

Elasticsearch can be installed on Windows using the Windows `.zip` archive. This comes with a `elasticsearch-service.bat` command which will setup Elasticsearch to run as a service.
Elasticsearch 可以使用 Windows `.zip`存档安装在 Windows 上。它附带了一个`elasticsearch-service.bat`命令，它将设置 Elasticsearch 作为服务运行。

This package contains both free and subscription features. [Start a 30-day trial](https://www.elastic.co/guide/en/elasticsearch/reference/current/license-settings.html) to try out all of the features.
该软件包包含免费和订阅功能。[开始 30 天试用](https://www.elastic.co/guide/en/elasticsearch/reference/current/license-settings.html)以尝试所有功能。

On Windows the Elasticsearch machine learning feature requires the Microsoft Universal C Runtime library. This is built into Windows 10, Windows Server 2016 and more recent versions of Windows. For older versions of Windows it can be installed via Windows Update, or from a [separate download](https://support.microsoft.com/en-us/help/2999226/update-for-universal-c-runtime-in-windows). If you cannot install the Microsoft Universal C Runtime library you can still use the rest of Elasticsearch if you disable the machine learning feature.
在 Windows 上，Elasticsearch 机器学习功能需要 Microsoft 通用 C 运行时库。它内置于 Windows  10、Windows Server 2016 和更新版本的 Windows 中。对于旧版本的 Windows，可以通过 Windows 更新或[单独下载](https://support.microsoft.com/en-us/help/2999226/update-for-universal-c-runtime-in-windows)进行安装。如果您无法安装 Microsoft 通用 C 运行时库，并且禁用机器学习功能，您仍然可以使用 Elasticsearch 的其余部分。

The latest stable version of Elasticsearch can be found on the [Download Elasticsearch](https://www.elastic.co/downloads/elasticsearch) page. Other versions can be found on the [Past Releases page](https://www.elastic.co/downloads/past-releases).
Elasticsearch 的最新稳定版本可以在[下载 Elasticsearch](https://www.elastic.co/downloads/elasticsearch)页面上找到。其他版本可以在[过去的版本页面](https://www.elastic.co/downloads/past-releases)上找到。

Elasticsearch includes a bundled version of [OpenJDK](https://openjdk.java.net) from the JDK maintainers (GPLv2+CE). To use your own version of Java, see the [JVM version requirements](https://www.elastic.co/guide/en/elasticsearch/reference/current/install-elasticsearch.html#jvm-version)
Elasticsearch 包含来自 JDK 维护者的[OpenJDK](https://openjdk.java.net)捆绑版本 (GPLv2+CE)。要使用您自己的 Java 版本，请参阅[JVM 版本要求](https://www.elastic.co/guide/en/elasticsearch/reference/current/install-elasticsearch.html#jvm-version)

## Download and install the `.zip` package 下载并安装`.zip`包

[edit 编辑](https://github.com/elastic/elasticsearch/edit/8.15/docs/reference/setup/install/zip-windows.asciidoc)

Download the `.zip` archive for Elasticsearch 8.15.1 from: https://artifacts.elastic.co/downloads/elasticsearch/elasticsearch-8.15.1-windows-x86_64.zip
从以下位置下载 Elasticsearch 8.15.1 的`.zip`存档： [https](https://artifacts.elastic.co/downloads/elasticsearch/elasticsearch-8.15.1-windows-x86_64.zip) ://artifacts.elastic.co/downloads/elasticsearch/elasticsearch-8.15.1-windows-x86_64.zip

Unzip it with your favorite unzip tool. This will create a folder called `elasticsearch-8.15.1`, which we will refer to as `%ES_HOME%`. In a terminal window, `cd` to the `%ES_HOME%` directory, for instance:
使用您最喜欢的解压工具将其解压。这将创建一个名为`elasticsearch-8.15.1`的文件夹，我们将其称为`%ES_HOME%` 。在终端窗口中， `cd`到`%ES_HOME%`目录，例如：

```sh
cd C:\Program Files\elasticsearch-8.15.1
```

## Enable automatic creation of system indices 启用系统索引的自动创建

[edit 编辑](https://github.com/elastic/elasticsearch/edit/8.15/docs/reference/setup/install/zip-windows.asciidoc)

Some commercial features automatically create indices within Elasticsearch. By default, Elasticsearch is configured to allow automatic index creation, and no additional steps are required. However, if you have disabled automatic index creation in Elasticsearch, you must configure [`action.auto_create_index`](https://www.elastic.co/guide/en/elasticsearch/reference/current/docs-index_.html#index-creation) in `elasticsearch.yml` to allow the commercial features to create the following indices:
一些商业功能会自动在 Elasticsearch 中创建索引。默认情况下，Elasticsearch 配置为允许自动创建索引，无需执行其他步骤。但是，如果您在Elasticsearch中禁用了自动索引创建，则必须在`elasticsearch.yml`中配置[`action.auto_create_index`](https://www.elastic.co/guide/en/elasticsearch/reference/current/docs-index_.html#index-creation)以允许商业功能创建以下索引：

```yaml
action.auto_create_index: .monitoring*,.watches,.triggered_watches,.watcher-history*,.ml*
```

If you are using [Logstash](https://www.elastic.co/products/logstash) or [Beats](https://www.elastic.co/products/beats) then you will most likely require additional index names in your `action.auto_create_index` setting, and the exact value will depend on your local configuration. If you are unsure of the correct value for your environment, you may consider setting the value to `*` which will allow automatic creation of all indices.
如果您使用的是[Logstash](https://www.elastic.co/products/logstash)或[Beats](https://www.elastic.co/products/beats) ，那么您很可能需要在`action.auto_create_index`设置中添加额外的索引名称，确切的值将取决于您的本地配置。如果您不确定您的环境的正确值，您可以考虑将该值设置为`*` ，这将允许自动创建所有索引。

## Run Elasticsearch from the command line 从命令行运行 Elasticsearch

[edit 编辑](https://github.com/elastic/elasticsearch/edit/8.15/docs/reference/setup/install/zip-windows-start.asciidoc)

Run the following command to start Elasticsearch from the command line:
运行以下命令从命令行启动 Elasticsearch：

```sh
.\bin\elasticsearch.bat
```

When starting Elasticsearch for the first time, security features are enabled and configured by default. The following security configuration occurs automatically:
首次启动 Elasticsearch 时，默认情况下会启用并配置安全功能。以下安全配置会自动发生：

- Authentication and authorization are enabled, and a password is generated for the `elastic` built-in superuser. 
  启用认证和授权，并为`elastic`内置超级用户生成密码。
- Certificates and keys for TLS are generated for the transport and HTTP layer, and TLS is enabled and configured with these keys and certificates. 
  为传输层和 HTTP 层生成 TLS 的证书和密钥，并使用这些密钥和证书启用和配置 TLS。
- An enrollment token is generated for Kibana, which is valid for 30 minutes. 
  为 Kibana 生成注册令牌，有效期为 30 分钟。

The password for the `elastic` user and the enrollment token for Kibana are output to your terminal.
`elastic`用户的密码和 Kibana 的注册令牌将输出到您的终端。

We recommend storing the `elastic` password as an environment variable in your shell. Example:
我们建议将`elastic`密码存储为 shell 中的环境变量。例子：

```sh
$ELASTIC_PASSWORD = "your_password"
```

If you have password-protected the Elasticsearch keystore, you will be prompted to enter the keystore’s password. See [Secure settings](https://www.elastic.co/guide/en/elasticsearch/reference/current/secure-settings.html) for more details.
如果您对 Elasticsearch 密钥库进行了密码保护，系统将提示您输入密钥库的密码。有关更多详细信息，请参阅[安全设置](https://www.elastic.co/guide/en/elasticsearch/reference/current/secure-settings.html)。

By default Elasticsearch prints its logs to the console (`STDOUT`) and to the `<cluster name>.log` file within the [logs directory](https://www.elastic.co/guide/en/elasticsearch/reference/current/important-settings.html#path-settings). Elasticsearch logs some information while it is starting, but after it has finished initializing it will continue to run in the foreground and won’t log anything further until something happens that is worth recording. While Elasticsearch is running you can interact with it through its HTTP interface which is on port `9200` by default.
默认情况下，Elasticsearch 将其日志打印到控制台 ( `STDOUT` ) 和`<cluster` [日志目录](https://www.elastic.co/guide/en/elasticsearch/reference/current/important-settings.html#path-settings)中的 name>.log 文件。 Elasticsearch  在启动时会记录一些信息，但在完成初始化后，它将继续在前台运行，并且不会进一步记录任何内容，直到发生值得记录的事情为止。当  Elasticsearch 运行时，您可以通过其 HTTP 接口（默认情况下位于端口`9200`与其进行交互。

To stop Elasticsearch, press `Ctrl-C`.
要停止 Elasticsearch，请按`Ctrl-C` 。

### Enroll nodes in an existing cluster 在现有集群中注册节点

[edit 编辑](https://github.com/elastic/elasticsearch/edit/8.15/docs/reference/setup/install/zip-windows-start.asciidoc)

When Elasticsearch starts for the first time, the security auto-configuration process binds the HTTP layer to `0.0.0.0`, but only binds the transport layer to localhost. This intended behavior ensures that you can start a single-node cluster with security enabled by default without any additional configuration.
当 Elasticsearch 第一次启动时，安全自动配置过程将 HTTP 层绑定到`0.0.0.0` ，但仅将传输层绑定到 localhost。此预期行为可确保您无需任何其他配置即可启动默认启用安全性的单节点集群。

Before enrolling a new node, additional actions such as binding to an address other than `localhost` or satisfying bootstrap checks are typically necessary in production clusters. During that time, an auto-generated enrollment token could expire, which is why enrollment tokens aren’t generated automatically.
在注册新节点之前，在生产集群中通常需要执行其他操作，例如绑定到`localhost`以外的地址或满足引导检查。在此期间，自动生成的注册令牌可能会过期，这就是注册令牌不会自动生成的原因。

Additionally, only nodes on the same host can join the cluster without additional configuration. If you want nodes from another host to join your cluster, you need to set `transport.host` to a [supported value](https://www.elastic.co/guide/en/elasticsearch/reference/8.15/modules-network.html#network-interface-values) (such as uncommenting the suggested value of `0.0.0.0`), or an IP address that’s bound to an interface where other hosts can reach it. Refer to [transport settings](https://www.elastic.co/guide/en/elasticsearch/reference/8.15/modules-network.html#transport-settings) for more information.
此外，只有同一主机上的节点才能加入集群，无需额外配置。如果您希望其他主机的节点加入您的集群，则需要将`transport.host`设置为[受支持的值](https://www.elastic.co/guide/en/elasticsearch/reference/8.15/modules-network.html#network-interface-values)（例如取消注释建议值`0.0.0.0` ），或者绑定到其他主机可以访问的接口的 IP 地址它。有关详细信息，请参阅[传输设置](https://www.elastic.co/guide/en/elasticsearch/reference/8.15/modules-network.html#transport-settings)。

To enroll new nodes in your cluster, create an enrollment token with the `elasticsearch-create-enrollment-token` tool on any existing node in your cluster. You can then start a new node with the `--enrollment-token` parameter so that it joins an existing cluster.
要在集群中注册新节点，请使用以下命令创建注册令牌 `elasticsearch-create-enrollment-token` 集群中任何现有节点上的工具。然后，您可以使用`--enrollment-token`参数启动一个新节点，以便它加入现有集群。

1. In a separate terminal from where Elasticsearch is running, navigate to the directory where you installed Elasticsearch and run the [`elasticsearch-create-enrollment-token`](https://www.elastic.co/guide/en/elasticsearch/reference/current/create-enrollment-token.html) tool to generate an enrollment token for your new nodes.
   在运行 Elasticsearch 的单独终端中，导航到安装 Elasticsearch 的目录并运行为新节点生成注册令牌的工具。

   ```sh
   bin\elasticsearch-create-enrollment-token -s node
   ```

   Copy the enrollment token, which you’ll use to enroll new nodes with your Elasticsearch cluster.
   复制注册令牌，您将使用该令牌向 Elasticsearch 集群注册新节点。

2. From the installation directory of your new node, start Elasticsearch and pass the enrollment token with the `--enrollment-token` parameter.
   从新节点的安装目录中，启动 Elasticsearch 并使用`--enrollment-token`参数传递注册令牌。

   ```sh
   bin\elasticsearch --enrollment-token <enrollment-token>
   ```

   Elasticsearch automatically generates certificates and keys in the following directory:
   Elasticsearch 自动在以下目录中生成证书和密钥：

   ```sh
   config\certs
   ```

3. Repeat the previous step for any new nodes that you want to enroll. 
   对要注册的任何新节点重复上一步。

## Configure Elasticsearch on the command line 在命令行上配置Elasticsearch

[edit 编辑](https://github.com/elastic/elasticsearch/edit/8.15/docs/reference/setup/install/zip-windows.asciidoc)

Elasticsearch loads its configuration from the `%ES_HOME%\config\elasticsearch.yml` file by default. The format of this config file is explained in [*Configuring Elasticsearch*](https://www.elastic.co/guide/en/elasticsearch/reference/current/settings.html).
Elasticsearch 从以下位置加载其配置 `%ES_HOME%\config\elasticsearch.yml` 默认文件。[*配置 Elasticsearch*](https://www.elastic.co/guide/en/elasticsearch/reference/current/settings.html)中解释了此配置文件的格式。

Any settings that can be specified in the config file can also be specified on the command line, using the `-E` syntax as follows:
可以在配置文件中指定的任何设置也可以在命令行上指定，使用`-E`语法如下：

```sh
.\bin\elasticsearch.bat -Ecluster.name=my_cluster -Enode.name=node_1
```

Values that contain spaces must be surrounded with quotes. For instance `-Epath.logs="C:\My Logs\logs"`.
包含空格的值必须用引号引起来。例如`-Epath.logs="C:\My Logs\logs"` 。

Typically, any cluster-wide settings (like `cluster.name`) should be added to the `elasticsearch.yml` config file, while any node-specific settings such as `node.name` could be specified on the command line.
通常，任何集群范围的设置（如`cluster.name` ）都应添加到`elasticsearch.yml`配置文件中，而任何特定于节点的设置（如`node.name`可以在命令行上指定。

## Check that Elasticsearch is running 检查 Elasticsearch 是否正在运行

[edit 编辑](https://github.com/elastic/elasticsearch/edit/8.15/docs/reference/setup/install/check-running.asciidoc)

You can test that your Elasticsearch node is running by sending an HTTPS request to port `9200` on `localhost`:
您可以通过向`localhost`上的端口`9200`发送 HTTPS 请求来测试您的 Elasticsearch 节点是否正在运行：

```sh
curl --cacert %ES_HOME%\config\certs\http_ca.crt -u elastic:$ELASTIC_PASSWORD https://localhost:9200 
```

|      | Ensure that you use `https` in your call, or the request will fail. 确保您在调用中使用`https` ，否则请求将失败。   `--cacert`  Path to the generated `http_ca.crt` certificate for the HTTP layer.  为 HTTP 层生成的`http_ca.crt`证书的路径。 |
| ---- | ------------------------------------------------------------ |
|      |                                                              |

The call returns a response like this:
该调用返回如下响应：

```js
{
  "name" : "Cp8oag6",
  "cluster_name" : "elasticsearch",
  "cluster_uuid" : "AT69_T_DTp-1qgIJlatQqA",
  "version" : {
    "number" : "8.15.1",
    "build_type" : "tar",
    "build_hash" : "f27399d",
    "build_flavor" : "default",
    "build_date" : "2016-03-30T09:51:41.449Z",
    "build_snapshot" : false,
    "lucene_version" : "9.11.1",
    "minimum_wire_compatibility_version" : "1.2.3",
    "minimum_index_compatibility_version" : "1.2.3"
  },
  "tagline" : "You Know, for Search"
}
```

## Install and run Elasticsearch as a service on Windows 在 Windows 上安装并运行 Elasticsearch 作为服务

[edit 编辑](https://github.com/elastic/elasticsearch/edit/8.15/docs/reference/setup/install/zip-windows.asciidoc)

You can install Elasticsearch as a service that runs in the background or starts automatically at boot time without user interaction.
您可以将 Elasticsearch 安装为在后台运行或在启动时自动启动的服务，无需用户交互。

1. Install Elasticsearch as a service. The name of the service and the value of `ES_JAVA_HOME` will be made available during install:
   将 Elasticsearch 安装为服务。服务的名称和`ES_JAVA_HOME`的值将在安装过程中可用：

   ```sh
   C:\Program Files\elasticsearch-8.15.1\bin>elasticsearch-service.bat install
   Installing service      :  "elasticsearch-service-x64"
   Using ES_JAVA_HOME (64-bit):  "C:\jvm\jdk1.8"
   The service 'elasticsearch-service-x64' has been installed.
   ```

2. Start Elasticsearch as a service. When Elasticsearch starts, authentication is enabled by default:
   将 Elasticsearch 作为服务启动。 Elasticsearch启动时，默认启用身份验证：

   ```sh
   C:\Program Files\elasticsearch-8.15.1\bin>bin\elasticsearch-service.bat start
   ```

   TLS is not enabled or configured when you start Elasticsearch as a service.
   当您将 Elasticsearch 作为服务启动时，未启用或配置 TLS。

3. Generate a password for the `elastic` user with the [`elasticsearch-reset-password`](https://www.elastic.co/guide/en/elasticsearch/reference/current/reset-password.html) tool. The password is output to the command line.
   使用[`elasticsearch-reset-password`](https://www.elastic.co/guide/en/elasticsearch/reference/current/reset-password.html)工具为`elastic`用户生成密码。密码输出到命令行。

   ```sh
   C:\Program Files\elasticsearch-8.15.1\bin>\bin\elasticsearch-reset-password -u elastic
   ```

While a JRE can be used for the Elasticsearch service, due to its use of a client VM (as opposed to a server JVM which offers better performance for long-running applications) its usage is discouraged and a warning will be issued.
虽然 JRE 可用于 Elasticsearch 服务，但由于它使用客户端 VM（而不是为长时间运行的应用程序提供更好性能的服务器 JVM），因此不鼓励使用它，并且会发出警告。

The system environment variable `ES_JAVA_HOME` should be set to the path of the JDK installation that you want the service to use. If you upgrade the JDK, you are not required to the reinstall the service but you must set the value of the system environment variable `ES_JAVA_HOME` to the path to the new JDK installation. However, upgrading across JVM types (e.g. JRE versus SE) is not supported, and does require the service to be reinstalled.
系统环境变量`ES_JAVA_HOME`应设置为您希望服务使用的 JDK 安装路径。如果升级JDK，则不需要重新安装服务，但必须将系统环境变量`ES_JAVA_HOME`的值设置为新JDK安装的路径。但是，不支持跨 JVM 类型（例如 JRE 与 SE）升级，并且需要重新安装服务。

### Manage Elasticsearch as a service on Windows 在 Windows 上将 Elasticsearch 作为服务进行管理

[edit 编辑](https://github.com/elastic/elasticsearch/edit/8.15/docs/reference/setup/install/zip-windows.asciidoc)

Run the `elasticsearch-service.bat` script in the `bin\` folder to install, remove, manage, or configure the service and potentially start and stop the service from the command line.
运行`bin\`文件夹中的`elasticsearch-service.bat`脚本来安装、删除、管理或配置服务，并可能从命令行启动和停止服务。

```sh
C:\Program Files\elasticsearch-8.15.1\bin>elasticsearch-service.bat

Usage: elasticsearch-service.bat install|remove|start|stop|manager [SERVICE_ID]
```

The script requires one parameter (the command to execute), followed by an optional one indicating the service id (useful when installing multiple Elasticsearch services).
该脚本需要一个参数（要执行的命令），后跟一个指示服务 ID 的可选参数（在安装多个 Elasticsearch 服务时很有用）。

The commands available are:
可用的命令有：

| `install` | Install Elasticsearch as a service  将 Elasticsearch 安装为服务 |
| --------- | ------------------------------------------------------------ |
| `remove`  | Remove the installed Elasticsearch service (and stop the service if started)  删除已安装的 Elasticsearch 服务（如果已启动，则停止该服务） |
| `start`   | Start the Elasticsearch service (if installed)  启动 Elasticsearch 服务（如果已安装） |
| `stop`    | Stop the Elasticsearch service (if started)  停止 Elasticsearch 服务（如果已启动） |
| `manager` | Start a GUI for managing the installed service  启动 GUI 来管理已安装的服务 |

## Customize service settings 自定义服务设置

[edit 编辑](https://github.com/elastic/elasticsearch/edit/8.15/docs/reference/setup/install/zip-windows.asciidoc)

The Elasticsearch service can be configured prior to installation by  setting the following environment variables (either using the [set command](https://technet.microsoft.com/en-us/library/cc754250(v=ws.10).aspx) from the command line, or through the **System Properties→Environment Variables** GUI).
可以在安装之前通过设置以下环境变量（使用命令行中的[set 命令](https://technet.microsoft.com/en-us/library/cc754250(v=ws.10).aspx)，或通过**系统属性→环境变量**GUI）来配置 Elasticsearch 服务。

| `SERVICE_ID`           | A unique identifier for the service. Useful if installing multiple instances on the same machine. Defaults to `elasticsearch-service-x64`.  服务的唯一标识符。如果在同一台计算机上安装多个实例，则很有用。默认为`elasticsearch-service-x64` 。 |
| ---------------------- | ------------------------------------------------------------ |
| `SERVICE_USERNAME`     | The user to run as, defaults to the local system account.  运行的用户默认为本地系统帐户。 |
| `SERVICE_PASSWORD`     | The password for the user specified in `%SERVICE_USERNAME%`.  `%SERVICE_USERNAME%`中指定的用户的密码。 |
| `SERVICE_DISPLAY_NAME` | The name of the service. Defaults to `{es} <version> %SERVICE_ID%`.  服务的名称。默认为`{es} <version> %SERVICE_ID%` 。 |
| `SERVICE_DESCRIPTION`  | The description of the service. Defaults to `{es} <version> Windows Service - https://elastic.co`.  服务的描述。默认为 `{es} <version> Windows Service - https://elastic.co` 。 |
| `ES_JAVA_HOME`         | The installation directory of the desired JVM to run the service under.  运行服务所需的 JVM 的安装目录。 |
| `SERVICE_LOG_DIR`      | Service log directory, defaults to `%ES_HOME%\logs`. Note that this does not control the path for the Elasticsearch logs; the path for these is set via the setting `path.logs` in the `elasticsearch.yml` configuration file, or on the command line.  服务日志目录，默认为`%ES_HOME%\logs` 。请注意，这不会控制 Elasticsearch 日志的路径；这些路径是通过`elasticsearch.yml`配置文件中的设置`path.logs`或在命令行上设置的。 |
| `ES_PATH_CONF`         | Configuration file directory (which needs to include `elasticsearch.yml`, `jvm.options`, and `log4j2.properties` files), defaults to `%ES_HOME%\config`.  配置文件目录（需要包含`elasticsearch.yml` 、 `jvm.options`和`log4j2.properties`文件），默认为`%ES_HOME%\config` 。 |
| `ES_JAVA_OPTS`         | Any additional JVM system properties you may want to apply.  您可能想要应用的任何其他 JVM 系统属性。 |
| `ES_START_TYPE`        | Startup mode for the service. Can be either `auto` or `manual` (default).  服务的启动模式。可以是`auto`或`manual` （默认）。 |
| `ES_STOP_TIMEOUT`      | The timeout in seconds that procrun waits for service to exit gracefully. Defaults to `0`.  procrun 等待服务正常退出的超时时间（以秒为单位）。默认为`0` 。 |

At its core, `elasticsearch-service.bat` relies on [Apache Commons Daemon](https://commons.apache.org/proper/commons-daemon/) project to install the service. Environment variables set prior to the service  installation are copied and will be used during the service lifecycle.  This means any changes made to them after the installation will not be  picked up unless the service is reinstalled.
从本质上讲， `elasticsearch-service.bat`依赖于[Apache Commons Daemon](https://commons.apache.org/proper/commons-daemon/)项目来安装服务。复制服务安装之前设置的环境变量并将在服务生命周期中使用。这意味着安装后对它们所做的任何更改都不会生效，除非重新安装服务。

By default, Elasticsearch automatically sizes JVM heap based on a node’s [roles](https://www.elastic.co/guide/en/elasticsearch/reference/current/modules-node.html#node-roles) and total memory. We recommend this default sizing for most production environments. If needed, you can override default sizing by manually setting the heap size.
默认情况下，Elasticsearch 根据节点的[角色](https://www.elastic.co/guide/en/elasticsearch/reference/current/modules-node.html#node-roles)和总内存自动调整 JVM 堆的大小。我们建议大多数生产环境使用此默认大小。如果需要，您可以通过手动设置堆大小来覆盖默认大小。

When installing Elasticsearch on Windows as a service for the first time or running Elasticsearch from the command line, you can manually [Set the JVM heap size](https://www.elastic.co/guide/en/elasticsearch/reference/current/advanced-configuration.html#set-jvm-heap-size). To resize the heap for an already installed service, use the service manager: `bin\elasticsearch-service.bat manager`.
首次在 Windows 上将 Elasticsearch 作为服务安装或从命令行运行 Elasticsearch 时，您可以手动[设置 JVM 堆大小](https://www.elastic.co/guide/en/elasticsearch/reference/current/advanced-configuration.html#set-jvm-heap-size)。要调整已安装服务的堆大小，请使用服务管理器： `bin\elasticsearch-service.bat manager` 。

The service automatically configures a private temporary directory for use by Elasticsearch when it is running. This private temporary directory is configured as a sub-directory of the private temporary directory for the user running the installation. If the service will run under a different user, you can configure the location of the temporary directory that the service should use by setting the environment variable `ES_TMPDIR` to the preferred location before you execute the service installation.
该服务会自动配置一个私有临时目录，供 Elasticsearch 在运行时使用。此私有临时目录被配置为运行安装的用户的私有临时目录的子目录。如果服务将在不同用户下运行，您可以在执行服务安装之前通过将环境变量`ES_TMPDIR`设置为首选位置来配置服务应使用的临时目录的位置。

- Using the Manager GUI 使用管理器 GUI

  It is also possible to configure the service after it’s been installed using the manager GUI (`elasticsearch-service-mgr.exe`), which offers insight into the installed service, including its status,  startup type, JVM, start and stop settings amongst other things. Invoke `elasticsearch-service.bat manager` from the command-line to open the manager window.  还可以在安装后使用管理器 GUI ( `elasticsearch-service-mgr.exe` ) 配置服务，它可以深入了解已安装的服务，包括其状态、启动类型、JVM、启动和停止设置等。调用 `elasticsearch-service.bat manager` 从命令行打开管理器窗口。

Most changes (like JVM settings) made through the manager GUI will require a restart of the service to take affect.
通过管理器 GUI 进行的大多数更改（例如 JVM 设置）都需要重新启动服务才能生效。

## Connect clients to Elasticsearch 将客户端连接到 Elasticsearch

[edit 编辑](https://github.com/elastic/elasticsearch/edit/8.15/docs/reference/setup/install/connect-clients.asciidoc)

When you start Elasticsearch for the first time, TLS is configured automatically for the HTTP layer. A CA certificate is generated and stored on disk at:
当您第一次启动 Elasticsearch 时，会自动为 HTTP 层配置 TLS。生成 CA 证书并将其存储在磁盘上：

```sh
%ES_HOME%\config\certs\http_ca.crt
```

The hex-encoded SHA-256 fingerprint of this certificate is also output to the terminal. Any clients that connect to Elasticsearch, such as the [Elasticsearch Clients](https://www.elastic.co/guide/en/elasticsearch/client/index.html), Beats, standalone Elastic Agents, and Logstash must validate that they trust the certificate that Elasticsearch uses for HTTPS. Fleet Server and Fleet-managed Elastic Agents are automatically configured to trust the CA certificate. Other clients can establish trust by using either the fingerprint of the CA certificate or the CA certificate itself.
该证书的十六进制编码的 SHA-256 指纹也会输出到终端。连接到 Elasticsearch 的任何客户端（例如[Elasticsearch 客户端](https://www.elastic.co/guide/en/elasticsearch/client/index.html)、Beats、独立 Elastic Agent 和 Logstash）必须验证它们是否信任 Elasticsearch 用于 HTTPS  的证书。队列服务器和队列管理的 Elastic Agent 会自动配置为信任 CA 证书。其他客户端可以使用 CA 证书的指纹或 CA  证书本身来建立信任。

If the auto-configuration process already completed, you can still obtain the fingerprint of the security certificate. You can also copy the CA certificate to your machine and configure your client to use it.
如果自动配置过程已经完成，您仍然可以获得安全证书的指纹。您还可以将 CA 证书复制到您的计算机并配置您的客户端以使用它。

#### Use the CA fingerprint 使用CA指纹

[edit 编辑](https://github.com/elastic/elasticsearch/edit/8.15/docs/reference/setup/install/connect-clients.asciidoc)

Copy the fingerprint value that’s output to your terminal when Elasticsearch starts, and configure your client to use this fingerprint to establish trust when it connects to Elasticsearch.
复制 Elasticsearch 启动时输出到终端的指纹值，并将客户端配置为在连接到 Elasticsearch 时使用此指纹建立信任。

If the auto-configuration process already completed, you can still obtain the fingerprint of the security certificate by running the following command. The path is to the auto-generated CA certificate for the HTTP layer.
如果自动配置过程已经完成，您仍然可以通过运行以下命令获取安全证书的指纹。该路径是自动生成的 HTTP 层 CA 证书的路径。

```sh
openssl x509 -fingerprint -sha256 -in config/certs/http_ca.crt
```

The command returns the security certificate, including the fingerprint. The `issuer` should be `Elasticsearch security auto-configuration HTTP CA`.
该命令返回安全证书，包括指纹。 `issuer`为 `Elasticsearch security auto-configuration HTTP CA` 。

```sh
issuer= /CN=Elasticsearch security auto-configuration HTTP CA
SHA256 Fingerprint=<fingerprint>
```

#### Use the CA certificate 使用CA证书

[edit 编辑](https://github.com/elastic/elasticsearch/edit/8.15/docs/reference/setup/install/connect-clients.asciidoc)

If your library doesn’t support a method of validating the fingerprint, the auto-generated CA certificate is created in the following directory on each Elasticsearch node:
如果您的库不支持验证指纹的方法，则会在每个 Elasticsearch 节点上的以下目录中创建自动生成的 CA 证书：

```sh
%ES_HOME%\config\certs\http_ca.crt
```

Copy the `http_ca.crt` file to your machine and configure your client to use this certificate to establish trust when it connects to Elasticsearch.
将`http_ca.crt`文件复制到您的计算机，并将客户端配置为在连接到 Elasticsearch 时使用此证书建立信任。

## Directory layout of `.zip` archive `.zip`存档的目录布局

[edit 编辑](https://github.com/elastic/elasticsearch/edit/8.15/docs/reference/setup/install/zip-windows.asciidoc)

The `.zip` package is entirely self-contained. All files and directories are, by default, contained within `%ES_HOME%` — the directory created when unpacking the archive.
`.zip`包是完全独立的。默认情况下，所有文件和目录都包含在`%ES_HOME%`中 - 解压存档时创建的目录。

This is very convenient because you don’t have to create any directories to start using Elasticsearch, and uninstalling Elasticsearch is as easy as removing the `%ES_HOME%` directory. However, it is advisable to change the default locations of the config directory, the data directory, and the logs directory so that you do not delete important data later on.
这非常方便，因为您无需创建任何目录即可开始使用 Elasticsearch，并且卸载 Elasticsearch 就像删除`%ES_HOME%`目录一样简单。但是，建议更改 config 目录、数据目录和日志目录的默认位置，以免以后删除重要数据。

| Type 类型         | Description 描述                                             | Default Location 默认位置                                    | Setting 环境   |
| ----------------- | ------------------------------------------------------------ | ------------------------------------------------------------ | -------------- |
| **home 家**       | Elasticsearch home directory or `%ES_HOME%` Elasticsearch 主目录或`%ES_HOME%` | Directory created by unpacking the archive 通过解压存档创建的目录 |                |
| **bin 垃圾桶**    | Binary scripts including `elasticsearch` to start a node    and `elasticsearch-plugin` to install plugins 二进制脚本，包括启动节点的`elasticsearch`和安装插件的`elasticsearch-plugin` | `%ES_HOME%\bin`                                              |                |
| **conf 会议**     | Configuration files including `elasticsearch.yml` 配置文件包括`elasticsearch.yml` | `%ES_HOME%\config`                                           | `ES_PATH_CONF` |
| **conf 会议**     | Generated TLS keys and certificates for the transport and HTTP layer. 为传输层和 HTTP 层生成 TLS 密钥和证书。 | `%ES_HOME%\config\certs`                                     |                |
| **data 数据**     | The location of the data files of each index / shard allocated    on the node. 节点上分配的每个索引/分片的数据文件的位置。 | `%ES_HOME%\data`                                             | `path.data`    |
| **logs 日志**     | Log files location. 日志文件位置。                           | `%ES_HOME%\logs`                                             | `path.logs`    |
| **plugins 插件**  | Plugin files location. Each plugin will be contained in a subdirectory. 插件文件位置。每个插件都将包含在一个子目录中。 | `%ES_HOME%\plugins`                                          |                |
| **repo 回购协议** | Shared file system repository locations. Can hold multiple locations. A file  system repository can be placed in to any subdirectory of any directory  specified here. 共享文件系统存储库位置。可以容纳多个位置。文件系统存储库可以放置在此处指定的任何目录的任何子目录中。 | Not configured 未配置                                        | `path.repo`    |

## Next steps 后续步骤

[edit 编辑](https://github.com/elastic/elasticsearch/edit/8.15/docs/reference/setup/install/next-steps.asciidoc)

You now have a test Elasticsearch environment set up. Before you start serious development or go into production with Elasticsearch, you must do some additional setup:
您现在已经设置了一个测试 Elasticsearch 环境。在开始认真开发或使用 Elasticsearch 投入生产之前，您必须执行一些额外的设置：

- Learn how to [configure Elasticsearch](https://www.elastic.co/guide/en/elasticsearch/reference/current/settings.html). 
  了解如何[配置 Elasticsearch](https://www.elastic.co/guide/en/elasticsearch/reference/current/settings.html) 。
- Configure [important Elasticsearch settings](https://www.elastic.co/guide/en/elasticsearch/reference/current/important-settings.html). 
  配置[重要的 Elasticsearch 设置](https://www.elastic.co/guide/en/elasticsearch/reference/current/important-settings.html)。
- Configure [important system settings](https://www.elastic.co/guide/en/elasticsearch/reference/current/system-config.html). 
  配置[重要的系统设置](https://www.elastic.co/guide/en/elasticsearch/reference/current/system-config.html)。

## 使用 Debian 软件包安装

Elasticsearch 的 Debian 软件包可以[从我们的网站](https://www.elastic.co/guide/en/elasticsearch/reference/current/deb.html#install-deb)或我们的[APT 存储库](https://www.elastic.co/guide/en/elasticsearch/reference/current/deb.html#deb-repo)下载。它可用于在任何基于 Debian 的系统（例如 Debian 和 Ubuntu）上安装 Elasticsearch。

软件包包含免费和订阅功能。[开始 30 天试用](https://www.elastic.co/guide/en/elasticsearch/reference/current/license-settings.html)以尝试所有功能。

### 导入 Elasticsearch PGP 密钥

We sign all of our packages with the Elasticsearch Signing Key (PGP key [D88E42B4](https://pgp.mit.edu/pks/lookup?op=vindex&search=0xD27D666CD88E42B4), available from https://pgp.mit.edu) with fingerprint:
使用 Elasticsearch 签名密钥（PGP 密钥 [D88E42B4](https://pgp.mit.edu/pks/lookup?op=vindex&search=0xD27D666CD88E42B4) ，可从 https://pgp.mit.edu 获取）和指纹对所有包进行签名：

```bash
4609 5ACC 8548 582C 1A26 99A9 D27D 666C D88E 42B4
```

下载并安装公共签名密钥：

```bash
wget -qO - https://artifacts.elastic.co/GPG-KEY-elasticsearch | sudo gpg --dearmor -o /usr/share/keyrings/elasticsearch-keyring.gpg
```

### 从 APT 存储库安装

在继续之前，可能需要在 Debian 上安装 `apt-transport-https` 软件包：

```bash
sudo apt-get install apt-transport-https
```

将存储库定义保存到 `/etc/apt/sources.list.d/elastic-8.x.list` :

```bash
echo "deb [signed-by=/usr/share/keyrings/elasticsearch-keyring.gpg] https://artifacts.elastic.co/packages/8.x/apt stable main" | sudo tee /etc/apt/sources.list.d/elastic-8.x.list
```

不使用 `add-apt-repository` 有几个原因：

1. `add-apt-repository` adds entries to the system `/etc/apt/sources.list` file rather than a clean per-repository file in `/etc/apt/sources.list.d`
   `add-apt-repository`将条目添加到系统`/etc/apt/sources.list`文件中，而不是`/etc/apt/sources.list.d`中的干净的每个存储库文件中

2. `add-apt-repository` is not part of the default install on many distributions and requires a number of non-default dependencies. 
   `add-apt-repository`不是许多发行版上默认安装的一部分，并且需要许多非默认依赖项。

3. Older versions of `add-apt-repository` always add a `deb-src` entry which will cause errors because we do not provide a source package. If you have added the `deb-src` entry, you will see an error like the following until you delete the `deb-src` line:
   旧版本的`add-apt-repository`总是添加`deb-src`条目，这会导致错误，因为我们不提供源码包。如果您已添加`deb-src`条目，您将看到类似以下的错误，直到删除`deb-src`行：

   ```bash
   Unable to find expected entry 'main/source/Sources' in Release file
   (Wrong sources.list entry or malformed file)
   ```

可以使用以下命令安装 Elasticsearch Debian 软件包：

```bash
sudo apt-get update && sudo apt-get install elasticsearch
```

如果同一个 Elasticsearch 存储库存在两个条目，将在 `apt-get update` 期间看到如下错误：

```
Duplicate sources.list entry https://artifacts.elastic.co/packages/8.x/apt/ ...`
```

Examine `/etc/apt/sources.list.d/elasticsearch-8.x.list` for the duplicate entry or locate the duplicate entry amongst the files in `/etc/apt/sources.list.d/` and the `/etc/apt/sources.list` file.
检查 `/etc/apt/sources.list.d/elasticsearch-8.x.list` 查找重复条目，或在 `/etc/apt/sources.list.d/` 和 `/etc/apt/sources.list` 文件中的文件中找到重复条目。

On systemd-based distributions, the installation scripts will attempt to set kernel parameters (e.g., `vm.max_map_count`); you can skip this by masking the systemd-sysctl.service unit.
在基于 systemd 的发行版上，安装脚本将尝试设置内核参数（例如 `vm.max_map_count` ）；可以通过屏蔽 systemd-sysctl.service 单元来跳过此步骤。

### 手动下载并安装

Elasticsearch v8.15.1 的 Debian 软件包可以从网站下载并安装，如下所示：

```bash
wget https://artifacts.elastic.co/downloads/elasticsearch/elasticsearch-8.15.1-amd64.deb
wget https://artifacts.elastic.co/downloads/elasticsearch/elasticsearch-8.15.1-amd64.deb.sha512
shasum -a 512 -c elasticsearch-8.15.1-amd64.deb.sha512 
sudo dpkg -i elasticsearch-8.15.1-amd64.deb
```

Compares the SHA of the downloaded Debian package and the published checksum, which should output `elasticsearch-{version}-amd64.deb: OK`. 比较下载的 Debian 软件包的 SHA 和发布的校验和，应该输出 `elasticsearch-{version}-amd64.deb: OK` 。

### 启动 Elasticsearch 并启用安全性

安装 Elasticsearch 时，默认启用并配置安全功能。安装 Elasticsearch 时，会自动进行以下安全配置：

- 启用认证和授权，并为 `elastic` 内置超级用户生成密码。
- Certificates and keys for TLS are generated for the transport and HTTP layer, and TLS is enabled and configured with these keys and certificates. 
  为传输层和 HTTP 层生成 TLS 的证书和密钥，并使用这些密钥和证书启用和配置 TLS。

The password and certificate and keys are output to your terminal. You can reset the password for the `elastic` user with the [`elasticsearch-reset-password`](https://www.elastic.co/guide/en/elasticsearch/reference/current/reset-password.html) command.
密码、证书和密钥将输出到您的终端。您可以使用 [`elasticsearch-reset-password`](https://www.elastic.co/guide/en/elasticsearch/reference/current/reset-password.html) 命令重置 `elastic` 用户的密码。

We recommend storing the `elastic` password as an environment variable in your shell. For example:
我们建议将`elastic`密码存储为 shell 中的环境变量。例如：

```sh
export ELASTIC_PASSWORD="your_password"
```

### 重新配置节点以加入现有集群

When you install Elasticsearch, the installation process configures a single-node cluster by default. If you want a node to join an existing cluster instead, generate an enrollment token on an existing node *before* you start the new node for the first time.
安装 Elasticsearch 时，安装过程默认配置单节点集群。如果您希望节点加入现有集群，请在首次启动新节点*之前*在现有节点上生成注册令牌。

1. On any node in your existing cluster, generate a node enrollment token:
   在现有集群中的任何节点上，生成节点注册令牌：

   ```sh
   /usr/share/elasticsearch/bin/elasticsearch-create-enrollment-token -s node
   ```

2. Copy the enrollment token, which is output to your terminal. 
   复制注册令牌，该令牌将输出到您的终端。

3. On your new Elasticsearch node, pass the enrollment token as a parameter to the `elasticsearch-reconfigure-node` tool:
   在新的 Elasticsearch 节点上，将注册令牌作为参数传递给 `elasticsearch-reconfigure-node` 工具：

   ```sh
   /usr/share/elasticsearch/bin/elasticsearch-reconfigure-node --enrollment-token <enrollment-token>
   ```

   Elasticsearch is now configured to join the existing cluster.
   Elasticsearch 现在已配置为加入现有集群。

4. [Start your new node using `systemd`](https://www.elastic.co/guide/en/elasticsearch/reference/current/deb.html#deb-running-systemd). 
   [使用`systemd`启动新节点](https://www.elastic.co/guide/en/elasticsearch/reference/current/deb.html#deb-running-systemd)。

### Enable automatic creation of system indices 启用系统索引的自动创建

[edit 编辑](https://github.com/elastic/elasticsearch/edit/8.15/docs/reference/setup/install/deb.asciidoc)

Some commercial features automatically create indices within Elasticsearch. By default, Elasticsearch is configured to allow automatic index creation, and no additional steps are required. However, if you have disabled automatic index creation in Elasticsearch, you must configure [`action.auto_create_index`](https://www.elastic.co/guide/en/elasticsearch/reference/current/docs-index_.html#index-creation) in `elasticsearch.yml` to allow the commercial features to create the following indices:
一些商业功能会自动在 Elasticsearch 中创建索引。默认情况下，Elasticsearch 配置为允许自动创建索引，无需执行其他步骤。但是，如果您在Elasticsearch中禁用了自动索引创建，则必须在`elasticsearch.yml`中配置[`action.auto_create_index`](https://www.elastic.co/guide/en/elasticsearch/reference/current/docs-index_.html#index-creation)以允许商业功能创建以下索引：

```yaml
action.auto_create_index: .monitoring*,.watches,.triggered_watches,.watcher-history*,.ml*
```

If you are using [Logstash](https://www.elastic.co/products/logstash) or [Beats](https://www.elastic.co/products/beats) then you will most likely require additional index names in your `action.auto_create_index` setting, and the exact value will depend on your local configuration. If you are unsure of the correct value for your environment, you may consider setting the value to `*` which will allow automatic creation of all indices.
如果您使用的是[Logstash](https://www.elastic.co/products/logstash)或[Beats](https://www.elastic.co/products/beats) ，那么您很可能需要在`action.auto_create_index`设置中添加额外的索引名称，确切的值将取决于您的本地配置。如果您不确定您的环境的正确值，您可以考虑将该值设置为`*` ，这将允许自动创建所有索引。

### 使用 `systemd` 运行 Elasticsearch

要将 Elasticsearch 配置为在系统启动时自动启动，请运行以下命令：

```sh
sudo /bin/systemctl daemon-reload
sudo /bin/systemctl enable elasticsearch.service
```

Elasticsearch 可以按如下方式启动和停止：

```sh
sudo systemctl start elasticsearch.service
sudo systemctl stop elasticsearch.service
```

这些命令不提供有关 Elasticsearch 是否成功启动的反馈。相反，此信息将写入位于`/var/log/elasticsearch/`日志文件中。

If you have password-protected your Elasticsearch keystore, you will need to provide `systemd` with the keystore password using a local file and systemd environment variables. This local file should be protected while it exists and may be safely deleted once Elasticsearch is up and running.
如果您的 Elasticsearch 密钥库受密码保护，则需要使用本地文件和 systemd 环境变量向`systemd`提供密钥库密码。该本地文件在存在时应受到保护，并且一旦 Elasticsearch 启动并运行即可安全删除。

```sh
echo "keystore_password" > /path/to/my_pwd_file.tmp
chmod 600 /path/to/my_pwd_file.tmp
sudo systemctl set-environment ES_KEYSTORE_PASSPHRASE_FILE=/path/to/my_pwd_file.tmp
sudo systemctl start elasticsearch.service
```

By default the Elasticsearch service doesn’t log information in the `systemd` journal. To enable `journalctl` logging, the `--quiet` option must be removed from the `ExecStart` command line in the `elasticsearch.service` file.
默认情况下，Elasticsearch 服务不会在`systemd`日志中记录信息。要启用`journalctl`日志记录，必须从`elasticsearch.service`文件中的`ExecStart`命令行中删除`--quiet`选项。

When `systemd` logging is enabled, the logging information are available using the `journalctl` commands:
启用`systemd`日志记录后，可以使用`journalctl`命令获取日志记录信息：

To tail the journal: 跟踪日志：

```sh
sudo journalctl -f
```

To list journal entries for the elasticsearch service:
列出 elasticsearch 服务的日志条目：

```sh
sudo journalctl --unit elasticsearch
```

To list journal entries for the elasticsearch service starting from a given time:
列出从给定时间开始的 elasticsearch 服务的日志条目：

```sh
sudo journalctl --unit elasticsearch --since  "2016-10-30 18:17:16"
```

Check `man journalctl` or https://www.freedesktop.org/software/systemd/man/journalctl.html for more command line options.
检查`man journalctl`或https://www.freedesktop.org/software/systemd/man/journalctl.html了解更多命令行选项。

### Startup timeouts with older `systemd` versions 较旧的`systemd`版本的启动超时

By default Elasticsearch sets the `TimeoutStartSec` parameter to `systemd` to `900s`. If you are running at least version 238 of `systemd` then Elasticsearch can automatically extend the startup timeout, and will do so repeatedly until startup is complete even if it takes longer than 900s.
默认情况下，Elasticsearch 将`systemd` `TimeoutStartSec`参数设置为`900s` 。如果您运行的`systemd`版本至少为 238，那么 Elasticsearch 可以自动延长启动超时，并且会重复执行此操作，直到启动完成，即使需要的时间超过 900 秒。

Versions of `systemd` prior to 238 do not support the timeout extension mechanism and will terminate the Elasticsearch process if it has not fully started up within the configured timeout. If this happens, Elasticsearch will report in its logs that it was shut down normally a short time after it started:
238 之前的`systemd`版本不支持超时扩展机制，如果 Elasticsearch 进程在配置的超时时间内未完全启动，则会终止 Elasticsearch 进程。如果发生这种情况，Elasticsearch 将在其日志中报告它在启动后不久就正常关闭：

```text
[2022-01-31T01:22:31,077][INFO ][o.e.n.Node               ] [instance-0000000123] starting ...
...
[2022-01-31T01:37:15,077][INFO ][o.e.n.Node               ] [instance-0000000123] stopping ...
```

However the `systemd` logs will report that the startup timed out:
但是`systemd`日志会报告启动超时：

```text
Jan 31 01:22:30 debian systemd[1]: Starting Elasticsearch...
Jan 31 01:37:15 debian systemd[1]: elasticsearch.service: Start operation timed out. Terminating.
Jan 31 01:37:15 debian systemd[1]: elasticsearch.service: Main process exited, code=killed, status=15/TERM
Jan 31 01:37:15 debian systemd[1]: elasticsearch.service: Failed with result 'timeout'.
Jan 31 01:37:15 debian systemd[1]: Failed to start Elasticsearch.
```

To avoid this, upgrade your `systemd` to at least version 238. You can also temporarily work around the problem by extending the `TimeoutStartSec` parameter.
为了避免这种情况，请将您的`systemd`至少升级到版本 238。您还可以通过扩展`TimeoutStartSec`参数来临时解决该问题。

### 检查 Elasticsearch 是否正在运行

可以通过向 `localhost` 上的端口 `9200` 发送 HTTPS 请求来测试 Elasticsearch 节点是否正在运行：

```sh
curl --cacert /etc/elasticsearch/certs/http_ca.crt -u elastic:$ELASTIC_PASSWORD https://localhost:9200 
```

Ensure that you use `https` in your call, or the request will fail. 确保您在调用中使用`https` ，否则请求将失败。   `--cacert`  Path to the generated `http_ca.crt` certificate for the HTTP layer.  为 HTTP 层生成的`http_ca.crt`证书的路径。

The call returns a response like this:
该调用返回如下响应：

```js
{
  "name" : "Cp8oag6",
  "cluster_name" : "elasticsearch",
  "cluster_uuid" : "AT69_T_DTp-1qgIJlatQqA",
  "version" : {
    "number" : "8.15.1",
    "build_type" : "tar",
    "build_hash" : "f27399d",
    "build_flavor" : "default",
    "build_date" : "2016-03-30T09:51:41.449Z",
    "build_snapshot" : false,
    "lucene_version" : "9.11.1",
    "minimum_wire_compatibility_version" : "1.2.3",
    "minimum_index_compatibility_version" : "1.2.3"
  },
  "tagline" : "You Know, for Search"
}
```

### 配置 Elasticsearch

The `/etc/elasticsearch` directory contains the default runtime configuration for Elasticsearch. The ownership of this directory and all contained files are set to `root:elasticsearch` on package installations.
`/etc/elasticsearch`目录包含 Elasticsearch 的默认运行时配置。该目录和所有包含的文件的所有权在软件包安装时设置为`root:elasticsearch` 。

The `setgid` flag applies group permissions on the `/etc/elasticsearch` directory to ensure that Elasticsearch can read any contained files and subdirectories. All files and subdirectories inherit the `root:elasticsearch` ownership. Running commands from this directory or any subdirectories, such as the [elasticsearch-keystore tool](https://www.elastic.co/guide/en/elasticsearch/reference/current/secure-settings.html), requires `root:elasticsearch` permissions.
`setgid`标志对`/etc/elasticsearch`目录应用组权限，以确保 Elasticsearch 可以读取任何包含的文件和子目录。所有文件和子目录都继承`root:elasticsearch`所有权。从此目录或任何子目录运行命令（例如[elasticsearch-keystore tool](https://www.elastic.co/guide/en/elasticsearch/reference/current/secure-settings.html) ）需要`root:elasticsearch`权限。

Elasticsearch loads its configuration from the `/etc/elasticsearch/elasticsearch.yml` file by default. The format of this config file is explained in [*Configuring Elasticsearch*](https://www.elastic.co/guide/en/elasticsearch/reference/current/settings.html).
Elasticsearch 从以下位置加载其配置 `/etc/elasticsearch/elasticsearch.yml` 默认文件。[*配置 Elasticsearch*](https://www.elastic.co/guide/en/elasticsearch/reference/current/settings.html)中解释了此配置文件的格式。

The Debian package also has a system configuration file (`/etc/default/elasticsearch`), which allows you to set the following parameters:
Debian 软件包还有一个系统配置文件 ( `/etc/default/elasticsearch` )，它允许您设置以下参数：

| `ES_JAVA_HOME`       | Set a custom Java path to be used.  设置要使用的自定义 Java 路径。 |
| -------------------- | ------------------------------------------------------------ |
| `ES_PATH_CONF`       | Configuration file directory (which needs to include `elasticsearch.yml`, `jvm.options`, and `log4j2.properties` files); defaults to `/etc/elasticsearch`.  配置文件目录（需要包含`elasticsearch.yml` 、 `jvm.options` 、 `log4j2.properties`文件）；默认为`/etc/elasticsearch` 。 |
| `ES_JAVA_OPTS`       | Any additional JVM system properties you may want to apply.  您可能想要应用的任何其他 JVM 系统属性。 |
| `RESTART_ON_UPGRADE` | Configure restart on package upgrade, defaults to `false`. This means you will have to restart your Elasticsearch instance after installing a package manually. The reason for this is to ensure, that upgrades in a cluster do not result in a continuous shard reallocation resulting in high network traffic and reducing the response times of your cluster.  配置包升级时重新启动，默认为`false` 。这意味着您必须在手动安装软件包后重新启动 Elasticsearch 实例。这样做的原因是为了确保集群中的升级不会导致连续的分片重新分配，从而导致高网络流量并减少集群的响应时间。 |

Distributions that use `systemd` require that system resource limits be configured via `systemd` rather than via the `/etc/sysconfig/elasticsearch` file. See [Systemd configuration](https://www.elastic.co/guide/en/elasticsearch/reference/current/setting-system-settings.html#systemd) for more information.
使用`systemd`的发行版要求通过`systemd`而不是通过`/etc/sysconfig/elasticsearch`文件配置系统资源限制。有关详细信息，请参阅[Systemd 配置](https://www.elastic.co/guide/en/elasticsearch/reference/current/setting-system-settings.html#systemd)。

### 将客户端连接到 Elasticsearch

When you start Elasticsearch for the first time, TLS is configured automatically for the HTTP layer. A CA certificate is generated and stored on disk at:
当您第一次启动 Elasticsearch 时，会自动为 HTTP 层配置 TLS。生成 CA 证书并将其存储在磁盘上：

```sh
/etc/elasticsearch/certs/http_ca.crt
```

The hex-encoded SHA-256 fingerprint of this certificate is also output to the terminal. Any clients that connect to Elasticsearch, such as the [Elasticsearch Clients](https://www.elastic.co/guide/en/elasticsearch/client/index.html), Beats, standalone Elastic Agents, and Logstash must validate that they trust the certificate that Elasticsearch uses for HTTPS. Fleet Server and Fleet-managed Elastic Agents are automatically configured to trust the CA certificate. Other clients can establish trust by using either the fingerprint of the CA certificate or the CA certificate itself.
该证书的十六进制编码的 SHA-256 指纹也会输出到终端。连接到 Elasticsearch 的任何客户端（例如[Elasticsearch 客户端](https://www.elastic.co/guide/en/elasticsearch/client/index.html)、Beats、独立 Elastic Agent 和 Logstash）必须验证它们是否信任 Elasticsearch 用于 HTTPS  的证书。队列服务器和队列管理的 Elastic Agent 会自动配置为信任 CA 证书。其他客户端可以使用 CA 证书的指纹或 CA  证书本身来建立信任。

If the auto-configuration process already completed, you can still obtain the fingerprint of the security certificate. You can also copy the CA certificate to your machine and configure your client to use it.
如果自动配置过程已经完成，您仍然可以获得安全证书的指纹。您还可以将 CA 证书复制到您的计算机并配置您的客户端以使用它。

#### Use the CA fingerprint 使用CA指纹

Copy the fingerprint value that’s output to your terminal when Elasticsearch starts, and configure your client to use this fingerprint to establish trust when it connects to Elasticsearch.
复制 Elasticsearch 启动时输出到终端的指纹值，并将客户端配置为在连接到 Elasticsearch 时使用此指纹建立信任。

If the auto-configuration process already completed, you can still obtain the fingerprint of the security certificate by running the following command. The path is to the auto-generated CA certificate for the HTTP layer.
如果自动配置过程已经完成，您仍然可以通过运行以下命令获取安全证书的指纹。该路径是自动生成的 HTTP 层 CA 证书的路径。

```sh
openssl x509 -fingerprint -sha256 -in config/certs/http_ca.crt
```

The command returns the security certificate, including the fingerprint. The `issuer` should be `Elasticsearch security auto-configuration HTTP CA`.
该命令返回安全证书，包括指纹。 `issuer`为 `Elasticsearch security auto-configuration HTTP CA` 。

```sh
issuer= /CN=Elasticsearch security auto-configuration HTTP CA
SHA256 Fingerprint=<fingerprint>
```

#### Use the CA certificate 使用CA证书

If your library doesn’t support a method of validating the fingerprint, the auto-generated CA certificate is created in the following directory on each Elasticsearch node:
如果您的库不支持验证指纹的方法，则会在每个 Elasticsearch 节点上的以下目录中创建自动生成的 CA 证书：

```sh
/etc/elasticsearch/certs/http_ca.crt
```

Copy the `http_ca.crt` file to your machine and configure your client to use this certificate to establish trust when it connects to Elasticsearch.
将`http_ca.crt`文件复制到您的计算机，并将客户端配置为在连接到 Elasticsearch 时使用此证书建立信任。

### Debian 软件包的目录布局

The Debian package places config files, logs, and the data directory in the appropriate locations for a Debian-based system:
Debian 软件包将配置文件、日志和数据目录放置在基于 Debian 的系统的适当位置：

| Type 类型         | Description 描述                                             | Default Location 默认位置          | Setting 环境   |
| ----------------- | ------------------------------------------------------------ | ---------------------------------- | -------------- |
| **home 家**       | Elasticsearch home directory or `$ES_HOME` Elasticsearch 主目录或`$ES_HOME` | `/usr/share/elasticsearch`         |                |
| **bin 垃圾桶**    | Binary scripts including `elasticsearch` to start a node    and `elasticsearch-plugin` to install plugins 二进制脚本，包括启动节点的`elasticsearch`和安装插件的`elasticsearch-plugin` | `/usr/share/elasticsearch/bin`     |                |
| **conf 会议**     | Configuration files including `elasticsearch.yml` 配置文件包括`elasticsearch.yml` | `/etc/elasticsearch`               | `ES_PATH_CONF` |
| **conf 会议**     | Environment variables including heap size, file descriptors. 环境变量包括堆大小、文件描述符。 | `/etc/default/elasticsearch`       |                |
| **conf 会议**     | Generated TLS keys and certificates for the transport and http layer. 为传输层和 http 层生成 TLS 密钥和证书。 | `/etc/elasticsearch/certs`         |                |
| **data 数据**     | The location of the data files of each index / shard allocated    on the node. 节点上分配的每个索引/分片的数据文件的位置。 | `/var/lib/elasticsearch`           | `path.data`    |
| **jdk**           | The bundled Java Development Kit used to run Elasticsearch. Can    be overridden by setting the `ES_JAVA_HOME` environment variable    in `/etc/default/elasticsearch`. 用于运行 Elasticsearch 的捆绑 Java 开发工具包。可以通过在`/etc/default/elasticsearch`中设置`ES_JAVA_HOME`环境变量来覆盖。 | `/usr/share/elasticsearch/jdk`     |                |
| **logs 日志**     | Log files location. 日志文件位置。                           | `/var/log/elasticsearch`           | `path.logs`    |
| **plugins 插件**  | Plugin files location. Each plugin will be contained in a subdirectory. 插件文件位置。每个插件都将包含在一个子目录中。 | `/usr/share/elasticsearch/plugins` |                |
| **repo 回购协议** | Shared file system repository locations. Can hold multiple locations. A file  system repository can be placed in to any subdirectory of any directory  specified here. 共享文件系统存储库位置。可以容纳多个位置。文件系统存储库可以放置在此处指定的任何目录的任何子目录中。 | Not configured 未配置              | `path.repo`    |

### Security certificates and keys 安全证书和密钥

When you install Elasticsearch, the following certificates and keys are generated in the Elasticsearch configuration directory, which are used to connect a Kibana instance to your secured Elasticsearch cluster and to encrypt internode communication. The files are listed here for reference.
安装 Elasticsearch 时，会在 Elasticsearch 配置目录中生成以下证书和密钥，用于将 Kibana 实例连接到安全的 Elasticsearch 集群并加密节点间通信。此处列出了这些文件以供参考。

- `http_ca.crt`

  The CA certificate that is used to sign the certificates for the HTTP layer of this Elasticsearch cluster.  用于签署此 Elasticsearch 集群的 HTTP 层证书的 CA 证书。

- `http.p12`

  Keystore that contains the key and certificate for the HTTP layer for this node.  包含此节点的 HTTP 层的密钥和证书的密钥库。

- `transport.p12`

  Keystore that contains the key and certificate for the transport layer for all the nodes in your cluster.  包含集群中所有节点传输层的密钥和证书的密钥库。

`http.p12` and `transport.p12` are password-protected PKCS#12 keystores. Elasticsearch stores the passwords for these keystores as [secure settings](https://www.elastic.co/guide/en/elasticsearch/reference/current/secure-settings.html). To retrieve the passwords so that you can inspect or change the keystore contents, use the [`bin/elasticsearch-keystore`](https://www.elastic.co/guide/en/elasticsearch/reference/current/elasticsearch-keystore.html) tool.
`http.p12`和`transport.p12`是受密码保护的 PKCS#12 密钥库。 Elasticsearch 将这些密钥库的密码存储为[安全设置](https://www.elastic.co/guide/en/elasticsearch/reference/current/secure-settings.html)。要检索密码以便可以检查或更改密钥库内容，请使用[`bin/elasticsearch-keystore`](https://www.elastic.co/guide/en/elasticsearch/reference/current/elasticsearch-keystore.html)工具。

Use the following command to retrieve the password for `http.p12`:
使用以下命令检索`http.p12`的密码：

```sh
bin/elasticsearch-keystore show xpack.security.http.ssl.keystore.secure_password
```

Use the following command to retrieve the password for `transport.p12`:
使用以下命令检索`transport.p12`的密码：

```sh
bin/elasticsearch-keystore show xpack.security.transport.ssl.keystore.secure_password
```

## 使用 RPM 安装

The RPM for Elasticsearch can be [downloaded from our website](https://www.elastic.co/guide/en/elasticsearch/reference/current/rpm.html#install-rpm) or from our  [RPM repository](https://www.elastic.co/guide/en/elasticsearch/reference/current/rpm.html#rpm-repo). It can be used to install Elasticsearch on any RPM-based system such as OpenSuSE, SLES, Centos, Red Hat, and Oracle Enterprise.
Elasticsearch 的 RPM 可以[从我们的网站](https://www.elastic.co/guide/en/elasticsearch/reference/current/rpm.html#install-rpm)或[RPM 存储库](https://www.elastic.co/guide/en/elasticsearch/reference/current/rpm.html#rpm-repo)下载。它可用于在任何基于 RPM 的系统上安装 Elasticsearch，例如 OpenSuSE、SLES、Centos、Red Hat 和 Oracle Enterprise。

RPM install is not supported on distributions with old versions of RPM, such as SLES 11 and CentOS 5. Please see [Install Elasticsearch from archive on Linux or MacOS](https://www.elastic.co/guide/en/elasticsearch/reference/current/targz.html) instead.
具有旧版本 RPM 的发行版（例如 SLES 11 和 CentOS 5）不支持 RPM 安装。请参阅[在 Linux 或 MacOS 上从存档安装 Elasticsearch](https://www.elastic.co/guide/en/elasticsearch/reference/current/targz.html) 。

This package contains both free and subscription features. [Start a 30-day trial](https://www.elastic.co/guide/en/elasticsearch/reference/current/license-settings.html) to try out all of the features.
该软件包包含免费和订阅功能。[开始 30 天试用](https://www.elastic.co/guide/en/elasticsearch/reference/current/license-settings.html)以尝试所有功能。

The latest stable version of Elasticsearch can be found on the [Download Elasticsearch](https://www.elastic.co/downloads/elasticsearch) page. Other versions can be found on the [Past Releases page](https://www.elastic.co/downloads/past-releases).
Elasticsearch 的最新稳定版本可以在[下载 Elasticsearch](https://www.elastic.co/downloads/elasticsearch)页面上找到。其他版本可以在[过去的版本页面](https://www.elastic.co/downloads/past-releases)上找到。

Elasticsearch includes a bundled version of [OpenJDK](https://openjdk.java.net) from the JDK maintainers (GPLv2+CE). To use your own version of Java, see the [JVM version requirements](https://www.elastic.co/guide/en/elasticsearch/reference/current/install-elasticsearch.html#jvm-version)
Elasticsearch 包含来自 JDK 维护者的[OpenJDK](https://openjdk.java.net)捆绑版本 (GPLv2+CE)。要使用您自己的 Java 版本，请参阅[JVM 版本要求](https://www.elastic.co/guide/en/elasticsearch/reference/current/install-elasticsearch.html#jvm-version)

For a step-by-step example of setting up the Elastic Stack on your own premises, try out our tutorial: [Installing a self-managed Elastic Stack](https://www.elastic.co/guide/en/elastic-stack/8.15/installing-stack-demo-self.html).
有关在您自己的场所设置 Elastic Stack 的分步示例，请尝试我们的教程：[安装自我管理的 Elastic Stack](https://www.elastic.co/guide/en/elastic-stack/8.15/installing-stack-demo-self.html) 。

## Import the Elasticsearch GPG Key 导入 Elasticsearch GPG 密钥

[edit 编辑](https://github.com/elastic/elasticsearch/edit/8.15/docs/reference/setup/install/rpm.asciidoc)

We sign all of our packages with the Elasticsearch Signing Key (PGP key [D88E42B4](https://pgp.mit.edu/pks/lookup?op=vindex&search=0xD27D666CD88E42B4), available from https://pgp.mit.edu) with fingerprint:
我们使用 Elasticsearch 签名密钥（PGP 密钥[D88E42B4](https://pgp.mit.edu/pks/lookup?op=vindex&search=0xD27D666CD88E42B4) ，可从https://pgp.mit.edu获取）和指纹对所有包进行签名：

```
4609 5ACC 8548 582C 1A26 99A9 D27D 666C D88E 42B4
```

Download and install the public signing key:
下载并安装公共签名密钥：

```sh
rpm --import https://artifacts.elastic.co/GPG-KEY-elasticsearch
```

## Installing from the RPM repository 从 RPM 存储库安装

[edit 编辑](https://github.com/elastic/elasticsearch/edit/8.15/docs/reference/setup/install/rpm.asciidoc)

Create a file called `elasticsearch.repo` in the `/etc/yum.repos.d/` directory for RedHat based distributions, or in the `/etc/zypp/repos.d/` directory for OpenSuSE based distributions, containing:
在`/etc/yum.repos.d/`目录（对于基于 RedHat 的发行版）或`/etc/zypp/repos.d/`目录（对于基于 OpenSuSE 的发行版）创建一个名为`elasticsearch.repo`的文件，其中包含：

```sh
[elasticsearch]
name=Elasticsearch repository for 8.x packages
baseurl=https://artifacts.elastic.co/packages/8.x/yum
gpgcheck=1
gpgkey=https://artifacts.elastic.co/GPG-KEY-elasticsearch
enabled=0
autorefresh=1
type=rpm-md
```

And your repository is ready for use. You can now install Elasticsearch with one of the following commands:
您的存储库已可供使用。您现在可以使用以下命令之一安装 Elasticsearch：

```sh
sudo yum install --enablerepo=elasticsearch elasticsearch 
sudo dnf install --enablerepo=elasticsearch elasticsearch 
sudo zypper modifyrepo --enable elasticsearch && \
  sudo zypper install elasticsearch; \
  sudo zypper modifyrepo --disable elasticsearch 
```

|      | Use `yum` on CentOS and older Red Hat based distributions. 在 CentOS 和较旧的基于 Red Hat 的发行版上使用`yum` 。 |
| ---- | ------------------------------------------------------------ |
|      | Use `dnf` on Fedora and other newer Red Hat distributions. 在 Fedora 和其他较新的 Red Hat 发行版上使用`dnf` 。 |
|      | Use `zypper` on OpenSUSE based distributions 在基于 OpenSUSE 的发行版上使用`zypper` |

The configured repository is disabled by default. This eliminates the possibility of accidentally upgrading `elasticsearch` when upgrading the rest of the system. Each install or upgrade command must explicitly enable the repository as indicated in the sample commands above.
默认情况下禁用配置的存储库。这消除了在升级系统其余部分时意外升级`elasticsearch`的可能性。每个安装或升级命令都必须显式启用存储库，如上面示例命令中所示。

## Download and install the RPM manually 手动下载并安装 RPM

[edit 编辑](https://github.com/elastic/elasticsearch/edit/8.15/docs/reference/setup/install/rpm.asciidoc)

The RPM for Elasticsearch v8.15.1 can be downloaded from the website and installed as follows:
RPM for Elasticsearch v8.15.1可以从网站下载并安装，如下所示：

```sh
wget https://artifacts.elastic.co/downloads/elasticsearch/elasticsearch-8.15.1-x86_64.rpm
wget https://artifacts.elastic.co/downloads/elasticsearch/elasticsearch-8.15.1-x86_64.rpm.sha512
shasum -a 512 -c elasticsearch-8.15.1-x86_64.rpm.sha512 
sudo rpm --install elasticsearch-8.15.1-x86_64.rpm
```

|      | Compares the SHA of the downloaded RPM and the published checksum, which should output `elasticsearch-{version}-x86_64.rpm: OK`. 比较下载的 RPM 的 SHA 和发布的校验和，应输出 `elasticsearch-{version}-x86_64.rpm: OK` 。 |
| ---- | ------------------------------------------------------------ |
|      |                                                              |

On systemd-based distributions, the installation scripts will attempt to set kernel parameters (e.g., `vm.max_map_count`); you can skip this by masking the systemd-sysctl.service unit.
在基于 systemd 的发行版上，安装脚本将尝试设置内核参数（例如`vm.max_map_count` ）；您可以通过屏蔽 systemd-sysctl.service 单元来跳过此步骤。

## Start Elasticsearch with security enabled 启动 Elasticsearch 并启用安全性

[edit 编辑](https://github.com/elastic/elasticsearch/edit/8.15/docs/reference/setup/install/package-security.asciidoc)

When installing Elasticsearch, security features are enabled and configured by default. When you install Elasticsearch, the following security configuration occurs automatically:
安装 Elasticsearch 时，默认启用并配置安全功能。安装 Elasticsearch 时，会自动进行以下安全配置：

- Authentication and authorization are enabled, and a password is generated for the `elastic` built-in superuser. 
  启用认证和授权，并为`elastic`内置超级用户生成密码。
- Certificates and keys for TLS are generated for the transport and HTTP layer, and TLS is enabled and configured with these keys and certificates. 
  为传输层和 HTTP 层生成 TLS 的证书和密钥，并使用这些密钥和证书启用和配置 TLS。

The password and certificate and keys are output to your terminal. You can reset the password for the `elastic` user with the [`elasticsearch-reset-password`](https://www.elastic.co/guide/en/elasticsearch/reference/current/reset-password.html) command.
密码、证书和密钥将输出到您的终端。您可以使用[`elasticsearch-reset-password`](https://www.elastic.co/guide/en/elasticsearch/reference/current/reset-password.html)命令重置`elastic`用户的密码。

We recommend storing the `elastic` password as an environment variable in your shell. For example:
我们建议将`elastic`密码存储为 shell 中的环境变量。例如：

```sh
export ELASTIC_PASSWORD="your_password"
```

### Reconfigure a node to join an existing cluster 重新配置节点以加入现有集群

[edit 编辑](https://github.com/elastic/elasticsearch/edit/8.15/docs/reference/setup/install/package-security.asciidoc)

When you install Elasticsearch, the installation process configures a single-node cluster by default. If you want a node to join an existing cluster instead, generate an enrollment token on an existing node *before* you start the new node for the first time.
安装 Elasticsearch 时，安装过程默认配置单节点集群。如果您希望节点加入现有集群，请在首次启动新节点*之前*在现有节点上生成注册令牌。

1. On any node in your existing cluster, generate a node enrollment token:
   在现有集群中的任何节点上，生成节点注册令牌：

   ```sh
   /usr/share/elasticsearch/bin/elasticsearch-create-enrollment-token -s node
   ```

2. Copy the enrollment token, which is output to your terminal. 
   复制注册令牌，该令牌将输出到您的终端。

3. On your new Elasticsearch node, pass the enrollment token as a parameter to the `elasticsearch-reconfigure-node` tool:
   在新的 Elasticsearch 节点上，将注册令牌作为参数传递给 `elasticsearch-reconfigure-node` 工具：

   ```sh
   /usr/share/elasticsearch/bin/elasticsearch-reconfigure-node --enrollment-token <enrollment-token>
   ```

   Elasticsearch is now configured to join the existing cluster.

4. [Start your new node using `systemd`](https://www.elastic.co/guide/en/elasticsearch/reference/current/rpm.html#rpm-running-systemd). 
   [使用`systemd`启动新节点](https://www.elastic.co/guide/en/elasticsearch/reference/current/rpm.html#rpm-running-systemd)。

## Enable automatic creation of system indices 启用系统索引的自动创建

[edit 编辑](https://github.com/elastic/elasticsearch/edit/8.15/docs/reference/setup/install/rpm.asciidoc)

Some commercial features automatically create indices within Elasticsearch. By default, Elasticsearch is configured to allow automatic index creation, and no additional steps are required. However, if you have disabled automatic index creation in Elasticsearch, you must configure [`action.auto_create_index`](https://www.elastic.co/guide/en/elasticsearch/reference/current/docs-index_.html#index-creation) in `elasticsearch.yml` to allow the commercial features to create the following indices:
一些商业功能会自动在 Elasticsearch 中创建索引。默认情况下，Elasticsearch 配置为允许自动创建索引，无需执行其他步骤。但是，如果您在Elasticsearch中禁用了自动索引创建，则必须在`elasticsearch.yml`中配置[`action.auto_create_index`](https://www.elastic.co/guide/en/elasticsearch/reference/current/docs-index_.html#index-creation)以允许商业功能创建以下索引：

```yaml
action.auto_create_index: .monitoring*,.watches,.triggered_watches,.watcher-history*,.ml*
```

If you are using [Logstash](https://www.elastic.co/products/logstash) or [Beats](https://www.elastic.co/products/beats) then you will most likely require additional index names in your `action.auto_create_index` setting, and the exact value will depend on your local configuration. If you are unsure of the correct value for your environment, you may consider setting the value to `*` which will allow automatic creation of all indices.
如果您使用的是[Logstash](https://www.elastic.co/products/logstash)或[Beats](https://www.elastic.co/products/beats) ，那么您很可能需要在`action.auto_create_index`设置中添加额外的索引名称，确切的值将取决于您的本地配置。如果您不确定您的环境的正确值，您可以考虑将该值设置为`*` ，这将允许自动创建所有索引。

## Running Elasticsearch with `systemd` 使用`systemd`运行 Elasticsearch

[edit 编辑](https://github.com/elastic/elasticsearch/edit/8.15/docs/reference/setup/install/systemd.asciidoc)

To configure Elasticsearch to start automatically when the system boots up, run the following commands:
要将 Elasticsearch 配置为在系统启动时自动启动，请运行以下命令：

```sh
sudo /bin/systemctl daemon-reload
sudo /bin/systemctl enable elasticsearch.service
```

Elasticsearch can be started and stopped as follows:
Elasticsearch 可以按如下方式启动和停止：

```sh
sudo systemctl start elasticsearch.service
sudo systemctl stop elasticsearch.service
```

These commands provide no feedback as to whether Elasticsearch was started successfully or not. Instead, this information will be written in the log files located in `/var/log/elasticsearch/`.
这些命令不提供有关 Elasticsearch 是否成功启动的反馈。相反，此信息将写入位于`/var/log/elasticsearch/`日志文件中。

If you have password-protected your Elasticsearch keystore, you will need to provide `systemd` with the keystore password using a local file and systemd environment variables. This local file should be protected while it exists and may be safely deleted once Elasticsearch is up and running.
如果您的 Elasticsearch 密钥库受密码保护，则需要使用本地文件和 systemd 环境变量向`systemd`提供密钥库密码。该本地文件在存在时应受到保护，并且一旦 Elasticsearch 启动并运行即可安全删除。

```sh
echo "keystore_password" > /path/to/my_pwd_file.tmp
chmod 600 /path/to/my_pwd_file.tmp
sudo systemctl set-environment ES_KEYSTORE_PASSPHRASE_FILE=/path/to/my_pwd_file.tmp
sudo systemctl start elasticsearch.service
```

By default the Elasticsearch service doesn’t log information in the `systemd` journal. To enable `journalctl` logging, the `--quiet` option must be removed from the `ExecStart` command line in the `elasticsearch.service` file.
默认情况下，Elasticsearch 服务不会在`systemd`日志中记录信息。要启用`journalctl`日志记录，必须从`elasticsearch.service`文件中的`ExecStart`命令行中删除`--quiet`选项。

When `systemd` logging is enabled, the logging information are available using the `journalctl` commands:
启用`systemd`日志记录后，可以使用`journalctl`命令获取日志记录信息：

To tail the journal: 跟踪日志：

```sh
sudo journalctl -f
```

To list journal entries for the elasticsearch service:
列出 elasticsearch 服务的日志条目：

```sh
sudo journalctl --unit elasticsearch
```

To list journal entries for the elasticsearch service starting from a given time:
列出从给定时间开始的 elasticsearch 服务的日志条目：

```sh
sudo journalctl --unit elasticsearch --since  "2016-10-30 18:17:16"
```

Check `man journalctl` or https://www.freedesktop.org/software/systemd/man/journalctl.html for more command line options.
检查`man journalctl`或https://www.freedesktop.org/software/systemd/man/journalctl.html了解更多命令行选项。

## Startup timeouts with older `systemd` versions 较旧的`systemd`版本的启动超时

By default Elasticsearch sets the `TimeoutStartSec` parameter to `systemd` to `900s`. If you are running at least version 238 of `systemd` then Elasticsearch can automatically extend the startup timeout, and will do so repeatedly until startup is complete even if it takes longer than 900s.
默认情况下，Elasticsearch 将`systemd` `TimeoutStartSec`参数设置为`900s` 。如果您运行的`systemd`版本至少为 238，那么 Elasticsearch 可以自动延长启动超时，并且会重复执行此操作，直到启动完成，即使需要的时间超过 900 秒。

Versions of `systemd` prior to 238 do not support the timeout extension mechanism and will terminate the Elasticsearch process if it has not fully started up within the configured timeout. If this happens, Elasticsearch will report in its logs that it was shut down normally a short time after it started:
238 之前的`systemd`版本不支持超时扩展机制，如果 Elasticsearch 进程在配置的超时时间内未完全启动，则会终止 Elasticsearch 进程。如果发生这种情况，Elasticsearch 将在其日志中报告它在启动后不久就正常关闭：

```text
[2022-01-31T01:22:31,077][INFO ][o.e.n.Node               ] [instance-0000000123] starting ...
...
[2022-01-31T01:37:15,077][INFO ][o.e.n.Node               ] [instance-0000000123] stopping ...
```

However the `systemd` logs will report that the startup timed out:
但是`systemd`日志会报告启动超时：

```text
Jan 31 01:22:30 debian systemd[1]: Starting Elasticsearch...
Jan 31 01:37:15 debian systemd[1]: elasticsearch.service: Start operation timed out. Terminating.
Jan 31 01:37:15 debian systemd[1]: elasticsearch.service: Main process exited, code=killed, status=15/TERM
Jan 31 01:37:15 debian systemd[1]: elasticsearch.service: Failed with result 'timeout'.
Jan 31 01:37:15 debian systemd[1]: Failed to start Elasticsearch.
```

To avoid this, upgrade your `systemd` to at least version 238. You can also temporarily work around the problem by extending the `TimeoutStartSec` parameter.
为了避免这种情况，请将您的`systemd`至少升级到版本 238。您还可以通过扩展`TimeoutStartSec`参数来临时解决该问题。

## Check that Elasticsearch is running 检查 Elasticsearch 是否正在运行

[edit 编辑](https://github.com/elastic/elasticsearch/edit/8.15/docs/reference/setup/install/check-running.asciidoc)

You can test that your Elasticsearch node is running by sending an HTTPS request to port `9200` on `localhost`:
您可以通过向`localhost`上的端口`9200`发送 HTTPS 请求来测试您的 Elasticsearch 节点是否正在运行：

```sh
curl --cacert /etc/elasticsearch/certs/http_ca.crt -u elastic:$ELASTIC_PASSWORD https://localhost:9200 
```

|      | Ensure that you use `https` in your call, or the request will fail. 确保您在调用中使用`https` ，否则请求将失败。   `--cacert`  Path to the generated `http_ca.crt` certificate for the HTTP layer.  为 HTTP 层生成的`http_ca.crt`证书的路径。 |
| ---- | ------------------------------------------------------------ |
|      |                                                              |

The call returns a response like this:
该调用返回如下响应：

```js
{
  "name" : "Cp8oag6",
  "cluster_name" : "elasticsearch",
  "cluster_uuid" : "AT69_T_DTp-1qgIJlatQqA",
  "version" : {
    "number" : "8.15.1",
    "build_type" : "tar",
    "build_hash" : "f27399d",
    "build_flavor" : "default",
    "build_date" : "2016-03-30T09:51:41.449Z",
    "build_snapshot" : false,
    "lucene_version" : "9.11.1",
    "minimum_wire_compatibility_version" : "1.2.3",
    "minimum_index_compatibility_version" : "1.2.3"
  },
  "tagline" : "You Know, for Search"
}
```

## Configuring Elasticsearch 配置Elasticsearch

[edit 编辑](https://github.com/elastic/elasticsearch/edit/8.15/docs/reference/setup/install/rpm.asciidoc)

The `/etc/elasticsearch` directory contains the default runtime configuration for Elasticsearch. The ownership of this directory and all contained files are set to `root:elasticsearch` on package installations.
`/etc/elasticsearch`目录包含 Elasticsearch 的默认运行时配置。该目录和所有包含的文件的所有权在软件包安装时设置为`root:elasticsearch` 。

The `setgid` flag applies group permissions on the `/etc/elasticsearch` directory to ensure that Elasticsearch can read any contained files and subdirectories. All files and subdirectories inherit the `root:elasticsearch` ownership. Running commands from this directory or any subdirectories, such as the [elasticsearch-keystore tool](https://www.elastic.co/guide/en/elasticsearch/reference/current/secure-settings.html), requires `root:elasticsearch` permissions.
`setgid`标志对`/etc/elasticsearch`目录应用组权限，以确保 Elasticsearch 可以读取任何包含的文件和子目录。所有文件和子目录都继承`root:elasticsearch`所有权。从此目录或任何子目录运行命令（例如[elasticsearch-keystore tool](https://www.elastic.co/guide/en/elasticsearch/reference/current/secure-settings.html) ）需要`root:elasticsearch`权限。

Elasticsearch loads its configuration from the `/etc/elasticsearch/elasticsearch.yml` file by default. The format of this config file is explained in [*Configuring Elasticsearch*](https://www.elastic.co/guide/en/elasticsearch/reference/current/settings.html).
Elasticsearch 从以下位置加载其配置 `/etc/elasticsearch/elasticsearch.yml` 默认文件。[*配置 Elasticsearch*](https://www.elastic.co/guide/en/elasticsearch/reference/current/settings.html)中解释了此配置文件的格式。

The RPM also has a system configuration file (`/etc/sysconfig/elasticsearch`), which allows you to set the following parameters:
RPM 还有一个系统配置文件 ( `/etc/sysconfig/elasticsearch` )，它允许您设置以下参数：

| `ES_JAVA_HOME`       | Set a custom Java path to be used.  设置要使用的自定义 Java 路径。 |
| -------------------- | ------------------------------------------------------------ |
| `ES_PATH_CONF`       | Configuration file directory (which needs to include `elasticsearch.yml`, `jvm.options`, and `log4j2.properties` files); defaults to `/etc/elasticsearch`.  配置文件目录（需要包含`elasticsearch.yml` 、 `jvm.options` 、 `log4j2.properties`文件）；默认为`/etc/elasticsearch` 。 |
| `ES_JAVA_OPTS`       | Any additional JVM system properties you may want to apply.  您可能想要应用的任何其他 JVM 系统属性。 |
| `RESTART_ON_UPGRADE` | Configure restart on package upgrade, defaults to `false`. This means you will have to restart your Elasticsearch instance after installing a package manually. The reason for this is to ensure, that upgrades in a cluster do not result in a continuous shard reallocation resulting in high network traffic and reducing the response times of your cluster.  配置包升级时重新启动，默认为`false` 。这意味着您必须在手动安装软件包后重新启动 Elasticsearch 实例。这样做的原因是为了确保集群中的升级不会导致连续的分片重新分配，从而导致高网络流量并减少集群的响应时间。 |

Distributions that use `systemd` require that system resource limits be configured via `systemd` rather than via the `/etc/sysconfig/elasticsearch` file. See [Systemd configuration](https://www.elastic.co/guide/en/elasticsearch/reference/current/setting-system-settings.html#systemd) for more information.
使用`systemd`的发行版要求通过`systemd`而不是通过`/etc/sysconfig/elasticsearch`文件配置系统资源限制。有关详细信息，请参阅[Systemd 配置](https://www.elastic.co/guide/en/elasticsearch/reference/current/setting-system-settings.html#systemd)。

## Connect clients to Elasticsearch 将客户端连接到 Elasticsearch

[edit 编辑](https://github.com/elastic/elasticsearch/edit/8.15/docs/reference/setup/install/connect-clients.asciidoc)

When you start Elasticsearch for the first time, TLS is configured automatically for the HTTP layer. A CA certificate is generated and stored on disk at:
当您第一次启动 Elasticsearch 时，会自动为 HTTP 层配置 TLS。生成 CA 证书并将其存储在磁盘上：

```sh
/etc/elasticsearch/certs/http_ca.crt
```

The hex-encoded SHA-256 fingerprint of this certificate is also output to the terminal. Any clients that connect to Elasticsearch, such as the [Elasticsearch Clients](https://www.elastic.co/guide/en/elasticsearch/client/index.html), Beats, standalone Elastic Agents, and Logstash must validate that they trust the certificate that Elasticsearch uses for HTTPS. Fleet Server and Fleet-managed Elastic Agents are automatically configured to trust the CA certificate. Other clients can establish trust by using either the fingerprint of the CA certificate or the CA certificate itself.
该证书的十六进制编码的 SHA-256 指纹也会输出到终端。连接到 Elasticsearch 的任何客户端（例如[Elasticsearch 客户端](https://www.elastic.co/guide/en/elasticsearch/client/index.html)、Beats、独立 Elastic Agent 和 Logstash）必须验证它们是否信任 Elasticsearch 用于 HTTPS  的证书。队列服务器和队列管理的 Elastic Agent 会自动配置为信任 CA 证书。其他客户端可以使用 CA 证书的指纹或 CA  证书本身来建立信任。

If the auto-configuration process already completed, you can still obtain the fingerprint of the security certificate. You can also copy the CA certificate to your machine and configure your client to use it.
如果自动配置过程已经完成，您仍然可以获得安全证书的指纹。您还可以将 CA 证书复制到您的计算机并配置您的客户端以使用它。

#### Use the CA fingerprint 使用CA指纹

[edit 编辑](https://github.com/elastic/elasticsearch/edit/8.15/docs/reference/setup/install/connect-clients.asciidoc)

Copy the fingerprint value that’s output to your terminal when Elasticsearch starts, and configure your client to use this fingerprint to establish trust when it connects to Elasticsearch.
复制 Elasticsearch 启动时输出到终端的指纹值，并将客户端配置为在连接到 Elasticsearch 时使用此指纹建立信任。

If the auto-configuration process already completed, you can still obtain the fingerprint of the security certificate by running the following command. The path is to the auto-generated CA certificate for the HTTP layer.
如果自动配置过程已经完成，您仍然可以通过运行以下命令获取安全证书的指纹。该路径是自动生成的 HTTP 层 CA 证书的路径。

```sh
openssl x509 -fingerprint -sha256 -in config/certs/http_ca.crt
```

The command returns the security certificate, including the fingerprint. The `issuer` should be `Elasticsearch security auto-configuration HTTP CA`.
该命令返回安全证书，包括指纹。 `issuer`为 `Elasticsearch security auto-configuration HTTP CA` 。

```sh
issuer= /CN=Elasticsearch security auto-configuration HTTP CA
SHA256 Fingerprint=<fingerprint>
```

#### Use the CA certificate 使用CA证书

[edit 编辑](https://github.com/elastic/elasticsearch/edit/8.15/docs/reference/setup/install/connect-clients.asciidoc)

If your library doesn’t support a method of validating the fingerprint, the auto-generated CA certificate is created in the following directory on each Elasticsearch node:
如果您的库不支持验证指纹的方法，则会在每个 Elasticsearch 节点上的以下目录中创建自动生成的 CA 证书：

```sh
/etc/elasticsearch/certs/http_ca.crt
```

Copy the `http_ca.crt` file to your machine and configure your client to use this certificate to establish trust when it connects to Elasticsearch.
将`http_ca.crt`文件复制到您的计算机，并将客户端配置为在连接到 Elasticsearch 时使用此证书建立信任。

## Directory layout of RPM RPM的目录布局

[edit 编辑](https://github.com/elastic/elasticsearch/edit/8.15/docs/reference/setup/install/rpm.asciidoc)

The RPM places config files, logs, and the data directory in the appropriate locations for an RPM-based system:
RPM 将配置文件、日志和数据目录放置在基于 RPM 的系统的适当位置：

| Type 类型         | Description 描述                                             | Default Location 默认位置          | Setting 环境   |
| ----------------- | ------------------------------------------------------------ | ---------------------------------- | -------------- |
| **home 家**       | Elasticsearch home directory or `$ES_HOME` Elasticsearch 主目录或`$ES_HOME` | `/usr/share/elasticsearch`         |                |
| **bin 垃圾桶**    | Binary scripts including `elasticsearch` to start a node    and `elasticsearch-plugin` to install plugins 二进制脚本，包括启动节点的`elasticsearch`和安装插件的`elasticsearch-plugin` | `/usr/share/elasticsearch/bin`     |                |
| **conf 会议**     | Configuration files including `elasticsearch.yml` 配置文件包括`elasticsearch.yml` | `/etc/elasticsearch`               | `ES_PATH_CONF` |
| **conf 会议**     | Environment variables including heap size, file descriptors. 环境变量包括堆大小、文件描述符。 | `/etc/sysconfig/elasticsearch`     |                |
| **conf 会议**     | Generated TLS keys and certificates for the transport and http layer. 为传输层和 http 层生成 TLS 密钥和证书。 | `/etc/elasticsearch/certs`         |                |
| **data 数据**     | The location of the data files of each index / shard allocated    on the node. 节点上分配的每个索引/分片的数据文件的位置。 | `/var/lib/elasticsearch`           | `path.data`    |
| **jdk**           | The bundled Java Development Kit used to run Elasticsearch. Can    be overridden by setting the `ES_JAVA_HOME` environment variable    in `/etc/sysconfig/elasticsearch`. 用于运行 Elasticsearch 的捆绑 Java 开发工具包。可以通过在`/etc/sysconfig/elasticsearch`中设置`ES_JAVA_HOME`环境变量来覆盖。 | `/usr/share/elasticsearch/jdk`     |                |
| **logs 日志**     | Log files location. 日志文件位置。                           | `/var/log/elasticsearch`           | `path.logs`    |
| **plugins 插件**  | Plugin files location. Each plugin will be contained in a subdirectory. 插件文件位置。每个插件都将包含在一个子目录中。 | `/usr/share/elasticsearch/plugins` |                |
| **repo 回购协议** | Shared file system repository locations. Can hold multiple locations. A file  system repository can be placed in to any subdirectory of any directory  specified here. 共享文件系统存储库位置。可以容纳多个位置。文件系统存储库可以放置在此处指定的任何目录的任何子目录中。 | Not configured 未配置              | `path.repo`    |

### Security certificates and keys 安全证书和密钥

[edit 编辑](https://github.com/elastic/elasticsearch/edit/8.15/docs/reference/setup/install/security-files-reference.asciidoc)

When you install Elasticsearch, the following certificates and keys are generated in the Elasticsearch configuration directory, which are used to connect a Kibana instance to your secured Elasticsearch cluster and to encrypt internode communication. The files are listed here for reference.
安装 Elasticsearch 时，会在 Elasticsearch 配置目录中生成以下证书和密钥，用于将 Kibana 实例连接到安全的 Elasticsearch 集群并加密节点间通信。此处列出了这些文件以供参考。

- `http_ca.crt`

  The CA certificate that is used to sign the certificates for the HTTP layer of this Elasticsearch cluster.  用于签署此 Elasticsearch 集群的 HTTP 层证书的 CA 证书。

- `http.p12`

  Keystore that contains the key and certificate for the HTTP layer for this node.  包含此节点的 HTTP 层的密钥和证书的密钥库。

- `transport.p12`

  Keystore that contains the key and certificate for the transport layer for all the nodes in your cluster.  包含集群中所有节点传输层的密钥和证书的密钥库。

`http.p12` and `transport.p12` are password-protected PKCS#12 keystores. Elasticsearch stores the passwords for these keystores as [secure settings](https://www.elastic.co/guide/en/elasticsearch/reference/current/secure-settings.html). To retrieve the passwords so that you can inspect or change the keystore contents, use the [`bin/elasticsearch-keystore`](https://www.elastic.co/guide/en/elasticsearch/reference/current/elasticsearch-keystore.html) tool.
`http.p12`和`transport.p12`是受密码保护的 PKCS#12 密钥库。 Elasticsearch 将这些密钥库的密码存储为[安全设置](https://www.elastic.co/guide/en/elasticsearch/reference/current/secure-settings.html)。要检索密码以便可以检查或更改密钥库内容，请使用[`bin/elasticsearch-keystore`](https://www.elastic.co/guide/en/elasticsearch/reference/current/elasticsearch-keystore.html)工具。

Use the following command to retrieve the password for `http.p12`:
使用以下命令检索`http.p12`的密码：

```sh
bin/elasticsearch-keystore show xpack.security.http.ssl.keystore.secure_password
```

Use the following command to retrieve the password for `transport.p12`:
使用以下命令检索`transport.p12`的密码：

```sh
bin/elasticsearch-keystore show xpack.security.transport.ssl.keystore.secure_password
```

## Next steps 后续步骤

[edit 编辑](https://github.com/elastic/elasticsearch/edit/8.15/docs/reference/setup/install/next-steps.asciidoc)

You now have a test Elasticsearch environment set up. Before you start serious development or go into production with Elasticsearch, you must do some additional setup:
您现在已经设置了一个测试 Elasticsearch 环境。在开始认真开发或使用 Elasticsearch 投入生产之前，您必须执行一些额外的设置：

- Learn how to [configure Elasticsearch](https://www.elastic.co/guide/en/elasticsearch/reference/current/settings.html). 
  了解如何[配置 Elasticsearch](https://www.elastic.co/guide/en/elasticsearch/reference/current/settings.html) 。
- Configure [important Elasticsearch settings](https://www.elastic.co/guide/en/elasticsearch/reference/current/important-settings.html). 
  配置[重要的 Elasticsearch 设置](https://www.elastic.co/guide/en/elasticsearch/reference/current/important-settings.html)。
- Configure [important system settings](https://www.elastic.co/guide/en/elasticsearch/reference/current/system-config.html). 
  配置[重要的系统设置](https://www.elastic.co/guide/en/elasticsearch/reference/current/system-config.html)。

### 使用 Docker 安装 Elasticsearch

[edit 编辑](https://github.com/elastic/elasticsearch/edit/8.15/docs/reference/setup/install/docker.asciidoc)

Docker images for Elasticsearch are available from the Elastic Docker registry. A list of all published Docker images and tags is available at [www.docker.elastic.co](https://www.docker.elastic.co). The source code is in [GitHub](https://github.com/elastic/elasticsearch/blob/8.15/distribution/docker).
Elasticsearch 的 Docker 镜像可从 Elastic Docker 注册表获取。所有已发布的 Docker 镜像和标签的列表可在[www.docker.elastic.co](https://www.docker.elastic.co)上找到。源代码位于[GitHub](https://github.com/elastic/elasticsearch/blob/8.15/distribution/docker)中。

This package contains both free and subscription features. [Start a 30-day trial](https://www.elastic.co/guide/en/elasticsearch/reference/current/license-settings.html) to try out all of the features.
该软件包包含免费和订阅功能。[开始 30 天试用](https://www.elastic.co/guide/en/elasticsearch/reference/current/license-settings.html)以尝试所有功能。

If you just want to test Elasticsearch in local development, refer to [*Local dev setup (Docker)*](https://www.elastic.co/guide/en/elasticsearch/reference/current/run-elasticsearch-locally.html). Please note that this setup is not suitable for production environments.
如果您只想在本地开发中测试 Elasticsearch，请参阅[*本地开发设置 (Docker)*](https://www.elastic.co/guide/en/elasticsearch/reference/current/run-elasticsearch-locally.html) 。请注意，此设置不适合生产环境。

## Run Elasticsearch in Docker 在 Docker 中运行 Elasticsearch

[edit 编辑](https://github.com/elastic/elasticsearch/edit/8.15/docs/reference/setup/install/docker.asciidoc)

Use Docker commands to start a single-node Elasticsearch cluster for development or testing. You can then run additional Docker commands to add nodes to the test cluster or run Kibana.
使用Docker命令启动单节点Elasticsearch集群进行开发或测试。然后，您可以运行其他 Docker 命令将节点添加到测试集群或运行 Kibana。

This setup doesn’t run multiple Elasticsearch nodes or Kibana by default. To create a multi-node cluster with Kibana, use Docker Compose instead. See [Start a multi-node cluster with Docker Compose](https://www.elastic.co/guide/en/elasticsearch/reference/current/docker.html#docker-compose-file).
默认情况下，此设置不会运行多个 Elasticsearch 节点或 Kibana。要使用 Kibana 创建多节点集群，请改用 Docker Compose。请参阅[使用 Docker Compose 启动多节点集群](https://www.elastic.co/guide/en/elasticsearch/reference/current/docker.html#docker-compose-file)。

### Start a single-node cluster 启动单节点集群

[edit 编辑](https://github.com/elastic/elasticsearch/edit/8.15/docs/reference/setup/install/docker.asciidoc)

1. Install Docker. Visit [Get Docker](https://docs.docker.com/get-docker/) to install Docker for your environment.
   安装 Docker。访问[获取 Docker](https://docs.docker.com/get-docker/)为您的环境安装 Docker。

   If using Docker Desktop, make sure to allocate at least 4GB of memory. You can adjust memory usage in Docker Desktop by going to **Settings > Resources**.
   如果使用 Docker Desktop，请确保分配至少 4GB 内存。您可以通过转到**“设置 > 资源”**来调整 Docker Desktop 中的内存使用情况。

2. Create a new docker network.
   创建一个新的 Docker 网络。

   ```sh
   docker network create elastic
   ```

3. Pull the Elasticsearch Docker image.
   拉取 Elasticsearch Docker 镜像。

   ```sh
   docker pull docker.elastic.co/elasticsearch/elasticsearch:8.15.1
   ```

4. Optional: Install [Cosign](https://docs.sigstore.dev/system_config/installation/) for your environment. Then use Cosign to verify the Elasticsearch image’s signature.
   可选：为您的环境安装[Cosign](https://docs.sigstore.dev/system_config/installation/) 。然后使用 Cosign 验证 Elasticsearch 镜像的签名。

   

   ```sh
   wget https://artifacts.elastic.co/cosign.pub
   cosign verify --key cosign.pub docker.elastic.co/elasticsearch/elasticsearch:8.15.1
   ```

   The `cosign` command prints the check results and the signature payload in JSON format:
   `cosign`命令以 JSON 格式打印检查结果和签名负载：

   ```sh
   Verification for docker.elastic.co/elasticsearch/elasticsearch:8.15.1 --
   The following checks were performed on each of these signatures:
     - The cosign claims were validated
     - Existence of the claims in the transparency log was verified offline
     - The signatures were verified against the specified public key
   ```

5. Start an Elasticsearch container.
   启动 Elasticsearch 容器。

   ```sh
   docker run --name es01 --net elastic -p 9200:9200 -it -m 1GB docker.elastic.co/elasticsearch/elasticsearch:8.15.1
   ```

   Use the `-m` flag to set a memory limit for the container. This removes the need to [manually set the JVM size](https://www.elastic.co/guide/en/elasticsearch/reference/current/docker.html#docker-set-heap-size).
   使用`-m`标志设置容器的内存限制。这样就无需[手动设置 JVM 大小](https://www.elastic.co/guide/en/elasticsearch/reference/current/docker.html#docker-set-heap-size)。

   The command prints the `elastic` user password and an enrollment token for Kibana.
   该命令打印 Kibana 的`elastic`用户密码和注册令牌。

6. Copy the generated `elastic` password and enrollment token. These credentials are only shown when you start Elasticsearch for the first time. You can regenerate the credentials using the following commands.
   复制生成的`elastic`密码和注册令牌。这些凭据仅在您首次启动 Elasticsearch 时显示。您可以使用以下命令重新生成凭据。

   ```sh
   docker exec -it es01 /usr/share/elasticsearch/bin/elasticsearch-reset-password -u elastic
   docker exec -it es01 /usr/share/elasticsearch/bin/elasticsearch-create-enrollment-token -s kibana
   ```

   We recommend storing the `elastic` password as an environment variable in your shell. Example:
   我们建议将`elastic`密码存储为 shell 中的环境变量。例子：

   ```sh
   export ELASTIC_PASSWORD="your_password"
   ```

7. Copy the `http_ca.crt` SSL certificate from the container to your local machine.
   将`http_ca.crt` SSL 证书从容器复制到本地计算机。

   ```sh
   docker cp es01:/usr/share/elasticsearch/config/certs/http_ca.crt .
   ```

8. Make a REST API call to Elasticsearch to ensure the Elasticsearch container is running.
   对 Elasticsearch 进行 REST API 调用以确保 Elasticsearch 容器正在运行。

   ```sh
   curl --cacert http_ca.crt -u elastic:$ELASTIC_PASSWORD https://localhost:9200
   ```

### Add more nodes 添加更多节点

[edit 编辑](https://github.com/elastic/elasticsearch/edit/8.15/docs/reference/setup/install/docker.asciidoc)

1. Use an existing node to generate a enrollment token for the new node.
   使用现有节点为新节点生成注册令牌。

   ```sh
   docker exec -it es01 /usr/share/elasticsearch/bin/elasticsearch-create-enrollment-token -s node
   ```

   The enrollment token is valid for 30 minutes.
   注册令牌的有效期为 30 分钟。

2. Start a new Elasticsearch container. Include the enrollment token as an environment variable.
   启动一个新的 Elasticsearch 容器。包含注册令牌作为环境变量。

   ```sh
   docker run -e ENROLLMENT_TOKEN="<token>" --name es02 --net elastic -it -m 1GB docker.elastic.co/elasticsearch/elasticsearch:8.15.1
   ```

3. Call the [cat nodes API](https://www.elastic.co/guide/en/elasticsearch/reference/current/cat-nodes.html) to verify the node was added to the cluster.
   调用[cat 节点 API](https://www.elastic.co/guide/en/elasticsearch/reference/current/cat-nodes.html)来验证节点是否已添加到集群中。

   ```sh
   curl --cacert http_ca.crt -u elastic:$ELASTIC_PASSWORD https://localhost:9200/_cat/nodes
   ```

### Run Kibana 运行基巴纳

[edit 编辑](https://github.com/elastic/elasticsearch/edit/8.15/docs/reference/setup/install/docker.asciidoc)

1. Pull the Kibana Docker image.
   拉取 Kibana Docker 镜像。

   ```sh
   docker pull docker.elastic.co/kibana/kibana:8.15.1
   ```

2. Optional: Verify the Kibana image’s signature.
   可选：验证 Kibana 映像的签名。

   ```sh
   wget https://artifacts.elastic.co/cosign.pub
   cosign verify --key cosign.pub docker.elastic.co/kibana/kibana:8.15.1
   ```

3. Start a Kibana container.
   启动 Kibana 容器。

   ```sh
   docker run --name kib01 --net elastic -p 5601:5601 docker.elastic.co/kibana/kibana:8.15.1
   ```

4. When Kibana starts, it outputs a unique generated link to the terminal. To access Kibana, open this link in a web browser. 
   当 Kibana 启动时，它会向终端输出一个唯一生成的链接。要访问 Kibana，请在 Web 浏览器中打开此链接。

5. In your browser, enter the enrollment token that was generated when you started Elasticsearch.
   在浏览器中，输入启动 Elasticsearch 时生成的注册令牌。

   To regenerate the token, run:
   要重新生成令牌，请运行：

   ```sh
   docker exec -it es01 /usr/share/elasticsearch/bin/elasticsearch-create-enrollment-token -s kibana
   ```

6. Log in to Kibana as the `elastic` user with the password that was generated when you started Elasticsearch.
   使用启动 Elasticsearch 时生成的密码以`elastic`用户身份登录 Kibana。

   To regenerate the password, run:
   要重新生成密码，请运行：

   ```sh
   docker exec -it es01 /usr/share/elasticsearch/bin/elasticsearch-reset-password -u elastic
   ```

### Remove containers 移除容器

[edit 编辑](https://github.com/elastic/elasticsearch/edit/8.15/docs/reference/setup/install/docker.asciidoc)

To remove the containers and their network, run:
要删除容器及其网络，请运行：

```sh
# Remove the Elastic network
docker network rm elastic

# Remove Elasticsearch containers
docker rm es01
docker rm es02

# Remove the Kibana container
docker rm kib01
```

### Next steps 后续步骤

[edit 编辑](https://github.com/elastic/elasticsearch/edit/8.15/docs/reference/setup/install/docker.asciidoc)

You now have a test Elasticsearch environment set up. Before you start serious development or go into production with Elasticsearch, review the [requirements and recommendations](https://www.elastic.co/guide/en/elasticsearch/reference/current/docker.html#docker-prod-prerequisites) to apply when running Elasticsearch in Docker in production.
您现在已经设置了一个测试 Elasticsearch 环境。在开始认真开发或使用 Elasticsearch 投入生产之前，请查看在生产环境中在 Docker 中运行 Elasticsearch 时要应用的[要求和建议](https://www.elastic.co/guide/en/elasticsearch/reference/current/docker.html#docker-prod-prerequisites)。

## Start a multi-node cluster with Docker Compose 使用 Docker Compose 启动多节点集群

[edit 编辑](https://github.com/elastic/elasticsearch/edit/8.15/docs/reference/setup/install/docker.asciidoc)

Use Docker Compose to start a three-node Elasticsearch cluster with Kibana. Docker Compose lets you start multiple containers with a single command.
使用 Docker Compose 和 Kibana 启动三节点 Elasticsearch 集群。 Docker Compose 允许您使用单个命令启动多个容器。

### Configure and start the cluster 配置并启动集群

[edit 编辑](https://github.com/elastic/elasticsearch/edit/8.15/docs/reference/setup/install/docker.asciidoc)

1. Install Docker Compose. Visit the [Docker Compose docs](https://docs.docker.com/compose/install/) to install Docker Compose for your environment.
   安装 Docker Compose。请访问[Docker Compose 文档](https://docs.docker.com/compose/install/)，为您的环境安装 Docker Compose。

   If you’re using Docker Desktop, Docker Compose is installed automatically. Make sure to allocate at least 4GB of memory to Docker Desktop. You can adjust memory usage in Docker Desktop by going to **Settings > Resources**.
   如果您使用 Docker Desktop，则会自动安装 Docker Compose。确保为 Docker Desktop 分配至少 4GB 内存。您可以通过转到**“设置 > 资源”**来调整 Docker Desktop 中的内存使用情况。

2. Create or navigate to an empty directory for the project. 
   创建或导航到项目的空目录。

3. Download and save the following files in the project directory:
   下载以下文件并将其保存在项目目录中：

   - [`.env`](https://github.com/elastic/elasticsearch/blob/8.15/docs/reference/setup/install/docker/.env)
   - [`docker-compose.yml`](https://github.com/elastic/elasticsearch/blob/8.15/docs/reference/setup/install/docker/docker-compose.yml)

4. In the `.env` file, specify a password for the `ELASTIC_PASSWORD` and `KIBANA_PASSWORD` variables.
   在`.env`文件中，为`ELASTIC_PASSWORD`和`KIBANA_PASSWORD`变量指定密码。

   The passwords must be alphanumeric and can’t contain special characters, such as `!` or `@`. The bash script included in the `docker-compose.yml` file only works with alphanumeric characters. Example:
   密码必须是字母数字且不能包含特殊字符，例如`!`或者`@` 。 `docker-compose.yml`文件中包含的 bash 脚本仅适用于字母数字字符。例子：

   ```txt
   # Password for the 'elastic' user (at least 6 characters)
   ELASTIC_PASSWORD=changeme
   
   # Password for the 'kibana_system' user (at least 6 characters)
   KIBANA_PASSWORD=changeme
   ...
   ```

5. In the `.env` file, set `STACK_VERSION` to the current Elastic Stack version.
   在`.env`文件中，将`STACK_VERSION`设置为当前 Elastic Stack 版本。

   ```txt
   ...
   # Version of Elastic products
   STACK_VERSION=8.15.1
   ...
   ```

6. By default, the Docker Compose configuration exposes port `9200` on all network interfaces.
   默认情况下，Docker Compose 配置在所有网络接口上公开端口`9200` 。

   To avoid exposing port `9200` to external hosts, set `ES_PORT` to `127.0.0.1:9200` in the `.env` file. This ensures Elasticsearch is only accessible from the host machine.
   为了避免将端口`9200`暴露给外部主机，请在`.env`文件中将`ES_PORT`设置为`127.0.0.1:9200` 。这确保只能从主机访问 Elasticsearch。

   ```txt
   ...
   # Port to expose Elasticsearch HTTP API to the host
   #ES_PORT=9200
   ES_PORT=127.0.0.1:9200
   ...
   ```

7. To start the cluster, run the following command from the project directory.
   要启动集群，请从项目目录运行以下命令。

   ```sh
   docker-compose up -d
   ```

8. After the cluster has started, open http://localhost:5601 in a web browser to access Kibana. 
   集群启动后，在Web浏览器中打开http://localhost:5601访问Kibana。

9. Log in to Kibana as the `elastic` user using the `ELASTIC_PASSWORD` you set earlier. 
   使用您之前设置的`ELASTIC_PASSWORD`以`elastic`用户身份登录 Kibana。

### Stop and remove the cluster 停止并删除集群

[edit 编辑](https://github.com/elastic/elasticsearch/edit/8.15/docs/reference/setup/install/docker.asciidoc)

To stop the cluster, run `docker-compose down`. The data in the Docker volumes is preserved and loaded when you restart the cluster with `docker-compose up`.
要停止集群，请运行`docker-compose down` 。当您使用`docker-compose up`重新启动集群时，Docker 卷中的数据将被保留并加载。

```sh
docker-compose down
```

To delete the network, containers, and volumes when you stop the cluster, specify the `-v` option:
要在停止集群时删除网络、容器和卷，请指定`-v`选项：

```sh
docker-compose down -v
```

### Next steps 后续步骤

[edit 编辑](https://github.com/elastic/elasticsearch/edit/8.15/docs/reference/setup/install/docker.asciidoc)

You now have a test Elasticsearch environment set up. Before you start serious development or go into production with Elasticsearch, review the [requirements and recommendations](https://www.elastic.co/guide/en/elasticsearch/reference/current/docker.html#docker-prod-prerequisites) to apply when running Elasticsearch in Docker in production.
您现在已经设置了一个测试 Elasticsearch 环境。在开始认真开发或使用 Elasticsearch 投入生产之前，请查看在生产环境中在 Docker 中运行 Elasticsearch 时要应用的[要求和建议](https://www.elastic.co/guide/en/elasticsearch/reference/current/docker.html#docker-prod-prerequisites)。

## Using the Docker images in production 在生产中使用 Docker 镜像

[edit 编辑](https://github.com/elastic/elasticsearch/edit/8.15/docs/reference/setup/install/docker.asciidoc)

The following requirements and recommendations apply when running Elasticsearch in Docker in production.
在生产环境中在 Docker 中运行 Elasticsearch 时，适用以下要求和建议。

### Set `vm.max_map_count` to at least `262144` 将`vm.max_map_count`设置为至少`262144`

[edit 编辑](https://github.com/elastic/elasticsearch/edit/8.15/docs/reference/setup/install/docker.asciidoc)

The `vm.max_map_count` kernel setting must be set to at least `262144` for production use.
`vm.max_map_count`内核设置必须至少设置为`262144`以供生产使用。

How you set `vm.max_map_count` depends on your platform.
如何设置`vm.max_map_count`取决于您的平台。

#### Linux

[edit 编辑](https://github.com/elastic/elasticsearch/edit/8.15/docs/reference/setup/install/docker.asciidoc)

To view the current value for the `vm.max_map_count` setting, run:
要查看`vm.max_map_count`设置的当前值，请运行：

```sh
grep vm.max_map_count /etc/sysctl.conf
vm.max_map_count=262144
```

To apply the setting on a live system, run:
要在实时系统上应用该设置，请运行：

```sh
sysctl -w vm.max_map_count=262144
```

To permanently change the value for the `vm.max_map_count` setting, update the value in `/etc/sysctl.conf`.
要永久更改`vm.max_map_count`设置的值，请​​更新`/etc/sysctl.conf`中的值。

#### macOS with [Docker for Mac](https://docs.docker.com/docker-for-mac) 带有[适用于 Mac 的 Docker 的](https://docs.docker.com/docker-for-mac)macOS

[edit 编辑](https://github.com/elastic/elasticsearch/edit/8.15/docs/reference/setup/install/docker.asciidoc)

The `vm.max_map_count` setting must be set within the xhyve virtual machine:
`vm.max_map_count`设置必须在 xhyve 虚拟机内设置：

1. From the command line, run:
   从命令行运行：

   ```sh
   screen ~/Library/Containers/com.docker.docker/Data/vms/0/tty
   ```

2. Press enter and use `sysctl` to configure `vm.max_map_count`:
   按 Enter 并使用`sysctl`配置`vm.max_map_count` ：

   ```sh
   sysctl -w vm.max_map_count=262144
   ```

3. To exit the `screen` session, type `Ctrl a d`. 
   要退出`screen`会话，请键入`Ctrl ad` 。

#### Windows and macOS with [Docker Desktop](https://www.docker.com/products/docker-desktop) 使用[Docker Desktop 的](https://www.docker.com/products/docker-desktop)Windows 和 macOS

[edit 编辑](https://github.com/elastic/elasticsearch/edit/8.15/docs/reference/setup/install/docker.asciidoc)

The `vm.max_map_count` setting must be set via docker-machine:
`vm.max_map_count`设置必须通过 docker-machine 设置：

```sh
docker-machine ssh
sudo sysctl -w vm.max_map_count=262144
```

#### Windows with [Docker Desktop WSL 2 backend](https://docs.docker.com/docker-for-windows/wsl) 带有[Docker Desktop WSL 2 后端的](https://docs.docker.com/docker-for-windows/wsl)Windows

[edit 编辑](https://github.com/elastic/elasticsearch/edit/8.15/docs/reference/setup/install/docker.asciidoc)

The `vm.max_map_count` setting must be set in the "docker-desktop" WSL instance before the Elasticsearch container will properly start. There are several ways to do this, depending on your version of Windows and your version of WSL.
在 Elasticsearch 容器正确启动之前，必须在“docker-desktop”WSL 实例中设置`vm.max_map_count`设置。有多种方法可以执行此操作，具体取决于您的 Windows 版本和 WSL 版本。

If you are on Windows 10 before version 22H2, or if you are on Windows 10 version 22H2 using the built-in version of WSL, you must either manually set it every time you restart Docker before starting your Elasticsearch container, or (if you do not wish to do so on every restart) you must globally set every WSL2 instance to have the `vm.max_map_count` changed. This is because these versions of WSL do not properly process the /etc/sysctl.conf file.
如果您使用的是版本 22H2 之前的 Windows 10，或者如果您使用的是使用内置版本 WSL 的 Windows 10 版本 22H2，则必须在每次启动  Elasticsearch 容器之前重新启动 Docker 时手动设置它，或者（如果您这样做）不希望每次重新启动时都这样做）您必须全局设置每个  WSL2 实例以更改`vm.max_map_count` 。这是因为这些版本的 WSL 无法正确处理 /etc/sysctl.conf 文件。

To manually set it every time you reboot, you must run the following commands in a command prompt or PowerShell window every time you restart Docker:
要在每次重新启动时手动设置它，您必须在每次重新启动 Docker 时在命令提示符或 PowerShell 窗口中运行以下命令：

```sh
wsl -d docker-desktop -u root
sysctl -w vm.max_map_count=262144
```

If you are on these versions of WSL and you do not want to have to run those commands every time you restart Docker, you can globally change every WSL distribution with this setting by modifying your %USERPROFILE%\.wslconfig as follows:
如果您使用这些版本的 WSL 并且不想每次重新启动 Docker 时都运行这些命令，则可以通过修改 %USERPROFILE%\.wslconfig 来全局更改每个 WSL 发行版的此设置，如下所示：

```text
[wsl2]
kernelCommandLine = "sysctl.vm.max_map_count=262144"
```

This will cause all WSL2 VMs to have that setting assigned when they start.
这将导致所有 WSL2 VM 在启动时分配该设置。

If you are on Windows 11, or Windows 10 version 22H2 and have installed the Microsoft Store version of WSL, you can modify the /etc/sysctl.conf within the "docker-desktop" WSL distribution, perhaps with commands like this:
如果您使用的是 Windows 11 或 Windows 10 版本 22H2 并且已安装 Microsoft Store 版本的 WSL，则可以修改“docker-desktop”WSL 发行版中的 /etc/sysctl.conf，可能使用如下命令：

```sh
wsl -d docker-desktop -u root
vi /etc/sysctl.conf
```

and appending a line which reads:
并附加一行内容：

```text
vm.max_map_count = 262144
```

### Configuration files must be readable by the `elasticsearch` user 配置文件必须可由`elasticsearch`用户读取

[edit 编辑](https://github.com/elastic/elasticsearch/edit/8.15/docs/reference/setup/install/docker.asciidoc)

By default, Elasticsearch runs inside the container as user `elasticsearch` using uid:gid `1000:0`.
默认情况下，Elasticsearch 使用 uid:gid `1000:0`作为用户`elasticsearch`在容器内运行。

One exception is [Openshift](https://docs.openshift.com/container-platform/3.6/creating_images/guidelines.html#openshift-specific-guidelines), which runs containers using an arbitrarily assigned user ID. Openshift presents persistent volumes with the gid set to `0`, which works without any adjustments.
[Openshift](https://docs.openshift.com/container-platform/3.6/creating_images/guidelines.html#openshift-specific-guidelines)是一个例外，它使用任意分配的用户 ID 来运行容器。 Openshift 提供 gid 设置为`0`持久卷，无需任何调整即可工作。

If you are bind-mounting a local directory or file, it must be readable by the `elasticsearch` user. In addition, this user must have write access to the [config, data and log dirs](https://www.elastic.co/guide/en/elasticsearch/reference/current/important-settings.html#path-settings) (Elasticsearch needs write access to the `config` directory so that it can generate a keystore). A good strategy is to grant group access to gid `0` for the local directory.
如果您要绑定挂载本地目录或文件，则该目录或文件必须可由`elasticsearch`用户读取。此外，该用户必须具有对[配置、数据和日志目录](https://www.elastic.co/guide/en/elasticsearch/reference/current/important-settings.html#path-settings)的写入权限（Elasticsearch 需要对`config`目录具有写入权限，以便生成密钥库）。一个好的策略是授予组对本地目录 gid `0`的访问权限。

For example, to prepare a local directory for storing data through a bind-mount:
例如，要通过绑定挂载准备一个用于存储数据的本地目录：

```sh
mkdir esdatadir
chmod g+rwx esdatadir
chgrp 0 esdatadir
```

You can also run an Elasticsearch container using both a custom UID and GID. You must ensure that file permissions will not prevent Elasticsearch from executing. You can use one of two options:
您还可以使用自定义 UID 和 GID 运行 Elasticsearch 容器。您必须确保文件权限不会阻止 Elasticsearch 执行。您可以使用以下两个选项之一：

- Bind-mount the `config`, `data` and `logs` directories. If you intend to install plugins and prefer not to [create a custom Docker image](https://www.elastic.co/guide/en/elasticsearch/reference/current/docker.html#_c_customized_image), you must also bind-mount the `plugins` directory. 
  绑定挂载`config` 、 `data`和`logs`目录。如果您打算安装插件并且不希望[创建自定义 Docker 映像](https://www.elastic.co/guide/en/elasticsearch/reference/current/docker.html#_c_customized_image)，则还必须绑定挂载`plugins`目录。
- Pass the `--group-add 0` command line option to `docker run`. This ensures that the user under which Elasticsearch is running is also a member of the `root` (GID 0) group inside the container. 
  将`--group-add 0`命令行选项传递给`docker run` 。这可确保运行 Elasticsearch 的用户也是容器内`root` (GID 0) 组的成员。

### Increase ulimits for nofile and nproc 增加 nofile 和 nproc 的 ulimit

[edit 编辑](https://github.com/elastic/elasticsearch/edit/8.15/docs/reference/setup/install/docker.asciidoc)

Increased ulimits for [nofile](https://www.elastic.co/guide/en/elasticsearch/reference/current/setting-system-settings.html) and [nproc](https://www.elastic.co/guide/en/elasticsearch/reference/current/max-number-threads-check.html) must be available for the Elasticsearch containers. Verify the [init system](https://github.com/moby/moby/tree/ea4d1243953e6b652082305a9c3cda8656edab26/contrib/init) for the Docker daemon sets them to acceptable values.
Elasticsearch 容器必须可以使用增加的[nofile](https://www.elastic.co/guide/en/elasticsearch/reference/current/setting-system-settings.html)和[nproc](https://www.elastic.co/guide/en/elasticsearch/reference/current/max-number-threads-check.html) ulimit。验证 Docker 守护进程的[init 系统](https://github.com/moby/moby/tree/ea4d1243953e6b652082305a9c3cda8656edab26/contrib/init)将它们设置为可接受的值。

To check the Docker daemon defaults for ulimits, run:
要检查 Docker 守护程序默认的 ulimits，请运行：

```sh
docker run --rm docker.elastic.co/elasticsearch/elasticsearch:8.15.1 /bin/bash -c 'ulimit -Hn && ulimit -Sn && ulimit -Hu && ulimit -Su'
```

If needed, adjust them in the Daemon or override them per container. For example, when using `docker run`, set:
如果需要，请在守护进程中调整它们或按容器覆盖它们。例如，使用`docker run`时，设置：

```sh
--ulimit nofile=65535:65535
```

### Disable swapping 禁用交换

[edit 编辑](https://github.com/elastic/elasticsearch/edit/8.15/docs/reference/setup/install/docker.asciidoc)

Swapping needs to be disabled for performance and node stability. For information about ways to do this, see [Disable swapping](https://www.elastic.co/guide/en/elasticsearch/reference/current/setup-configuration-memory.html).
为了性能和节点稳定性，需要禁用交换。有关执行此操作的方法的信息，请参阅[禁用交换](https://www.elastic.co/guide/en/elasticsearch/reference/current/setup-configuration-memory.html)。

If you opt for the `bootstrap.memory_lock: true` approach, you also need to define the `memlock: true` ulimit in the [Docker Daemon](https://docs.docker.com/engine/reference/commandline/dockerd/#default-ulimits), or explicitly set for the container as shown in the  [sample compose file](https://www.elastic.co/guide/en/elasticsearch/reference/current/docker.html#docker-compose-file). When using `docker run`, you can specify:
如果您选择`bootstrap.memory_lock: true`方法，您还需要在[Docker Daemon](https://docs.docker.com/engine/reference/commandline/dockerd/#default-ulimits)中定义`memlock: true` ulimit ，或者为容器显式设置，如[示例 compose 文件](https://www.elastic.co/guide/en/elasticsearch/reference/current/docker.html#docker-compose-file)中所示。使用`docker run`时，您可以指定：

```sh
-e "bootstrap.memory_lock=true" --ulimit memlock=-1:-1
```

### Randomize published ports 随机化已发布的端口

[edit 编辑](https://github.com/elastic/elasticsearch/edit/8.15/docs/reference/setup/install/docker.asciidoc)

The image [exposes](https://docs.docker.com/engine/reference/builder/#/expose) TCP ports 9200 and 9300. For production clusters, randomizing the published ports with `--publish-all` is recommended, unless you are pinning one container per host.
该映像[公开](https://docs.docker.com/engine/reference/builder/#/expose)TCP 端口 9200 和 9300。对于生产集群，建议使用`--publish-all`随机化已发布的端口，除非您为每台主机固定一个容器。

### Manually set the heap size 手动设置堆大小

[edit 编辑](https://github.com/elastic/elasticsearch/edit/8.15/docs/reference/setup/install/docker.asciidoc)

By default, Elasticsearch automatically sizes JVM heap based on a nodes’s [roles](https://www.elastic.co/guide/en/elasticsearch/reference/current/modules-node.html#node-roles) and the total memory available to the node’s container. We recommend this default sizing for most production environments. If needed, you can override default sizing by manually setting JVM heap size.
默认情况下，Elasticsearch 根据节点的[角色](https://www.elastic.co/guide/en/elasticsearch/reference/current/modules-node.html#node-roles)和节点容器可用的总内存自动调整 JVM 堆的大小。我们建议大多数生产环境使用此默认大小。如果需要，您可以通过手动设置 JVM 堆大小来覆盖默认大小。

To manually set the heap size in production, bind mount a [JVM options](https://www.elastic.co/guide/en/elasticsearch/reference/current/advanced-configuration.html#set-jvm-options) file under `/usr/share/elasticsearch/config/jvm.options.d` that includes your desired [heap size](https://www.elastic.co/guide/en/elasticsearch/reference/current/advanced-configuration.html#set-jvm-heap-size) settings.
要在生产中手动设置堆大小，请在下面绑定安装[JVM 选项](https://www.elastic.co/guide/en/elasticsearch/reference/current/advanced-configuration.html#set-jvm-options)文件 `/usr/share/elasticsearch/config/jvm.options.d` 其中包括您所需的[堆大小](https://www.elastic.co/guide/en/elasticsearch/reference/current/advanced-configuration.html#set-jvm-heap-size)设置。

For testing, you can also manually set the heap size using the `ES_JAVA_OPTS` environment variable. For example, to use 1GB, use the following command.
为了进行测试，您还可以使用`ES_JAVA_OPTS`环境变量手动设置堆大小。例如，要使用 1GB，请使用以下命令。

```sh
docker run -e ES_JAVA_OPTS="-Xms1g -Xmx1g" -e ENROLLMENT_TOKEN="<token>" --name es01 -p 9200:9200 --net elastic -it docker.elastic.co/elasticsearch/elasticsearch:8.15.1
```

The `ES_JAVA_OPTS` variable overrides all other JVM options. We do not recommend using `ES_JAVA_OPTS` in production.
`ES_JAVA_OPTS`变量会覆盖所有其他 JVM 选项。我们不建议在生产中使用`ES_JAVA_OPTS` 。

### Pin deployments to a specific image version 将部署固定到特定映像版本

[edit 编辑](https://github.com/elastic/elasticsearch/edit/8.15/docs/reference/setup/install/docker.asciidoc)

Pin your deployments to a specific version of the Elasticsearch Docker image. For example `docker.elastic.co/elasticsearch/elasticsearch:8.15.1`.
将您的部署固定到特定版本的 Elasticsearch Docker 映像。例如 `docker.elastic.co/elasticsearch/elasticsearch:8.15.1` 。

### Always bind data volumes 始终绑定数据卷

[edit 编辑](https://github.com/elastic/elasticsearch/edit/8.15/docs/reference/setup/install/docker.asciidoc)

You should use a volume bound on `/usr/share/elasticsearch/data` for the following reasons:
您应该使用`/usr/share/elasticsearch/data`上绑定的卷，原因如下：

1. The data of your Elasticsearch node won’t be lost if the container is killed 
   如果容器被杀死，Elasticsearch节点的数据不会丢失
2. Elasticsearch is I/O sensitive and the Docker storage driver is not ideal for fast I/O 
   Elasticsearch 对 I/O 敏感，而 Docker 存储驱动程序对于快速 I/O 并不理想
3. It allows the use of advanced [Docker volume plugins](https://docs.docker.com/engine/extend/plugins/#volume-plugins)
   它允许使用高级[Docker 卷插件](https://docs.docker.com/engine/extend/plugins/#volume-plugins)

### Avoid using `loop-lvm` mode 避免使用`loop-lvm`模式

[edit 编辑](https://github.com/elastic/elasticsearch/edit/8.15/docs/reference/setup/install/docker.asciidoc)

If you are using the devicemapper storage driver, do not use the default `loop-lvm` mode. Configure docker-engine to use [direct-lvm](https://docs.docker.com/engine/userguide/storagedriver/device-mapper-driver/#configure-docker-with-devicemapper).
如果您使用的是 devicemapper 存储驱动程序，请勿使用默认的`loop-lvm`模式。配置 docker-engine 以使用[direct-lvm](https://docs.docker.com/engine/userguide/storagedriver/device-mapper-driver/#configure-docker-with-devicemapper) 。

### Centralize your logs 集中您的日志

[edit 编辑](https://github.com/elastic/elasticsearch/edit/8.15/docs/reference/setup/install/docker.asciidoc)

Consider centralizing your logs by using a different [logging driver](https://docs.docker.com/engine/admin/logging/overview/). Also note that the default json-file logging driver is not ideally suited for production use.
考虑使用不同的[日志记录驱动程序](https://docs.docker.com/engine/admin/logging/overview/)来集中日志。另请注意，默认的 json 文件日志记录驱动程序不太适合生产使用。

## Configuring Elasticsearch with Docker 使用 Docker 配置 Elasticsearch

[edit 编辑](https://github.com/elastic/elasticsearch/edit/8.15/docs/reference/setup/install/docker.asciidoc)

When you run in Docker, the [Elasticsearch configuration files](https://www.elastic.co/guide/en/elasticsearch/reference/current/settings.html#config-files-location) are loaded from `/usr/share/elasticsearch/config/`.
当您在 Docker 中运行时， [Elasticsearch 配置文件](https://www.elastic.co/guide/en/elasticsearch/reference/current/settings.html#config-files-location)将从 `/usr/share/elasticsearch/config/` 。

To use custom configuration files, you [bind-mount the files](https://www.elastic.co/guide/en/elasticsearch/reference/current/docker.html#docker-config-bind-mount) over the configuration files in the image.
要使用自定义配置文件，您[可以将这些文件绑定挂载](https://www.elastic.co/guide/en/elasticsearch/reference/current/docker.html#docker-config-bind-mount)到映像中的配置文件上。

You can set individual Elasticsearch configuration parameters using Docker environment variables. The [sample compose file](https://www.elastic.co/guide/en/elasticsearch/reference/current/docker.html#docker-compose-file) and the [single-node example](https://www.elastic.co/guide/en/elasticsearch/reference/current/docker.html#docker-cli-run-dev-mode) use this method. You can use the setting name directly as the environment variable name. If you cannot do this, for example because your orchestration platform forbids periods in environment variable names, then you can use an alternative style by converting the setting name as follows.
您可以使用 Docker 环境变量设置单独的 Elasticsearch 配置参数。[示例撰写文件](https://www.elastic.co/guide/en/elasticsearch/reference/current/docker.html#docker-compose-file)和[单节点示例](https://www.elastic.co/guide/en/elasticsearch/reference/current/docker.html#docker-cli-run-dev-mode)使用此方法。您可以直接使用设置名称作为环境变量名称。如果您无法执行此操作，例如因为您的编排平台禁止在环境变量名称中使用句点，则您可以通过转换设置名称来使用替代样式，如下所示。

1. Change the setting name to uppercase 
   将设置名称更改为大写
2. Prefix it with `ES_SETTING_`
   加上`ES_SETTING_`前缀
3. Escape any underscores (`_`) by duplicating them 
   通过复制来转义任何下划线 ( `_` )
4. Convert all periods (`.`) to underscores (`_`) 
   将所有句点 ( `.` ) 转换为下划线 ( `_` )

For example, `-e bootstrap.memory_lock=true` becomes `-e ES_SETTING_BOOTSTRAP_MEMORY__LOCK=true`.
例如， `-e bootstrap.memory_lock=true`变为 `-e ES_SETTING_BOOTSTRAP_MEMORY__LOCK=true` 。

You can use the contents of a file to set the value of the `ELASTIC_PASSWORD` or `KEYSTORE_PASSWORD` environment variables, by suffixing the environment variable name with `_FILE`. This is useful for passing secrets such as passwords to Elasticsearch without specifying them directly.
您可以使用文件的内容来设置`ELASTIC_PASSWORD`或`KEYSTORE_PASSWORD`环境变量的值，方法是在环境变量名称后添加`_FILE` 。这对于将密码（例如密码）传递给 Elasticsearch 而不直接指定它们非常有用。

For example, to set the Elasticsearch bootstrap password from a file, you can bind mount the file and set the `ELASTIC_PASSWORD_FILE` environment variable to the mount location. If you mount the password file to `/run/secrets/bootstrapPassword.txt`, specify:
例如，要从文件设置 Elasticsearch 引导密码，您可以绑定挂载该文件并将`ELASTIC_PASSWORD_FILE`环境变量设置为挂载位置。如果将密码文件挂载到 `/run/secrets/bootstrapPassword.txt` ， 指定：

```sh
-e ELASTIC_PASSWORD_FILE=/run/secrets/bootstrapPassword.txt
```

You can override the default command for the image to pass Elasticsearch configuration parameters as command line options. For example:
您可以覆盖图像的默认命令，以将 Elasticsearch 配置参数作为命令行选项传递。例如：

```sh
docker run <various parameters> bin/elasticsearch -Ecluster.name=mynewclustername
```

While bind-mounting your configuration files is usually the preferred method in production, you can also [create a custom Docker image](https://www.elastic.co/guide/en/elasticsearch/reference/current/docker.html#_c_customized_image) that contains your configuration.
虽然绑定安装配置文件通常是生产中的首选方法，但您也可以[创建包含配置的自定义 Docker 映像](https://www.elastic.co/guide/en/elasticsearch/reference/current/docker.html#_c_customized_image)。

### Mounting Elasticsearch configuration files 挂载Elasticsearch配置文件

[edit 编辑](https://github.com/elastic/elasticsearch/edit/8.15/docs/reference/setup/install/docker.asciidoc)

Create custom config files and bind-mount them over the corresponding files in the Docker image. For example, to bind-mount `custom_elasticsearch.yml` with `docker run`, specify:
创建自定义配置文件并将它们绑定安装到 Docker 映像中的相应文件上。例如，要使用`docker run`绑定挂载`custom_elasticsearch.yml` ，请指定：

```sh
-v full_path_to/custom_elasticsearch.yml:/usr/share/elasticsearch/config/elasticsearch.yml
```

If you bind-mount a custom `elasticsearch.yml` file, ensure it includes the `network.host: 0.0.0.0` setting. This setting ensures the node is reachable for HTTP and transport traffic, provided its ports are exposed. The Docker image’s built-in `elasticsearch.yml` file includes this setting by default.
如果您绑定挂载自定义`elasticsearch.yml`文件，请确保它包含`network.host: 0.0.0.0`设置。此设置可确保节点可通过 HTTP 和传输流量访问，前提是其端口已公开。默认情况下，Docker 映像的内置`elasticsearch.yml`文件包含此设置。

The container **runs Elasticsearch as user `elasticsearch` using uid:gid `1000:0`**. Bind mounted host directories and files must be accessible by this user, and the data and log directories must be writable by this user.
容器**使用 uid:gid `1000:0`作为用户`elasticsearch`运行 Elasticsearch** 。绑定安装的主机目录和文件必须可由该用户访问，并且数据和日志目录必须可由该用户写入。

### Create an encrypted Elasticsearch keystore 创建加密的 Elasticsearch 密钥库

[edit 编辑](https://github.com/elastic/elasticsearch/edit/8.15/docs/reference/setup/install/docker.asciidoc)

By default, Elasticsearch will auto-generate a keystore file for [secure settings](https://www.elastic.co/guide/en/elasticsearch/reference/current/secure-settings.html). This file is obfuscated but not encrypted.
默认情况下，Elasticsearch 将自动生成用于[安全设置](https://www.elastic.co/guide/en/elasticsearch/reference/current/secure-settings.html)的密钥库文件。该文件已被混淆但未加密。

To encrypt your secure settings with a password and have them persist outside the container, use a `docker run` command to manually create the keystore instead. The command must:
要使用密码加密您的安全设置并使其保留在容器外部，请使用`docker run`命令手动创建密钥库。该命令必须：

- Bind-mount the `config` directory. The command will create an `elasticsearch.keystore` file in this directory. To avoid errors, do not directly bind-mount the `elasticsearch.keystore` file. 
  绑定挂载`config`目录。该命令将在此目录中创建一个`elasticsearch.keystore`文件。为避免错误，请勿直接绑定挂载`elasticsearch.keystore`文件。
- Use the `elasticsearch-keystore` tool with the `create -p` option. You’ll be prompted to enter a password for the keystore. 
  将`elasticsearch-keystore`工具与`create -p`选项结合使用。系统将提示您输入密钥库的密码。

For example: 例如：

```sh
docker run -it --rm \
-v full_path_to/config:/usr/share/elasticsearch/config \
docker.elastic.co/elasticsearch/elasticsearch:8.15.1 \
bin/elasticsearch-keystore create -p
```

You can also use a `docker run` command to add or update secure settings in the keystore. You’ll be prompted to enter the setting values. If the keystore is encrypted, you’ll also be prompted to enter the keystore password.
您还可以使用`docker run`命令添加或更新密钥库中的安全设置。系统将提示您输入设置值。如果密钥库已加密，系统还会提示您输入密钥库密码。

```sh
docker run -it --rm \
-v full_path_to/config:/usr/share/elasticsearch/config \
docker.elastic.co/elasticsearch/elasticsearch:8.15.1 \
bin/elasticsearch-keystore \
add my.secure.setting \
my.other.secure.setting
```

If you’ve already created the keystore and don’t need to update it, you can bind-mount the `elasticsearch.keystore` file directly. You can use the `KEYSTORE_PASSWORD` environment variable to provide the keystore password to the container at startup. For example, a `docker run` command might have the following options:
如果您已经创建了密钥库并且不需要更新它，则可以直接绑定挂载`elasticsearch.keystore`文件。您可以使用`KEYSTORE_PASSWORD`环境变量在启动时向容器提供密钥库密码。例如， `docker run`命令可能具有以下选项：

```sh
-v full_path_to/config/elasticsearch.keystore:/usr/share/elasticsearch/config/elasticsearch.keystore
-e KEYSTORE_PASSWORD=mypassword
```

### Using custom Docker images 使用自定义 Docker 镜像

[edit 编辑](https://github.com/elastic/elasticsearch/edit/8.15/docs/reference/setup/install/docker.asciidoc)

In some environments, it might make more sense to prepare a custom image that contains your configuration. A `Dockerfile` to achieve this might be as simple as:
在某些环境中，准备包含您的配置的自定义映像可能更有意义。实现此目的的`Dockerfile`可能很简单：

```sh
FROM docker.elastic.co/elasticsearch/elasticsearch:8.15.1
COPY --chown=elasticsearch:elasticsearch elasticsearch.yml /usr/share/elasticsearch/config/
```

You could then build and run the image with:
然后您可以使用以下命令构建并运行该映像：

```sh
docker build --tag=elasticsearch-custom .
docker run -ti -v /usr/share/elasticsearch/data elasticsearch-custom
```

Some plugins require additional security permissions. You must explicitly accept them either by:
某些插件需要额外的安全权限。您必须通过以下方式明确接受它们：

- Attaching a `tty` when you run the Docker image and allowing the permissions when prompted. 
  运行 Docker 映像时附加一个`tty` ，并在出现提示时允许权限。
- Inspecting the security permissions and accepting them (if appropriate) by adding the `--batch` flag to the plugin install command. 
  通过将`--batch`标志添加到插件安装命令来检查安全权限并接受它们（如果适用）。

See [Plugin management](https://www.elastic.co/guide/en/elasticsearch/plugins/8.15/_other_command_line_parameters.html) for more information.
有关更多信息，请参阅[插件管理](https://www.elastic.co/guide/en/elasticsearch/plugins/8.15/_other_command_line_parameters.html)。

### Troubleshoot Docker errors for Elasticsearch 排查 Elasticsearch 的 Docker 错误

[edit 编辑](https://github.com/elastic/elasticsearch/edit/8.15/docs/reference/setup/install/docker.asciidoc)

Here’s how to resolve common errors when running Elasticsearch with Docker.
以下是如何解决使用 Docker 运行 Elasticsearch 时的常见错误。

### elasticsearch.keystore is a directory elasticsearch.keystore 是一个目录

[edit 编辑](https://github.com/elastic/elasticsearch/edit/8.15/docs/reference/setup/install/docker.asciidoc)

```txt
Exception in thread "main" org.elasticsearch.bootstrap.BootstrapException: java.io.IOException: Is a directory: SimpleFSIndexInput(path="/usr/share/elasticsearch/config/elasticsearch.keystore") Likely root cause: java.io.IOException: Is a directory
```

A [keystore-related](https://www.elastic.co/guide/en/elasticsearch/reference/current/docker.html#docker-keystore-bind-mount) `docker run` command attempted to directly bind-mount an `elasticsearch.keystore` file that doesn’t exist. If you use the `-v` or `--volume` flag to mount a file that doesn’t exist, Docker instead creates a directory with the same name.
[与密钥库相关的](https://www.elastic.co/guide/en/elasticsearch/reference/current/docker.html#docker-keystore-bind-mount)`docker run`命令尝试直接绑定挂载不存在的`elasticsearch.keystore`文件。如果您使用`-v`或`--volume`标志挂载不存在的文件，Docker 会创建一个同名的目录。

To resolve this error: 要解决此错误：

1. Delete the `elasticsearch.keystore` directory in the `config` directory. 
   删除`config`目录下的`elasticsearch.keystore`目录。
2. Update the `-v` or `--volume` flag to point to the `config` directory path rather than the keystore file’s path. For an example, see [Create an encrypted Elasticsearch keystore](https://www.elastic.co/guide/en/elasticsearch/reference/current/docker.html#docker-keystore-bind-mount). 
   更新`-v`或`--volume`标志以指向`config`目录路径而不是密钥库文件的路径。有关示例，请参阅[创建加密的 Elasticsearch 密钥库](https://www.elastic.co/guide/en/elasticsearch/reference/current/docker.html#docker-keystore-bind-mount)。
3. Retry the command. 重试该命令。

### elasticsearch.keystore: Device or resource busy elasticsearch.keystore：设备或资源繁忙

[edit 编辑](https://github.com/elastic/elasticsearch/edit/8.15/docs/reference/setup/install/docker.asciidoc)

```txt
Exception in thread "main" java.nio.file.FileSystemException: /usr/share/elasticsearch/config/elasticsearch.keystore.tmp -> /usr/share/elasticsearch/config/elasticsearch.keystore: Device or resource busy
```

A `docker run` command attempted to [update the keystore](https://www.elastic.co/guide/en/elasticsearch/reference/current/docker.html#docker-keystore-bind-mount) while directly bind-mounting the `elasticsearch.keystore` file. To update the keystore, the container requires access to other files in the `config` directory, such as `keystore.tmp`.
`docker run`命令尝试在直接绑定挂载`elasticsearch.keystore`文件时[更新密钥库](https://www.elastic.co/guide/en/elasticsearch/reference/current/docker.html#docker-keystore-bind-mount)。要更新密钥库，容器需要访问`config`目录中的其他文件，例如`keystore.tmp` 。

To resolve this error: 要解决此错误：

1. Update the `-v` or `--volume` flag to point to the `config` directory path rather than the keystore file’s path. For an example, see [Create an encrypted Elasticsearch keystore](https://www.elastic.co/guide/en/elasticsearch/reference/current/docker.html#docker-keystore-bind-mount). 
   更新`-v`或`--volume`标志以指向`config`目录路径而不是密钥库文件的路径。有关示例，请参阅[创建加密的 Elasticsearch 密钥库](https://www.elastic.co/guide/en/elasticsearch/reference/current/docker.html#docker-keystore-bind-mount)。
2. Retry the command. 重试该命令。