# 安装

[TOC]

## 部署选项

要使用 Elasticsearch，需要一个正在运行的 Elasticsearch 服务实例。可以通过多种方式部署 Elasticsearch：

- [**Local dev**](https://www.elastic.co/guide/en/elasticsearch/reference/current/run-elasticsearch-locally.html): Get started quickly with a minimal local Docker setup. 
  [**本地开发**](https://www.elastic.co/guide/en/elasticsearch/reference/current/run-elasticsearch-locally.html)：通过最少的本地 Docker 设置快速入门。
- [**Elastic Cloud**](https://www.elastic.co/guide/en/cloud/current/ec-getting-started-trial.html): Elasticsearch is available as part of our hosted Elastic Stack  offering, deployed in the cloud with your provider of choice. Elasticsearch 作为我们托管的 Elastic Stack 产品的一部分提供，由您选择的提供商部署在云中。注册[14 天免费试用](https://cloud.elastic.co/registration)。
- [**Elastic Cloud Serverless** (技术预览版)](https://docs.elastic.co/serverless/general/sign-up-trial): Create serverless projects for autoscaled and fully managed Elasticsearch deployments. Sign up for a [14-day free trial](https://cloud.elastic.co/serverless-registration). 为自动扩展和完全托管的 Elasticsearch 部署创建无服务器项目。注册[14 天免费试用](https://cloud.elastic.co/serverless-registration)。

**高级部署选项**

- [**Self-managed**](https://www.elastic.co/guide/en/elasticsearch/reference/current/install-elasticsearch.html#elasticsearch-deployment-options)：在自己的场所安装、配置和运行 Elasticsearch。
- [**Elastic Cloud Enterprise**](https://www.elastic.co/guide/en/cloud-enterprise/current/Elastic-Cloud-Enterprise-overview.html)：Deploy Elastic Cloud on public or private clouds, virtual machines, or your own premises. 在公共云或私有云、虚拟机或您自己的场所上部署 Elastic Cloud。
- [**Elastic Cloud on Kubernetes**](https://www.elastic.co/guide/en/cloud-on-k8s/current/k8s-overview.html)： 在 Kubernetes 上部署 Elastic Cloud。

## 在 Docker 中本地运行 Elasticsearch（无安全性）

**DO NOT USE THESE INSTRUCTIONS FOR PRODUCTION DEPLOYMENTS
请勿将这些说明用于生产部署**

此说明**仅适用于本地开发**。不要将这些说明用于生产部署，因为它们不安全。虽然这种方法方便实验和学习，但永远不应该在生产环境中以这种方式运行服务。

以下命令可帮助您快速启动单节点 Elasticsearch 集群以及 Docker 中的 Kibana。请注意，如果不需要 Kibana UI，则可以跳过这些说明。

### 什么时候会使用这个设置？

如果想快速启动 Elasticsearch（和 Kibana）以进行本地开发或测试，请使用此设置。

例如，可能：

- 想要进行快速测试以了解某个功能的工作原理。
- 遵循需要 Elasticsearch 集群的教程或指南。
- Experiment with the Elasticsearch APIs using different tools, like the  Dev Tools Console, cURL, or an Elastic programming language client. 
  使用不同的工具（例如开发工具控制台、cURL 或 Elastic 编程语言客户端）试验 Elasticsearch API 。
- Quickly spin up an Elasticsearch cluster to test an executable [Python notebook](https://github.com/elastic/elasticsearch-labs/tree/main/notebooks#readme) locally. 
  快速启动 Elasticsearch 集群以在本地测试可执行的 [Python 笔记本](https://github.com/elastic/elasticsearch-labs/tree/main/notebooks#readme) 。

### 先决条件

如果您尚未安装 Docker，[请下载并安装适用于您的操作系统的 Docker Desktop](https://www.docker.com/products/docker-desktop) 。

### 设置环境变量

配置以下环境变量：

```bash
export ELASTIC_PASSWORD="<ES_PASSWORD>"   # password for "elastic" username
export KIBANA_PASSWORD="<KIB_PASSWORD>"   # Used _internally_ by Kibana, must be at least 6 characters long
```

### 创建 Docker 网络

To run both Elasticsearch and Kibana, you’ll need to create a Docker network:
要运行 Elasticsearch 和 Kibana，您需要创建一个 Docker 网络：

```sh
docker network create elastic-net
```

### 运行 Elasticsearch

Start the Elasticsearch container with the following command:
使用以下命令启动 Elasticsearch 容器：

```sh
docker run -p 127.0.0.1:9200:9200 -d --name elasticsearch --network elastic-net \
  -e ELASTIC_PASSWORD=$ELASTIC_PASSWORD \
  -e "discovery.type=single-node" \
  -e "xpack.security.http.ssl.enabled=false" \
  -e "xpack.license.self_generated.type=trial" \
  docker.elastic.co/elasticsearch/elasticsearch:8.15.1
```

### 运行 Kibana（可选）

To run Kibana, you must first set the `kibana_system` password in the Elasticsearch container.
要运行 Kibana，您必须首先在 Elasticsearch 容器中设置`kibana_system`密码。

```sh
# configure the Kibana password in the ES container
curl -u elastic:$ELASTIC_PASSWORD \
  -X POST \
  http://localhost:9200/_security/user/kibana_system/_password \
  -d '{"password":"'"$KIBANA_PASSWORD"'"}' \
  -H 'Content-Type: application/json'
```

Start the Kibana container with the following command:
使用以下命令启动 Kibana 容器：

```sh
docker run -p 127.0.0.1:5601:5601 -d --name kibana --network elastic-net \
  -e ELASTICSEARCH_URL=http://elasticsearch:9200 \
  -e ELASTICSEARCH_HOSTS=http://elasticsearch:9200 \
  -e ELASTICSEARCH_USERNAME=kibana_system \
  -e ELASTICSEARCH_PASSWORD=$KIBANA_PASSWORD \
  -e "xpack.security.enabled=false" \
  -e "xpack.license.self_generated.type=trial" \
  docker.elastic.co/kibana/kibana:8.15.1
```

When you access Kibana, use `elastic` as the username and the password you set earlier for the `ELASTIC_PASSWORD` environment variable.
当您访问 Kibana 时，请使用`elastic`作为用户名和您之前为`ELASTIC_PASSWORD`环境变量设置的密码。

The service is started with a trial license. The trial license enables all  features of Elasticsearch for a trial period of 30 days. After the trial period expires, the license is downgraded to a basic license, which is  free forever. If you prefer to skip the trial and use the basic license, set the value of the `xpack.license.self_generated.type` variable to basic instead. For a detailed feature comparison between the different licenses, refer to our [subscriptions page](https://www.elastic.co/subscriptions).
该服务通过试用许可证启动。试用许可证可在 30 天的试用期内启用 Elasticsearch 的所有功能。试用期满后，许可证将降级为基本许可证，永久免费。如果您希望跳过试用并使用基本许可证，请设置 `xpack.license.self_generated.type` 改为基本变量。有关不同许可证之间的详细功能比较，请参阅我们的[订阅页面](https://www.elastic.co/subscriptions)。

### Connecting to Elasticsearch with language clients 使用语言客户端连接到 Elasticsearch

To connect to the Elasticsearch cluster from a language client, you can use basic authentication with the `elastic` username and the password you set in the environment variable.
要从语言客户端连接到 Elasticsearch 集群，您可以使用`elastic`用户名和在环境变量中设置的密码进行基本身份验证。

您将使用以下连接详细信息：

- **Elasticsearch endpoint**: `http://localhost:9200`
  **Elasticsearch 端点**： `http://localhost:9200`
- **Username**: `elastic`
  **用户名**： `elastic`
- **Password**: `$ELASTIC_PASSWORD` (Value you set in the environment variable) 
  **密码**： `$ELASTIC_PASSWORD` （您在环境变量中设置的值）

For example, to connect with the Python `elasticsearch` client:
例如，要连接Python `elasticsearch`客户端：

```python
import os
from elasticsearch import Elasticsearch

username = 'elastic'
password = os.getenv('ELASTIC_PASSWORD') # Value you set in the environment variable

client = Elasticsearch(
    "http://localhost:9200",
    basic_auth=(username, password)
)

print(client.info())
```

Here’s an example curl command using basic authentication:
以下是使用基本身份验证的示例 curl 命令：

```sh
curl -u elastic:$ELASTIC_PASSWORD \
  -X PUT \
  http://localhost:9200/my-new-index \
  -H 'Content-Type: application/json'
```

### Moving to production 转向生产

This setup is not suitable for production use. For production deployments,  we recommend using our managed service on Elastic Cloud. [Sign up for a free trial](https://cloud.elastic.co/registration) (no credit card required).
此设置不适合生产使用。对于生产部署，我们建议使用 Elastic Cloud 上的托管服务。[注册免费试用](https://cloud.elastic.co/registration)（无需信用卡）。

Otherwise, refer to [Install Elasticsearch](https://www.elastic.co/guide/en/elasticsearch/reference/current/install-elasticsearch.html) to learn about the various options for installing Elasticsearch in a  self-managed production environment, including using Docker.
否则，请参阅[安装 Elasticsearch](https://www.elastic.co/guide/en/elasticsearch/reference/current/install-elasticsearch.html)了解在自我管理的生产环境中安装 Elasticsearch 的各种选项，包括使用 Docker。