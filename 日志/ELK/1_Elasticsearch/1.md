# Secure settings 安全设置

[edit 编辑](https://github.com/elastic/elasticsearch/edit/8.15/docs/reference/setup/secure-settings.asciidoc)

Some settings are sensitive, and relying on filesystem permissions to protect their values is not sufficient. For this use case, Elasticsearch provides a keystore and the [`elasticsearch-keystore` tool](https://www.elastic.co/guide/en/elasticsearch/reference/current/elasticsearch-keystore.html) to manage the settings in the keystore.
某些设置是敏感的，依靠文件系统权限来保护它们的值是不够的。对于此用例，Elasticsearch 提供了密钥库和[`elasticsearch-keystore`工具](https://www.elastic.co/guide/en/elasticsearch/reference/current/elasticsearch-keystore.html)来管理密钥库中的设置。

Only some settings are designed to be read from the keystore. Adding unsupported settings to the keystore causes the validation in the `_nodes/reload_secure_settings` API to fail and if not addressed, will cause Elasticsearch to fail to start. To see whether a setting is supported in the keystore, look for a "Secure" qualifier in the setting reference.
只有某些设置被设计为从密钥库中读取。将不受支持的设置添加到密钥库会导致`_nodes/reload_secure_settings` API 中的验证失败，如果不解决，将导致 Elasticsearch 无法启动。要查看密钥库中是否支持某个设置，请在设置参考中查找“安全”限定符。

All the modifications to the keystore take effect only after restarting Elasticsearch.
所有对keystore的修改只有在重启Elasticsearch后才会生效。

These settings, just like the regular ones in the `elasticsearch.yml` config file, need to be specified on each node in the cluster. Currently, all secure settings are node-specific settings that must have the same value on every node.
这些设置与`elasticsearch.yml`配置文件中的常规设置一样，需要在集群中的每个节点上指定。目前，所有安全设置都是特定于节点的设置，每个节点上必须具有相同的值。

## Reloadable secure settings 可重新加载的安全设置

[edit 编辑](https://github.com/elastic/elasticsearch/edit/8.15/docs/reference/setup/secure-settings.asciidoc)

Just like the settings values in `elasticsearch.yml`, changes to the keystore contents are not automatically applied to the running Elasticsearch node. Re-reading settings requires a node restart. However, certain secure settings are marked as **reloadable**. Such settings can be re-read and applied on a running node.
就像`elasticsearch.yml`中的设置值一样，对密钥库内容的更改不会自动应用于正在运行的 Elasticsearch 节点。重新读取设置需要重新启动节点。但是，某些安全设置被标记为**可重新加载**。此类设置可以重新读取并应用到正在运行的节点上。

You can define these settings before the node is started, or call the [Nodes reload secure settings API](https://www.elastic.co/guide/en/elasticsearch/reference/current/cluster-nodes-reload-secure-settings.html) after the settings are defined to apply them to a running node.
您可以在节点启动之前定义这些设置，或者在定义设置后调用[节点重新加载安全设置 API](https://www.elastic.co/guide/en/elasticsearch/reference/current/cluster-nodes-reload-secure-settings.html)将它们应用到正在运行的节点。

The values of all secure settings, **reloadable** or not, must be identical across all cluster nodes. After making the desired secure settings changes, using the `bin/elasticsearch-keystore add` command, call:
所有安全设置的值（无论是否**可重新加载**）在所有集群节点上都必须相同。进行所需的安全设置更改后，使用 `bin/elasticsearch-keystore add` 命令，调用：



```console
POST _nodes/reload_secure_settings
{
  "secure_settings_password": "keystore-password" 
}
```

Copy as curl 复制为卷曲[Try in Elastic 尝试使用弹性](http://localhost:5601/zzz/app/kibana#/dev_tools/console?load_from=https://www.elastic.co/guide/en/elasticsearch/reference/current/snippets/9.console) 

|      | The password that the Elasticsearch keystore is encrypted with. Elasticsearch 密钥库加密所用的密码。 |
| ---- | ------------------------------------------------------------ |
|      |                                                              |

This API decrypts, re-reads the entire keystore and validates all settings on every cluster node, but only the **reloadable** secure settings are applied. Changes to other settings do not go into effect until the next restart. Once the call returns, the reload has been completed, meaning that all internal data structures dependent on these settings have been changed. Everything should look as if the settings had the new value from the start.
此 API 解密、重新读取整个密钥库并验证每个集群节点上的所有设置，但仅应用**可重新加载的**安全设置。对其他设置的更改只有在下次重新启动后才会生效。一旦调用返回，重新加载就已完成，这意味着依赖于这些设置的所有内部数据结构都已更改。一切都应该看起来好像设置从一开始就具有新值。

When changing multiple **reloadable** secure settings, modify all of them on each cluster node, then issue a [`reload_secure_settings`](https://www.elastic.co/guide/en/elasticsearch/reference/current/cluster-nodes-reload-secure-settings.html) call instead of reloading after each modification.
更改多个**可重新加载的**安全设置时，请在每个集群节点上修改所有这些设置，然后发出[`reload_secure_settings`](https://www.elastic.co/guide/en/elasticsearch/reference/current/cluster-nodes-reload-secure-settings.html)调用，而不是在每次修改后重新加载。

There are reloadable secure settings for:
有可重新加载的安全设置：

- [The Azure repository plugin
  Azure 存储库插件](https://www.elastic.co/guide/en/elasticsearch/reference/current/repository-azure.html)
- [The EC2 discovery plugin EC2 发现插件](https://www.elastic.co/guide/en/elasticsearch/plugins/8.15/discovery-ec2-usage.html#_configuring_ec2_discovery)
- [The GCS repository plugin
  GCS 存储库插件](https://www.elastic.co/guide/en/elasticsearch/reference/current/repository-gcs.html)
- [The S3 repository plugin S3 存储库插件](https://www.elastic.co/guide/en/elasticsearch/reference/current/repository-s3.html)
- [Monitoring settings 监控设置](https://www.elastic.co/guide/en/elasticsearch/reference/current/monitoring-settings.html)
- [Watcher settings 观察者设置](https://www.elastic.co/guide/en/elasticsearch/reference/current/notification-settings.html)
- [JWT realm JWT 领域](https://www.elastic.co/guide/en/elasticsearch/reference/current/security-settings.html#ref-jwt-settings)
- [Active Directory realm 活动目录领域](https://www.elastic.co/guide/en/elasticsearch/reference/current/security-settings.html#ref-ad-settings)
- [LDAP realm LDAP 领域](https://www.elastic.co/guide/en/elasticsearch/reference/current/security-settings.html#ref-ldap-settings)
- [Remote cluster credentials for the API key based security model
  基于 API 密钥的安全模型的远程集群凭据](https://www.elastic.co/guide/en/elasticsearch/reference/current/remote-clusters-settings.html#remote-cluster-credentials-setting)

# Auditing security settings 审核安全设置

[edit 编辑](https://github.com/elastic/elasticsearch/edit/8.15/docs/reference/settings/audit-settings.asciidoc)

You can use [audit logging](https://www.elastic.co/guide/en/elasticsearch/reference/current/enable-audit-logging.html) to record security-related events, such as authentication failures, refused connections, and data-access events. In addition, changes via the APIs to the security configuration, such as creating, updating and removing [native](https://www.elastic.co/guide/en/elasticsearch/reference/current/native-realm.html) and [built-in](https://www.elastic.co/guide/en/elasticsearch/reference/current/built-in-users.html) users, [roles](https://www.elastic.co/guide/en/elasticsearch/reference/current/security-api-put-role.html), [role mappings](https://www.elastic.co/guide/en/elasticsearch/reference/current/security-api-put-role-mapping.html) and [API keys](https://www.elastic.co/guide/en/elasticsearch/reference/current/security-api-create-api-key.html) are also recorded.
您可以使用[审核日志记录](https://www.elastic.co/guide/en/elasticsearch/reference/current/enable-audit-logging.html)来记录与安全相关的事件，例如身份验证失败、拒绝连接和数据访问事件。此外，还记录通过 API 对安全配置进行的更改，例如创建、更新和删除[本机](https://www.elastic.co/guide/en/elasticsearch/reference/current/native-realm.html)和[内置](https://www.elastic.co/guide/en/elasticsearch/reference/current/built-in-users.html)用户、[角色](https://www.elastic.co/guide/en/elasticsearch/reference/current/security-api-put-role.html)、[角色映射](https://www.elastic.co/guide/en/elasticsearch/reference/current/security-api-put-role-mapping.html)和[API 密钥](https://www.elastic.co/guide/en/elasticsearch/reference/current/security-api-create-api-key.html)。

Audit logs are only available on certain subscription levels. For more information, see https://www.elastic.co/subscriptions.
审核日志仅在某些订阅级别可用。有关更多信息，请参阅https://www.elastic.co/subscriptions 。

If configured, auditing settings must be set on every node in the cluster. Static settings, such as `xpack.security.audit.enabled`, must be configured in `elasticsearch.yml` on each node. For dynamic auditing settings, use the [cluster update settings API](https://www.elastic.co/guide/en/elasticsearch/reference/current/cluster-update-settings.html) to ensure the setting is the same on all nodes.
如果已配置，则必须在集群中的每个节点上设置审核设置。静态设置，例如`xpack.security.audit.enabled` ，必须在每个节点上的`elasticsearch.yml`中配置。对于动态审核设置，请使用[集群更新设置 API](https://www.elastic.co/guide/en/elasticsearch/reference/current/cluster-update-settings.html)以确保所有节点上的设置相同。

## General Auditing Settings 常规审核设置

[edit 编辑](https://github.com/elastic/elasticsearch/edit/8.15/docs/reference/settings/audit-settings.asciidoc)



- `xpack.security.audit.enabled`

  ([Static](https://www.elastic.co/guide/en/elasticsearch/reference/current/settings.html#static-cluster-setting)) Set to `true` to enable auditing on the node. The default value is `false`. This puts the auditing events in a dedicated file named `<clustername>_audit.json` on each node.  （[静态](https://www.elastic.co/guide/en/elasticsearch/reference/current/settings.html#static-cluster-setting)）设置为`true`以在节点上启用审核。默认值为`false` 。这会将审核事件放入每个节点上名为`<clustername>_audit.json`专用文件中。 If enabled, this setting must be configured in `elasticsearch.yml` on all nodes in the cluster. 如果启用，则必须在集群中所有节点上的`elasticsearch.yml`中配置此设置。

## Audited Event Settings 审核事件设置

[edit 编辑](https://github.com/elastic/elasticsearch/edit/8.15/docs/reference/settings/audit-settings.asciidoc)

The events and some other information about what gets logged can be controlled by using the following settings:
可以使用以下设置来控制事件和有关记录内容的其他一些信息：



- `xpack.security.audit.logfile.events.include`

  ([Dynamic](https://www.elastic.co/guide/en/elasticsearch/reference/current/settings.html#dynamic-cluster-setting)) Specifies the [kind of events](https://www.elastic.co/guide/en/elasticsearch/reference/current/audit-event-types.html) to print in the auditing output. In addition, `_all` can be used to exhaustively audit all the events, but this is usually discouraged since it will get very verbose. The default list value contains: `access_denied, access_granted, anonymous_access_denied, authentication_failed, connection_denied, tampered_request, run_as_denied, run_as_granted, security_config_change`.  （[动态](https://www.elastic.co/guide/en/elasticsearch/reference/current/settings.html#dynamic-cluster-setting)）指定要在审核输出中打印的[事件类型](https://www.elastic.co/guide/en/elasticsearch/reference/current/audit-event-types.html)。此外， `_all`可用于彻底审核所有事件，但通常不鼓励这样做，因为它会变得非常冗长。默认列表值包含： `access_denied, access_granted, anonymous_access_denied, authentication_failed, connection_denied, tampered_request, run_as_denied, run_as_granted, security_config_change` 。



- `xpack.security.audit.logfile.events.exclude`

  ([Dynamic](https://www.elastic.co/guide/en/elasticsearch/reference/current/settings.html#dynamic-cluster-setting)) Excludes the specified [kind of events](https://www.elastic.co/guide/en/elasticsearch/reference/current/audit-event-types.html) from the include list. This is useful in the case where the `events.include` setting contains the special value `_all`. The default is the empty list.  （[动态](https://www.elastic.co/guide/en/elasticsearch/reference/current/settings.html#dynamic-cluster-setting)）从包含列表中排除指定[类型的事件](https://www.elastic.co/guide/en/elasticsearch/reference/current/audit-event-types.html)。这在`events.include`设置包含特殊值`_all`的情况下很有用。默认为空列表。



- `xpack.security.audit.logfile.events.emit_request_body`

  ([Dynamic](https://www.elastic.co/guide/en/elasticsearch/reference/current/settings.html#dynamic-cluster-setting)) Specifies whether to include the full request body from REST requests as an attribute of certain kinds of audit events. This setting can be used to [audit search queries](https://www.elastic.co/guide/en/elasticsearch/reference/current/auditing-search-queries.html).  （[动态](https://www.elastic.co/guide/en/elasticsearch/reference/current/settings.html#dynamic-cluster-setting)）指定是否包含 REST 请求的完整请求正文作为某些类型审核事件的属性。此设置可用于[审核搜索查询](https://www.elastic.co/guide/en/elasticsearch/reference/current/auditing-search-queries.html)。 The default value is `false`, so request bodies are not printed. 默认值为`false` ，因此不会打印请求正文。  Be advised that sensitive data may be audited in plain text when including the request body in audit events, even though all the security APIs, such as those that change the user’s password, have the credentials filtered out when audited. 请注意，在审核事件中包含请求正文时，敏感数据可能会以纯文本形式进行审核，即使所有安全 API（例如更改用户密码的 API）在审核时都会过滤掉凭据。

## Local Node Info Settings 本地节点信息设置

[edit 编辑](https://github.com/elastic/elasticsearch/edit/8.15/docs/reference/settings/audit-settings.asciidoc)



- `xpack.security.audit.logfile.emit_node_name`

  ([Dynamic](https://www.elastic.co/guide/en/elasticsearch/reference/current/settings.html#dynamic-cluster-setting)) Specifies whether to include the [node name](https://www.elastic.co/guide/en/elasticsearch/reference/current/important-settings.html#node-name) as a field in each audit event. The default value is `false`.  （[动态](https://www.elastic.co/guide/en/elasticsearch/reference/current/settings.html#dynamic-cluster-setting)）指定是否将[节点名称](https://www.elastic.co/guide/en/elasticsearch/reference/current/important-settings.html#node-name)作为字段包含在每个审核事件中。默认值为`false` 。



- `xpack.security.audit.logfile.emit_node_host_address`

  ([Dynamic](https://www.elastic.co/guide/en/elasticsearch/reference/current/settings.html#dynamic-cluster-setting)) Specifies whether to include the node’s IP address as a field in each audit event. The default value is `false`.  （[动态](https://www.elastic.co/guide/en/elasticsearch/reference/current/settings.html#dynamic-cluster-setting)）指定是否将节点的 IP 地址作为字段包含在每个审核事件中。默认值为`false` 。



- `xpack.security.audit.logfile.emit_node_host_name`

  ([Dynamic](https://www.elastic.co/guide/en/elasticsearch/reference/current/settings.html#dynamic-cluster-setting)) Specifies whether to include the node’s host name as a field in each audit event. The default value is `false`.  （[动态](https://www.elastic.co/guide/en/elasticsearch/reference/current/settings.html#dynamic-cluster-setting)）指定是否将节点的主机名作为字段包含在每个审核事件中。默认值为`false` 。



- `xpack.security.audit.logfile.emit_node_id`

  ([Dynamic](https://www.elastic.co/guide/en/elasticsearch/reference/current/settings.html#dynamic-cluster-setting)) Specifies whether to include the node id as a field in each audit event. Unlike [node name](https://www.elastic.co/guide/en/elasticsearch/reference/current/important-settings.html#node-name), whose value might change if the administrator changes the setting in the config file, the node id will persist across cluster restarts and the administrator cannot change it. The default value is `true`.  （[动态](https://www.elastic.co/guide/en/elasticsearch/reference/current/settings.html#dynamic-cluster-setting)）指定是否将节点 ID 作为字段包含在每个审核事件中。与[节点名称](https://www.elastic.co/guide/en/elasticsearch/reference/current/important-settings.html#node-name)不同，如果管理员更改配置文件中的设置，其值可能会更改，节点 ID 将在集群重新启动后持续存在，并且管理员无法更改它。默认值为`true` 。

## Audit Logfile Event Ignore Policies 审核日志文件事件忽略策略

[edit 编辑](https://github.com/elastic/elasticsearch/edit/8.15/docs/reference/settings/audit-settings.asciidoc)

The following settings affect the [ignore policies](https://www.elastic.co/guide/en/elasticsearch/reference/current/audit-log-ignore-policy.html) that enable fine-grained control over which audit events are printed to the log file. All of the settings with the same policy name combine to form a single policy. If an event matches all the conditions of any policy, it is ignored and not printed. Most audit events are subject to the ignore policies. The sole exception are events of the `security_config_change` type, which cannot be filtered out, unless [excluded](https://www.elastic.co/guide/en/elasticsearch/reference/current/auditing-settings.html#xpack-sa-lf-events-exclude) altogether.
以下设置会影响[忽略策略](https://www.elastic.co/guide/en/elasticsearch/reference/current/audit-log-ignore-policy.html)，这些策略可以对将哪些审核事件打印到日志文件进行细粒度控制。具有相同策略名称的所有设置组合起来形成一个策略。如果事件与任何策略的所有条件匹配，则该事件将被忽略且不会打印。大多数审核事件都受忽略策略的约束。唯一的例外是`security_config_change`类型的事件，除非完全[排除](https://www.elastic.co/guide/en/elasticsearch/reference/current/auditing-settings.html#xpack-sa-lf-events-exclude)，否则无法过滤掉这些事件。



- `xpack.security.audit.logfile.events.ignore_filters.<policy_name>.users`

  ([Dynamic](https://www.elastic.co/guide/en/elasticsearch/reference/current/settings.html#dynamic-cluster-setting)) A list of user names or wildcards. The specified policy will not print audit events for users matching these values.  （[动态](https://www.elastic.co/guide/en/elasticsearch/reference/current/settings.html#dynamic-cluster-setting)）用户名或通配符列表。指定的策略不会打印匹配这些值的用户的审核事件。



- `xpack.security.audit.logfile.events.ignore_filters.<policy_name>.realms`

  ([Dynamic](https://www.elastic.co/guide/en/elasticsearch/reference/current/settings.html#dynamic-cluster-setting)) A list of authentication realm names or wildcards. The specified policy will not print audit events for users in these realms.  （[动态](https://www.elastic.co/guide/en/elasticsearch/reference/current/settings.html#dynamic-cluster-setting)）身份验证领域名称或通配符的列表。指定的策略不会打印这些领域中用户的审核事件。



- `xpack.security.audit.logfile.events.ignore_filters.<policy_name>.actions`

  ([Dynamic](https://www.elastic.co/guide/en/elasticsearch/reference/current/settings.html#dynamic-cluster-setting)) A list of action names or wildcards. Action name can be found in the `action` field of the audit event. The specified policy will not print audit events for actions matching these values.



- `xpack.security.audit.logfile.events.ignore_filters.<policy_name>.roles`

  ([Dynamic](https://www.elastic.co/guide/en/elasticsearch/reference/current/settings.html#dynamic-cluster-setting)) A list of role names or wildcards. The specified policy will not print audit events for users that have these roles. If the user has several roles, some of which are **not** covered by the policy, the policy will **not** cover this event.  （[动态](https://www.elastic.co/guide/en/elasticsearch/reference/current/settings.html#dynamic-cluster-setting)）角色名称或通配符列表。指定的策略不会打印具有这些角色的用户的审核事件。如果用户具有多个角色，其中某些角色**不在**策略涵盖范围内，则策略**不会**涵盖此事件。



- `xpack.security.audit.logfile.events.ignore_filters.<policy_name>.indices`

  ([Dynamic](https://www.elastic.co/guide/en/elasticsearch/reference/current/settings.html#dynamic-cluster-setting)) A list of index names or wildcards. The specified policy will not print audit events when all the indices in the event match these values. If the event concerns several indices, some of which are **not** covered by the policy, the policy will **not** cover this event.  （[动态](https://www.elastic.co/guide/en/elasticsearch/reference/current/settings.html#dynamic-cluster-setting)）索引名称或通配符的列表。当事件中的所有索引都与这些值匹配时，指定的策略将不会打印审核事件。如果该事件涉及多个指数，而其中一些指数**不在**保单承保范围内，则保单将**不**承保该事件。

# Circuit breaker settings 断路器设置

[edit 编辑](https://github.com/elastic/elasticsearch/edit/8.15/docs/reference/modules/indices/circuit_breaker.asciidoc)

Elasticsearch contains multiple circuit breakers used to prevent operations from  causing an OutOfMemoryError. Each breaker specifies a limit for how much memory it can use. Additionally, there is a parent-level breaker that  specifies the total amount of memory that can be used across all  breakers.
Elasticsearch 包含多个断路器，用于防止操作导致 OutOfMemoryError。每个断路器都指定其可以使用的内存量的限制。此外，还有一个父级断路器，用于指定所有断路器可以使用的内存总量。

Except where noted otherwise, these settings can be dynamically updated on a live cluster with the [cluster-update-settings](https://www.elastic.co/guide/en/elasticsearch/reference/current/cluster-update-settings.html) API.
除非另有说明，这些设置可以使用[cluster-update-settings](https://www.elastic.co/guide/en/elasticsearch/reference/current/cluster-update-settings.html) API 在实时集群上动态更新。

For information about circuit breaker errors, see [Circuit breaker errors](https://www.elastic.co/guide/en/elasticsearch/reference/current/circuit-breaker-errors.html).
有关断路器错误的信息，请参阅[断路器错误](https://www.elastic.co/guide/en/elasticsearch/reference/current/circuit-breaker-errors.html)。

## Parent circuit breaker 母断路器

[edit 编辑](https://github.com/elastic/elasticsearch/edit/8.15/docs/reference/modules/indices/circuit_breaker.asciidoc)

The parent-level breaker can be configured with the following settings:
父级断路器可以配置以下设置：

- `indices.breaker.total.use_real_memory`

  ([Static](https://www.elastic.co/guide/en/elasticsearch/reference/current/settings.html#static-cluster-setting)) Determines whether the parent breaker should take real memory usage into account (`true`) or only consider the amount that is reserved by child circuit breakers (`false`). Defaults to `true`.  （[静态](https://www.elastic.co/guide/en/elasticsearch/reference/current/settings.html#static-cluster-setting)）确定父断路器是否应考虑实际内存使用情况 ( `true` )，还是仅考虑子断路器保留的内存量 ( `false` )。默认为`true` 。



- `indices.breaker.total.limit` [![logo cloud](https://doc-icons.s3.us-east-2.amazonaws.com/logo_cloud.svg)](https://www.elastic.co/cloud/elasticsearch-service/signup?page=docs&placement=docs-body)

  ([Dynamic](https://www.elastic.co/guide/en/elasticsearch/reference/current/settings.html#dynamic-cluster-setting)) Starting limit for overall parent breaker. Defaults to 70% of JVM heap if `indices.breaker.total.use_real_memory` is `false`. If `indices.breaker.total.use_real_memory` is `true`, defaults to 95% of the JVM heap.  （[动态](https://www.elastic.co/guide/en/elasticsearch/reference/current/settings.html#dynamic-cluster-setting)）总体父断路器的起始限制。默认为 JVM 堆的 70%，如果 `indices.breaker.total.use_real_memory` 是`false` 。如果 `indices.breaker.total.use_real_memory` 为`true` ，默认为 JVM 堆的 95%。

## Field data circuit breaker 现场数据断路器

[edit 编辑](https://github.com/elastic/elasticsearch/edit/8.15/docs/reference/modules/indices/circuit_breaker.asciidoc)

The field data circuit breaker estimates the heap memory required to load a field into the [field data cache](https://www.elastic.co/guide/en/elasticsearch/reference/current/modules-fielddata.html). If loading the field would cause the cache to exceed a predefined memory limit, the circuit breaker stops the operation and returns an error.
字段数据断路器估计将字段加载到[字段数据缓存](https://www.elastic.co/guide/en/elasticsearch/reference/current/modules-fielddata.html)所需的堆内存。如果加载字段会导致缓存超出预定义的内存限制，则断路器会停止操作并返回错误。



- `indices.breaker.fielddata.limit` [![logo cloud](https://doc-icons.s3.us-east-2.amazonaws.com/logo_cloud.svg)](https://www.elastic.co/cloud/elasticsearch-service/signup?page=docs&placement=docs-body)

  ([Dynamic](https://www.elastic.co/guide/en/elasticsearch/reference/current/settings.html#dynamic-cluster-setting)) Limit for fielddata breaker. Defaults to 40% of JVM heap.  （[动态](https://www.elastic.co/guide/en/elasticsearch/reference/current/settings.html#dynamic-cluster-setting)）字段数据断路器的限制。默认为 JVM 堆的 40%。



- `indices.breaker.fielddata.overhead` [![logo cloud](https://doc-icons.s3.us-east-2.amazonaws.com/logo_cloud.svg)](https://www.elastic.co/cloud/elasticsearch-service/signup?page=docs&placement=docs-body)

  ([Dynamic](https://www.elastic.co/guide/en/elasticsearch/reference/current/settings.html#dynamic-cluster-setting)) A constant that all field data estimations are multiplied with to determine a final estimation. Defaults to `1.03`.  （[动态](https://www.elastic.co/guide/en/elasticsearch/reference/current/settings.html#dynamic-cluster-setting)）所有现场数据估计值相乘以确定最终估计值的常量。默认为`1.03` 。

## Request circuit breaker 请求断路器

[edit 编辑](https://github.com/elastic/elasticsearch/edit/8.15/docs/reference/modules/indices/circuit_breaker.asciidoc)

The request circuit breaker allows Elasticsearch to prevent per-request data structures (for example, memory used for calculating aggregations during a request) from exceeding a certain amount of memory.
请求断路器允许 Elasticsearch 防止每个请求的数据结构（例如，在请求期间用于计算聚合的内存）超过一定的内存量。



- `indices.breaker.request.limit` [![logo cloud](https://doc-icons.s3.us-east-2.amazonaws.com/logo_cloud.svg)](https://www.elastic.co/cloud/elasticsearch-service/signup?page=docs&placement=docs-body)

  ([Dynamic](https://www.elastic.co/guide/en/elasticsearch/reference/current/settings.html#dynamic-cluster-setting)) Limit for request breaker, defaults to 60% of JVM heap.  （[动态](https://www.elastic.co/guide/en/elasticsearch/reference/current/settings.html#dynamic-cluster-setting)）请求断路器的限制，默认为 JVM 堆的 60%。



- `indices.breaker.request.overhead` [![logo cloud](https://doc-icons.s3.us-east-2.amazonaws.com/logo_cloud.svg)](https://www.elastic.co/cloud/elasticsearch-service/signup?page=docs&placement=docs-body)

  ([Dynamic](https://www.elastic.co/guide/en/elasticsearch/reference/current/settings.html#dynamic-cluster-setting)) A constant that all request estimations are multiplied with to determine a final estimation. Defaults to `1`.  （[动态](https://www.elastic.co/guide/en/elasticsearch/reference/current/settings.html#dynamic-cluster-setting)）所有请求估计值相乘以确定最终估计值的常量。默认为`1` 。

## In flight requests circuit breaker 飞行中请求断路器

[edit 编辑](https://github.com/elastic/elasticsearch/edit/8.15/docs/reference/modules/indices/circuit_breaker.asciidoc)

The in flight requests circuit breaker allows Elasticsearch to limit the memory usage of all currently active incoming requests on transport or HTTP level from exceeding a certain amount of memory on a node. The memory usage is based on the content length of the request itself. This circuit breaker also considers that memory is not only needed for representing the raw request but also as a structured object which is reflected by default overhead.
飞行中请求断路器允许 Elasticsearch 限制传输或 HTTP  级别上所有当前活动传入请求的内存使用量，以免超过节点上的特定内存量。内存使用量基于请求本身的内容长度。该断路器还认为内存不仅需要用于表示原始请求，而且还需要作为默认开销反映的结构化对象。

- `network.breaker.inflight_requests.limit`

  ([Dynamic](https://www.elastic.co/guide/en/elasticsearch/reference/current/settings.html#dynamic-cluster-setting)) Limit for in flight requests breaker, defaults to 100% of JVM heap. This means that it is bound by the limit configured for the parent circuit breaker.  （[动态](https://www.elastic.co/guide/en/elasticsearch/reference/current/settings.html#dynamic-cluster-setting)）飞行中请求断路器的限制，默认为 JVM 堆的 100%。这意味着它受到为父断路器配置的限制的约束。

- `network.breaker.inflight_requests.overhead`

  ([Dynamic](https://www.elastic.co/guide/en/elasticsearch/reference/current/settings.html#dynamic-cluster-setting)) A constant that all in flight requests estimations are multiplied with to determine a final estimation. Defaults to 2.  （[动态](https://www.elastic.co/guide/en/elasticsearch/reference/current/settings.html#dynamic-cluster-setting)）一个常量，将所有飞行中请求估计值相乘以确定最终估计值。默认为 2。

## Script compilation circuit breaker 脚本编译断路器

[edit 编辑](https://github.com/elastic/elasticsearch/edit/8.15/docs/reference/modules/indices/circuit_breaker.asciidoc)

Slightly different than the previous memory-based circuit breaker, the script compilation circuit breaker limits the number of inline script compilations within a period of time.
与之前基于内存的断路器略有不同，脚本编译断路器限制了一段时间内内联脚本编译的数量。

See the "prefer-parameters" section of the [scripting](https://www.elastic.co/guide/en/elasticsearch/reference/current/modules-scripting-using.html) documentation for more information.
有关详细信息，请参阅[脚本](https://www.elastic.co/guide/en/elasticsearch/reference/current/modules-scripting-using.html)文档的“首选参数”部分。

- `script.max_compilations_rate`

  ([Dynamic](https://www.elastic.co/guide/en/elasticsearch/reference/current/settings.html#dynamic-cluster-setting)) Limit for the number of unique dynamic scripts within a certain interval that are allowed to be compiled. Defaults to `150/5m`, meaning 150 every 5 minutes.  ([动态](https://www.elastic.co/guide/en/elasticsearch/reference/current/settings.html#dynamic-cluster-setting)) 在一定的时间间隔内允许编译的唯一动态脚本的数量限制。默认为`150/5m` ，表示每 5 分钟 150 次。

If the cluster regularly hits the given `max_compilation_rate`, it’s possible the script cache is undersized, use [Nodes Stats](https://www.elastic.co/guide/en/elasticsearch/reference/current/cluster-nodes-stats.html) to inspect the number of recent cache evictions, `script.cache_evictions_history` and compilations `script.compilations_history`.  If there are a large number of recent cache evictions or compilations, the script cache may be undersized, consider doubling the size of the script cache via the setting `script.cache.max_size`.
如果集群定期达到给定的`max_compilation_rate` ，则脚本缓存可能过小，请使用[Nodes Stats](https://www.elastic.co/guide/en/elasticsearch/reference/current/cluster-nodes-stats.html)检查最近缓存驱逐的数量， `script.cache_evictions_history` 和编译`script.compilations_history` 。如果最近有大量缓存逐出或编译，则脚本缓存可能过小，请考虑通过设置`script.cache.max_size`将脚本缓存的大小加倍。

## Regex circuit breaker 正则表达式断路器

[edit 编辑](https://github.com/elastic/elasticsearch/edit/8.15/docs/reference/modules/indices/circuit_breaker.asciidoc)

Poorly written regular expressions can degrade cluster stability and performance. The regex circuit breaker limits the use and complexity of [regex in Painless scripts](https://www.elastic.co/guide/en/elasticsearch/painless/8.15/painless-regexes.html).
写得不好的正则表达式会降低集群的稳定性和性能。正则表达式断路器限制了[正则表达式在 Painless 脚本中](https://www.elastic.co/guide/en/elasticsearch/painless/8.15/painless-regexes.html)的使用和复杂性。



- `script.painless.regex.enabled`

  ([Static](https://www.elastic.co/guide/en/elasticsearch/reference/current/settings.html#static-cluster-setting)) Enables regex in Painless scripts. Accepts:  （[静态](https://www.elastic.co/guide/en/elasticsearch/reference/current/settings.html#static-cluster-setting)）在 Painless 脚本中启用正则表达式。接受：   `limited` (Default)  `limited` （默认）  Enables regex but limits complexity using the [`script.painless.regex.limit-factor`](https://www.elastic.co/guide/en/elasticsearch/reference/current/circuit-breaker.html#script-painless-regex-limit-factor) cluster setting.  启用正则表达式，但使用以下限制复杂性集群设置。  `true`  Enables regex with no complexity limits. Disables the regex circuit breaker.  启用没有复杂性限制的正则表达式。禁用正则表达式断路器。  `false`  Disables regex. Any Painless script containing a regular expression returns an error.  禁用正则表达式。任何包含正则表达式的 Painless 脚本都会返回错误。



- `script.painless.regex.limit-factor`

  ([Static](https://www.elastic.co/guide/en/elasticsearch/reference/current/settings.html#static-cluster-setting)) Limits the number of characters a regular expression in a Painless script can consider. Elasticsearch calculates this limit by multiplying the setting value by the script input’s character length.  （[静态](https://www.elastic.co/guide/en/elasticsearch/reference/current/settings.html#static-cluster-setting)）限制 Painless 脚本中的正则表达式可以考虑的字符数。 Elasticsearch 通过将设置值乘以脚本输入的字符长度来计算此限制。 For example, the input `foobarbaz` has a character length of `9`. If `script.painless.regex.limit-factor` is `6`, a regular expression on `foobarbaz` can consider up to 54 (9 * 6) characters. If the expression exceeds this limit, it triggers the regex circuit breaker and returns an error. 例如，输入`foobarbaz`字符长度为`9` 。如果 `script.painless.regex.limit-factor` 是`6` ， `foobarbaz`上的正则表达式最多可以考虑 54 (9 * 6) 个字符。如果表达式超出此限制，则会触发正则表达式断路器并返回错误。 Elasticsearch only applies this limit if [`script.painless.regex.enabled`](https://www.elastic.co/guide/en/elasticsearch/reference/current/circuit-breaker.html#script-painless-regex-enabled) is `limited`. Elasticsearch 仅在[`script.painless.regex.enabled`](https://www.elastic.co/guide/en/elasticsearch/reference/current/circuit-breaker.html#script-painless-regex-enabled)受到`limited`时才应用此限制。

### EQL circuit breaker EQL断路器

[edit 编辑](https://github.com/elastic/elasticsearch/edit/8.15/docs/reference/modules/indices/circuit_breaker.asciidoc)

When a [sequence](https://www.elastic.co/guide/en/elasticsearch/reference/current/eql-syntax.html#eql-sequences) query is executed, the node handling the query needs to keep some structures in memory, which are needed by the algorithm implementing the sequence matching. When large amounts of data need to be processed, and/or a large amount of matched sequences is requested by the user (by setting the [size](https://www.elastic.co/guide/en/elasticsearch/reference/current/eql-search-api.html#eql-search-api-params-size) query param), the memory occupied by those structures could potentially exceed the available memory of the JVM. This would cause an `OutOfMemory` exception which would bring down the node.
当执行[序列](https://www.elastic.co/guide/en/elasticsearch/reference/current/eql-syntax.html#eql-sequences)查询时，处理查询的节点需要在内存中保留一些结构，这些结构是实现序列匹配的算法所需要的。当需要处理大量数据和/或用户请求大量匹配序列（通过设置[大小](https://www.elastic.co/guide/en/elasticsearch/reference/current/eql-search-api.html#eql-search-api-params-size)查询参数）时，这些结构占用的内存可能会超过 JVM 的可用内存。这将导致`OutOfMemory`异常，进而导致节点宕机。

To prevent this from happening, a special [circuit breaker](https://www.elastic.co/guide/en/elasticsearch/reference/current/circuit-breaker.html) is used, which limits the memory allocation during the execution of a [sequence](https://www.elastic.co/guide/en/elasticsearch/reference/current/eql-syntax.html#eql-sequences) query. When the breaker is triggered, an `org.elasticsearch.common.breaker.CircuitBreakingException` is thrown and a descriptive error message including `circuit_breaking_exception` is returned to the user.
为了防止这种情况发生，使用了特殊的[断路器](https://www.elastic.co/guide/en/elasticsearch/reference/current/circuit-breaker.html)，它限制了[序列](https://www.elastic.co/guide/en/elasticsearch/reference/current/eql-syntax.html#eql-sequences)查询执行期间的内存分配。当断路器被触发时， `org.elasticsearch.common.breaker.CircuitBreakingException` 被抛出，并向用户返回一条包含`circuit_breaking_exception`的描述性错误消息。

This [circuit breaker](https://www.elastic.co/guide/en/elasticsearch/reference/current/circuit-breaker.html) can be configured using the following settings:
可以使用以下设置来配置该[断路器](https://www.elastic.co/guide/en/elasticsearch/reference/current/circuit-breaker.html)：

- `breaker.eql_sequence.limit`

  ([Dynamic](https://www.elastic.co/guide/en/elasticsearch/reference/current/cluster-update-settings.html)) The limit for circuit breaker used to restrict the memory utilisation during the execution of an EQL sequence query. This value is defined as a percentage of the JVM heap. Defaults to `50%`. If the [parent circuit breaker](https://www.elastic.co/guide/en/elasticsearch/reference/current/circuit-breaker.html#parent-circuit-breaker) is set to a value less than `50%`, this setting uses that value as its default instead.  （[动态](https://www.elastic.co/guide/en/elasticsearch/reference/current/cluster-update-settings.html)）断路器限制，用于限制执行 EQL 序列查询期间的内存利用率。该值定义为 JVM 堆的百分比。默认为`50%` 。如果[父断路器](https://www.elastic.co/guide/en/elasticsearch/reference/current/circuit-breaker.html#parent-circuit-breaker)设置为小于`50%`值，则此设置将使用该值作为默认值。

- `breaker.eql_sequence.overhead`

  ([Dynamic](https://www.elastic.co/guide/en/elasticsearch/reference/current/cluster-update-settings.html)) A constant that sequence query memory estimates are multiplied by to determine a final estimate. Defaults to `1`.  （[动态](https://www.elastic.co/guide/en/elasticsearch/reference/current/cluster-update-settings.html)）一个常量，序列查询内存估计乘以该常量以确定最终估计。默认为`1` 。

- `breaker.eql_sequence.type`

  ([Static](https://www.elastic.co/guide/en/elasticsearch/reference/current/settings.html#static-cluster-setting)) Circuit breaker type. Valid values are:  （[静态](https://www.elastic.co/guide/en/elasticsearch/reference/current/settings.html#static-cluster-setting)）断路器类型。有效值为：   `memory` (Default)  `memory` （默认）  The breaker limits memory usage for EQL sequence queries.  断路器限制 EQL 序列查询的内存使用。  `noop`  Disables the breaker. 禁用断路器。

## Machine learning circuit breaker 机器学习断路器

[edit 编辑](https://github.com/elastic/elasticsearch/edit/8.15/docs/reference/modules/indices/circuit_breaker.asciidoc)

- `breaker.model_inference.limit`

  ([Dynamic](https://www.elastic.co/guide/en/elasticsearch/reference/current/cluster-update-settings.html)) The limit for the trained model circuit breaker. This value is defined as a percentage of the JVM heap. Defaults to `50%`. If the [parent circuit breaker](https://www.elastic.co/guide/en/elasticsearch/reference/current/circuit-breaker.html#parent-circuit-breaker) is set to a value less than `50%`, this setting uses that value as its default instead.  （[动态](https://www.elastic.co/guide/en/elasticsearch/reference/current/cluster-update-settings.html)）经过训练的模型断路器的限制。该值定义为 JVM 堆的百分比。默认为`50%` 。如果[父断路器](https://www.elastic.co/guide/en/elasticsearch/reference/current/circuit-breaker.html#parent-circuit-breaker)设置为小于`50%`值，则此设置将使用该值作为默认值。

- `breaker.model_inference.overhead`

  ([Dynamic](https://www.elastic.co/guide/en/elasticsearch/reference/current/cluster-update-settings.html)) A constant that all trained model estimations are multiplied by to determine a final estimation. See [Circuit breaker settings](https://www.elastic.co/guide/en/elasticsearch/reference/current/circuit-breaker.html). Defaults to `1`.  （[动态](https://www.elastic.co/guide/en/elasticsearch/reference/current/cluster-update-settings.html)）一个常量，所有经过训练的模型估计都会乘以该常量以确定最终估计。请参阅[断路器设置](https://www.elastic.co/guide/en/elasticsearch/reference/current/circuit-breaker.html)。默认为`1` 。

- `breaker.model_inference.type`

  ([Static](https://www.elastic.co/guide/en/elasticsearch/reference/current/settings.html#static-cluster-setting)) The underlying type of the circuit breaker. There are two valid options: `noop` and `memory`. `noop` means the circuit breaker does nothing to prevent too much memory usage. `memory` means the circuit breaker tracks the memory used by trained models and can potentially break and prevent `OutOfMemory` errors. The default value is `memory`.  （[静态](https://www.elastic.co/guide/en/elasticsearch/reference/current/settings.html#static-cluster-setting)）断路器的基础类型。有两个有效选项： `noop`和`memory` 。 `noop`意味着断路器不采取任何措施来防止过多的内存使用。 `memory`意味着断路器会跟踪经过训练的模型使用的内存，并且可以潜在地破坏和防止`OutOfMemory`错误。默认值是`memory` 。

# Cluster-level shard allocation and routing settings 集群级分片分配和路由设置

[edit 编辑](https://github.com/elastic/elasticsearch/edit/8.15/docs/reference/modules/cluster.asciidoc)

Shard allocation is the process of assigning shard copies to nodes. This can happen during initial recovery, replica allocation, rebalancing, when  nodes are added to or removed from the cluster, or when cluster or index settings that impact allocation are updated.
分片分配是将分片副本分配给节点的过程。在初始恢复、副本分配、重新平衡期间、在集群中添加或删除节点时，或者影响分配的集群或索引设置更新时，可能会发生这种情况。

One of the main roles of the master is to decide which shards to allocate to which nodes, and when to move shards between nodes in order to rebalance the cluster.
主节点的主要角色之一是决定将哪些分片分配给哪些节点，以及何时在节点之间移动分片以重新平衡集群。

There are a number of settings available to control the shard allocation process:
有许多设置可用于控制分片分配过程：

- [Cluster-level shard allocation settings](https://www.elastic.co/guide/en/elasticsearch/reference/current/modules-cluster.html#cluster-shard-allocation-settings) control allocation and rebalancing operations. 
  [集群级分片分配设置](https://www.elastic.co/guide/en/elasticsearch/reference/current/modules-cluster.html#cluster-shard-allocation-settings)控制分配和重新平衡操作。
- [Disk-based shard allocation settings](https://www.elastic.co/guide/en/elasticsearch/reference/current/modules-cluster.html#disk-based-shard-allocation) explains how Elasticsearch takes available disk space into account, and the related settings. 
  [基于磁盘的分片分配设置](https://www.elastic.co/guide/en/elasticsearch/reference/current/modules-cluster.html#disk-based-shard-allocation)解释了 Elasticsearch 如何考虑可用磁盘空间以及相关设置。
- [Shard allocation awareness](https://www.elastic.co/guide/en/elasticsearch/reference/current/modules-cluster.html#shard-allocation-awareness) and [Forced awareness](https://www.elastic.co/guide/en/elasticsearch/reference/current/modules-cluster.html#forced-awareness) control how shards can be distributed across different racks or availability zones. 
  [分片分配感知](https://www.elastic.co/guide/en/elasticsearch/reference/current/modules-cluster.html#shard-allocation-awareness)和[强制感知](https://www.elastic.co/guide/en/elasticsearch/reference/current/modules-cluster.html#forced-awareness)控制分片如何分布在不同的机架或可用区域。
- [Cluster-level shard allocation filtering](https://www.elastic.co/guide/en/elasticsearch/reference/current/modules-cluster.html#cluster-shard-allocation-filtering) allows certain nodes or groups of nodes excluded from allocation so that they can be decommissioned. 
  [集群级分片分配过滤](https://www.elastic.co/guide/en/elasticsearch/reference/current/modules-cluster.html#cluster-shard-allocation-filtering)允许将某些节点或节点组排除在分配之外，以便它们可以退役。

Besides these, there are a few other [miscellaneous cluster-level settings](https://www.elastic.co/guide/en/elasticsearch/reference/current/misc-cluster-settings.html).
除此之外，还有一些其他[杂项的集群级别设置](https://www.elastic.co/guide/en/elasticsearch/reference/current/misc-cluster-settings.html)。

## Cluster-level shard allocation settings 集群级分片分配设置

[edit 编辑](https://github.com/elastic/elasticsearch/edit/8.15/docs/reference/modules/cluster/shards_allocation.asciidoc)

You can use the following settings to control shard allocation and recovery:
您可以使用以下设置来控制分片分配和恢复：



- `cluster.routing.allocation.enable`

  ([Dynamic](https://www.elastic.co/guide/en/elasticsearch/reference/current/settings.html#dynamic-cluster-setting)) Enable or disable allocation for specific kinds of shards: （[动态](https://www.elastic.co/guide/en/elasticsearch/reference/current/settings.html#dynamic-cluster-setting)）启用或禁用特定类型分片的分配：  `all` -             (default) Allows shard allocation for all kinds of shards.  `all` -（默认）允许为所有类型的分片分配分片。 `primaries` -       Allows shard allocation only for primary shards.  `primaries` - 仅允许为主分片进行分片分配。 `new_primaries` -   Allows shard allocation only for primary shards for new indices.  `new_primaries` - 只允许为新索引的主分片分配分片。 `none` -            No shard allocations of any kind are allowed for any indices.  `none` - 任何索引都不允许进行任何类型的分片分配。  This setting does not affect the recovery of local primary shards when restarting a node. A restarted node that has a copy of an unassigned primary shard will recover that primary immediately, assuming that its allocation id matches one of the active allocation ids in the cluster state. 此设置不会影响重启节点时本地主分片的恢复。具有未分配主分片副本的重新启动节点将立即恢复该主分片，假设其分配 ID 与集群状态中的活动分配 ID 之一匹配。



- `cluster.routing.allocation.same_shard.host`

  ([Dynamic](https://www.elastic.co/guide/en/elasticsearch/reference/current/settings.html#dynamic-cluster-setting)) If `true`, forbids multiple copies of a shard from being allocated to distinct nodes on the same host, i.e. which have the same network address. Defaults to `false`, meaning that copies of a shard may sometimes be allocated to nodes on the same host. This setting is only relevant if you run multiple nodes on each host.  （[动态](https://www.elastic.co/guide/en/elasticsearch/reference/current/settings.html#dynamic-cluster-setting)）如果为`true` ，则禁止将分片的多个副本分配给同一主机上的不同节点，即具有相同网络地址的节点。默认为`false` ，这意味着分片的副本有时可能会分配给同一主机上的节点。仅当您在每个主机上运行多个节点时，此设置才相关。

- `cluster.routing.allocation.node_concurrent_incoming_recoveries`

  ([Dynamic](https://www.elastic.co/guide/en/elasticsearch/reference/current/settings.html#dynamic-cluster-setting)) How many concurrent incoming shard recoveries are allowed to happen on a node. Incoming recoveries are the recoveries where the target shard (most likely the replica unless a shard is relocating) is allocated on the node. Defaults to `2`. Increasing this setting may cause shard movements to have a performance impact on other activity in your cluster, but may not make shard movements complete noticeably sooner. We do not recommend adjusting this setting from its default of `2`.  （[动态](https://www.elastic.co/guide/en/elasticsearch/reference/current/settings.html#dynamic-cluster-setting)）节点上允许发生多少并发传入分片恢复。传入恢复是在节点上分配目标分片（很可能是副本，除非分片正在重新定位）的恢复。默认为`2` 。增加此设置可能会导致分片移动对集群中的其他活动产生性能影响，但可能不会使分片移动明显更快地完成。我们不建议调整此设置的默认值`2` 。

- `cluster.routing.allocation.node_concurrent_outgoing_recoveries`

  ([Dynamic](https://www.elastic.co/guide/en/elasticsearch/reference/current/settings.html#dynamic-cluster-setting)) How many concurrent outgoing shard recoveries are allowed to happen on a node. Outgoing recoveries are the recoveries where the source shard (most likely the primary unless a shard is relocating) is allocated on the node. Defaults to `2`. Increasing this setting may cause shard movements to have a performance impact on other activity in your cluster, but may not make shard movements complete noticeably sooner. We do not recommend adjusting this setting from its default of `2`.  （[动态](https://www.elastic.co/guide/en/elasticsearch/reference/current/settings.html#dynamic-cluster-setting)）节点上允许发生多少并发传出分片恢复。传出恢复是在节点上分配源分片（很可能是主分片，除非分片正在重新定位）的恢复。默认为`2` 。增加此设置可能会导致分片移动对集群中的其他活动产生性能影响，但可能不会使分片移动明显更快地完成。我们不建议调整此设置的默认值`2` 。

- `cluster.routing.allocation.node_concurrent_recoveries`

  ([Dynamic](https://www.elastic.co/guide/en/elasticsearch/reference/current/settings.html#dynamic-cluster-setting)) A shortcut to set both `cluster.routing.allocation.node_concurrent_incoming_recoveries` and `cluster.routing.allocation.node_concurrent_outgoing_recoveries`. The value of this setting takes effect only when the more specific setting is not configured.  Defaults to `2`. Increasing this setting may cause shard movements to have a performance impact on other activity in your cluster, but may not make shard movements complete noticeably sooner. We do not recommend adjusting this setting from its default of `2`.  （[动态](https://www.elastic.co/guide/en/elasticsearch/reference/current/settings.html#dynamic-cluster-setting)）设置两者的快捷方式 `cluster.routing.allocation.node_concurrent_incoming_recoveries` 和 `cluster.routing.allocation.node_concurrent_outgoing_recoveries` 。仅当未配置更具体的设置时，此设置的值才会生效。默认为`2` 。增加此设置可能会导致分片移动对集群中的其他活动产生性能影响，但可能不会使分片移动明显更快地完成。我们不建议调整此设置的默认值`2` 。

- `cluster.routing.allocation.node_initial_primaries_recoveries`

  ([Dynamic](https://www.elastic.co/guide/en/elasticsearch/reference/current/settings.html#dynamic-cluster-setting)) While the recovery of replicas happens over the network, the recovery of an unassigned primary after node restart uses data from the local disk. These should be fast so more initial primary recoveries can happen in parallel on each node. Defaults to `4`. Increasing this setting may cause shard recoveries to have a performance impact on other activity in your cluster, but may not make shard recoveries complete noticeably sooner. We do not recommend adjusting this setting from its default of `4`.  （[动态](https://www.elastic.co/guide/en/elasticsearch/reference/current/settings.html#dynamic-cluster-setting)）虽然副本的恢复通过网络进行，但节点重新启动后未分配的主节点的恢复使用本地磁盘中的数据。这些应该很快，以便更多的初始主恢复可以在每个节点上并行发生。默认为`4` 。增加此设置可能会导致分片恢复对集群中的其他活动产生性能影响，但可能不会使分片恢复明显更快地完成。我们不建议调整此设置的默认值`4` 。

## Shard rebalancing settings 分片重新平衡设置

[edit 编辑](https://github.com/elastic/elasticsearch/edit/8.15/docs/reference/modules/cluster/shards_allocation.asciidoc)

A cluster is *balanced* when it has an equal number of shards on each node, with all nodes needing equal resources, without having a concentration of shards from any index on any node. Elasticsearch runs an automatic process called *rebalancing* which moves shards between the nodes in your cluster to improve its balance. Rebalancing obeys all other shard allocation rules such as [allocation filtering](https://www.elastic.co/guide/en/elasticsearch/reference/current/modules-cluster.html#cluster-shard-allocation-filtering) and [forced awareness](https://www.elastic.co/guide/en/elasticsearch/reference/current/modules-cluster.html#forced-awareness) which may prevent it from completely balancing the cluster. In that case, rebalancing strives to achieve the most balanced cluster possible within the rules you have configured. If you are using [data tiers](https://www.elastic.co/guide/en/elasticsearch/reference/current/data-tiers.html) then Elasticsearch automatically applies allocation filtering rules to place each shard within the appropriate tier. These rules mean that the balancer works independently within each tier.
当集群的每个节点上有相同数量的分片，并且所有节点需要相同的资源，并且任何节点上的任何索引的分片不集中时，集群就是*平衡的*。 Elasticsearch 运行一个称为*重新平衡*的自动过程，该过程会在集群中的节点之间移动分片以改善其平衡。重新平衡遵循所有其他分片分配规则，例如[分配过滤](https://www.elastic.co/guide/en/elasticsearch/reference/current/modules-cluster.html#cluster-shard-allocation-filtering)和[强制感知](https://www.elastic.co/guide/en/elasticsearch/reference/current/modules-cluster.html#forced-awareness)，这可能会阻止它完全平衡集群。在这种情况下，重新平衡会努力在您配置的规则内实现最平衡的集群。如果您使用[数据层](https://www.elastic.co/guide/en/elasticsearch/reference/current/data-tiers.html)，则 Elasticsearch 会自动应用分配过滤规则，将每个分片放置在适当的层中。这些规则意味着平衡器在每一层内独立工作。

You can use the following settings to control the rebalancing of shards across the cluster:
您可以使用以下设置来控制集群中分片的重新平衡：

- `cluster.routing.allocation.allow_rebalance`

  ([Dynamic](https://www.elastic.co/guide/en/elasticsearch/reference/current/settings.html#dynamic-cluster-setting)) Specify when shard rebalancing is allowed: （[动态](https://www.elastic.co/guide/en/elasticsearch/reference/current/settings.html#dynamic-cluster-setting)）指定何时允许分片重新平衡：  `always` -                    Always allow rebalancing.  `always` - 始终允许重新平衡。 `indices_primaries_active` -  Only when all primaries in the cluster are allocated.  `indices_primaries_active` - 仅当集群中的所有主节点都已分配时。 `indices_all_active` -        (default) Only when all shards (primaries and replicas) in the cluster are allocated.  `indices_all_active` -（默认）仅当集群中的所有分片（主分片和副本分片）均已分配时。

- `cluster.routing.rebalance.enable`

  ([Dynamic](https://www.elastic.co/guide/en/elasticsearch/reference/current/settings.html#dynamic-cluster-setting)) Enable or disable rebalancing for specific kinds of shards: （[动态](https://www.elastic.co/guide/en/elasticsearch/reference/current/settings.html#dynamic-cluster-setting)）启用或禁用特定类型分片的重新平衡：  `all` -         (default) Allows shard balancing for all kinds of shards.  `all` -（默认）允许所有类型的分片进行分片平衡。 `primaries` -   Allows shard balancing only for primary shards.  `primaries` - 仅允许主分片进行分片平衡。 `replicas` -    Allows shard balancing only for replica shards.  `replicas` - 仅允许副本分片的分片平衡。 `none` -        No shard balancing of any kind are allowed for any indices.  `none` - 任何索引都不允许任何类型的分片平衡。  Rebalancing is important to ensure the cluster returns to a healthy and fully resilient state after a disruption. If you adjust this setting, remember to set it back to `all` as soon as possible. 重新平衡对于确保集群在中断后恢复到健康且完全有弹性的状态非常重要。如果您调整此设置，请记住尽快将其设置回`all` 。

- `cluster.routing.allocation.cluster_concurrent_rebalance`

  ([Dynamic](https://www.elastic.co/guide/en/elasticsearch/reference/current/settings.html#dynamic-cluster-setting)) Defines the number of concurrent shard rebalances are allowed across the whole cluster. Defaults to `2`. Note that this setting only controls the number of concurrent shard relocations due to imbalances in the cluster. This setting does not limit shard relocations due to [allocation filtering](https://www.elastic.co/guide/en/elasticsearch/reference/current/modules-cluster.html#cluster-shard-allocation-filtering) or [forced awareness](https://www.elastic.co/guide/en/elasticsearch/reference/current/modules-cluster.html#forced-awareness). Increasing this setting may cause the cluster to use additional resources moving shards between nodes, so we generally do not recommend adjusting this setting from its default of `2`.  （[动态](https://www.elastic.co/guide/en/elasticsearch/reference/current/settings.html#dynamic-cluster-setting)）定义整个集群允许的并发分片重新平衡的数量。默认为`2` 。请注意，此设置仅控制由于集群不平衡而导致的并发分片重定位的数量。此设置不会限制由于[分配过滤](https://www.elastic.co/guide/en/elasticsearch/reference/current/modules-cluster.html#cluster-shard-allocation-filtering)或[强制感知](https://www.elastic.co/guide/en/elasticsearch/reference/current/modules-cluster.html#forced-awareness)而导致的分片重新定位。增加此设置可能会导致集群使用额外的资源在节点之间移动分片，因此我们通常不建议调整此设置的默认值`2` 。

- `cluster.routing.allocation.type`

  Selects the algorithm used for computing the cluster balance. Defaults to `desired_balance` which selects the *desired balance allocator*. This allocator runs a background task which computes the desired balance of shards in the cluster. Once this background task completes, Elasticsearch moves shards to their desired locations. 选择用于计算集群平衡的算法。默认为`desired_balance` ，它选择*所需的余额分配器*。该分配器运行一个后台任务，计算集群中所需的分片平衡。此后台任务完成后，Elasticsearch 会将分片移动到所需位置。 [8.8] [ 8.8 ] Deprecated in 8.8. The `balanced` allocator type is deprecated and no longer recommended  May also be set to `balanced` to select the legacy *balanced allocator*. This allocator was the default allocator in versions of Elasticsearch before 8.6.0. It runs in the foreground, preventing the master from doing other work in parallel. It works by selecting a small number of shard movements which immediately improve the balance of the cluster, and when those shard movements complete it runs again and selects another few shards to move. Since this allocator makes its decisions based only on the current state of the cluster, it will sometimes move a shard several times while balancing the cluster. 也可以设置为`balanced`以选择传统的*平衡分配器*。该分配器是 8.6.0 之前的 Elasticsearch 版本中的默认分配器。它在前台运行，阻止 master  并行执行其他工作。它的工作原理是选择少量的分片移动，从而立即改善集群的平衡，当这些分片移动完成时，它会再次运行并选择另外几个分片进行移动。由于该分配器仅根据集群的当前状态做出决策，因此有时会在平衡集群时多次移动分片。

## Shard balancing heuristics settings 分片平衡启发式设置

[edit 编辑](https://github.com/elastic/elasticsearch/edit/8.15/docs/reference/modules/cluster/shards_allocation.asciidoc)

Rebalancing works by computing a *weight* for each node based on its allocation of shards, and then moving shards between nodes to reduce the weight of the heavier nodes and increase the weight of the lighter ones. The cluster is balanced when there is no possible shard movement that can bring the weight of any node closer to the weight of any other node by more than a configurable threshold.
重新平衡的工作原理是根据分片的分配计算每个节点的*权重*，然后在节点之间移动分片以减少较重节点的权重并增加较轻节点的权重。当不存在可能使任何节点的权重更接近任何其他节点的权重超过可配置阈值的分片移动时，集群达到平衡。

The weight of a node depends on the number of shards it holds and on the total estimated resource usage of those shards expressed in terms of the size of the shard on disk and the number of threads needed to support write traffic to the shard. Elasticsearch estimates the resource usage of shards belonging to data streams when they are created by a rollover. The estimated disk size of the new shard is the mean size of the other shards in the data stream. The estimated write load of the new shard is a weighted average of the actual write loads of recent shards in the data stream. Shards that do not belong to the write index of a data stream have an estimated write load of zero.
节点的权重取决于它拥有的分片数量以及这些分片的估计总资源使用量（以磁盘上分片的大小和支持分片写入流量所需的线程数表示）。 Elasticsearch  会估计通过翻转创建属于数据流的分片的资源使用情况。新分片的估计磁盘大小是数据流中其他分片的平均大小。新分片的估计写入负载是数据流中最近分片的实际写入负载的加权平均值。不属于数据流写入索引的分片的估计写入负载为零。

The following settings control how Elasticsearch combines these values into an overall measure of each node’s weight.
以下设置控制 Elasticsearch 如何将这些值组合成每个节点权重的总体度量。

- `cluster.routing.allocation.balance.threshold`

  (float, [Dynamic](https://www.elastic.co/guide/en/elasticsearch/reference/current/settings.html#dynamic-cluster-setting)) The minimum improvement in weight which triggers a rebalancing shard movement. Defaults to `1.0f`. Raising this value will cause Elasticsearch to stop rebalancing shards sooner, leaving the cluster in a more unbalanced state.  (float, [Dynamic](https://www.elastic.co/guide/en/elasticsearch/reference/current/settings.html#dynamic-cluster-setting) ) 触发重新平衡分片移动的最小重量改进。默认为`1.0f` 。提高此值将导致 Elasticsearch 更快地停止重新平衡分片，使集群处于更加不平衡的状态。

- `cluster.routing.allocation.balance.shard`

  (float, [Dynamic](https://www.elastic.co/guide/en/elasticsearch/reference/current/settings.html#dynamic-cluster-setting)) Defines the weight factor for the total number of shards allocated to each node. Defaults to `0.45f`. Raising this value increases the tendency of Elasticsearch to equalize the total number of shards across nodes ahead of the other balancing variables.  (float, [Dynamic](https://www.elastic.co/guide/en/elasticsearch/reference/current/settings.html#dynamic-cluster-setting) ) 定义分配给每个节点的分片总数的权重因子。默认为`0.45f` 。提高此值会增加 Elasticsearch 在其他平衡变量之前均衡节点间分片总数的趋势。

- `cluster.routing.allocation.balance.index`

  (float, [Dynamic](https://www.elastic.co/guide/en/elasticsearch/reference/current/settings.html#dynamic-cluster-setting)) Defines the weight factor for the number of shards per index allocated to each node. Defaults to `0.55f`. Raising this value increases the tendency of Elasticsearch to equalize the number of shards of each index across nodes ahead of the other balancing variables.  (float, [Dynamic](https://www.elastic.co/guide/en/elasticsearch/reference/current/settings.html#dynamic-cluster-setting) ) 定义分配给每个节点的每个索引的分片数量的权重因子。默认为`0.55f` 。提高此值会增加 Elasticsearch 在其他平衡变量之前均衡跨节点的每个索引的分片数量的趋势。

- `cluster.routing.allocation.balance.disk_usage`

  (float, [Dynamic](https://www.elastic.co/guide/en/elasticsearch/reference/current/settings.html#dynamic-cluster-setting)) Defines the weight factor for balancing shards according to their predicted disk size in bytes. Defaults to `2e-11f`. Raising this value increases the tendency of Elasticsearch to equalize the total disk usage across nodes ahead of the other balancing variables.  (float, [Dynamic](https://www.elastic.co/guide/en/elasticsearch/reference/current/settings.html#dynamic-cluster-setting) ) 根据预测的磁盘大小（以字节为单位）定义平衡分片的权重因子。默认为`2e-11f` 。提高此值会增加 Elasticsearch 在其他平衡变量之前均衡节点间总磁盘使用量的趋势。

- `cluster.routing.allocation.balance.write_load`

  (float, [Dynamic](https://www.elastic.co/guide/en/elasticsearch/reference/current/settings.html#dynamic-cluster-setting)) Defines the weight factor for the write load of each shard, in terms of the estimated number of indexing threads needed by the shard. Defaults to `10.0f`. Raising this value increases the tendency of Elasticsearch to equalize the total write load across nodes ahead of the other balancing variables.  (float, [Dynamic](https://www.elastic.co/guide/en/elasticsearch/reference/current/settings.html#dynamic-cluster-setting) ) 根据分片所需的索引线程的估计数量定义每个分片的写入负载的权重因子。默认为`10.0f` 。提高此值会增加 Elasticsearch 在其他平衡变量之前均衡节点间总写入负载的趋势。

- If you have a large cluster, it may be unnecessary to keep it in a perfectly balanced state at all times. It is less resource-intensive for the cluster to operate in a somewhat unbalanced state rather than to perform all the shard movements needed to achieve the perfect balance. If so, increase the value of `cluster.routing.allocation.balance.threshold` to define the acceptable imbalance between nodes. For instance, if you have an average of 500 shards per node and can accept a difference of 5% (25 typical shards) between nodes, set `cluster.routing.allocation.balance.threshold` to `25`. 
  如果您有一个大型集群，则可能没有必要始终使其保持完美平衡状态。对于集群来说，在某种程度不平衡的状态下运行比执行实现完美平衡所需的所有分片移动所需的资源更少。如果是这样，请增加 `cluster.routing.allocation.balance.threshold` 定义节点之间可接受的不平衡。例如，如果每个节点平均有 500 个分片，并且可以接受节点之间 5% 的差异（25 个典型分片），请设置 `cluster.routing.allocation.balance.threshold` 到`25` 。
- We do not recommend adjusting the values of the heuristic weight factor settings. The default values work well in all reasonable clusters. Although different values may improve the current balance in some ways, it is possible that they will create unexpected problems in the future or prevent it from gracefully handling an unexpected disruption. 
  我们不建议调整启发式权重因子设置的值。默认值在所有合理的集群中都能很好地工作。尽管不同的值可能会在某些方面改善当前的平衡，但它们可能会在未来产生意想不到的问题或阻止其优雅地处理意外中断。
- Regardless of the result of the balancing algorithm, rebalancing might not be allowed due to allocation rules such as forced awareness and allocation filtering. Use the [Cluster allocation explain](https://www.elastic.co/guide/en/elasticsearch/reference/current/cluster-allocation-explain.html) API to explain the current allocation of shards. 
  无论平衡算法的结果如何，由于强制感知和分配过滤等分配规则，可能不允许重新平衡。使用[集群分配解释](https://www.elastic.co/guide/en/elasticsearch/reference/current/cluster-allocation-explain.html)API 来解释当前的分片分配。

## Disk-based shard allocation settings 基于磁盘的分片分配设置

[edit 编辑](https://github.com/elastic/elasticsearch/edit/8.15/docs/reference/modules/cluster/disk_allocator.asciidoc)

The disk-based shard allocator ensures that all nodes have enough disk space without performing more shard movements than necessary. It allocates shards based on a pair of thresholds known as the *low watermark* and the *high watermark*. Its primary goal is to ensure that no node exceeds the high watermark, or at least that any such overage is only temporary. If a node exceeds the high watermark then Elasticsearch will solve this by moving some of its shards onto other nodes in the cluster.
基于磁盘的分片分配器确保所有节点都有足够的磁盘空间，而不会执行不必​​要的分片移动。它根据一对称为*低水位线*和*高水位线*的阈值来分配分片。其主要目标是确保没有节点超过高水位线，或者至少任何此类超额只是暂时的。如果某个节点超过了高水位线，Elasticsearch 将通过将其一些分片移动到集群中的其他节点来解决此问题。

It is normal for nodes to temporarily exceed the high watermark from time to time.
节点偶尔会暂时超过高水位线是正常的。

The allocator also tries to keep nodes clear of the high watermark by forbidding the allocation of more shards to a node that exceeds the low watermark. Importantly, if all of your nodes have exceeded the low watermark then no new shards can be allocated and Elasticsearch will not be able to move any shards between nodes in order to keep the disk usage below the high watermark. You must ensure that your cluster has enough disk space in total and that there are always some nodes below the low watermark.
分配器还试图通过禁止向超过低水位线的节点分配更多分片来使节点远离高水位线。重要的是，如果所有节点都超过了低水位线，则无法分配新的分片，并且 Elasticsearch  将无法在节点之间移动任何分片以将磁盘使用率保持在高水位线以下。您必须确保集群总共有足够的磁盘空间，并且始终有一些节点低于低水位线。

Shard movements triggered by the disk-based shard allocator must also satisfy all other shard allocation rules such as [allocation filtering](https://www.elastic.co/guide/en/elasticsearch/reference/current/modules-cluster.html#cluster-shard-allocation-filtering) and [forced awareness](https://www.elastic.co/guide/en/elasticsearch/reference/current/modules-cluster.html#forced-awareness). If these rules are too strict then they can also prevent the shard movements needed to keep the nodes' disk usage under control. If you are using [data tiers](https://www.elastic.co/guide/en/elasticsearch/reference/current/data-tiers.html) then Elasticsearch automatically configures allocation filtering rules to place shards within the appropriate tier, which means that the disk-based shard allocator works independently within each tier.
基于磁盘的分片分配器触发的分片移动还必须满足所有其他分片分配规则，例如[分配过滤](https://www.elastic.co/guide/en/elasticsearch/reference/current/modules-cluster.html#cluster-shard-allocation-filtering)和[强制感知](https://www.elastic.co/guide/en/elasticsearch/reference/current/modules-cluster.html#forced-awareness)。如果这些规则过于严格，那么它们还会阻止控制节点磁盘使用所需的分片移动。如果您使用[数据层](https://www.elastic.co/guide/en/elasticsearch/reference/current/data-tiers.html)，则 Elasticsearch 会自动配置分配过滤规则以将分片放置在适当的层中，这意味着基于磁盘的分片分配器在每个层中独立工作。

If a node is filling up its disk faster than Elasticsearch can move shards elsewhere then there is a risk that the disk will completely fill up. To prevent this, as a last resort, once the disk usage reaches the *flood-stage* watermark Elasticsearch will block writes to indices with a shard on the affected node. It will also continue to move shards onto the other nodes in the cluster. When disk usage on the affected node drops below the high watermark, Elasticsearch automatically removes the write block. Refer to [Fix watermark errors](https://www.elastic.co/guide/en/elasticsearch/reference/current/fix-watermark-errors.html) to resolve persistent watermark errors.
如果节点填满磁盘的速度快于 Elasticsearch 将分片移动到其他地方的速度，则存在磁盘完全填满的风险。为了防止这种情况，作为最后的手段，一旦磁盘使用量达到*洪水阶段*水位线，Elasticsearch 将阻止对受影响节点上的分片索引的写入。它还将继续将分片移动到集群中的其他节点上。当受影响节点上的磁盘使用率降至高水位线以下时，Elasticsearch 会自动删除写入块。请参阅[修复水印错误](https://www.elastic.co/guide/en/elasticsearch/reference/current/fix-watermark-errors.html)以解决持续存在的水印错误。



It is normal for the nodes in your cluster to be using very different amounts of disk space. The [balance](https://www.elastic.co/guide/en/elasticsearch/reference/current/modules-cluster.html#shards-rebalancing-settings) of the cluster depends on a combination of factors which includes the number of shards on each node, the indices to which those shards belong, and the resource needs of each shard in terms of its size on disk and its CPU usage. Elasticsearch must trade off all of these factors against each other, and a cluster which is balanced when looking at the combination of all of these factors may not appear to be balanced if you focus attention on just one of them.
集群中的节点使用不同数量的磁盘空间是正常的。集群的[平衡](https://www.elastic.co/guide/en/elasticsearch/reference/current/modules-cluster.html#shards-rebalancing-settings)取决于多种因素的组合，其中包括每个节点上的分片数量、这些分片所属的索引以及每个分片在磁盘上的大小和 CPU 使用率方面的资源需求。 Elasticsearch  必须权衡所有这些因素，如果您只将注意力集中在其中一个因素上，那么在考虑所有这些因素的组合时平衡的集群可能看起来并不平衡。

You can use the following settings to control disk-based allocation:
您可以使用以下设置来控制基于磁盘的分配：



- `cluster.routing.allocation.disk.threshold_enabled`

  ([Dynamic](https://www.elastic.co/guide/en/elasticsearch/reference/current/settings.html#dynamic-cluster-setting)) Defaults to `true`. Set to `false` to disable the disk allocation decider. Upon disabling, it will also remove any existing `index.blocks.read_only_allow_delete` index blocks.  （[动态](https://www.elastic.co/guide/en/elasticsearch/reference/current/settings.html#dynamic-cluster-setting)）默认为`true` 。设置为`false`以禁用磁盘分配决策程序。禁用后，它还将删除任何现有的 `index.blocks.read_only_allow_delete` 索引块。



- `cluster.routing.allocation.disk.watermark.low` [![logo cloud](https://doc-icons.s3.us-east-2.amazonaws.com/logo_cloud.svg)](https://www.elastic.co/cloud/elasticsearch-service/signup?page=docs&placement=docs-body)

  ([Dynamic](https://www.elastic.co/guide/en/elasticsearch/reference/current/settings.html#dynamic-cluster-setting)) Controls the low watermark for disk usage. It defaults to `85%`, meaning that Elasticsearch will not allocate shards to nodes that have  more than 85% disk used. It can alternatively be set to a ratio value,  e.g., `0.85`. It can also be set to an absolute byte value (like `500mb`) to prevent Elasticsearch from allocating shards if less than the  specified amount of space is available. This setting has no effect on  the primary shards of newly-created indices but will prevent their  replicas from being allocated.  （[动态](https://www.elastic.co/guide/en/elasticsearch/reference/current/settings.html#dynamic-cluster-setting)）控制磁盘使用的低水位线。默认为`85%` ，这意味着 Elasticsearch 不会将分片分配给磁盘使用率超过 85% 的节点。或者可以将其设置为比率值，例如`0.85` 。它还可以设置为绝对字节值（例如`500mb` ），以防止 Elasticsearch 在可用空间小于指定量时分配分片。此设置对新创建索引的主分片没有影响，但会阻止分配其副本。

- `cluster.routing.allocation.disk.watermark.low.max_headroom`

  ([Dynamic](https://www.elastic.co/guide/en/elasticsearch/reference/current/settings.html#dynamic-cluster-setting)) Controls the max headroom for the low watermark (in case of a percentage/ratio value). Defaults to 200GB when `cluster.routing.allocation.disk.watermark.low` is not explicitly set. This caps the amount of free space required.  ([动态](https://www.elastic.co/guide/en/elasticsearch/reference/current/settings.html#dynamic-cluster-setting)) 控制低水位线的最大余量（在百分比/比率值的情况下）。默认为 200GB，当 `cluster.routing.allocation.disk.watermark.low` 没有明确设置。这限制了所需的可用空间量。



- `cluster.routing.allocation.disk.watermark.high` [![logo cloud](https://doc-icons.s3.us-east-2.amazonaws.com/logo_cloud.svg)](https://www.elastic.co/cloud/elasticsearch-service/signup?page=docs&placement=docs-body)

  ([Dynamic](https://www.elastic.co/guide/en/elasticsearch/reference/current/settings.html#dynamic-cluster-setting)) Controls the high watermark. It defaults to `90%`, meaning that Elasticsearch will attempt to relocate shards away from a  node whose disk usage is above 90%. It can alternatively be set to a  ratio value, e.g., `0.9`. It can also be set to an absolute byte value (similarly to the low  watermark) to relocate shards away from a node if it has less than the  specified amount of free space. This setting affects the allocation of  all shards, whether previously allocated or not.  （[动态](https://www.elastic.co/guide/en/elasticsearch/reference/current/settings.html#dynamic-cluster-setting)）控制高水位线。它默认为`90%` ，这意味着 Elasticsearch 将尝试将分片重新定位到磁盘使用率高于 90% 的节点上。或者可以将其设置为比率值，例如`0.9` 。它还可以设置为绝对字节值（类似于低水位线），以便在节点的可用空间小于指定数量时将分片重新定位到远离节点的位置。此设置会影响所有分片的分配，无论之前是否已分配。

- `cluster.routing.allocation.disk.watermark.high.max_headroom`

  ([Dynamic](https://www.elastic.co/guide/en/elasticsearch/reference/current/settings.html#dynamic-cluster-setting)) Controls the max headroom for the high watermark (in case of a percentage/ratio value). Defaults to 150GB when `cluster.routing.allocation.disk.watermark.high` is not explicitly set. This caps the amount of free space required.  ([动态](https://www.elastic.co/guide/en/elasticsearch/reference/current/settings.html#dynamic-cluster-setting)) 控制高水位线的最大余量（在百分比/比率值的情况下）。默认为 150GB `cluster.routing.allocation.disk.watermark.high` 没有明确设置。这限制了所需的可用空间量。

- `cluster.routing.allocation.disk.watermark.enable_for_single_data_node`

  ​    ([Static](https://www.elastic.co/guide/en/elasticsearch/reference/current/settings.html#static-cluster-setting)) In earlier releases, the default behaviour was to disregard disk watermarks for a single data node cluster when making an allocation decision. This is deprecated behavior since 7.14 and has been removed in 8.0. The only valid value for this setting is now `true`. The setting will be removed in a future release.  （[静态](https://www.elastic.co/guide/en/elasticsearch/reference/current/settings.html#static-cluster-setting)）在早期版本中，默认行为是在做出分配决策时忽略单个数据节点集群的磁盘水印。这是自 7.14 起已弃用的行为，并已在 8.0 中删除。此设置的唯一有效值现在是`true` 。该设置将在未来版本中删除。



- `cluster.routing.allocation.disk.watermark.flood_stage` [![logo cloud](https://doc-icons.s3.us-east-2.amazonaws.com/logo_cloud.svg)](https://www.elastic.co/cloud/elasticsearch-service/signup?page=docs&placement=docs-body)

  ([Dynamic](https://www.elastic.co/guide/en/elasticsearch/reference/current/settings.html#dynamic-cluster-setting)) Controls the flood stage watermark, which defaults to 95%. Elasticsearch enforces a read-only index block (`index.blocks.read_only_allow_delete`) on every index that has one or more shards allocated on the node, and  that has at least one disk exceeding the flood stage. This setting is a  last resort to prevent nodes from running out of disk space. The index  block is automatically released when the disk utilization falls below  the high watermark. Similarly to the low and high watermark values, it  can alternatively be set to a ratio value, e.g., `0.95`, or an absolute byte value. ([动态](https://www.elastic.co/guide/en/elasticsearch/reference/current/settings.html#dynamic-cluster-setting)) 控制洪水阶段水印，默认为 95%。 Elasticsearch 强制执行只读索引块（ `index.blocks.read_only_allow_delete` ）在节点上分配了一个或多个分片且至少有一个磁盘超过泛洪阶段的每个索引上。此设置是防止节点耗尽磁盘空间的最后手段。当磁盘利用率低于高水位线时，索引块会自动释放。与低水印值和高水印值类似，它可以替代地被设置为比率值，例如`0.95` ，或绝对字节值。 An example of resetting the read-only index block on the `my-index-000001` index: 重置`my-index-000001`索引上的只读索引块的示例：    `PUT /my-index-000001/_settings {  "index.blocks.read_only_allow_delete": null }`

- `cluster.routing.allocation.disk.watermark.flood_stage.max_headroom`

  ([Dynamic](https://www.elastic.co/guide/en/elasticsearch/reference/current/settings.html#dynamic-cluster-setting)) Controls the max headroom for the flood stage watermark (in case of a percentage/ratio value). Defaults to 100GB when `cluster.routing.allocation.disk.watermark.flood_stage` is not explicitly set. This caps the amount of free space required.  （[动态](https://www.elastic.co/guide/en/elasticsearch/reference/current/settings.html#dynamic-cluster-setting)）控制洪水阶段水印的最大净空（在百分比/比率值的情况下）。默认为 100GB `cluster.routing.allocation.disk.watermark.flood_stage` 没有明确设置。这限制了所需的可用空间量。

You cannot mix the usage of percentage/ratio values and byte values across the `cluster.routing.allocation.disk.watermark.low`, `cluster.routing.allocation.disk.watermark.high`, and `cluster.routing.allocation.disk.watermark.flood_stage` settings. Either all values are set to percentage/ratio values, or all are set to byte values. This enforcement is so that Elasticsearch can validate that the settings are internally consistent, ensuring that the low disk threshold is less than the high disk threshold, and the high disk threshold is less than the flood stage threshold. A similar comparison check is done for the max headroom values.
您不能在整个范围内混合使用百分比/比率值和字节值 `cluster.routing.allocation.disk.watermark.low` , `cluster.routing.allocation.disk.watermark.high` ， 和 `cluster.routing.allocation.disk.watermark.flood_stage` 设置。所有值都设置为百分比/比率值，或者全部设置为字节值。此强制执行是为了让 Elasticsearch 可以验证设置在内部是否一致，确保低磁盘阈值小于高磁盘阈值，并且高磁盘阈值小于泛洪阶段阈值。对最大净空值进行类似的比较检查。



- `cluster.routing.allocation.disk.watermark.flood_stage.frozen` [![logo cloud](https://doc-icons.s3.us-east-2.amazonaws.com/logo_cloud.svg)](https://www.elastic.co/cloud/elasticsearch-service/signup?page=docs&placement=docs-body)

  ([Dynamic](https://www.elastic.co/guide/en/elasticsearch/reference/current/settings.html#dynamic-cluster-setting)) Controls the flood stage watermark for dedicated frozen nodes, which defaults to 95%.  （[动态](https://www.elastic.co/guide/en/elasticsearch/reference/current/settings.html#dynamic-cluster-setting)）控制专用冻结节点的洪水阶段水印，默认为 95%。

- `cluster.routing.allocation.disk.watermark.flood_stage.frozen.max_headroom` [![logo cloud](https://doc-icons.s3.us-east-2.amazonaws.com/logo_cloud.svg)](https://www.elastic.co/cloud/elasticsearch-service/signup?page=docs&placement=docs-body)

  ([Dynamic](https://www.elastic.co/guide/en/elasticsearch/reference/current/settings.html#dynamic-cluster-setting)) Controls the max headroom for the flood stage watermark (in case of a percentage/ratio value) for dedicated frozen nodes. Defaults to 20GB when `cluster.routing.allocation.disk.watermark.flood_stage.frozen` is not explicitly set. This caps the amount of free space required on dedicated frozen nodes.  （[动态](https://www.elastic.co/guide/en/elasticsearch/reference/current/settings.html#dynamic-cluster-setting)）控制专用冻结节点的洪水阶段水印的最大净空（在百分比/比率值的情况下）。默认为 20GB `cluster.routing.allocation.disk.watermark.flood_stage.frozen` 没有明确设置。这限制了专用冻结节点上所需的可用空间量。

- `cluster.info.update.interval`

  ([Dynamic](https://www.elastic.co/guide/en/elasticsearch/reference/current/settings.html#dynamic-cluster-setting)) How often Elasticsearch should check on disk usage for each node in the cluster. Defaults to `30s`.  （[动态](https://www.elastic.co/guide/en/elasticsearch/reference/current/settings.html#dynamic-cluster-setting)）Elasticsearch 检查集群中每个节点的磁盘使用情况的频率。默认为`30s` 。

Percentage values refer to used disk space, while byte values refer to free disk space. This can be confusing, since it flips the meaning of high and low. For example, it makes sense to set the low watermark to 10gb and the high watermark to 5gb, but not the other way around.
百分比值是指已用磁盘空间，而字节值是指可用磁盘空间。这可能会令人困惑，因为它颠倒了高和低的含义。例如，将低水印设置为 10gb，将高水印设置为 5gb 是有意义的，但反之则不然。

An example of updating the low watermark to at least 100 gigabytes free, a high watermark of at least 50 gigabytes free, and a flood stage watermark of 10 gigabytes free, and updating the information about the cluster every minute:
将低水位线更新为至少 100 GB 可用空间，将高水位线更新为至少 50 GB 可用空间，将洪泛阶段水位线更新为 10 GB 可用空间，并每分钟更新一次集群信息的示例：



```console
PUT _cluster/settings
{
  "persistent": {
    "cluster.routing.allocation.disk.watermark.low": "100gb",
    "cluster.routing.allocation.disk.watermark.high": "50gb",
    "cluster.routing.allocation.disk.watermark.flood_stage": "10gb",
    "cluster.info.update.interval": "1m"
  }
}
```

Copy as curl[Try in Elastic](http://localhost:5601/zzz/app/kibana#/dev_tools/console?load_from=https://www.elastic.co/guide/en/elasticsearch/reference/current/snippets/11.console) 

Concerning the max headroom settings for the watermarks, please note that these apply only in the case that the watermark settings are percentages/ratios. The aim of a max headroom value is to cap the required free disk space before hitting the respective watermark. This is especially useful for servers with larger disks, where a percentage/ratio watermark could translate to a big free disk space requirement, and the max headroom can be used to cap the required free disk space amount. As an example, let us take the default settings for the flood watermark. It has a 95% default value, and the flood max headroom setting has a default value of 100GB. This means that:
关于水印的最大净空设置，请注意，这些设置仅适用于水印设置为百分比/比率的情况。最大净空值的目的是在达到相应水位线之前限制所需的可用磁盘空间。这对于具有较大磁盘的服务器特别有用，其中百分比/比率水印可以转化为大的可用磁盘空间需求，并且最大净空可用于限制所需的可用磁盘空间量。作为示例，我们采用洪水水印的默认设置。它的默认值为 95%，洪水最大净空设置的默认值为 100GB。这意味着：

- For a smaller disk, e.g., of 100GB, the flood watermark will hit at 95%, meaning at 5GB of free space, since 5GB is smaller than the 100GB max headroom value. 
  对于较小的磁盘（例如 100GB），洪水水位线将达到 95%，这意味着 5GB 的可用空间，因为 5GB 小于 100GB 最大净空值。
- For a larger disk, e.g., of 100TB, the flood watermark will hit at 100GB of free space. That is because the 95% flood watermark alone would require 5TB of free disk space, but that is capped by the max headroom setting to 100GB. 
  对于较大的磁盘（例如 100TB），洪水水位将达到 100GB 的可用空间。这是因为仅 95% 的洪水水位线就需要 5TB 的可用磁盘空间，但这受到最大净空设置为 100GB 的限制。

Finally, the max headroom settings have their default values only if their respective watermark settings are not explicitly set (thus, they have their default percentage values). If watermarks are explicitly set, then the max headroom settings do not have their default values, and would need to be explicitly set if they are desired.
最后，仅当未明确设置各自的水印设置时，最大净空设置才具有默认值（因此，它们具有默认百分比值）。如果显式设置水印，则最大净空设置没有默认值，如果需要，则需要显式设置。

## Shard allocation awareness 分片分配意识

[edit 编辑](https://github.com/elastic/elasticsearch/edit/8.15/docs/reference/modules/cluster/allocation_awareness.asciidoc)

You can use custom node attributes as *awareness attributes* to enable Elasticsearch to take your physical hardware configuration into account when allocating shards. If Elasticsearch knows which nodes are on the same physical server, in the same rack, or in the same zone, it can distribute the primary shard and its replica shards to minimize the risk of losing all shard copies in the event of a failure.
您可以使用自定义节点属性作为*感知属性*，以使 Elasticsearch 在分配分片时能够考虑您的物理硬件配置。如果 Elasticsearch 知道哪些节点位于同一物理服务器、同一机架或同一区域，则它可以分配主分片及其副本分片，以最大程度地减少在发生故障时丢失所有分片副本的风险。

When shard allocation awareness is enabled with the [dynamic](https://www.elastic.co/guide/en/elasticsearch/reference/current/settings.html#dynamic-cluster-setting) `cluster.routing.allocation.awareness.attributes` setting, shards are only allocated to nodes that have values set for the specified awareness attributes. If you use multiple awareness attributes, Elasticsearch considers each attribute separately when allocating shards.
当通过[动态](https://www.elastic.co/guide/en/elasticsearch/reference/current/settings.html#dynamic-cluster-setting)启用分片分配感知时 `cluster.routing.allocation.awareness.attributes` 设置中，分片仅分配给具有指定感知属性设置值的节点。如果您使用多个感知属性，Elasticsearch 在分配分片时会单独考虑每个属性。

The number of attribute values determines how many shard copies are allocated in each location. If the number of nodes in each location is unbalanced and there are a lot of replicas, replica shards might be left unassigned.
属性值的数量决定了每个位置分配多少个分片副本。如果每个位置的节点数量不平衡并且存在大量副本，则副本分片可能会处于未分配状态。

Learn more about [designing resilient clusters](https://www.elastic.co/guide/en/elasticsearch/reference/current/high-availability-cluster-design-large-clusters.html).
了解有关[设计弹性集群的](https://www.elastic.co/guide/en/elasticsearch/reference/current/high-availability-cluster-design-large-clusters.html)更多信息。

### Enabling shard allocation awareness 启用分片分配感知

[edit 编辑](https://github.com/elastic/elasticsearch/edit/8.15/docs/reference/modules/cluster/allocation_awareness.asciidoc)

To enable shard allocation awareness:
要启用分片分配感知：

1. Specify the location of each node with a custom node attribute. For example, if you want Elasticsearch to distribute shards across different racks, you might use an awareness attribute called `rack_id`.
   使用自定义节点属性指定每个节点的位置。例如，如果您希望 Elasticsearch 将分片分布在不同的机架上，您可以使用名为`rack_id`的感知属性。

   You can set custom attributes in two ways:
   您可以通过两种方式设置自定义属性：

   - By editing the `elasticsearch.yml` config file:
     通过编辑`elasticsearch.yml`配置文件：

     ```yaml
     node.attr.rack_id: rack_one
     ```

   - Using the `-E` command line argument when you start a node:
     启动节点时使用`-E`命令行参数：

     ```sh
     ./bin/elasticsearch -Enode.attr.rack_id=rack_one
     ```

2. Tell Elasticsearch to take one or more awareness attributes into account when allocating shards by setting `cluster.routing.allocation.awareness.attributes` in **every** master-eligible node’s `elasticsearch.yml` config file.
   通过设置告诉 Elasticsearch 在分配分片时考虑一个或多个感知属性 `cluster.routing.allocation.awareness.attributes` 在**每个**符合主节点资格的节点的`elasticsearch.yml`配置文件中。

   ```yaml
   cluster.routing.allocation.awareness.attributes: rack_id 
   ```

   |      | Specify multiple attributes as a comma-separated list. 将多个属性指定为逗号分隔的列表。 |
   | ---- | ------------------------------------------------------------ |
   |      |                                                              |

   You can also use the [cluster-update-settings](https://www.elastic.co/guide/en/elasticsearch/reference/current/cluster-update-settings.html) API to set or update a cluster’s awareness attributes:
   您还可以使用[cluster-update-settings](https://www.elastic.co/guide/en/elasticsearch/reference/current/cluster-update-settings.html) API 来设置或更新集群的感知属性：

   

   ```console
   PUT /_cluster/settings
   {
     "persistent" : {
       "cluster.routing.allocation.awareness.attributes" : "rack_id"
     }
   }
   ```

1. Copy as curl 复制为卷曲[Try in Elastic 尝试使用弹性](http://localhost:5601/zzz/app/kibana#/dev_tools/console?load_from=https://www.elastic.co/guide/en/elasticsearch/reference/current/snippets/12.console) 

With this example configuration, if you start two nodes with `node.attr.rack_id` set to `rack_one` and create an index with 5 primary shards and 1 replica of each primary, all primaries and replicas are allocated across the two node.
使用此示例配置，如果您启动两个节点，并将`node.attr.rack_id`设置为`rack_one` ，并创建一个包含 5 个主分片和每个主分片 1 个副本的索引，则所有主分片和副本都将分配到这两个节点上。

![All primaries and replicas are allocated across two nodes in the same rack](https://www.elastic.co/guide/en/elasticsearch/reference/current/images/shard-allocation/shard-allocation-awareness-one-rack.png)

Figure 1. All primaries and replicas allocated across two nodes in the same rack
图 1. 跨同一机架中两个节点分配的所有主节点和副本

If you add two nodes with `node.attr.rack_id` set to `rack_two`, Elasticsearch moves shards to the new nodes, ensuring (if possible) that no two copies of the same shard are in the same rack.
如果添加两个节点并将`node.attr.rack_id`设置为`rack_two` ，Elasticsearch 会将分片移动到新节点，确保（如果可能）同一分片的两个副本不会位于同一机架中。

![Primaries and replicas are allocated across four nodes in two racks with no two copies of the same shard in the same rack](https://www.elastic.co/guide/en/elasticsearch/reference/current/images/shard-allocation/shard-allocation-awareness-two-racks.png)

Figure 2. Primaries and replicas allocated across four nodes in two racks, with no two copies of the same shard in the same rack
图 2. 主副本和副本分配在两个机架中的四个节点上，同一机架中没有相同分片的两个副本

If `rack_two` fails and takes down both its nodes, by default Elasticsearch allocates the lost shard copies to nodes in `rack_one`. To prevent multiple copies of a particular shard from being allocated in the same location, you can enable forced awareness.
如果`rack_two`失败并关闭其两个节点，默认情况下Elasticsearch会将丢失的分片副本分配给`rack_one`中的节点。为了防止在同一位置分配特定分片的多个副本，您可以启用强制感知。

### Forced awareness 强迫意识

[edit 编辑](https://github.com/elastic/elasticsearch/edit/8.15/docs/reference/modules/cluster/allocation_awareness.asciidoc)

By default, if one location fails, Elasticsearch spreads its shards across the remaining locations. This might be undesirable if the cluster does not have sufficient resources to host all its shards when one location is missing.
默认情况下，如果一个位置发生故障，Elasticsearch 会将其分片分布到其余位置。如果在一个位置丢失时集群没有足够的资源来托管其所有分片，那么这可能是不可取的。

To prevent the remaining locations from being overloaded in the event of a whole-location failure, specify the attribute values that should exist with the `cluster.routing.allocation.awareness.force.*` settings. This will mean that Elasticsearch will prefer to leave some replicas unassigned in the event of a whole-location failure instead of overloading the nodes in the remaining locations.
为了防止在整个位置发生故障时剩余位置过载，请指定应与 `cluster.routing.allocation.awareness.force.*` 设置。这意味着，如果发生整个位置故障，Elasticsearch 更愿意保留一些未分配的副本，而不是使其余位置的节点过载。

For example, if you have an awareness attribute called `zone` and configure nodes in `zone1` and `zone2`, you can use forced awareness to make Elasticsearch leave half of your shard copies unassigned if only one zone is available:
例如，如果您有一个名为`zone`的感知属性，并在`zone1`和`zone2`中配置节点，则在只有一个区域可用时，您可以使用强制感知使 Elasticsearch 保留一半的分片副本未分配：

```yaml
cluster.routing.allocation.awareness.attributes: zone
cluster.routing.allocation.awareness.force.zone.values: zone1,zone2 
```

|      | Specify all possible `zone` attribute values. 指定所有可能的`zone`属性值。 |
| ---- | ------------------------------------------------------------ |
|      |                                                              |

With this example configuration, if you have two nodes with `node.attr.zone` set to `zone1` and an index with `number_of_replicas` set to `1`, Elasticsearch allocates all the primary shards but none of the replicas. It will assign the replica shards once nodes with a different value for `node.attr.zone` join the cluster. In contrast, if you do not configure forced awareness, Elasticsearch will allocate all primaries and replicas to the two nodes even though they are in the same zone.
在此示例配置中，如果您有两个节点，其`node.attr.zone`设置为`zone1` ，且索引的`number_of_replicas`设置为`1` ，则 Elasticsearch 会分配所有主分片，但不会分配任何副本。一旦具有不同`node.attr.zone`值的节点加入集群，它将分配副本分片。相反，如果您不配置强制感知，Elasticsearch 会将所有主节点和副本分配给这两个节点，即使它们位于同一区域中。

## Cluster-level shard allocation filtering 集群级分片分配过滤

[edit 编辑](https://github.com/elastic/elasticsearch/edit/8.15/docs/reference/modules/cluster/allocation_filtering.asciidoc)

You can use cluster-level shard allocation filters to control where Elasticsearch allocates shards from any index. These cluster wide filters are applied in conjunction with [per-index allocation filtering](https://www.elastic.co/guide/en/elasticsearch/reference/current/shard-allocation-filtering.html) and [allocation awareness](https://www.elastic.co/guide/en/elasticsearch/reference/current/modules-cluster.html#shard-allocation-awareness).
您可以使用集群级分片分配过滤器来控制 Elasticsearch 从任何索引分配分片的位置。这些集群范围的过滤器与[每个索引的分配过滤](https://www.elastic.co/guide/en/elasticsearch/reference/current/shard-allocation-filtering.html)和[分配感知](https://www.elastic.co/guide/en/elasticsearch/reference/current/modules-cluster.html#shard-allocation-awareness)结合应用。

Shard allocation filters can be based on custom node attributes or the built-in `_name`, `_host_ip`, `_publish_ip`, `_ip`, `_host`, `_id` and `_tier` attributes.
分片分配过滤器可以基于自定义节点属性或内置`_name` 、 `_host_ip` 、 `_publish_ip` 、 `_ip` 、 `_host` 、 `_id`和`_tier`属性。

The `cluster.routing.allocation` settings are [dynamic](https://www.elastic.co/guide/en/elasticsearch/reference/current/settings.html#dynamic-cluster-setting), enabling live indices to be moved from one set of nodes to another. Shards are only relocated if it is possible to do so without breaking another routing constraint, such as never allocating a primary and replica shard on the same node.
`cluster.routing.allocation`设置是[动态的](https://www.elastic.co/guide/en/elasticsearch/reference/current/settings.html#dynamic-cluster-setting)，允许将实时索引从一组节点移动到另一组节点。仅当可以在不破坏其他路由约束的情况下重新定位分片，例如从不在同一节点上分配主分片和副本分片。

The most common use case for cluster-level shard allocation filtering is when you want to decommission a node. To move shards off of a node prior to shutting it down, you could create a filter that excludes the node by its IP address:
集群级分片分配过滤最常见的用例是当您想要停用节点时。要在关闭节点之前将分片移出节点，您可以创建一个过滤器，通过 IP 地址排除该节点：



```console
PUT _cluster/settings
{
  "persistent" : {
    "cluster.routing.allocation.exclude._ip" : "10.0.0.1"
  }
}
```

Copy as curl 复制为卷曲[Try in Elastic 尝试使用弹性](http://localhost:5601/zzz/app/kibana#/dev_tools/console?load_from=https://www.elastic.co/guide/en/elasticsearch/reference/current/snippets/13.console) 

### Cluster routing settings 集群路由设置

[edit 编辑](https://github.com/elastic/elasticsearch/edit/8.15/docs/reference/modules/cluster/allocation_filtering.asciidoc)

- `cluster.routing.allocation.include.{attribute}`

  ([Dynamic](https://www.elastic.co/guide/en/elasticsearch/reference/current/settings.html#dynamic-cluster-setting)) Allocate shards to a node whose `{attribute}` has at least one of the comma-separated values.  （[动态](https://www.elastic.co/guide/en/elasticsearch/reference/current/settings.html#dynamic-cluster-setting)）将分片分配给其`{attribute}`至少具有一个逗号分隔值的节点。

- `cluster.routing.allocation.require.{attribute}`

  ([Dynamic](https://www.elastic.co/guide/en/elasticsearch/reference/current/settings.html#dynamic-cluster-setting)) Only allocate shards to a node whose `{attribute}` has *all* of the comma-separated values.  （[动态](https://www.elastic.co/guide/en/elasticsearch/reference/current/settings.html#dynamic-cluster-setting)）仅将分片分配给其`{attribute}`具有*所有*逗号分隔值的节点。

- `cluster.routing.allocation.exclude.{attribute}`

  ([Dynamic](https://www.elastic.co/guide/en/elasticsearch/reference/current/settings.html#dynamic-cluster-setting)) Do not allocate shards to a node whose `{attribute}` has *any* of the comma-separated values.  （[动态](https://www.elastic.co/guide/en/elasticsearch/reference/current/settings.html#dynamic-cluster-setting)）不要将分片分配给其`{attribute}`具有*任何*逗号分隔值的节点。

The cluster allocation settings support the following built-in attributes:
集群分配设置支持以下内置属性：

| `_name`       | Match nodes by node name  按节点名称匹配节点                 |
| ------------- | ------------------------------------------------------------ |
| `_host_ip`    | Match nodes by host IP address (IP associated with hostname)  按主机 IP 地址（与主机名关联的 IP）匹配节点 |
| `_publish_ip` | Match nodes by publish IP address  通过发布IP地址匹配节点    |
| `_ip`         | Match either `_host_ip` or `_publish_ip` 匹配`_host_ip`或`_publish_ip` |
| `_host`       | Match nodes by hostname 按主机名匹配节点                     |
| `_id`         | Match nodes by node id  通过节点id匹配节点                   |
| `_tier`       | Match nodes by the node’s [data tier](https://www.elastic.co/guide/en/elasticsearch/reference/current/data-tiers.html) role  按节点的[数据层](https://www.elastic.co/guide/en/elasticsearch/reference/current/data-tiers.html)角色匹配节点 |

`_tier` filtering is based on [node](https://www.elastic.co/guide/en/elasticsearch/reference/current/modules-node.html) roles. Only a subset of roles are [data tier](https://www.elastic.co/guide/en/elasticsearch/reference/current/data-tiers.html) roles, and the generic [data role](https://www.elastic.co/guide/en/elasticsearch/reference/current/modules-node.html#data-node) will match any tier filtering. a subset of roles that are [data tier](https://www.elastic.co/guide/en/elasticsearch/reference/current/data-tiers.html) roles, but the generic [data role](https://www.elastic.co/guide/en/elasticsearch/reference/current/modules-node.html#data-node) will match any tier filtering.
`_tier`过滤基于[节点](https://www.elastic.co/guide/en/elasticsearch/reference/current/modules-node.html)角色。只有一部分角色是[数据层](https://www.elastic.co/guide/en/elasticsearch/reference/current/data-tiers.html)角色，通用[数据角色](https://www.elastic.co/guide/en/elasticsearch/reference/current/modules-node.html#data-node)将匹配任何层过滤。[数据层](https://www.elastic.co/guide/en/elasticsearch/reference/current/data-tiers.html)角色的角色子集，但通用[数据角色](https://www.elastic.co/guide/en/elasticsearch/reference/current/modules-node.html#data-node)将匹配任何层过滤。

You can use wildcards when specifying attribute values, for example:
指定属性值时可以使用通配符，例如：



```console
PUT _cluster/settings
{
  "persistent": {
    "cluster.routing.allocation.exclude._ip": "192.168.2.*"
  }
}
```

Copy as curl 复制为卷曲[Try in Elastic 尝试使用弹性](http://localhost:5601/zzz/app/kibana#/dev_tools/console?load_from=https://www.elastic.co/guide/en/elasticsearch/reference/current/snippets/14.console) 

# Miscellaneous cluster settings 其他集群设置

[edit 编辑](https://github.com/elastic/elasticsearch/edit/8.15/docs/reference/modules/cluster/misc.asciidoc)

## Metadata 元数据

[edit 编辑](https://github.com/elastic/elasticsearch/edit/8.15/docs/reference/modules/cluster/misc.asciidoc)

An entire cluster may be set to read-only with the following setting:
可以使用以下设置将整个集群设置为只读：

- `cluster.blocks.read_only`

  ([Dynamic](https://www.elastic.co/guide/en/elasticsearch/reference/current/settings.html#dynamic-cluster-setting)) Make the whole cluster read only (indices do not accept write operations), metadata is not allowed to be modified (create or delete indices). Defaults to `false`.  （[动态](https://www.elastic.co/guide/en/elasticsearch/reference/current/settings.html#dynamic-cluster-setting)）使整个集群只读（索引不接受写操作），不允许修改元数据（创建或删除索引）。默认为`false` 。

- `cluster.blocks.read_only_allow_delete`

  ([Dynamic](https://www.elastic.co/guide/en/elasticsearch/reference/current/settings.html#dynamic-cluster-setting)) Identical to `cluster.blocks.read_only` but allows to delete indices to free up resources. Defaults to `false`.  （[动态](https://www.elastic.co/guide/en/elasticsearch/reference/current/settings.html#dynamic-cluster-setting)）与`cluster.blocks.read_only`相同，但允许删除索引以释放资源。默认为`false` 。

Don’t rely on this setting to prevent changes to your cluster. Any user with access to the [cluster-update-settings](https://www.elastic.co/guide/en/elasticsearch/reference/current/cluster-update-settings.html) API can make the cluster read-write again.
不要依赖此设置来防止对集群进行更改。任何有权访问[cluster-update-settings](https://www.elastic.co/guide/en/elasticsearch/reference/current/cluster-update-settings.html) API 的用户都可以使集群再次读写。

## Cluster shard limits 集群分片限制

[edit 编辑](https://github.com/elastic/elasticsearch/edit/8.15/docs/reference/modules/cluster/misc.asciidoc)

There is a limit on the number of shards in a cluster, based on the number of nodes in the cluster. This is intended to prevent a runaway process from creating too many shards which can harm performance and in extreme cases may destabilize your cluster.
根据集群中的节点数量，集群中的分片数量存在限制。这是为了防止失控进程创建过多的分片，这可能会损害性能，并且在极端情况下可能会破坏集群的稳定性。

These limits are intended as a safety net to protect against runaway shard creation and are not a sizing recommendation. The exact number of shards your cluster can safely support depends on your hardware configuration and workload, and may be smaller than the default limits.
这些限制旨在作为安全网，防止失控的分片创建，而不是大小建议。您的集群可以安全支持的确切分片数量取决于您的硬件配置和工作负载，并且可能小于默认限制。

We do not recommend increasing these limits beyond the defaults. Clusters with more shards may appear to run well in normal operation, but may take a very long time to recover from temporary disruptions such as a network partition or an unexpected node restart, and may encounter problems when performing maintenance activities such as a rolling restart or upgrade.
我们不建议将这些限制增加到默认值之外。具有更多分片的集群在正常操作中可能运行良好，但可能需要很长时间才能从临时中断（例如网络分区或意外节点重新启动）中恢复，并且在执行维护活动（例如滚动重新启动或升级。

If an operation, such as creating a new index, restoring a snapshot of an index, or opening a closed index would lead to the number of shards in the cluster going over this limit, the operation will fail with an error indicating the shard limit. To resolve this, either scale out your cluster by adding nodes, or [delete some indices](https://www.elastic.co/guide/en/elasticsearch/reference/current/indices-delete-index.html) to bring the number of shards below the limit.
如果某个操作（例如创建新索引、恢复索引快照或打开已关闭的索引）会导致集群中的分片数量超过此限制，则该操作将失败并出现指示分片限制的错误。要解决此问题，请通过添加节点来扩展集群，或者[删除一些索引](https://www.elastic.co/guide/en/elasticsearch/reference/current/indices-delete-index.html)以使分片数量低于限制。

If a cluster is already over the limit, perhaps due to changes in node membership or setting changes, all operations that create or open indices will fail.
如果集群已经超出限制，可能是由于节点成员资格更改或设置更改，则所有创建或打开索引的操作都将失败。

The cluster shard limit defaults to 1000 shards per non-frozen data node for normal (non-frozen) indices and 3000 shards per frozen data node for frozen indices. Both primary and replica shards of all open indices count toward the limit, including unassigned shards. For example, an open index with 5 primary shards and 2 replicas counts as 15 shards. Closed indices do not contribute to the shard count.
对于正常（非冻结）索引，集群分片限制默认为每个非冻结数据节点 1000 个分片，对于冻结索引，每个冻结数据节点默认为 3000  个分片。所有开放索引的主分片和副本分片都计入限制，包括未分配的分片。例如，具有 5 个主分片和 2 个副本的开放索引计为 15  个分片。封闭索引不会影响分片计数。

You can dynamically adjust the cluster shard limit with the following setting:
您可以使用以下设置动态调整集群分片限制：



- `cluster.max_shards_per_node`

  ([Dynamic](https://www.elastic.co/guide/en/elasticsearch/reference/current/settings.html#dynamic-cluster-setting)) Limits the total number of primary and replica shards for the cluster. Elasticsearch calculates the limit as follows: （[动态](https://www.elastic.co/guide/en/elasticsearch/reference/current/settings.html#dynamic-cluster-setting)）限制集群的主分片和副本分片的总数。 Elasticsearch 计算限制如下： `cluster.max_shards_per_node * number of non-frozen data nodes` Shards for closed indices do not count toward this limit. Defaults to `1000`. A cluster with no data nodes is unlimited. 封闭索引的分片不计入此限制。默认为`1000` 。没有数据节点的集群是无限的。 Elasticsearch rejects any request that creates more shards than this limit allows. For example, a cluster with a `cluster.max_shards_per_node` setting of `100` and three data nodes has a shard limit of 300. If the cluster already contains 296 shards, Elasticsearch rejects any request that adds five or more shards to the cluster. Elasticsearch 会拒绝任何创建超过此限制允许的分片的请求。例如， `cluster.max_shards_per_node`设置为`100`和三个数据节点的集群的分片限制为 300。如果集群已包含 296 个分片，Elasticsearch 会拒绝任何向集群添加 5 个或更多分片的请求。 Note that if `cluster.max_shards_per_node` is set to a higher value than the default, the limits for [mmap count](https://www.elastic.co/guide/en/elasticsearch/reference/current/vm-max-map-count.html) and [open file descriptors](https://www.elastic.co/guide/en/elasticsearch/reference/current/file-descriptors.html) might also require adjustment. 请注意，如果`cluster.max_shards_per_node`设置为高于默认值，则[mmap 计数](https://www.elastic.co/guide/en/elasticsearch/reference/current/vm-max-map-count.html)和[打开文件描述符](https://www.elastic.co/guide/en/elasticsearch/reference/current/file-descriptors.html)的限制可能也需要调整。 Notice that frozen shards have their own independent limit. 请注意，冻结的碎片有其自己的独立限制。



- `cluster.max_shards_per_node.frozen`

  ([Dynamic](https://www.elastic.co/guide/en/elasticsearch/reference/current/settings.html#dynamic-cluster-setting)) Limits the total number of primary and replica frozen shards for the cluster. Elasticsearch calculates the limit as follows: （[动态](https://www.elastic.co/guide/en/elasticsearch/reference/current/settings.html#dynamic-cluster-setting)）限制集群的主分片和副本冻结分片的总数。 Elasticsearch 计算限制如下： `cluster.max_shards_per_node.frozen * number of frozen data nodes` Shards for closed indices do not count toward this limit. Defaults to `3000`. A cluster with no frozen data nodes is unlimited. 封闭索引的分片不计入此限制。默认为`3000` 。没有冻结数据节点的集群是无限的。 Elasticsearch rejects any request that creates more frozen shards than this limit allows. For example, a cluster with a `cluster.max_shards_per_node.frozen` setting of `100` and three frozen data nodes has a frozen shard limit of 300. If the cluster already contains 296 shards, Elasticsearch rejects any request that adds five or more frozen shards to the cluster. Elasticsearch 会拒绝任何创建超过此限制允许的冻结分片的请求。例如，一个集群具有 `cluster.max_shards_per_node.frozen` 设置为`100`和三个冻结数据节点时，冻结分片限制为 300。如果集群已包含 296 个分片，Elasticsearch 会拒绝向集群添加 5 个或更多冻结分片的任何请求。

These limits only apply to actions which create shards and do not limit the number of shards assigned to each node. To limit the number of shards assigned to each node, use the [`cluster.routing.allocation.total_shards_per_node`](https://www.elastic.co/guide/en/elasticsearch/reference/current/allocation-total-shards.html#cluster-total-shards-per-node) setting.
这些限制仅适用于创建分片的操作，并不限制分配给每个节点的分片数量。要限制分配给每个节点的分片数量，请使用环境。

## User-defined cluster metadata 用户定义的集群元数据

[edit 编辑](https://github.com/elastic/elasticsearch/edit/8.15/docs/reference/modules/cluster/misc.asciidoc)

User-defined metadata can be stored and retrieved using the Cluster Settings API. This can be used to store arbitrary, infrequently-changing data about the cluster without the need to create an index to store it. This data may be stored using any key prefixed with `cluster.metadata.`. For example, to store the email address of the administrator of a cluster under the key `cluster.metadata.administrator`, issue this request:
可以使用集群设置 API 来存储和检索用户定义的元数据。这可用于存储有关集群的任意、不经常更改的数据，而无需创建索引来存储它。该数据可以使用任何前缀为`cluster.metadata.` 。例如，将集群管理员的电子邮件地址存储在键下 `cluster.metadata.administrator` ，发出此请求：



```console
PUT /_cluster/settings
{
  "persistent": {
    "cluster.metadata.administrator": "sysadmin@example.com"
  }
}
```

Copy as curl 复制为卷曲[Try in Elastic 尝试使用弹性](http://localhost:5601/zzz/app/kibana#/dev_tools/console?load_from=https://www.elastic.co/guide/en/elasticsearch/reference/current/snippets/15.console) 

User-defined cluster metadata is not intended to store sensitive or confidential information. Any information stored in user-defined cluster metadata will be viewable by anyone with access to the [Cluster Get Settings](https://www.elastic.co/guide/en/elasticsearch/reference/current/cluster-get-settings.html) API, and is recorded in the Elasticsearch logs.
用户定义的集群元数据无意存储敏感或机密信息。任何有权访问[Cluster Get Settings](https://www.elastic.co/guide/en/elasticsearch/reference/current/cluster-get-settings.html) API 的人都可以查看存储在用户定义的集群元数据中的任何信息，并记录在 Elasticsearch 日志中。

## Index tombstones 索引墓碑

[edit 编辑](https://github.com/elastic/elasticsearch/edit/8.15/docs/reference/modules/cluster/misc.asciidoc)

The cluster state maintains index tombstones to explicitly denote indices that have been deleted. The number of tombstones maintained in the cluster state is controlled by the following setting:
集群状态维护索引墓碑以明确表示已删除的索引。集群状态中维护的逻辑删除数量由以下设置控制：

- `cluster.indices.tombstones.size`

  ([Static](https://www.elastic.co/guide/en/elasticsearch/reference/current/settings.html#static-cluster-setting)) Index tombstones prevent nodes that are not part of the cluster when a delete occurs from joining the cluster and reimporting the index as though the delete was never issued. To keep the cluster state from growing huge we only keep the last `cluster.indices.tombstones.size` deletes, which defaults to 500. You can increase it if you expect nodes to be absent from the cluster and miss more than 500 deletes. We think that is rare, thus the default. Tombstones don’t take up much space, but we also think that a number like 50,000 is probably too big.  （[静态](https://www.elastic.co/guide/en/elasticsearch/reference/current/settings.html#static-cluster-setting)）索引墓碑可防止发生删除时不属于集群的节点加入集群并重新导入索引，就好像从未发出删除一样。为了防止集群状态变得巨大，我们只保留最后一个 `cluster.indices.tombstones.size` 删除次数，默认为 500。如果您预计节点将不在集群中并且错过超过 500 个删除，则可以增加该值。我们认为这种情况很少见，因此是默认的。墓碑占用的空间并不大，但我们也认为五万个这样的数字可能太大了。

If Elasticsearch encounters index data that is absent from the current cluster state, those indices are considered to be dangling. For example, this can happen if you delete more than `cluster.indices.tombstones.size` indices while an Elasticsearch node is offline.
如果 Elasticsearch 遇到当前集群状态中不存在的索引数据，则这些索引被视为悬空。例如，如果您删除超过 `cluster.indices.tombstones.size` Elasticsearch 节点离线时的索引。

You can use the [Dangling indices API](https://www.elastic.co/guide/en/elasticsearch/reference/current/indices.html#dangling-indices-api) to manage this situation.
您可以使用[悬空索引 API](https://www.elastic.co/guide/en/elasticsearch/reference/current/indices.html#dangling-indices-api)来管理这种情况。

## Logger 日志

[edit 编辑](https://github.com/elastic/elasticsearch/edit/8.15/docs/reference/modules/cluster/misc.asciidoc)

The settings which control logging can be updated [dynamically](https://www.elastic.co/guide/en/elasticsearch/reference/current/settings.html#dynamic-cluster-setting) with the `logger.` prefix. For instance, to increase the logging level of the `indices.recovery` module to `DEBUG`, issue this request:
控制日志记录的设置可以使用记录器[动态](https://www.elastic.co/guide/en/elasticsearch/reference/current/settings.html#dynamic-cluster-setting)更新`logger.`前缀。例如，要将`indices.recovery`模块的日志记录级别增加到`DEBUG` ，请发出以下请求：



```console
PUT /_cluster/settings
{
  "persistent": {
    "logger.org.elasticsearch.indices.recovery": "DEBUG"
  }
}
```

Copy as curl 复制为卷曲[Try in Elastic 尝试使用弹性](http://localhost:5601/zzz/app/kibana#/dev_tools/console?load_from=https://www.elastic.co/guide/en/elasticsearch/reference/current/snippets/16.console) 

## Persistent tasks allocation 持久任务分配

[edit 编辑](https://github.com/elastic/elasticsearch/edit/8.15/docs/reference/modules/cluster/misc.asciidoc)

Plugins can create a kind of tasks called persistent tasks. Those tasks are usually long-lived tasks and are stored in the cluster state, allowing the tasks to be revived after a full cluster restart.
插件可以创建一种称为持久任务的任务。这些任务通常是长期任务，并存储在集群状态中，允许在整个集群重新启动后恢复这些任务。

Every time a persistent task is created, the master node takes care of assigning the task to a node of the cluster, and the assigned node will then pick up the task and execute it locally. The process of assigning persistent tasks to nodes is controlled by the following settings:
每次创建持久任务时，主节点都会将该任务分配给集群中的一个节点，然后分配的节点将拾取该任务并在本地执行。将持久任务分配给节点的过程由以下设置控制：

- `cluster.persistent_tasks.allocation.enable`

  ([Dynamic](https://www.elastic.co/guide/en/elasticsearch/reference/current/settings.html#dynamic-cluster-setting)) Enable or disable allocation for persistent tasks: （[动态](https://www.elastic.co/guide/en/elasticsearch/reference/current/settings.html#dynamic-cluster-setting)）启用或禁用持久任务的分配：  `all` -             (default) Allows persistent tasks to be assigned to nodes  `all` -（默认）允许将持久任务分配给节点 `none` -            No allocations are allowed for any type of persistent task  `none` - 任何类型的持久性任务都不允许分配  This setting does not affect the persistent tasks that are already being executed. Only newly created persistent tasks, or tasks that must be reassigned (after a node left the cluster, for example), are impacted by this setting. 此设置不会影响已执行的持久任务。只有新创建的持久性任务或必须重新分配的任务（例如，在节点离开集群后）才会受此设置的影响。

- `cluster.persistent_tasks.allocation.recheck_interval`

  ([Dynamic](https://www.elastic.co/guide/en/elasticsearch/reference/current/settings.html#dynamic-cluster-setting)) The master node will automatically check whether persistent tasks need to be assigned when the cluster state changes significantly. However, there may be other factors, such as memory usage, that affect whether persistent tasks can be assigned to nodes but do not cause the cluster state to change. This setting controls how often assignment checks are performed to react to these factors. The default is 30 seconds. The minimum permitted value is 10 seconds.  （[动态](https://www.elastic.co/guide/en/elasticsearch/reference/current/settings.html#dynamic-cluster-setting)）当集群状态发生显着变化时，主节点会自动检查是否需要分配持久化任务。然而，可能还有其他因素，例如内存使用情况，会影响持久性任务是否可以分配给节点但不会导致集群状态发生变化。此设置控制执行分配检查以对这些因素做出反应的频率。默认值为 30 秒。允许的最小值为 10 秒。

# Cross-cluster replication settings 跨集群复制设置

[edit 编辑](https://github.com/elastic/elasticsearch/edit/8.15/docs/reference/settings/ccr-settings.asciidoc)

These cross-cluster replication settings can be dynamically updated on a live cluster with the [cluster update settings API](https://www.elastic.co/guide/en/elasticsearch/reference/current/cluster-update-settings.html).
可以使用[集群更新设置 API](https://www.elastic.co/guide/en/elasticsearch/reference/current/cluster-update-settings.html)在实时集群上动态更新这些跨集群复制设置。

## Remote recovery settings 远程恢复设置

[edit 编辑](https://github.com/elastic/elasticsearch/edit/8.15/docs/reference/settings/ccr-settings.asciidoc)

The following setting can be used to rate-limit the data transmitted during [remote recoveries](https://www.elastic.co/guide/en/elasticsearch/reference/current/xpack-ccr.html#ccr-remote-recovery):
以下设置可用于限制[远程恢复](https://www.elastic.co/guide/en/elasticsearch/reference/current/xpack-ccr.html#ccr-remote-recovery)期间传输的数据的速率：

- `ccr.indices.recovery.max_bytes_per_sec` ([Dynamic](https://www.elastic.co/guide/en/elasticsearch/reference/current/cluster-update-settings.html))   `ccr.indices.recovery.max_bytes_per_sec` （[动态的](https://www.elastic.co/guide/en/elasticsearch/reference/current/cluster-update-settings.html)）

  Limits the total inbound and outbound remote recovery traffic on each node. Since this limit applies on each node, but there may be many nodes performing remote recoveries concurrently, the total amount of remote recovery bytes may be much higher than this limit. If you set this limit too high then there is a risk that ongoing remote recoveries will consume an excess of bandwidth (or other resources) which could destabilize the cluster. This setting is used by both the leader and follower clusters. For example if it is set to `20mb` on a leader, the leader will only send `20mb/s` to the follower even if the follower is requesting and can accept `60mb/s`. Defaults to `40mb`.  限制每个节点上的总入站和出站远程恢复流量。由于此限制适用于每个节点，但可能有多个节点同时执行远程恢复，因此远程恢复字节总数可能远高于此限制。如果您将此限制设置得太高，则存在持续的远程恢复将消耗过多带宽（或其他资源）的风险，这可能会破坏集群的稳定性。该设置由领导者和追随者集群使用。例如，如果在领导者上设置为`20mb` ，则领导者只会以`20mb/s`发送给追随者，即使追随者正在请求并且可以接受`60mb/s` 。默认为`40mb` 。

## Advanced remote recovery settings 高级远程恢复设置

[edit 编辑](https://github.com/elastic/elasticsearch/edit/8.15/docs/reference/settings/ccr-settings.asciidoc)

The following *expert* settings can be set to manage the resources consumed by remote recoveries:
可以设置以下*专家*设置来管理远程恢复消耗的资源：

- `ccr.indices.recovery.max_concurrent_file_chunks` ([Dynamic](https://www.elastic.co/guide/en/elasticsearch/reference/current/cluster-update-settings.html))   `ccr.indices.recovery.max_concurrent_file_chunks` （[动态的](https://www.elastic.co/guide/en/elasticsearch/reference/current/cluster-update-settings.html)）

  Controls the number of file chunk requests that can be sent in parallel per recovery. As multiple remote recoveries might already running in parallel, increasing this expert-level setting might only help in situations where remote recovery of a single shard is not reaching the total inbound and outbound remote recovery traffic as configured by `ccr.indices.recovery.max_bytes_per_sec`. Defaults to `5`. The maximum allowed value is `10`.  控制每次恢复可以并行发送的文件块请求的数量。由于多个远程恢复可能已经并行运行，因此增加此专家级设置可能仅在单个分片的远程恢复未达到由配置的入站和出站远程恢复总流量的情况下有所帮助。 `ccr.indices.recovery.max_bytes_per_sec` 。默认为`5` 。最大允许值为`10` 。

- `ccr.indices.recovery.chunk_size`([Dynamic](https://www.elastic.co/guide/en/elasticsearch/reference/current/cluster-update-settings.html))   `ccr.indices.recovery.chunk_size` （[动态的](https://www.elastic.co/guide/en/elasticsearch/reference/current/cluster-update-settings.html)）

  Controls the chunk size requested by the follower during file transfer. Defaults to `1mb`.  控制文件传输期间跟随者请求的块大小。默认为`1mb` 。

- `ccr.indices.recovery.recovery_activity_timeout`([Dynamic](https://www.elastic.co/guide/en/elasticsearch/reference/current/cluster-update-settings.html))   `ccr.indices.recovery.recovery_activity_timeout` （[动态的](https://www.elastic.co/guide/en/elasticsearch/reference/current/cluster-update-settings.html)）

  Controls the timeout for recovery activity. This timeout primarily  applies on the leader cluster. The leader cluster must open resources in-memory to  supply data to the follower during the recovery process. If the leader does not receive recovery requests from the follower for this period of time, it will close the resources. Defaults to 60 seconds.  控制恢复活动的超时。此超时主要适用于领导集群。在恢复过程中，Leader 集群必须打开内存中的资源以向 Follower 提供数据。如果Leader在这段时间没有收到Follower的恢复请求，就会关闭资源。默认为 60 秒。

- `ccr.indices.recovery.internal_action_timeout` ([Dynamic](https://www.elastic.co/guide/en/elasticsearch/reference/current/cluster-update-settings.html))   `ccr.indices.recovery.internal_action_timeout` （[动态的](https://www.elastic.co/guide/en/elasticsearch/reference/current/cluster-update-settings.html)）

  Controls the timeout for individual network requests during the remote recovery process. An individual action timing out can fail the recovery. Defaults to 60 seconds.  控制远程恢复过程中各个网络请求的超时。单个操作超时可能导致恢复失败。默认为 60 秒。

# Discovery and cluster formation settings 发现和集群形成设置

[edit 编辑](https://github.com/elastic/elasticsearch/edit/8.15/docs/reference/modules/discovery/discovery-settings.asciidoc)

[Discovery and cluster formation](https://www.elastic.co/guide/en/elasticsearch/reference/current/modules-discovery.html) are affected by the following settings:
[发现和集群形成](https://www.elastic.co/guide/en/elasticsearch/reference/current/modules-discovery.html)受以下设置影响：

- `discovery.seed_hosts`

  ([Static](https://www.elastic.co/guide/en/elasticsearch/reference/current/settings.html#static-cluster-setting)) Provides a list of the addresses of the master-eligible nodes in the cluster. May also be a single string containing the addresses separated by commas. Each address has the format `host:port` or `host`. The `host` is either a host name to be resolved by DNS, an IPv4 address, or an IPv6 address. IPv6 addresses must be enclosed in square brackets. If a host name resolves via DNS to multiple addresses, Elasticsearch uses all of them. DNS lookups are subject to [JVM DNS caching](https://www.elastic.co/guide/en/elasticsearch/reference/current/networkaddress-cache-ttl.html). If the `port` is not given then it is determined by checking the following settings in order: （[静态](https://www.elastic.co/guide/en/elasticsearch/reference/current/settings.html#static-cluster-setting)）提供集群中符合主节点资格的节点的地址列表。也可以是包含用逗号分隔的地址的单个字符串。每个地址的格式为`host:port`或`host` 。 `host`是要由 DNS 解析的主机名、IPv4 地址或 IPv6 地址。 IPv6 地址必须括在方括号内。如果主机名通过 DNS 解析为多个地址，Elasticsearch 将使用所有这些地址。 DNS 查找受[JVM DNS 缓存的](https://www.elastic.co/guide/en/elasticsearch/reference/current/networkaddress-cache-ttl.html)约束。如果未给出`port` ，则通过按顺序检查以下设置来确定：  `transport.profiles.default.port`  `transport.port`  If neither of these is set then the default port is `9300`. The default value for `discovery.seed_hosts` is `["127.0.0.1", "[::1]"]`. See [`discovery.seed_hosts`](https://www.elastic.co/guide/en/elasticsearch/reference/current/important-settings.html#unicast.hosts). 如果这些都没有设置，则默认端口为`9300` 。 `discovery.seed_hosts`的默认值为`["127.0.0.1", "[::1]"]` 。请参阅[`discovery.seed_hosts`](https://www.elastic.co/guide/en/elasticsearch/reference/current/important-settings.html#unicast.hosts) 。

- `discovery.seed_providers`

  ([Static](https://www.elastic.co/guide/en/elasticsearch/reference/current/settings.html#static-cluster-setting)) Specifies which types of [seed hosts provider](https://www.elastic.co/guide/en/elasticsearch/reference/current/discovery-hosts-providers.html#built-in-hosts-providers) to use to obtain the addresses of the seed nodes used to start the discovery process. By default, it is the [settings-based seed hosts provider](https://www.elastic.co/guide/en/elasticsearch/reference/current/discovery-hosts-providers.html#settings-based-hosts-provider) which obtains the seed node addresses from the `discovery.seed_hosts` setting.  （[静态](https://www.elastic.co/guide/en/elasticsearch/reference/current/settings.html#static-cluster-setting)）指定使用哪种类型的[种子主机提供程序](https://www.elastic.co/guide/en/elasticsearch/reference/current/discovery-hosts-providers.html#built-in-hosts-providers)来获取用于启动发现过程的种子节点的地址。默认情况下，[基于设置的种子主机提供程序](https://www.elastic.co/guide/en/elasticsearch/reference/current/discovery-hosts-providers.html#settings-based-hosts-provider)从`discovery.seed_hosts`设置中获取种子节点地址。

- `discovery.type`

  ([Static](https://www.elastic.co/guide/en/elasticsearch/reference/current/settings.html#static-cluster-setting)) Specifies whether Elasticsearch should form a multiple-node cluster. Defaults to `multi-node`, which means that Elasticsearch discovers other nodes when forming a cluster and allows other nodes to join the cluster later. If set to `single-node`, Elasticsearch forms a single-node cluster and suppresses the timeout set by `cluster.publish.timeout`. For more information about when you might use this setting, see [Single-node discovery](https://www.elastic.co/guide/en/elasticsearch/reference/current/bootstrap-checks.html#single-node-discovery).  （[静态](https://www.elastic.co/guide/en/elasticsearch/reference/current/settings.html#static-cluster-setting)）指定 Elasticsearch 是否应形成多节点集群。默认为`multi-node` ，这意味着 Elasticsearch 在形成集群时会发现其他节点，并允许其他节点稍后加入集群。如果设置为`single-node` ，Elasticsearch 会形成单节点集群并抑制`cluster.publish.timeout`设置的超时。有关何时可以使用此设置的更多信息，请参阅[单节点发现](https://www.elastic.co/guide/en/elasticsearch/reference/current/bootstrap-checks.html#single-node-discovery)。

- `cluster.initial_master_nodes`

  ([Static](https://www.elastic.co/guide/en/elasticsearch/reference/current/settings.html#static-cluster-setting)) Sets the initial set of master-eligible nodes in a brand-new cluster. By default this list is empty, meaning that this node expects to join a cluster that has already been bootstrapped. Remove this setting once the cluster has formed. Do not use this setting when restarting nodes or when adding new nodes to an existing cluster. See [`cluster.initial_master_nodes`](https://www.elastic.co/guide/en/elasticsearch/reference/current/important-settings.html#initial_master_nodes).  （[静态](https://www.elastic.co/guide/en/elasticsearch/reference/current/settings.html#static-cluster-setting)）在全新集群中设置初始的符合主节点资格的节点集。默认情况下，此列表为空，这意味着该节点期望加入已引导的集群。集群形成后删除此设置。重新启动节点或向现有集群添加新节点时请勿使用此设置。请参阅[`cluster.initial_master_nodes`](https://www.elastic.co/guide/en/elasticsearch/reference/current/important-settings.html#initial_master_nodes) 。

## Expert settings 专家设置

[edit 编辑](https://github.com/elastic/elasticsearch/edit/8.15/docs/reference/modules/discovery/discovery-settings.asciidoc)

Discovery and cluster formation are also affected by the following *expert-level* settings, although it is not recommended to change any of these from their default values.
发现和集群形成也受到以下*专家级*设置的影响，但不建议更改其中任何默认值。

If you adjust these settings then your cluster may not form correctly or may become unstable or intolerant of certain failures.
如果调整这些设置，那么您的集群可能无法正确形成，或者可能变得不稳定或无法容忍某些故障。

- `discovery.cluster_formation_warning_timeout`

  ([Static](https://www.elastic.co/guide/en/elasticsearch/reference/current/settings.html#static-cluster-setting)) Sets how long a node will try to form a cluster before logging a warning that the cluster did not form. Defaults to `10s`. If a cluster has not formed after `discovery.cluster_formation_warning_timeout` has elapsed then the node will log a warning message that starts with the phrase `master not discovered` which describes the current state of the discovery process.  （[静态](https://www.elastic.co/guide/en/elasticsearch/reference/current/settings.html#static-cluster-setting)）设置节点在记录集群未形成的警告之前尝试形成集群的时间。默认为`10s` 。如果之后还没有形成簇 `discovery.cluster_formation_warning_timeout` 已过去，则节点将记录一条警告消息，该消息以短语`master not discovered`开头，该短语描述了发现过程的当前状态。

- `discovery.find_peers_interval`

  ([Static](https://www.elastic.co/guide/en/elasticsearch/reference/current/settings.html#static-cluster-setting)) Sets how long a node will wait before attempting another discovery round. Defaults to `1s`.  （[静态](https://www.elastic.co/guide/en/elasticsearch/reference/current/settings.html#static-cluster-setting)）设置节点在尝试另一轮发现之前等待的时间。默认为`1s` 。

- `discovery.probe.connect_timeout`

  ([Static](https://www.elastic.co/guide/en/elasticsearch/reference/current/settings.html#static-cluster-setting)) Sets how long to wait when attempting to connect to each address. Defaults to `30s`.  （[静态](https://www.elastic.co/guide/en/elasticsearch/reference/current/settings.html#static-cluster-setting)）设置尝试连接到每个地址时等待的时间。默认为`30s` 。

- `discovery.probe.handshake_timeout`

  ([Static](https://www.elastic.co/guide/en/elasticsearch/reference/current/settings.html#static-cluster-setting)) Sets how long to wait when attempting to identify the remote node via a handshake. Defaults to `30s`.  （[静态](https://www.elastic.co/guide/en/elasticsearch/reference/current/settings.html#static-cluster-setting)）设置尝试通过握手识别远程节点时等待的时间。默认为`30s` 。

- `discovery.request_peers_timeout`

  ([Static](https://www.elastic.co/guide/en/elasticsearch/reference/current/settings.html#static-cluster-setting)) Sets how long a node will wait after asking its peers again before considering the request to have failed. Defaults to `3s`.  （[静态](https://www.elastic.co/guide/en/elasticsearch/reference/current/settings.html#static-cluster-setting)）设置节点在再次询问其对等方之后在考虑请求失败之前将等待多长时间。默认为`3s` 。

- `discovery.find_peers_warning_timeout`

  ([Static](https://www.elastic.co/guide/en/elasticsearch/reference/current/settings.html#static-cluster-setting)) Sets how long a node will attempt to discover its peers before it starts to log verbose messages describing why the connection attempts are failing. Defaults to `3m`.  （[静态](https://www.elastic.co/guide/en/elasticsearch/reference/current/settings.html#static-cluster-setting)）设置节点在开始记录描述连接尝试失败原因的详细消息之前尝试发现其对等点的时间。默认为`3m` 。

- `discovery.seed_resolver.max_concurrent_resolvers`

  ([Static](https://www.elastic.co/guide/en/elasticsearch/reference/current/settings.html#static-cluster-setting)) Specifies how many concurrent DNS lookups to perform when resolving the addresses of seed nodes. Defaults to `10`.  （[静态](https://www.elastic.co/guide/en/elasticsearch/reference/current/settings.html#static-cluster-setting)）指定解析种子节点地址时要执行的并发 DNS 查找数量。默认为`10` 。

- `discovery.seed_resolver.timeout`

  ([Static](https://www.elastic.co/guide/en/elasticsearch/reference/current/settings.html#static-cluster-setting)) Specifies how long to wait for each DNS lookup performed when resolving the addresses of seed nodes. Defaults to `5s`.  （[静态](https://www.elastic.co/guide/en/elasticsearch/reference/current/settings.html#static-cluster-setting)）指定解析种子节点地址时执行的每次 DNS 查找的等待时间。默认为`5s` 。

- `cluster.auto_shrink_voting_configuration`

  ([Dynamic](https://www.elastic.co/guide/en/elasticsearch/reference/current/settings.html#dynamic-cluster-setting)) Controls whether the [voting configuration](https://www.elastic.co/guide/en/elasticsearch/reference/current/modules-discovery-voting.html) sheds departed nodes automatically, as long as it still contains at least 3 nodes. The default value is `true`. If set to `false`, the voting configuration never shrinks automatically and you must remove departed nodes manually with the [voting configuration exclusions API](https://www.elastic.co/guide/en/elasticsearch/reference/current/voting-config-exclusions.html).  （[动态](https://www.elastic.co/guide/en/elasticsearch/reference/current/settings.html#dynamic-cluster-setting)）控制[投票配置](https://www.elastic.co/guide/en/elasticsearch/reference/current/modules-discovery-voting.html)是否自动删除离开的节点，只要它仍然包含至少 3 个节点。默认值为`true` 。如果设置为`false` ，投票配置永远不会自动收缩，您必须使用[投票配置排除 API](https://www.elastic.co/guide/en/elasticsearch/reference/current/voting-config-exclusions.html)手动删除离开的节点。

- `cluster.election.back_off_time`

  ([Static](https://www.elastic.co/guide/en/elasticsearch/reference/current/settings.html#static-cluster-setting)) Sets the amount to increase the upper bound on the wait before an election on each election failure. Note that this is *linear* backoff. This defaults to `100ms`. Changing this setting from the default may cause your cluster to fail to elect a master node.  （[静态](https://www.elastic.co/guide/en/elasticsearch/reference/current/settings.html#static-cluster-setting)）设置每次选举失败时选举前等待时间上限的增加量。请注意，这是*线性*退避。默认为`100ms` 。更改此默认设置可能会导致集群无法选择主节点。

- `cluster.election.duration`

  ([Static](https://www.elastic.co/guide/en/elasticsearch/reference/current/settings.html#static-cluster-setting)) Sets how long each election is allowed to take before a node considers it to have failed and schedules a retry. This defaults to `500ms`. Changing this setting from the default may cause your cluster to fail to elect a master node.  （[静态](https://www.elastic.co/guide/en/elasticsearch/reference/current/settings.html#static-cluster-setting)）设置每次选举在节点认为失败并安排重试之前允许进行的时间。默认为`500ms` 。更改此默认设置可能会导致集群无法选择主节点。

- `cluster.election.initial_timeout`

  ([Static](https://www.elastic.co/guide/en/elasticsearch/reference/current/settings.html#static-cluster-setting)) Sets the upper bound on how long a node will wait initially, or after the elected master fails, before attempting its first election. This defaults to `100ms`. Changing this setting from the default may cause your cluster to fail to elect a master node.  （[静态](https://www.elastic.co/guide/en/elasticsearch/reference/current/settings.html#static-cluster-setting)）设置节点最初等待的时间上限，或者在当选的主节点失败后，在尝试第一次选举之前等待的时间上限。默认为`100ms` 。更改此默认设置可能会导致集群无法选择主节点。

- `cluster.election.max_timeout`

  ([Static](https://www.elastic.co/guide/en/elasticsearch/reference/current/settings.html#static-cluster-setting)) Sets the maximum upper bound on how long a node will wait before attempting an first election, so that an network partition that lasts for a long time does not result in excessively sparse elections. This defaults to `10s`. Changing this setting from the default may cause your cluster to fail to elect a master node.  （[静态](https://www.elastic.co/guide/en/elasticsearch/reference/current/settings.html#static-cluster-setting)）设置节点在尝试第一次选举之前等待的时间的最大上限，以便持续很长时间的网络分区不会导致选举过于稀疏。默认为`10s` 。更改此默认设置可能会导致集群无法选择主节点。

- `cluster.fault_detection.follower_check.interval`

  ([Static](https://www.elastic.co/guide/en/elasticsearch/reference/current/settings.html#static-cluster-setting)) Sets how long the elected master waits between follower checks to each other node in the cluster. Defaults to `1s`. Changing this setting from the default may cause your cluster to become unstable.  （[静态](https://www.elastic.co/guide/en/elasticsearch/reference/current/settings.html#static-cluster-setting)）设置当选的主节点在跟随者检查集群中每个其他节点之间等待的时间。默认为`1s` 。更改此默认设置可能会导致您的集群变得不稳定。

- `cluster.fault_detection.follower_check.timeout`

  ([Static](https://www.elastic.co/guide/en/elasticsearch/reference/current/settings.html#static-cluster-setting)) Sets how long the elected master waits for a response to a follower check before considering it to have failed. Defaults to `10s`. Changing this setting from the default may cause your cluster to become unstable.  （[静态](https://www.elastic.co/guide/en/elasticsearch/reference/current/settings.html#static-cluster-setting)）设置当选的主节点在认为跟随者检查失败之前等待响应的时间。默认为`10s` 。更改此默认设置可能会导致您的集群变得不稳定。

- `cluster.fault_detection.follower_check.retry_count`

  ([Static](https://www.elastic.co/guide/en/elasticsearch/reference/current/settings.html#static-cluster-setting)) Sets how many consecutive follower check failures must occur to each node before the elected master considers that node to be faulty and removes it from the cluster. Defaults to `3`. Changing this setting from the default may cause your cluster to become unstable.  （[静态](https://www.elastic.co/guide/en/elasticsearch/reference/current/settings.html#static-cluster-setting)）设置每个节点必须发生多少次连续的跟随者检查失败后，当选的主节点才会认为该节点出现故障并将其从集群中删除。默认为`3` 。更改此默认设置可能会导致您的集群变得不稳定。

- `cluster.fault_detection.leader_check.interval`

  ([Static](https://www.elastic.co/guide/en/elasticsearch/reference/current/settings.html#static-cluster-setting)) Sets how long each node waits between checks of the elected master. Defaults to `1s`. Changing this setting from the default may cause your cluster to become unstable.  （[静态](https://www.elastic.co/guide/en/elasticsearch/reference/current/settings.html#static-cluster-setting)）设置每个节点在检查所选主节点之间等待的时间。默认为`1s` 。更改此默认设置可能会导致您的集群变得不稳定。

- `cluster.fault_detection.leader_check.timeout`

  ([Static](https://www.elastic.co/guide/en/elasticsearch/reference/current/settings.html#static-cluster-setting)) Sets how long each node waits for a response to a leader check from the elected master before considering it to have failed. Defaults to `10s`. Changing this setting from the default may cause your cluster to become unstable.  （[静态](https://www.elastic.co/guide/en/elasticsearch/reference/current/settings.html#static-cluster-setting)）设置每个节点在认为节点失败之前等待所选主节点对领导者检查的响应的时间。默认为`10s` 。更改此默认设置可能会导致您的集群变得不稳定。

- `cluster.fault_detection.leader_check.retry_count`

  ([Static](https://www.elastic.co/guide/en/elasticsearch/reference/current/settings.html#static-cluster-setting)) Sets how many consecutive leader check failures must occur before a node considers the elected master to be faulty and attempts to find or elect a new master. Defaults to `3`. Changing this setting from the default may cause your cluster to become unstable.  （[静态](https://www.elastic.co/guide/en/elasticsearch/reference/current/settings.html#static-cluster-setting)）设置在节点认为当选的主节点有故障并尝试查找或选举新的主节点之前，必须发生多少次连续的领导者检查失败。默认为`3` 。更改此默认设置可能会导致您的集群变得不稳定。

- `cluster.follower_lag.timeout`

  ([Static](https://www.elastic.co/guide/en/elasticsearch/reference/current/settings.html#static-cluster-setting)) Sets how long the master node waits to receive acknowledgements for cluster state updates from lagging nodes. The default value is `90s`. If a node does not successfully apply the cluster state update within this period of time, it is considered to have failed and is removed from the cluster. See [Publishing the cluster state](https://www.elastic.co/guide/en/elasticsearch/reference/current/cluster-state-publishing.html).  （[静态](https://www.elastic.co/guide/en/elasticsearch/reference/current/settings.html#static-cluster-setting)）设置主节点等待从滞后节点接收集群状态更新确认的时间。默认值为`90s` 。如果节点在这段时间内没有成功应用集群状态更新，则认为该节点已失败并从集群中删除。请参阅[发布集群状态](https://www.elastic.co/guide/en/elasticsearch/reference/current/cluster-state-publishing.html)。

- `cluster.max_voting_config_exclusions`

  ([Dynamic](https://www.elastic.co/guide/en/elasticsearch/reference/current/settings.html#dynamic-cluster-setting)) Sets a limit on the number of voting configuration exclusions at any one time. The default value is `10`. See [*Add and remove nodes in your cluster*](https://www.elastic.co/guide/en/elasticsearch/reference/current/add-elasticsearch-nodes.html).  （[动态](https://www.elastic.co/guide/en/elasticsearch/reference/current/settings.html#dynamic-cluster-setting)）对任意一次投票配置排除的数量设置限制。默认值为`10` 。请参阅[*添加和删除集群中的节点*](https://www.elastic.co/guide/en/elasticsearch/reference/current/add-elasticsearch-nodes.html)。

- `cluster.publish.info_timeout`

  ([Static](https://www.elastic.co/guide/en/elasticsearch/reference/current/settings.html#static-cluster-setting)) Sets how long the master node waits for each cluster state update to be completely published to all nodes before logging a message indicating that some nodes are responding slowly. The default value is `10s`.  （[静态](https://www.elastic.co/guide/en/elasticsearch/reference/current/settings.html#static-cluster-setting)）设置主节点在记录指示某些节点响应缓慢的消息之前等待每个集群状态更新完全发布到所有节点的时间。默认值为`10s` 。

- `cluster.publish.timeout`

  ([Static](https://www.elastic.co/guide/en/elasticsearch/reference/current/settings.html#static-cluster-setting)) Sets how long the master node waits for each cluster state update to be completely published to all nodes, unless `discovery.type` is set to `single-node`. The default value is `30s`. See [Publishing the cluster state](https://www.elastic.co/guide/en/elasticsearch/reference/current/cluster-state-publishing.html).  （[静态](https://www.elastic.co/guide/en/elasticsearch/reference/current/settings.html#static-cluster-setting)）设置主节点等待每个集群状态更新完全发布到所有节点的时间，除非`discovery.type`设置为`single-node` 。默认值为`30s` 。请参阅[发布集群状态](https://www.elastic.co/guide/en/elasticsearch/reference/current/cluster-state-publishing.html)。

- `cluster.discovery_configuration_check.interval`

  ([Static](https://www.elastic.co/guide/en/elasticsearch/reference/current/settings.html#static-cluster-setting)) Sets the interval of some checks that will log warnings about an incorrect discovery configuration. The default value is `30s`.  （[静态](https://www.elastic.co/guide/en/elasticsearch/reference/current/settings.html#static-cluster-setting)）设置一些检查的时间间隔，这些检查将记录有关不正确的发现配置的警告。默认值为`30s` 。

- `cluster.join_validation.cache_timeout`

  ([Static](https://www.elastic.co/guide/en/elasticsearch/reference/current/settings.html#static-cluster-setting)) When a node requests to join the cluster, the elected master node sends it a copy of a recent cluster state to detect certain problems which might prevent the new node from joining the cluster. The master caches the state it sends and uses the cached state if another node joins the cluster soon after. This setting controls how long the master waits until it clears this cache. Defaults to `60s`.  （[静态](https://www.elastic.co/guide/en/elasticsearch/reference/current/settings.html#static-cluster-setting)）当节点请求加入集群时，当选的主节点会向其发送最近集群状态的副本，以检测可能阻止新节点加入集群的某些问题。主节点缓存其发送的状态，并在另一个节点随后加入集群时使用缓存的状态。此设置控制主设备清除此缓存之前等待的时间。默认为`60s` 。



- `cluster.no_master_block`

  ([Dynamic](https://www.elastic.co/guide/en/elasticsearch/reference/current/settings.html#dynamic-cluster-setting)) Specifies which operations are rejected when there is no active master in a cluster. This setting has three valid values:  （[动态](https://www.elastic.co/guide/en/elasticsearch/reference/current/settings.html#dynamic-cluster-setting)）指定当集群中没有活动主节点时拒绝哪些操作。此设置具有三个有效值：   `all`  All operations on the node (both read and write operations) are rejected. This also applies for API cluster state read or write operations, like the get index settings, update mapping, and cluster state API.  节点上的所有操作（读和写操作）都会被拒绝。这也适用于 API 集群状态读取或写入操作，例如获取索引设置、更新映射和集群状态 API。  `write`  (default) Write operations are rejected. Read operations succeed, based on the last known cluster configuration. This situation may result in partial reads of stale data as this node may be isolated from the rest of the cluster.  （默认）写入操作被拒绝。根据最后已知的集群配置，读取操作成功。这种情况可能会导致部分读取过时数据，因为该节点可能与集群的其余部分隔离。  `metadata_write`  Only metadata write operations (e.g. mapping updates, routing table changes) are rejected but regular indexing operations continue to work. Read and write operations succeed, based on the last known cluster configuration. This situation may result in partial reads of stale data as this node may be isolated from the rest of the cluster.  仅拒绝元数据写入操作（例如映射更新、路由表更改），但常规索引操作继续工作。根据最后已知的集群配置，读取和写入操作成功。这种情况可能会导致部分读取过时数据，因为该节点可能与集群的其余部分隔离。     The `cluster.no_master_block` setting doesn’t apply to nodes-based APIs (for example, cluster stats, node info, and node stats APIs). Requests to these APIs are not be blocked and can run on any available node.  `cluster.no_master_block`设置不适用于基于节点的 API（例如，集群统计信息、节点信息和节点统计 API）。对这些 API 的请求不会被阻止，并且可以在任何可用节点上运行。 For the cluster to be fully operational, it must have an active master.  为了使集群完全运行，它必须有一个活动的主节点。

- `monitor.fs.health.enabled`

  ([Dynamic](https://www.elastic.co/guide/en/elasticsearch/reference/current/settings.html#dynamic-cluster-setting)) If `true`, the node runs periodic [filesystem health checks](https://www.elastic.co/guide/en/elasticsearch/reference/current/cluster-fault-detection.html#cluster-fault-detection-filesystem-health). Defaults to `true`.  （[动态](https://www.elastic.co/guide/en/elasticsearch/reference/current/settings.html#dynamic-cluster-setting)）如果为`true` ，则节点运行定期[文件系统运行状况检查](https://www.elastic.co/guide/en/elasticsearch/reference/current/cluster-fault-detection.html#cluster-fault-detection-filesystem-health)。默认为`true` 。

- `monitor.fs.health.refresh_interval`

  ([Static](https://www.elastic.co/guide/en/elasticsearch/reference/current/settings.html#static-cluster-setting)) Interval between successive [filesystem health checks](https://www.elastic.co/guide/en/elasticsearch/reference/current/cluster-fault-detection.html#cluster-fault-detection-filesystem-health). Defaults to `2m`.  （[静态](https://www.elastic.co/guide/en/elasticsearch/reference/current/settings.html#static-cluster-setting)）连续[文件系统运行状况检查](https://www.elastic.co/guide/en/elasticsearch/reference/current/cluster-fault-detection.html#cluster-fault-detection-filesystem-health)之间的时间间隔。默认为`2m` 。

- `monitor.fs.health.slow_path_logging_threshold`

  ([Dynamic](https://www.elastic.co/guide/en/elasticsearch/reference/current/settings.html#dynamic-cluster-setting)) If a [filesystem health checks](https://www.elastic.co/guide/en/elasticsearch/reference/current/cluster-fault-detection.html#cluster-fault-detection-filesystem-health) takes longer than this threshold then Elasticsearch logs a warning. Defaults to `5s`.  （[动态](https://www.elastic.co/guide/en/elasticsearch/reference/current/settings.html#dynamic-cluster-setting)）如果[文件系统运行状况检查](https://www.elastic.co/guide/en/elasticsearch/reference/current/cluster-fault-detection.html#cluster-fault-detection-filesystem-health)花费的时间超过此阈值，则 Elasticsearch 会记录警告。默认为`5s` 。

# Field data cache settings 字段数据缓存设置

[edit 编辑](https://github.com/elastic/elasticsearch/edit/8.15/docs/reference/modules/indices/fielddata.asciidoc)

The field data cache contains [field data](https://www.elastic.co/guide/en/elasticsearch/reference/current/text.html#fielddata-mapping-param) and [global ordinals](https://www.elastic.co/guide/en/elasticsearch/reference/current/eager-global-ordinals.html), which are both used to support aggregations on certain field types. Since these are on-heap data structures, it is important to monitor the cache’s use.
字段数据缓存包含[字段数据](https://www.elastic.co/guide/en/elasticsearch/reference/current/text.html#fielddata-mapping-param)和[全局序号](https://www.elastic.co/guide/en/elasticsearch/reference/current/eager-global-ordinals.html)，它们都用于支持某些字段类型的聚合。由于这些是堆上数据结构，因此监视缓存的使用非常重要。

## Cache size 缓存大小

[edit 编辑](https://github.com/elastic/elasticsearch/edit/8.15/docs/reference/modules/indices/fielddata.asciidoc)

The entries in the cache are expensive to build, so the default behavior is to keep the cache loaded in memory. The default cache size is unlimited, causing the cache to grow until it reaches the limit set by the [field data circuit breaker](https://www.elastic.co/guide/en/elasticsearch/reference/current/circuit-breaker.html#fielddata-circuit-breaker). This behavior can be configured.
缓存中的条目的构建成本很高，因此默认行为是将缓存加载到内存中。默认缓存大小是无限的，导致缓存不断增长，直到达到[字段数据断路器](https://www.elastic.co/guide/en/elasticsearch/reference/current/circuit-breaker.html#fielddata-circuit-breaker)设置的限制。可以配置此行为。

If the cache size limit is set, the cache will begin clearing the least-recently-updated entries in the cache. This setting can automatically avoid the circuit breaker limit, at the cost of rebuilding the cache as needed.
如果设置了缓存大小限制，缓存将开始清除缓存中最近最少更新的条目。此设置可以自动避免断路器限制，但代价是根据需要重建缓存。

If the circuit breaker limit is reached, further requests that increase the cache size will be prevented. In this case you should manually [clear the cache](https://www.elastic.co/guide/en/elasticsearch/reference/current/indices-clearcache.html).
如果达到断路器限制，将阻止进一步增加缓存大小的请求。在这种情况下，您应该手动[清除缓存](https://www.elastic.co/guide/en/elasticsearch/reference/current/indices-clearcache.html)。

- `indices.fielddata.cache.size`

  ([Static](https://www.elastic.co/guide/en/elasticsearch/reference/current/settings.html#static-cluster-setting)) The max size of the field data cache, eg `38%` of node heap space, or an absolute value, eg `12GB`. Defaults to unbounded. If you choose to set it, it should be smaller than [Field data circuit breaker](https://www.elastic.co/guide/en/elasticsearch/reference/current/circuit-breaker.html#fielddata-circuit-breaker) limit.  （[静态](https://www.elastic.co/guide/en/elasticsearch/reference/current/settings.html#static-cluster-setting)）字段数据缓存的最大大小，例如节点堆空间的`38%` ，或绝对值，例如`12GB` 。默认为无界。如果选择设置，则应小于[现场数据断路器](https://www.elastic.co/guide/en/elasticsearch/reference/current/circuit-breaker.html#fielddata-circuit-breaker)限制。

## Monitoring field data 监测现场数据

[edit 编辑](https://github.com/elastic/elasticsearch/edit/8.15/docs/reference/modules/indices/fielddata.asciidoc)

You can monitor memory usage for field data as well as the field data circuit breaker using the [nodes stats API](https://www.elastic.co/guide/en/elasticsearch/reference/current/cluster-nodes-stats.html) or the [cat fielddata API](https://www.elastic.co/guide/en/elasticsearch/reference/current/cat-fielddata.html).
您可以使用[nodes stats API](https://www.elastic.co/guide/en/elasticsearch/reference/current/cluster-nodes-stats.html)或[cat fielddata API](https://www.elastic.co/guide/en/elasticsearch/reference/current/cat-fielddata.html)监控字段数据的内存使用情况以及字段数据断路器。

# Health diagnostic settings in Elasticsearch Elasticsearch 中的健康诊断设置

[edit 编辑](https://github.com/elastic/elasticsearch/edit/8.15/docs/reference/settings/health-diagnostic-settings.asciidoc)

The following are the *expert-level* settings available for configuring an internal diagnostics service. The output of this service is currently exposed through the Health API [Health API](https://www.elastic.co/guide/en/elasticsearch/reference/current/health-api.html). It is not recommended to change any of these from their default values.
以下是可用于配置内部诊断服务的*专家级*设置。该服务的输出当前通过 Health API [Health API](https://www.elastic.co/guide/en/elasticsearch/reference/current/health-api.html)公开。不建议更改其中任何默认值。

## Cluster level settings 集群级别设置

[edit 编辑](https://github.com/elastic/elasticsearch/edit/8.15/docs/reference/settings/health-diagnostic-settings.asciidoc)

- `health.master_history.has_master_lookup_timeframe`

  ([Static](https://www.elastic.co/guide/en/elasticsearch/reference/current/settings.html#static-cluster-setting)) The amount of time a node looks back to see if it has observed a master at all, before moving on with other checks. Defaults to `30s` (30 seconds).  （[静态](https://www.elastic.co/guide/en/elasticsearch/reference/current/settings.html#static-cluster-setting)）节点在继续进行其他检查之前回头查看是否已观察到主节点的时间量。默认为`30s` （30 秒）。

- `master_history.max_age`

  ([Static](https://www.elastic.co/guide/en/elasticsearch/reference/current/settings.html#static-cluster-setting)) The timeframe we record the master history to be used for diagnosing the cluster health. Master node changes older than this time will not be considered when diagnosing the cluster health. Defaults to `30m` (30 minutes).  （[静态](https://www.elastic.co/guide/en/elasticsearch/reference/current/settings.html#static-cluster-setting)）我们记录用于诊断集群健康状况的主历史记录的时间范围。诊断集群运行状况时，不会考虑早于该时间的主节点更改。默认为`30m` （30 分钟）。

- `health.master_history.identity_changes_threshold`

  ([Static](https://www.elastic.co/guide/en/elasticsearch/reference/current/settings.html#static-cluster-setting)) The number of master identity changes witnessed by a node that indicates the cluster is not healthy. Defaults to `4`.  （[静态](https://www.elastic.co/guide/en/elasticsearch/reference/current/settings.html#static-cluster-setting)）节点见证的表明集群不健康的主节点身份更改的数量。默认为`4` 。

- `health.master_history.no_master_transitions_threshold`

  ([Static](https://www.elastic.co/guide/en/elasticsearch/reference/current/settings.html#static-cluster-setting)) The number of transitions to no master witnessed by a node that indicates the cluster is not healthy. Defaults to `4`.  （[静态](https://www.elastic.co/guide/en/elasticsearch/reference/current/settings.html#static-cluster-setting)）节点见证的无主节点转换的数量，表明集群不健康。默认为`4` 。

- `health.node.enabled`

  ([Dynamic](https://www.elastic.co/guide/en/elasticsearch/reference/current/cluster-update-settings.html)) Enables the health node, which allows the health API to provide indications about cluster wide health aspects such as disk space.  （[动态](https://www.elastic.co/guide/en/elasticsearch/reference/current/cluster-update-settings.html)）启用运行状况节点，该节点允许运行状况 API 提供有关集群范围运行状况（例如磁盘空间）的指示。

- `health.reporting.local.monitor.interval`

  ([Dynamic](https://www.elastic.co/guide/en/elasticsearch/reference/current/cluster-update-settings.html)) Determines the interval in which each node of the cluster monitors aspects that comprise its local health such as its disk usage.  （[动态](https://www.elastic.co/guide/en/elasticsearch/reference/current/cluster-update-settings.html)）确定集群的每个节点监视构成其本地运行状况（例如磁盘使用情况）的各个方面的时间间隔。

- `health.ilm.max_time_on_action`

  ([Dynamic](https://www.elastic.co/guide/en/elasticsearch/reference/current/cluster-update-settings.html)) The minimum amount of time an index has to be in an index lifecycle  management (ILM) action before it is considered stagnant. Defaults to `1d` (1 day).  （[动态](https://www.elastic.co/guide/en/elasticsearch/reference/current/cluster-update-settings.html)）索引在被视为停滞之前必须处于索引生命周期管理 (ILM) 操作的最短时间。默认为`1d` （1 天）。

- `health.ilm.max_time_on_step`

  ([Dynamic](https://www.elastic.co/guide/en/elasticsearch/reference/current/cluster-update-settings.html)) The minimum amount of time an index has to be in an ILM step before it is considered stagnant. Defaults to `1d` (1 day).  （[动态](https://www.elastic.co/guide/en/elasticsearch/reference/current/cluster-update-settings.html)）索引在被视为停滞之前必须处于 ILM 步骤的最短时间。默认为`1d` （1 天）。

- `health.ilm.max_retries_per_step`

  ([Dynamic](https://www.elastic.co/guide/en/elasticsearch/reference/current/cluster-update-settings.html)) The minimum amount of times an index has retried by an ILM step before it is considered stagnant. Defaults to `100` （[动态](https://www.elastic.co/guide/en/elasticsearch/reference/current/cluster-update-settings.html)）在索引被视为停滞之前，ILM 步骤重试索引的最小次数。默认为`100`

- `health.periodic_logger.enabled`

  ([Dynamic](https://www.elastic.co/guide/en/elasticsearch/reference/current/cluster-update-settings.html)) Enables the health periodic logger, which logs the health statuses of  each health indicator along with the top level one as observed by the  Health API. Defaults to `false`.  ([动态](https://www.elastic.co/guide/en/elasticsearch/reference/current/cluster-update-settings.html)) 启用运行状况定期记录器，该记录器记录每个运行状况指标的运行状态以及由运行状况 API 观察到的顶级指标。默认为`false` 。

- `health.periodic_logger.poll_interval`

  ([Dynamic](https://www.elastic.co/guide/en/elasticsearch/reference/current/cluster-update-settings.html), [time unit value](https://www.elastic.co/guide/en/elasticsearch/reference/current/api-conventions.html#time-units)) How often Elasticsearch logs the health status of the cluster and of each health indicator as observed by the Health API. Defaults to `60s` (60 seconds).  （[动态](https://www.elastic.co/guide/en/elasticsearch/reference/current/cluster-update-settings.html)，[时间单位值](https://www.elastic.co/guide/en/elasticsearch/reference/current/api-conventions.html#time-units)）Elasticsearch 记录集群健康状态以及健康 API 观察到的每个健康指标的频率。默认为`60s` （60 秒）。

# Index lifecycle management settings in Elasticsearch Elasticsearch 中的索引生命周期管理设置

[edit 编辑](https://github.com/elastic/elasticsearch/edit/8.15/docs/reference/settings/ilm-settings.asciidoc)

These are the settings available for configuring [index lifecycle management](https://www.elastic.co/guide/en/elasticsearch/reference/current/index-lifecycle-management.html) (ILM).
这些是可用于配置[索引生命周期管理](https://www.elastic.co/guide/en/elasticsearch/reference/current/index-lifecycle-management.html)(ILM) 的设置。

## Cluster level settings 集群级别设置

[edit 编辑](https://github.com/elastic/elasticsearch/edit/8.15/docs/reference/settings/ilm-settings.asciidoc)

- `xpack.ilm.enabled`

  ([Static](https://www.elastic.co/guide/en/elasticsearch/reference/current/settings.html#static-cluster-setting), Boolean) [7.8.0] Deprecated in 7.8.0. Basic License features are always enabled  7.8.0 中已弃用。基本许可证功能始终启用  （静态，布尔值）[7.8.0]  This deprecated setting has no effect and will be removed in Elasticsearch 8.0.  此已弃用的设置无效，并将在 Elasticsearch 8.0 中删除。

- `indices.lifecycle.history_index_enabled`

  ([Dynamic](https://www.elastic.co/guide/en/elasticsearch/reference/current/settings.html#dynamic-cluster-setting), Boolean) Whether ILM’s history index is enabled. If enabled, ILM will record the history of actions taken as part of ILM policies to the `ilm-history-*` indices. Defaults to `true`.  ( [Dynamic](https://www.elastic.co/guide/en/elasticsearch/reference/current/settings.html#dynamic-cluster-setting) , Boolean) 是否启用 ILM 的历史索引。如果启用，ILM 会将作为 ILM 策略一部分所采取的操作历史记录记录到`ilm-history-*`索引中。默认为`true` 。



- `indices.lifecycle.poll_interval`

  ([Dynamic](https://www.elastic.co/guide/en/elasticsearch/reference/current/settings.html#dynamic-cluster-setting), [time unit value](https://www.elastic.co/guide/en/elasticsearch/reference/current/api-conventions.html#time-units)) How often index lifecycle management checks for indices that meet policy criteria. Defaults to `10m`.  （[动态](https://www.elastic.co/guide/en/elasticsearch/reference/current/settings.html#dynamic-cluster-setting)，[时间单位值](https://www.elastic.co/guide/en/elasticsearch/reference/current/api-conventions.html#time-units)）索引生命周期管理检查满足策略标准的索引的频率。默认为`10m` 。



- `indices.lifecycle.rollover.only_if_has_documents`

  ([Dynamic](https://www.elastic.co/guide/en/elasticsearch/reference/current/settings.html#dynamic-cluster-setting), Boolean) Whether ILM will only roll over non-empty indices. If enabled, ILM will only roll over indices as long as they contain at least one document. Defaults to `true`.  ( [Dynamic](https://www.elastic.co/guide/en/elasticsearch/reference/current/settings.html#dynamic-cluster-setting) , Boolean ) ILM 是否只滚动非空索引。如果启用，ILM 将仅滚动包含至少一个文档的索引。默认为`true` 。

## Index level settings 索引级别设置

[edit 编辑](https://github.com/elastic/elasticsearch/edit/8.15/docs/reference/settings/ilm-settings.asciidoc)

These index-level ILM settings are typically configured through index templates. For more information, see [Create a lifecycle policy](https://www.elastic.co/guide/en/elasticsearch/reference/current/getting-started-index-lifecycle-management.html#ilm-gs-create-policy).
这些索引级 ILM 设置通常通过索引模板进行配置。有关详细信息，请参阅[创建生命周期策略](https://www.elastic.co/guide/en/elasticsearch/reference/current/getting-started-index-lifecycle-management.html#ilm-gs-create-policy)。

- `index.lifecycle.indexing_complete`

  ([Dynamic](https://www.elastic.co/guide/en/elasticsearch/reference/current/indices-update-settings.html), Boolean) Indicates whether or not the index has been rolled over. Automatically set to `true` when ILM completes the rollover action. You can explicitly set it to [skip rollover](https://www.elastic.co/guide/en/elasticsearch/reference/current/skipping-rollover.html). Defaults to `false`.  ( [Dynamic](https://www.elastic.co/guide/en/elasticsearch/reference/current/indices-update-settings.html) , Boolean ) 指示索引是否已滚动。当 ILM 完成翻转操作时自动设置为`true` 。您可以明确将其设置为[跳过翻转](https://www.elastic.co/guide/en/elasticsearch/reference/current/skipping-rollover.html)。默认为`false` 。



- `index.lifecycle.name`

  ([Dynamic](https://www.elastic.co/guide/en/elasticsearch/reference/current/indices-update-settings.html), string) The name of the policy to use to manage the index. For information about how Elasticsearch applies policy changes, see [Policy updates](https://www.elastic.co/guide/en/elasticsearch/reference/current/update-lifecycle-policy.html). If you are restoring an index from snapshot that was previously managed by index lifecycle management, you can override this setting to null during the restore operation to disable further management of the index. See also [Index level settings](https://www.elastic.co/guide/en/elasticsearch/reference/current/ilm-settings.html#index-lifecycle-rollover-alias).  ( [Dynamic](https://www.elastic.co/guide/en/elasticsearch/reference/current/indices-update-settings.html) , string) 用于管理索引的策略的名称。有关 Elasticsearch 如何应用策略更改的信息，请参阅[策略更新](https://www.elastic.co/guide/en/elasticsearch/reference/current/update-lifecycle-policy.html)。如果要从以前由索引生命周期管理管理的快照恢复索引，则可以在恢复操作期间将此设置覆盖为空，以禁用对索引的进一步管理。另请参见[索引级别设置](https://www.elastic.co/guide/en/elasticsearch/reference/current/ilm-settings.html#index-lifecycle-rollover-alias)。



- `index.lifecycle.origination_date`

  ([Dynamic](https://www.elastic.co/guide/en/elasticsearch/reference/current/indices-update-settings.html), long) If specified, this is the timestamp used to calculate the index age for its phase transitions. Use this setting if you create a new index that contains old data and want to use the original creation date to calculate the index age. Specified as a Unix epoch value in milliseconds.  ( [Dynamic](https://www.elastic.co/guide/en/elasticsearch/reference/current/indices-update-settings.html) , long) 如果指定，则这是用于计算其相变的索引寿命的时间戳。如果您创建包含旧数据的新索引并希望使用原始创建日期来计算索引期限，请使用此设置。指定为 Unix 纪元值（以毫秒为单位）。



- `index.lifecycle.parse_origination_date`

  ([Dynamic](https://www.elastic.co/guide/en/elasticsearch/reference/current/indices-update-settings.html), Boolean) Set to `true` to parse the origination date from the index name. This origination date is used to calculate the index age for its phase transitions. The index name must match the pattern `^.*-{date_format}-\\d+`, where the `date_format` is `yyyy.MM.dd` and the trailing digits are optional. An index that was rolled over would normally match the full format, for example `logs-2016.10.31-000002`). If the index name doesn’t match the pattern, index creation fails.  ( [Dynamic](https://www.elastic.co/guide/en/elasticsearch/reference/current/indices-update-settings.html) , Boolean) 设置为`true`以从索引名称解析起始日期。该起始日期用于计算其相变的索引年龄。索引名称必须与模式`^.*-{date_format}-\\d+`匹配，其中`date_format`为`yyyy.MM.dd` ，尾随数字是可选的。滚动的索引通常会匹配完整格式，例如`logs-2016.10.31-000002` ）。如果索引名称与模式不匹配，索引创建将失败。



- `index.lifecycle.step.wait_time_threshold`

  ([Dynamic](https://www.elastic.co/guide/en/elasticsearch/reference/current/indices-update-settings.html), [time value](https://www.elastic.co/guide/en/elasticsearch/reference/current/api-conventions.html#time-units)) Time to wait for the cluster to resolve allocation issues during an ILM [`shrink`](https://www.elastic.co/guide/en/elasticsearch/reference/current/ilm-shrink.html) action. Must be greater than `1h` (1 hour). Defaults to `12h` (12 hours). See [Shard allocation for shrink](https://www.elastic.co/guide/en/elasticsearch/reference/current/ilm-shrink.html#ilm-shrink-shard-allocation).  （[动态](https://www.elastic.co/guide/en/elasticsearch/reference/current/indices-update-settings.html)，[时间值](https://www.elastic.co/guide/en/elasticsearch/reference/current/api-conventions.html#time-units)）在 ILM [`shrink`](https://www.elastic.co/guide/en/elasticsearch/reference/current/ilm-shrink.html)操作期间等待集群解决分配问题的时间。必须大于`1h` （1 小时）。默认为`12h` （12 小时）。请参阅[收缩的分片分配](https://www.elastic.co/guide/en/elasticsearch/reference/current/ilm-shrink.html#ilm-shrink-shard-allocation)。



- `index.lifecycle.rollover_alias`

  ([Dynamic](https://www.elastic.co/guide/en/elasticsearch/reference/current/indices-update-settings.html), string) The index alias to update when the index rolls over. Specify when using a policy that contains a rollover action. When the index rolls over, the alias is updated to reflect that the index is no longer the write index. For more information about rolling indices, see [Rollover](https://www.elastic.co/guide/en/elasticsearch/reference/current/index-rollover.html). If you are restoring an index from snapshot that was previously managed by index lifecycle management, you can override this setting to null during the restore operation to disable further management of future indices. See also [Index level settings](https://www.elastic.co/guide/en/elasticsearch/reference/current/ilm-settings.html#index-lifecycle-name).  ( [Dynamic](https://www.elastic.co/guide/en/elasticsearch/reference/current/indices-update-settings.html) , string) 索引翻转时要更新的索引别名。指定何时使用包含滚动操作的策略。当索引翻转时，别名会更新以反映该索引不再是写入索引。有关滚动索引的更多信息，请参阅[Rollover](https://www.elastic.co/guide/en/elasticsearch/reference/current/index-rollover.html) 。如果您要从以前由索引生命周期管理管理的快照恢复索引，则可以在恢复操作期间将此设置覆盖为空，以禁用对未来索引的进一步管理。另请参见[索引级别设置](https://www.elastic.co/guide/en/elasticsearch/reference/current/ilm-settings.html#index-lifecycle-name)。

# Data stream lifecycle settings in Elasticsearch Elasticsearch 中的数据流生命周期设置

[edit 编辑](https://github.com/elastic/elasticsearch/edit/8.15/docs/reference/settings/data-stream-lifecycle-settings.asciidoc)

These are the settings available for configuring [data stream lifecycle](https://www.elastic.co/guide/en/elasticsearch/reference/current/data-stream-lifecycle.html).
这些是可用于配置[数据流生命周期](https://www.elastic.co/guide/en/elasticsearch/reference/current/data-stream-lifecycle.html)的设置。

## Cluster level settings 集群级别设置

[edit 编辑](https://github.com/elastic/elasticsearch/edit/8.15/docs/reference/settings/data-stream-lifecycle-settings.asciidoc)



- `data_streams.lifecycle.poll_interval`

  ([Dynamic](https://www.elastic.co/guide/en/elasticsearch/reference/current/settings.html#dynamic-cluster-setting), [time unit value](https://www.elastic.co/guide/en/elasticsearch/reference/current/api-conventions.html#time-units)) How often Elasticsearch checks what is the next action for all data streams with a built-in lifecycle. Defaults to `5m`.  （[动态](https://www.elastic.co/guide/en/elasticsearch/reference/current/settings.html#dynamic-cluster-setting)，[时间单位值](https://www.elastic.co/guide/en/elasticsearch/reference/current/api-conventions.html#time-units)）Elasticsearch 检查具有内置生命周期的所有数据流的下一步操作的频率。默认为`5m` 。



- `cluster.lifecycle.default.rollover`

  ([Dynamic](https://www.elastic.co/guide/en/elasticsearch/reference/current/settings.html#dynamic-cluster-setting), string) This property accepts a key value pair formatted string and configures the conditions that would trigger a data stream to [rollover](https://www.elastic.co/guide/en/elasticsearch/reference/current/index-rollover.html) when it has `lifecycle` configured. This property is an implementation detail and subject to change. Currently, it defaults to `max_age=auto,max_primary_shard_size=50gb,min_docs=1,max_primary_shard_docs=200000000`, this means that your data stream will rollover if any of the following conditions are met:  ( [Dynamic](https://www.elastic.co/guide/en/elasticsearch/reference/current/settings.html#dynamic-cluster-setting) , string) 此属性接受键值对格式的字符串，并配置在配置了`lifecycle`后触发数据流[滚动](https://www.elastic.co/guide/en/elasticsearch/reference/current/index-rollover.html)的条件。该属性是一个实现细节，可能会发生变化。目前，它默认为 `max_age=auto,max_primary_shard_size=50gb,min_docs=1,max_primary_shard_docs=200000000` ，这意味着如果满足以下任何条件，您的数据流将滚动：  Either any primary shard reaches the size of 50GB,  任一主分片大小达到 50GB， or any primary shard contains 200.000.000 documents  或任何主分片包含 200.000.000 个文档 or the index reaches a certain age which depends on the retention time of your data stream,  或者索引达到一定的年龄，这取决于数据流的保留时间， **and** has at least one document.  **并且**至少有一份文件。



- `data_streams.lifecycle.target.merge.policy.merge_factor`

  ([Dynamic](https://www.elastic.co/guide/en/elasticsearch/reference/current/settings.html#dynamic-cluster-setting), integer) Data stream lifecycle implements [tail merging](https://www.elastic.co/guide/en/elasticsearch/reference/current/data-stream-lifecycle.html#data-streams-lifecycle-how-it-works) by updating the lucene merge policy factor for the target backing index. The merge factor is both the number of segments that should be merged together, and the maximum number of segments that we expect to find on a given tier. This setting controls what value does [Data stream lifecycle](https://www.elastic.co/guide/en/elasticsearch/reference/current/data-stream-lifecycle.html) configures on the target index. It defaults to `16`. The value will be visible under the `index.merge.policy.merge_factor` index setting on the target index.  （[动态](https://www.elastic.co/guide/en/elasticsearch/reference/current/settings.html#dynamic-cluster-setting)，整数）数据流生命周期通过更新目标后备索引的lucene合并策略因子来实现[尾部合并](https://www.elastic.co/guide/en/elasticsearch/reference/current/data-stream-lifecycle.html#data-streams-lifecycle-how-it-works)。合并因子既是应合并在一起的段数，也是我们期望在给定层上找到的最大段数。此设置控制[数据流生命周期](https://www.elastic.co/guide/en/elasticsearch/reference/current/data-stream-lifecycle.html)在目标索引上配置的值。默认为`16` 。该值将在下面可见 `index.merge.policy.merge_factor` 目标索引上的索引设置。



- `data_streams.lifecycle.target.merge.policy.floor_segment`

  ([Dynamic](https://www.elastic.co/guide/en/elasticsearch/reference/current/settings.html#dynamic-cluster-setting)) Data stream lifecycle implements [tail merging](https://www.elastic.co/guide/en/elasticsearch/reference/current/data-stream-lifecycle.html#data-streams-lifecycle-how-it-works) by updating the lucene merge policy floor segment for the target backing index. This floor segment size is a way to prevent indices from having a long tail of very small segments. This setting controls what value does [data stream lifecycle](https://www.elastic.co/guide/en/elasticsearch/reference/current/data-stream-lifecycle.html) configures on the target index. It defaults to `100MB`.  （[动态](https://www.elastic.co/guide/en/elasticsearch/reference/current/settings.html#dynamic-cluster-setting)）数据流生命周期通过更新目标后备索引的lucene合并策略底层段来实现[尾部合并](https://www.elastic.co/guide/en/elasticsearch/reference/current/data-stream-lifecycle.html#data-streams-lifecycle-how-it-works)。此下限段大小是防止索引具有由非常小的段组成的长尾的一种方法。此设置控制[数据流生命周期](https://www.elastic.co/guide/en/elasticsearch/reference/current/data-stream-lifecycle.html)在目标索引上配置的值。默认为`100MB` 。



- `data_streams.lifecycle.signalling.error_retry_interval`

  ([Dynamic](https://www.elastic.co/guide/en/elasticsearch/reference/current/settings.html#dynamic-cluster-setting), integer) Represents the number of retries data stream lifecycle has to perform for an index in an error step in order to signal that the index is not progressing (i.e. it’s stuck in an error step). The current signalling mechanism is a log statement at the `error` level however, the signalling mechanism can be extended in the future. Defaults to 10 retries.  ( [Dynamic](https://www.elastic.co/guide/en/elasticsearch/reference/current/settings.html#dynamic-cluster-setting) , integer) 表示数据流生命周期必须在错误步骤中对索引执行的重试次数，以表明索引未进行（即卡在错误步骤中）。当前的信令机制是`error`级别的日志语句，但是将来可以扩展该信令机制。默认重试 10 次。

## Index level settings 索引级别设置

[edit 编辑](https://github.com/elastic/elasticsearch/edit/8.15/docs/reference/settings/data-stream-lifecycle-settings.asciidoc)

The following index-level settings are typically configured on the backing indices of a data stream.
以下索引级别设置通常在数据流的后备索引上配置。



- `index.lifecycle.prefer_ilm`

  ([Dynamic](https://www.elastic.co/guide/en/elasticsearch/reference/current/indices-update-settings.html), boolean) This setting determines which feature is managing the backing index of a data stream if, and only if, the backing index has an [index lifecycle management](https://www.elastic.co/guide/en/elasticsearch/reference/current/index-lifecycle-management.html) (ILM) policy and the data stream has also a built-in lifecycle. When `true` this index is managed by ILM, when `false` the backing index is managed by the data stream lifecycle. Defaults to `true`.  （ [Dynamic](https://www.elastic.co/guide/en/elasticsearch/reference/current/indices-update-settings.html) 、 boolean）当且仅当后备索引具有[索引生命周期管理](https://www.elastic.co/guide/en/elasticsearch/reference/current/index-lifecycle-management.html)(ILM) 策略并且数据流也具有内置生命周期时，此设置确定哪个功能正在管理数据流的后备索引。如果`true`则此索引由 ILM 管理；如果为`false`则后备索引由数据流生命周期管理。默认为`true` 。



- `index.lifecycle.origination_date`

  ([Dynamic](https://www.elastic.co/guide/en/elasticsearch/reference/current/indices-update-settings.html), long) If specified, this is the timestamp used to calculate the backing index generation age after this backing index has been [rolled over](https://www.elastic.co/guide/en/elasticsearch/reference/current/index-rollover.html). The generation age is used to determine data retention, consequently, you can use this setting if you create a backing index that contains older data and want to ensure that the retention period or other parts of the lifecycle will be applied based on the data’s original timestamp and not the timestamp they got indexed. Specified as a Unix epoch value in milliseconds.  （[动态](https://www.elastic.co/guide/en/elasticsearch/reference/current/indices-update-settings.html)，长整型）如果指定，则这是用于计算此后备索引[滚动](https://www.elastic.co/guide/en/elasticsearch/reference/current/index-rollover.html)后后备索引生成期限的时间戳。世代年龄用于确定数据保留，因此，如果您创建包含较旧数据的后备索引并希望确保保留期或生命周期的其他部分将基于数据的原始时间戳应用，则可以使用此设置而不是他们被索引的时间戳。指定为 Unix 纪元值（以毫秒为单位）。