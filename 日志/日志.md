# 日志
## 日志文件
| 文件 | 程序 | 出处 | 频率 | 系统 | 内容 | 备注 |
|----|----|----|----|----|----|----|
| anaconda.ifcfg.log |  |  |  |  |  |  |
| anaconda.log |  |  |  |  |  |  |
| anaconda.program.log |  |  |  |  |  |  |
| anaconda.storage.log |  |  |  |  |  |  |
| anaconda.syslog |  |  |  |  |  |  |
| anaconda.xlog |  |  |  |  |  |  |
| anaconda.yum.log |  |  |  |  |  |  |
| acpid | acpid | F | 64K | RZ | 与电源相关的事件 |  |
| audit.log |  |  |  |  |  |  |
| auth.log | sudo等 | S | M | U | 授权 |  |
| apache2/* | httpd ver.2 | F | D | ZU | Apache HTTP服务器的日志(第二版) |  |
| apt* | APT | F | M | U | Aptitude软件包安装程序 |  |
| boot.log | rc脚本 | F | M | R | 系统启动脚本的输出 |  |
| boot.msg | 内核 | H | - | Z | 内核消息缓冲的转储 |  |
| cron,cron/log | cron | S | W | RAH | cron的执行情况和出错信息 |  |
| cups/* | CUPS | F | W | ZRU | 与打印有关的消息 |  |
| daemon.log | 许多 | S | W | U | 所有守护进程功能的消息 |  |
| debug | 许多 | S | D | U | 调试输出 |  |
| dmesg | 内核 | H | - | RU | 内核消息缓冲的转储 |  |
| dpkg.log | dpkg | F | M | U | 软件包管理日志 |  |
| dracut.log |  |  |  |  |  |  |
| faillog | login | H | W | RZU | 不成功的登录企图 |  |
| httpd/* | httpd | F | D | R | Apache HTTP服务器的日志(在/etc下) |  |
| kern.log | 内核 | S | W | U | 所有kern功能的消息 |  |
| lastlog | login | H | - | RZ | 每个用户上次登录的时间(二进制) |  |
| maillog | 与mail有关的 | S | W | 所有 | 所有mail功能的消息 |  |
| messages | 许多 | S | W | RZUS | 经常是主要的系统日志文件，系统启动后的信息和错误日志 |  |
| rpmpkgs | cron.daily | H | D | R | 已安装的RPM软件包清单 |  |
| samba/* | smbd等 | F | W | - | Samba |  |
| secure | sshd等 | S | M | R | 保密的授权消息 |  |
| spooler |  |  |  |  | 与UUCP和news设备相关的日志信息 |  |
| sulog | su | F | - | SAH | su成功和失败 |  |
| syslog* | 许多 | S | W | SUH | 系统日志主文件 |  |
| tallylog |  |  |  |  |  |  |
| warn | 许多 | S | W | Z | 所有的警告/出错级的消息 |  |
| wpars/* | wpar | F | - | A | 工作负载分区事件 |  |
| wtmp | login | H | M | 所有 | 登录记录（二进制） |  |
| xen/* | Xen | F | W | RS | Xen虚拟机信息 |  |
| xferlog |  |  |  |  |  |  |
| Xorg.n.log | Xorg | F | W | RS | X窗口服务器的出错信息 |  |
| yum.log | yum | F | W | R | 软件包管理日志 |  |

出处：S=Syslog H=硬链接 F=配置文件  
频率：D=每天 W=每周 M=每月 NN[km]=基于大小，以KB或者MB为单位  
系统：U=Ubuntu Z=SUSE R=Red Hat和CentOS S=Solaris H=HP-UX A=AIX
## 体系结构
1. syslogd，日志守护进程(及其配置文件/etc/syslog.conf)  
2. openlog等，将消息提交给syslogd的库例程
3. logger，一条从shell提交日志记录项的用户级命令

syslogd在系统引导时启动并连续运行，不能用inetd来管理。程序把日志项写到/dev/log中，syslogd从其中读取消息，参考配置文件，将各条信息发送到合适的目的地。
## 配置syslogd
/etc/syslog.conf基本格式为：

    selector<Tab>action
selector的格式为：

    facility.level
### syslog的设备名
| 设备(facility) | 使用该设备的程序 |
|--------------|----------|
| * | 除了"mark"之外的所有设备 |
| auth | 与安全和授权有关的命令 |
| authpriv | 敏感/保密的授权信息 |
| cron | 守护进程cron |
| daemon | 系统守护进程 |
| ftp | FTP守护进程，ftpd |
| kern | 内核 |
| local0-7 | 本地消息的8种类型 |
| lpr | 行式打印机的假脱机系统 |
| mail | sendmail及其他与电子邮件有关的软件 |
| mark | 定期产生的时间戳 |
| news | Usenet新闻系统(已淘汰) |
| syslog | syslogd内部消息 |
| user | 用户进程(如果没有指定，这将是默认值) |
| uucp | 已淘汰，可忽略 |
### syslog的严重性级别
| 级别 | 大致含义 | 级别 | 大致含义 |
|--|--|--|--|
| emerg | 恐慌状态 | warning | 警告消息 |
| alert | 紧急状态 | notice | 需要调查的事项 |
| crit | 临界状态 | info | 提供信息的消息 |
| err | 其他错误情况 | debug | 仅供调试 |
### Linux在syslog.conf中限定优先级的例子
| 选择符 | 含义 |
|--|--|
| mail.info | 选择与邮件相关的、优先级为info或者更高的消息 |
| mail.=info | 只选择优先级为info的消息 |
| mail.info;mail.!err | 只选择优先级为info、notice和warning的消息 |
| mail.debug;mail.!=warning | 选择除warning之外的所有优先级 |
### syslog动作
| 动作 | 含义 | 备注 |
|--|--|--|
| filename | 把消息写入本地机器上的一个文件里 |  |
| @hostname | 把消息转发给主机hostname上的syslogd |  |
| @ipaddress | 把消息转发给IP地址为ipaddress的主机 |  |
| \|fifoname | 把消息写入有名管道fifoname | 参考info mkfifo，仅限linux版本的syslogd |
| user1,user2,... | 如果用户登录到了系统上，那么就把消息卸载用户的屏幕上 |  |
| * | 把消息写给目前已经登录的所有用户 |  |
## logrotate
配置文件：
/etc/logrotate.conf
### logrotate选项
| 选项 | 含义 |
|----|----|
| compress | 压缩日志文件的所有非当前版本 |
| daily,weekly,monthly | 以指定的时间安排来轮换日志文件 |
| delaycompress | 压缩除了当前和最近之外的所有其他版本 |
| endscript | 标记prerotate或者postrotate脚本结束 |
| errors *emailaddr* | 向指定的emailaddr发送出错通知邮件 |
| missingok | 如果日志不存在，不会发出抱怨 |
| notifempty | 如果日志为空，则不轮换它 |
| olddir *dir* | 指定要放入dir里的日志文件老版本 |
| postrotate | 引入在轮换过日志之后要运行的脚本 |
| prerotate | 引入在进行任何改动之前运行的脚本 |
| rotate *n* | 在轮换方案中包括n个版本的日志 |
| sharedscripts | 只为整个日志组运行一次的脚本 |
| size=logsize | 如果日志文件大于logsize才轮换 |
## 分析日志文件
swatch
logcheck
splunk