# Troubleshooting 故障 排除

#### On this page 本页内容

​                                                [Checking logs 检查日志](https://microk8s.io/docs/troubleshooting#checking-logs)                                                      [Examining the configuration
检查配置](https://microk8s.io/docs/troubleshooting#examining-the-configuration)                                                              

It is important to recognise that things *can* go wrong. But MicroK8s gives you tools to help work out *what* has gone wrong, as detailed below. Be sure to check out the [common issues](https://microk8s.io/docs/troubleshooting#heading--common-issues) section for help resolving the most frequently encountered problems.
重要的是要认识到事情*可能会*出错。但 MicroK8s 为您提供了一些工具来帮助您找出问题*所在*，如下所述。请务必查看[常见问题](https://microk8s.io/docs/troubleshooting#heading--common-issues)部分，以帮助解决最常见的问题。

### [Checking logs 检查日志](https://microk8s.io/docs/troubleshooting#checking-logs)

If a pod is not behaving as expected, the first port of call should be the logs.
如果 Pod 未按预期运行，则第一个调用端口应为日志。

Assuming you run a simple workload in a namespace called `redis`, first determine the resource identifier for the pod:
假设您在名为 `redis` 的命名空间中运行一个简单的工作负载，请首先确定 pod 的资源标识符：

```bash
microk8s kubectl get pods -n redis
```

This will list the currently available pods, for example:
这将列出当前可用的 Pod，例如：

```no-highlight
NAME    READY   STATUS         RESTARTS   AGE
redis   0/1     ErrImagePull   0          84m
```

You can then use `kubectl` to view the log. For example, for the simple redis pod above:
然后，您可以使用 `kubectl` 查看日志。例如，对于上面的简单 redis pod：

```bash
microk8s kubectl logs redis -n redis
Error from server (BadRequest): container "redis" in pod "redis" is waiting to start: image can't be pulled
```

If this information is not sufficient, you can look into the events to find out more:
如果此信息还不够，您可以查看事件以了解更多信息：

```auto
microk8s kubectl get events -n redis
LAST SEEN   TYPE      REASON      OBJECT      MESSAGE
5m9s        Warning   Failed      pod/redis   Failed to pull image "redis:XXlatest": failed to pull and unpack image "docker.io/library/redis:XXlatest": failed to resolve reference "docker.io/library/redis:XXlatest": unexpected status from HEAD request to https://www.docker.com/: 403 Forbidden
5m9s        Warning   Failed      pod/redis   Error: ErrImagePull
3m59s       Warning   BackOff     pod/redis   Back-off restarting failed container redis in pod redis_redis(b4ec0dac-609d-48c2-955a-1d6abc1c42b0)
```

In this specific case there is no such image in the image registry, thus the pod specification needs to be adjusted.
在这种特定情况下，镜像仓库中没有这样的镜像，因此需要调整 Pod 规范。

### [Examining the configuration 检查配置](https://microk8s.io/docs/troubleshooting#examining-the-configuration)

If the problem you are experiencing indicates a problem with the  configuration of the Kubernetes components themselves, it could be  helpful to examine the arguments used to run these components.
如果您遇到的问题表明 Kubernetes 组件本身的配置存在问题，那么检查用于运行这些组件的参数可能会有所帮助。

These are available in the directory `${SNAP_DATA}/args`, which on Ubuntu should point to `/var/snap/microk8s/current`.
这些位于目录 `${SNAP_DATA}/args` 中，在 Ubuntu 上应指向 `/var/snap/microk8s/current`。
 Note that the `$SNAP_DATA` environment variable itself is only available to the running snap. For more information on the snap environment, check the [snap documentation](https://snapcraft.io/docs/environment-variables).
请注意，`$SNAP_DATA` 环境变量本身仅可用于正在运行的快照。有关 snap 环境的更多信息，请查看 [snap 文档](https://snapcraft.io/docs/environment-variables)。

### Using the built-in inspection tool 使用内置检查工具

MicroK8s ships with a script to compile a complete report on MicroK8s and the  system which it is running on. This is essential for bug reports, but is also a useful way of confirming the system is (or isn’t) working and  collecting all the relevant data in one place.
MicroK8s 附带一个脚本，用于编译有关 MicroK8s 及其运行系统的完整报告。这对于 bug 报告至关重要，但也是确认系统正在（或未）工作并在一个地方收集所有相关数据的有用方法。

To run the inspection tool, enter the command (admin privilege is required to collect all the data):
要运行检查工具，请输入命令（需要管理员权限才能收集所有数据）：

```bash
sudo microk8s inspect
```

You should see output similar to the following:
您应该会看到类似于以下内容的输出：

```bash
Inspecting services
  Service snap.microk8s.daemon-cluster-agent is running
  Service snap.microk8s.daemon-flanneld is running
  Service snap.microk8s.daemon-containerd is running
  Service snap.microk8s.daemon-apiserver is running
  Service snap.microk8s.daemon-apiserver-kicker is running
  Service snap.microk8s.daemon-proxy is running
  Service snap.microk8s.daemon-kubelet is running
  Service snap.microk8s.daemon-scheduler is running
  Service snap.microk8s.daemon-controller-manager is running
  Service snap.microk8s.daemon-etcd is running
  Copy service arguments to the final report tarball
Inspecting AppArmor configuration
Gathering system information
  Copy processes list to the final report tarball
  Copy snap list to the final report tarball
  Copy VM name (or none) to the final report tarball
  Copy disk usage information to the final report tarball
  Copy memory usage information to the final report tarball
  Copy server uptime to the final report tarball
  Copy current linux distribution to the final report tarball
  Copy openSSL information to the final report tarball
  Copy network configuration to the final report tarball
Inspecting kubernetes cluster
  Inspect kubernetes cluster

Building the report tarball
  Report tarball is at /var/snap/microk8s/1031/inspection-report-20191104_153950.tar.gz
```

This confirms the services that are running, and the resultant report file  can be viewed to get a detailed look at every aspect of the system.
这确认了正在运行的服务，并且可以查看生成的报告文件以详细了解系统的各个方面。

### Common issues 常见问题

<details open="" data-immersive-translate-walked="7a038aed-f864-4cc1-8d5d-0758a9bf2781">
<summary data-immersive-translate-walked="7a038aed-f864-4cc1-8d5d-0758a9bf2781"><strong data-immersive-translate-walked="7a038aed-f864-4cc1-8d5d-0758a9bf2781" data-immersive-translate-paragraph="1">Node is not ready when RBAC is enabled...<font class="notranslate immersive-translate-target-wrapper" data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br><font class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper" data-immersive-translate-translation-element-mark="1"><font class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner" data-immersive-translate-translation-element-mark="1">启用 RBAC 后，Node 未准备就绪...</font></font></font></strong></summary>
<p data-immersive-translate-walked="7a038aed-f864-4cc1-8d5d-0758a9bf2781" data-immersive-translate-paragraph="1">Ensure
 the hostname of your machine name does not contain capital letters or 
underscores. Kubernetes normalizes the machine name causing its 
registration to fail.
<font class="notranslate immersive-translate-target-wrapper" data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br><font class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper" data-immersive-translate-translation-element-mark="1"><font class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner" data-immersive-translate-translation-element-mark="1">确保计算机名称的主机名不包含大写字母或下划线。Kubernetes 会规范化机器名称，从而导致其注册失败。</font></font></font></p><p data-immersive-translate-walked="7a038aed-f864-4cc1-8d5d-0758a9bf2781" data-immersive-translate-paragraph="1">To fix this you can <a href="https://askubuntu.com/questions/87665/how-do-i-change-the-hostname-without-a-restart" data-immersive-translate-walked="7a038aed-f864-4cc1-8d5d-0758a9bf2781">change the hostname</a> or use the <code data-immersive-translate-walked="7a038aed-f864-4cc1-8d5d-0758a9bf2781">--hostname-override</code> argument in kubelet’s configuration in <code data-immersive-translate-walked="7a038aed-f864-4cc1-8d5d-0758a9bf2781">/var/snap/microk8s/current/args/kubelet</code>.<font class="notranslate immersive-translate-target-wrapper" data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br><font class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper" data-immersive-translate-translation-element-mark="1"><font class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner" data-immersive-translate-translation-element-mark="1">要解决此问题<a data-immersive-translate-walked="7a038aed-f864-4cc1-8d5d-0758a9bf2781" href="https://askubuntu.com/questions/87665/how-do-i-change-the-hostname-without-a-restart">，你可以更改主机名</a>，或者在 kubelet 的配置中使用 <code data-immersive-translate-walked="7a038aed-f864-4cc1-8d5d-0758a9bf2781">--hostname-override</code> 参数 <code data-immersive-translate-walked="7a038aed-f864-4cc1-8d5d-0758a9bf2781">/var/snap/microk8s/current/args/kubelet</code> 。</font></font></font></p>
</details>

<details open="" data-immersive-translate-walked="7a038aed-f864-4cc1-8d5d-0758a9bf2781">
<summary data-immersive-translate-walked="7a038aed-f864-4cc1-8d5d-0758a9bf2781"><strong data-immersive-translate-walked="7a038aed-f864-4cc1-8d5d-0758a9bf2781" data-immersive-translate-paragraph="1">My dns and dashboard pods are CrashLooping...<font class="notranslate immersive-translate-target-wrapper" data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br><font class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper" data-immersive-translate-translation-element-mark="1"><font class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner" data-immersive-translate-translation-element-mark="1">我的 dns 和仪表板 pod 是 CrashLooping...</font></font></font></strong></summary>
<p data-immersive-translate-walked="7a038aed-f864-4cc1-8d5d-0758a9bf2781" data-immersive-translate-paragraph="1">The cni network plugin used by MicroK8s creates a <code data-immersive-translate-walked="7a038aed-f864-4cc1-8d5d-0758a9bf2781">vxlan.calico</code>
    interface (<code data-immersive-translate-walked="7a038aed-f864-4cc1-8d5d-0758a9bf2781">cbr0</code> on pre v1.16 releases or <code data-immersive-translate-walked="7a038aed-f864-4cc1-8d5d-0758a9bf2781">cni0</code> in 
    pre v1.19 releases and non-HA deployments) when the first pod is
    created.<font class="notranslate immersive-translate-target-wrapper" data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br><font class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper" data-immersive-translate-translation-element-mark="1"><font class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner" data-immersive-translate-translation-element-mark="1">MicroK8s 使用的 cni 网络插件会创建一个 <code data-immersive-translate-walked="7a038aed-f864-4cc1-8d5d-0758a9bf2781">vxlan.calico</code>
接口（v1.16 之前版本中的 <code data-immersive-translate-walked="7a038aed-f864-4cc1-8d5d-0758a9bf2781">cbr0</code> 或 v1.19 之前版本和非 HA 部署中的 <code data-immersive-translate-walked="7a038aed-f864-4cc1-8d5d-0758a9bf2781">cni0</code>）。</font></font></font></p>
<p data-immersive-translate-walked="7a038aed-f864-4cc1-8d5d-0758a9bf2781" data-immersive-translate-paragraph="1">If you have <code data-immersive-translate-walked="7a038aed-f864-4cc1-8d5d-0758a9bf2781">ufw</code> enabled, you'll need to allow traffic on
    this interface:<font class="notranslate immersive-translate-target-wrapper" data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br><font class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper" data-immersive-translate-translation-element-mark="1"><font class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner" data-immersive-translate-translation-element-mark="1">如果您启用了 <code data-immersive-translate-walked="7a038aed-f864-4cc1-8d5d-0758a9bf2781">ufw</code>，则需要允许此接口上的流量：</font></font></font></p>
<pre><code>sudo ufw allow in on vxlan.calico &amp;&amp; sudo ufw allow out on vxlan.calico
sudo ufw allow in on cali+ &amp;&amp; sudo ufw allow out on cali+</code></pre>
</details>

<details open="" data-immersive-translate-walked="7a038aed-f864-4cc1-8d5d-0758a9bf2781">
<summary data-immersive-translate-walked="7a038aed-f864-4cc1-8d5d-0758a9bf2781"><strong data-immersive-translate-walked="7a038aed-f864-4cc1-8d5d-0758a9bf2781" data-immersive-translate-paragraph="1">My pods can't reach the internet or each other (but my MicroK8s host machine can)...<font class="notranslate immersive-translate-target-wrapper" data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br><font class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper" data-immersive-translate-translation-element-mark="1"><font class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner" data-immersive-translate-translation-element-mark="1">我的 Pod 无法访问互联网或彼此无法访问（但我的 MicroK8s 主机可以）......</font></font></font></strong></summary>
<p data-immersive-translate-walked="7a038aed-f864-4cc1-8d5d-0758a9bf2781" data-immersive-translate-paragraph="1">Make sure packets to/from the pod network interface can be forwarded
      to/from the default interface on the host via the <code data-immersive-translate-walked="7a038aed-f864-4cc1-8d5d-0758a9bf2781">iptables</code> tool.
      Such changes can be made persistent by installing the <code data-immersive-translate-walked="7a038aed-f864-4cc1-8d5d-0758a9bf2781">iptables-persistent</code> package:<font class="notranslate immersive-translate-target-wrapper" data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br><font class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper" data-immersive-translate-translation-element-mark="1"><font class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner" data-immersive-translate-translation-element-mark="1">确保进出 Pod 网络接口的数据包可以通过 <code data-immersive-translate-walked="7a038aed-f864-4cc1-8d5d-0758a9bf2781">iptables</code> 工具转发到主机上的默认接口或从主机的默认接口转发。通过安装 <code data-immersive-translate-walked="7a038aed-f864-4cc1-8d5d-0758a9bf2781">iptables-persistent</code> 软件包，可以使此类更改持久化：</font></font></font></p>
<div data-immersive-translate-walked="7a038aed-f864-4cc1-8d5d-0758a9bf2781"><div data-immersive-translate-walked="7a038aed-f864-4cc1-8d5d-0758a9bf2781"><pre><code>   sudo iptables -P FORWARD ACCEPT
   sudo apt-get install iptables-persistent
   </code></pre></div></div>
<p data-immersive-translate-walked="7a038aed-f864-4cc1-8d5d-0758a9bf2781" data-immersive-translate-paragraph="1">or, if using <code data-immersive-translate-walked="7a038aed-f864-4cc1-8d5d-0758a9bf2781">ufw</code>:<font class="notranslate immersive-translate-target-wrapper" data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br><font class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper" data-immersive-translate-translation-element-mark="1"><font class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner" data-immersive-translate-translation-element-mark="1">或者，如果使用 <code data-immersive-translate-walked="7a038aed-f864-4cc1-8d5d-0758a9bf2781">UFW</code>：</font></font></font></p>
<div data-immersive-translate-walked="7a038aed-f864-4cc1-8d5d-0758a9bf2781"><div data-immersive-translate-walked="7a038aed-f864-4cc1-8d5d-0758a9bf2781"><pre><code>   sudo ufw default allow routed
   </code></pre></div></div>
<p data-immersive-translate-walked="7a038aed-f864-4cc1-8d5d-0758a9bf2781" data-immersive-translate-paragraph="1">The MicroK8s inspect command can be used to check the firewall configuration:<font class="notranslate immersive-translate-target-wrapper" data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br><font class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper" data-immersive-translate-translation-element-mark="1"><font class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner" data-immersive-translate-translation-element-mark="1">MicroK8s inspect 命令可用于检查防火墙配置：</font></font></font></p>
<div data-immersive-translate-walked="7a038aed-f864-4cc1-8d5d-0758a9bf2781"><div data-immersive-translate-walked="7a038aed-f864-4cc1-8d5d-0758a9bf2781"><pre><code>   microk8s inspect
   </code></pre></div></div>
<p data-immersive-translate-walked="7a038aed-f864-4cc1-8d5d-0758a9bf2781" data-immersive-translate-paragraph="1">A warning will be shown if the firewall is not forwarding traffic.<font class="notranslate immersive-translate-target-wrapper" data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br><font class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper" data-immersive-translate-translation-element-mark="1"><font class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner" data-immersive-translate-translation-element-mark="1">如果防火墙未转发流量，则会显示警告。</font></font></font></p>
</details>

<details open="" data-immersive-translate-walked="7a038aed-f864-4cc1-8d5d-0758a9bf2781">
<summary data-immersive-translate-walked="7a038aed-f864-4cc1-8d5d-0758a9bf2781"><strong data-immersive-translate-walked="7a038aed-f864-4cc1-8d5d-0758a9bf2781" data-immersive-translate-paragraph="1">My log collector is not collecting any logs...<font class="notranslate immersive-translate-target-wrapper" data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br><font class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper" data-immersive-translate-translation-element-mark="1"><font class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner" data-immersive-translate-translation-element-mark="1">我的日志收集器没有收集任何日志...</font></font></font></strong></summary>
<p data-immersive-translate-walked="7a038aed-f864-4cc1-8d5d-0758a9bf2781" data-immersive-translate-paragraph="1">By default container logs are located in <code data-immersive-translate-walked="7a038aed-f864-4cc1-8d5d-0758a9bf2781">/var/log/pods/{id}</code>. You have to mount this location in your log collector for that to work. Following is an example diff for <a href="https://raw.githubusercontent.com/fluent/fluent-bit-kubernetes-logging/master/output/elasticsearch/fluent-bit-ds.yaml" data-immersive-translate-walked="7a038aed-f864-4cc1-8d5d-0758a9bf2781">fluent-bit</a>:<font class="notranslate immersive-translate-target-wrapper" data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br><font class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper" data-immersive-translate-translation-element-mark="1"><font class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner" data-immersive-translate-translation-element-mark="1">默认情况下，容器日志位于 <code data-immersive-translate-walked="7a038aed-f864-4cc1-8d5d-0758a9bf2781">/var/log/pods/{id}</code> 中。您必须在日志收集器中挂载此位置才能正常工作。以下是 <a data-immersive-translate-walked="7a038aed-f864-4cc1-8d5d-0758a9bf2781" href="https://raw.githubusercontent.com/fluent/fluent-bit-kubernetes-logging/master/output/elasticsearch/fluent-bit-ds.yaml">fluent-bit</a> 的示例 diff：</font></font></font></p>
<div data-immersive-translate-walked="7a038aed-f864-4cc1-8d5d-0758a9bf2781"><div data-immersive-translate-walked="7a038aed-f864-4cc1-8d5d-0758a9bf2781"><pre><code><span>@@ -36,6 +36,9 @@
   </span>         - name: varlibdockercontainers
              mountPath: /var/lib/docker/containers
              readOnly: true
   <span>+        - name: varlibdockercontainers
   +          mountPath: /var/snap/microk8s/common/var/lib/containerd/
   +          readOnly: true
   </span>         - name: fluent-bit-config
              mountPath: /fluent-bit/etc/
          terminationGracePeriodSeconds: 10
   <span>@@ -45,7 +48,7 @@
   </span>           path: /var/log
          - name: varlibdockercontainers
            hostPath:
   <span>-          path: /var/lib/docker/containers
   </span><span>+          mountPath: /var/snap/microk8s/common/var/lib/containerd/
   </span>       - name: fluent-bit-config
            configMap:
              name: fluent-bit-config
   </code></pre></div></div>
</details>

<details open="" data-immersive-translate-walked="7a038aed-f864-4cc1-8d5d-0758a9bf2781">
<summary data-immersive-translate-walked="7a038aed-f864-4cc1-8d5d-0758a9bf2781"><strong data-immersive-translate-walked="7a038aed-f864-4cc1-8d5d-0758a9bf2781" data-immersive-translate-paragraph="1">My pods are not starting and I use ZFS...<font class="notranslate immersive-translate-target-wrapper" data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br><font class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper" data-immersive-translate-translation-element-mark="1"><font class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner" data-immersive-translate-translation-element-mark="1">我的 Pod 没有启动，我使用 ZFS...</font></font></font></strong></summary>
<p data-immersive-translate-walked="7a038aed-f864-4cc1-8d5d-0758a9bf2781" data-immersive-translate-paragraph="1">Microk8s switched to <code data-immersive-translate-walked="7a038aed-f864-4cc1-8d5d-0758a9bf2781">containerd</code> as its container runtime in release 492. When run on ZFS, <code data-immersive-translate-walked="7a038aed-f864-4cc1-8d5d-0758a9bf2781">containerd</code> must be configured to use ZFS snapshots. Presently neither Microk8s nor <code data-immersive-translate-walked="7a038aed-f864-4cc1-8d5d-0758a9bf2781">containerd</code> perform this automatically so you must manually update the configuration. Instructions on how to do this are documented <a href="https://github.com/ubuntu/microk8s/issues/401#issuecomment-480945986" data-immersive-translate-walked="7a038aed-f864-4cc1-8d5d-0758a9bf2781">here</a>.<font class="notranslate immersive-translate-target-wrapper" data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br><font class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper" data-immersive-translate-translation-element-mark="1"><font class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner" data-immersive-translate-translation-element-mark="1">Microk8s 在版本 492 中切换到 <code data-immersive-translate-walked="7a038aed-f864-4cc1-8d5d-0758a9bf2781">containerd</code> 作为其容器运行时。在 ZFS 上运行时，必须将 <code data-immersive-translate-walked="7a038aed-f864-4cc1-8d5d-0758a9bf2781">containerd</code> 配置为使用 ZFS 快照。目前，Microk8s 和 <code data-immersive-translate-walked="7a038aed-f864-4cc1-8d5d-0758a9bf2781">containerd</code> 都不会自动执行此作，因此您必须手动更新配置。有关如何执行此作的说明记录<a data-immersive-translate-walked="7a038aed-f864-4cc1-8d5d-0758a9bf2781" href="https://github.com/ubuntu/microk8s/issues/401#issuecomment-480945986">在此处</a>。</font></font></font></p>
</details>

<details open="" data-immersive-translate-walked="7a038aed-f864-4cc1-8d5d-0758a9bf2781">
<summary data-immersive-translate-walked="7a038aed-f864-4cc1-8d5d-0758a9bf2781"><strong data-immersive-translate-walked="7a038aed-f864-4cc1-8d5d-0758a9bf2781" data-immersive-translate-paragraph="1">My home directory is not in <code data-immersive-translate-walked="7a038aed-f864-4cc1-8d5d-0758a9bf2781">/home</code> or is on NFS and I can't get Microk8s to work...<font class="notranslate immersive-translate-target-wrapper" data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br><font class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper" data-immersive-translate-translation-element-mark="1"><font class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner" data-immersive-translate-translation-element-mark="1">我的主目录不在 <code data-immersive-translate-walked="7a038aed-f864-4cc1-8d5d-0758a9bf2781">/home</code> 中或在 NFS 上，我无法让 Microk8s 工作...</font></font></font></strong></summary>
<p data-immersive-translate-walked="7a038aed-f864-4cc1-8d5d-0758a9bf2781" data-immersive-translate-paragraph="1">While
 not strictly a Microk8s issue, snaps generally do not work out of the 
box if your home directory is mounted via NFS, or if it is not located 
directly under <code data-immersive-translate-walked="7a038aed-f864-4cc1-8d5d-0758a9bf2781">/home</code>. See <code data-immersive-translate-walked="7a038aed-f864-4cc1-8d5d-0758a9bf2781">snapd</code> bugs <a href="https://bugs.launchpad.net/ubuntu/+source/snapd/+bug/1662552" data-immersive-translate-walked="7a038aed-f864-4cc1-8d5d-0758a9bf2781">#1662552</a> and <a href="https://bugs.launchpad.net/snappy/+bug/1620771" data-immersive-translate-walked="7a038aed-f864-4cc1-8d5d-0758a9bf2781">#1620771</a> for further information and possible workarounds.<font class="notranslate immersive-translate-target-wrapper" data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br><font class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper" data-immersive-translate-translation-element-mark="1"><font class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner" data-immersive-translate-translation-element-mark="1">虽然严格来说不是 Microk8s 的问题，但如果您的主目录是通过 NFS 挂载的，或者它不直接位于 <code data-immersive-translate-walked="7a038aed-f864-4cc1-8d5d-0758a9bf2781">/home</code> 下，则快照通常不会开箱即用。请参阅 <code data-immersive-translate-walked="7a038aed-f864-4cc1-8d5d-0758a9bf2781">snapd</code> 错误 <a data-immersive-translate-walked="7a038aed-f864-4cc1-8d5d-0758a9bf2781" href="https://bugs.launchpad.net/ubuntu/+source/snapd/+bug/1662552">#1662552</a> 和 <a data-immersive-translate-walked="7a038aed-f864-4cc1-8d5d-0758a9bf2781" href="https://bugs.launchpad.net/snappy/+bug/1620771">#1620771</a> 以获取更多信息和可能的解决方法。</font></font></font></p>
</details>

<details open="" data-immersive-translate-walked="7a038aed-f864-4cc1-8d5d-0758a9bf2781">
<summary data-immersive-translate-walked="7a038aed-f864-4cc1-8d5d-0758a9bf2781"><strong data-immersive-translate-walked="7a038aed-f864-4cc1-8d5d-0758a9bf2781" data-immersive-translate-paragraph="1">I need to recover my HA cluster <font class="notranslate immersive-translate-target-wrapper" data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br><font class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper" data-immersive-translate-translation-element-mark="1"><font class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner" data-immersive-translate-translation-element-mark="1">我需要恢复我的 HA 集群</font></font></font></strong></summary>
<p data-immersive-translate-walked="7a038aed-f864-4cc1-8d5d-0758a9bf2781" data-immersive-translate-paragraph="1">In
 normal use, a MicroK8s HA cluster is self healing. There may be 
occasions when testing edge versions or mixing releases that the cluster
 may need to be recovered. This <a href="https://discuss.kubernetes.io/t/recovery-of-ha-microk8s-clusters/12931" data-immersive-translate-walked="7a038aed-f864-4cc1-8d5d-0758a9bf2781"> docs page</a> details the procedure.<font class="notranslate immersive-translate-target-wrapper" data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br><font class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper" data-immersive-translate-translation-element-mark="1"><font class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner" data-immersive-translate-translation-element-mark="1">在正常使用中，MicroK8s HA 集群是自我修复的。有时，在测试 Edge 版本或混合版本时，可能需要恢复集群。此<a data-immersive-translate-walked="7a038aed-f864-4cc1-8d5d-0758a9bf2781" href="https://discuss.kubernetes.io/t/recovery-of-ha-microk8s-clusters/12931">文档页面</a>详细介绍了该过程。</font></font></font></p>
</details>

<details open="" data-immersive-translate-walked="7a038aed-f864-4cc1-8d5d-0758a9bf2781">
<summary data-immersive-translate-walked="7a038aed-f864-4cc1-8d5d-0758a9bf2781"><strong data-immersive-translate-walked="7a038aed-f864-4cc1-8d5d-0758a9bf2781" data-immersive-translate-paragraph="1">Raspberry Pi and systems with low disk performance<font class="notranslate immersive-translate-target-wrapper" data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br><font class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper" data-immersive-translate-translation-element-mark="1"><font class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner" data-immersive-translate-translation-element-mark="1">Raspberry Pi 和磁盘性能低的系统</font></font></font></strong></summary>
<p data-immersive-translate-walked="7a038aed-f864-4cc1-8d5d-0758a9bf2781" data-immersive-translate-paragraph="1">The
 symptoms you may observe vary. You may experience the API server being 
slow, crashing or forming an unstable multi node cluster. Such problems 
are often traced to low performing or miss-configured disks. In the logs
 of the API server you will notice the data store being slow to write on
 disk.
With <code data-immersive-translate-walked="7a038aed-f864-4cc1-8d5d-0758a9bf2781">journalctl -f -u snap.microk8s.daemon-kubelite</code> or (for prior to v1.21) <code data-immersive-translate-walked="7a038aed-f864-4cc1-8d5d-0758a9bf2781">journalctl -f -u snap.microk8s.daemon-apiserver</code> you will see messages such as <code data-immersive-translate-walked="7a038aed-f864-4cc1-8d5d-0758a9bf2781">microk8s.daemon-kubelite[3802920]: Trace[736557743]: ---"Object stored in database" 7755ms </code>.
<font class="notranslate immersive-translate-target-wrapper" data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br><font class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper" data-immersive-translate-translation-element-mark="1"><font class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner" data-immersive-translate-translation-element-mark="1">您可能会观察到的症状各不相同。您可能会遇到 API 服务器运行缓慢、崩溃或形成不稳定的多节点集群的情况。此类问题通常可追溯到性能低下或配置错误的磁盘。在 API 服务器的日志中，您会注意到数据存储在磁盘上写入的速度很慢。使用 <code data-immersive-translate-walked="7a038aed-f864-4cc1-8d5d-0758a9bf2781">journalctl -f -u snap.microk8s.daemon-kubelite</code> 或 （对于 v1.21 之前的版本）， <code data-immersive-translate-walked="7a038aed-f864-4cc1-8d5d-0758a9bf2781">journalctl -f -u snap.microk8s.daemon-apiserver</code> 您将看到诸如 <code data-immersive-translate-walked="7a038aed-f864-4cc1-8d5d-0758a9bf2781">microk8s.daemon-kubelite[3802920]: Trace[736557743]: ---"Object stored in database" 7755ms </code> .</font></font></font></p><p data-immersive-translate-walked="7a038aed-f864-4cc1-8d5d-0758a9bf2781" data-immersive-translate-paragraph="1">To identify if the a slow disk is affecting you, you could use <code data-immersive-translate-walked="7a038aed-f864-4cc1-8d5d-0758a9bf2781"> hdparm </code> and try to write a large file with <code data-immersive-translate-walked="7a038aed-f864-4cc1-8d5d-0758a9bf2781">dd</code>, for example, <code data-immersive-translate-walked="7a038aed-f864-4cc1-8d5d-0758a9bf2781"> hdparm -Tt /dev/sda </code> and <code data-immersive-translate-walked="7a038aed-f864-4cc1-8d5d-0758a9bf2781">  dd if=/dev/zero of=/tmp/test1.img bs=1G count=1 </code><font class="notranslate immersive-translate-target-wrapper" data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br><font class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper" data-immersive-translate-translation-element-mark="1"><font class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner" data-immersive-translate-translation-element-mark="1">要确定慢速磁盘是否影响您，您可以使用 <code data-immersive-translate-walked="7a038aed-f864-4cc1-8d5d-0758a9bf2781"> hdparm </code> 并尝试使用 <code data-immersive-translate-walked="7a038aed-f864-4cc1-8d5d-0758a9bf2781">dd</code> 编写一个大文件，例如， <code data-immersive-translate-walked="7a038aed-f864-4cc1-8d5d-0758a9bf2781"> hdparm -Tt /dev/sda </code> 和 <code data-immersive-translate-walked="7a038aed-f864-4cc1-8d5d-0758a9bf2781">  dd if=/dev/zero of=/tmp/test1.img bs=1G count=1 </code> </font></font></font></p>
<p data-immersive-translate-walked="7a038aed-f864-4cc1-8d5d-0758a9bf2781" data-immersive-translate-paragraph="1">In systems such as the Raspberry Pi the issue may caused by <a href="https://www.raspberrypi.org/forums/viewtopic.php?f=28&amp;t=245931" data-immersive-translate-walked="7a038aed-f864-4cc1-8d5d-0758a9bf2781">devices not fully implementing the UAS specification</a>.<font class="notranslate immersive-translate-target-wrapper" data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br><font class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper" data-immersive-translate-translation-element-mark="1"><font class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner" data-immersive-translate-translation-element-mark="1">在 Raspberry Pi 等系统中，该问题可能是由于<a data-immersive-translate-walked="7a038aed-f864-4cc1-8d5d-0758a9bf2781" href="https://www.raspberrypi.org/forums/viewtopic.php?f=28&amp;t=245931">设备未完全实现 UAS 规范</a>引起的。</font></font></font></p>
<p data-immersive-translate-walked="7a038aed-f864-4cc1-8d5d-0758a9bf2781" data-immersive-translate-paragraph="1">In some cases, a way to mitigate the issue is to move the <a href="https://www.freedesktop.org/software/systemd/man/journald.conf.html" data-immersive-translate-walked="7a038aed-f864-4cc1-8d5d-0758a9bf2781">journald logs on volatile storage</a>. This is done by editing <code data-immersive-translate-walked="7a038aed-f864-4cc1-8d5d-0758a9bf2781">/etc/systemd/journald.conf</code> setting <code data-immersive-translate-walked="7a038aed-f864-4cc1-8d5d-0758a9bf2781">Storage=volatile</code>.<font class="notranslate immersive-translate-target-wrapper" data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br><font class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper" data-immersive-translate-translation-element-mark="1"><font class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner" data-immersive-translate-translation-element-mark="1">在某些情况下，缓解此问题的一种方法是将<a data-immersive-translate-walked="7a038aed-f864-4cc1-8d5d-0758a9bf2781" href="https://www.freedesktop.org/software/systemd/man/journald.conf.html">日志移动到易失性存储上</a>。这可以通过编辑 <code data-immersive-translate-walked="7a038aed-f864-4cc1-8d5d-0758a9bf2781">/etc/systemd/journald.conf</code> 设置 <code data-immersive-translate-walked="7a038aed-f864-4cc1-8d5d-0758a9bf2781">Storage=volatile</code> 来完成。</font></font></font></p>
<p data-immersive-translate-walked="7a038aed-f864-4cc1-8d5d-0758a9bf2781" data-immersive-translate-paragraph="1">Of course, you can always consider upgrading the attached storage.<font class="notranslate immersive-translate-target-wrapper" data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br><font class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper" data-immersive-translate-translation-element-mark="1"><font class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner" data-immersive-translate-translation-element-mark="1">当然，您始终可以考虑升级附加的存储。</font></font></font></p>
<p data-immersive-translate-walked="7a038aed-f864-4cc1-8d5d-0758a9bf2781" data-immersive-translate-paragraph="1">The issue <a class="inline-onebox" href="https://github.com/ubuntu/microk8s/issues/2280" data-immersive-translate-walked="7a038aed-f864-4cc1-8d5d-0758a9bf2781">API Server hanging on raspberry pi · Issue #2280 · canonical/microk8s · GitHub</a> demonstrates a successful debugging of this issue.<font class="notranslate immersive-translate-target-wrapper" data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br><font class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper" data-immersive-translate-translation-element-mark="1"><font class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner" data-immersive-translate-translation-element-mark="1">Issue <a data-immersive-translate-walked="7a038aed-f864-4cc1-8d5d-0758a9bf2781" href="https://github.com/ubuntu/microk8s/issues/2280" class="inline-onebox">API Server 挂在 Raspberry Pi 上 ·问题 #2280 ·规范/microk8s ·GitHub</a> 演示了此问题的成功调试。</font></font></font></p>
<p data-immersive-translate-walked="7a038aed-f864-4cc1-8d5d-0758a9bf2781"></p>
</details>

<details open="" data-immersive-translate-walked="7a038aed-f864-4cc1-8d5d-0758a9bf2781">
<summary data-immersive-translate-walked="7a038aed-f864-4cc1-8d5d-0758a9bf2781"><strong data-immersive-translate-walked="7a038aed-f864-4cc1-8d5d-0758a9bf2781" data-immersive-translate-paragraph="1">"access denied" error on Debian 9<font class="notranslate immersive-translate-target-wrapper" data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br><font class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper" data-immersive-translate-translation-element-mark="1"><font class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner" data-immersive-translate-translation-element-mark="1">Debian 9 上的 “access denied” 错误</font></font></font></strong></summary>
<p data-immersive-translate-walked="7a038aed-f864-4cc1-8d5d-0758a9bf2781" data-immersive-translate-paragraph="1">Snapctl coming with Debian 9 is outdated. Here is how to replace it with a fresh one:
   <font class="notranslate immersive-translate-target-wrapper" data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br><font class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper" data-immersive-translate-translation-element-mark="1"><font class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner" data-immersive-translate-translation-element-mark="1">Debian 9 附带的 Snapctl 已过时。以下是用新的替换它的方法：</font></font></font></p><div data-immersive-translate-walked="7a038aed-f864-4cc1-8d5d-0758a9bf2781"><div data-immersive-translate-walked="7a038aed-f864-4cc1-8d5d-0758a9bf2781"><pre><code>   sudo snap install core
   sudo mv /usr/bin/snapctl /usr/bin/snapctl.old
   sudo ln -s  /snap/core/current/usr/bin/snapctl /usr/bin/snapctl</code></pre></div></div>
</details>

<details open="" data-immersive-translate-walked="7a038aed-f864-4cc1-8d5d-0758a9bf2781">
<summary data-immersive-translate-walked="7a038aed-f864-4cc1-8d5d-0758a9bf2781"><strong data-immersive-translate-walked="7a038aed-f864-4cc1-8d5d-0758a9bf2781" data-immersive-translate-paragraph="1"> I get "i/o timeouts" when calling "microk8s kubectl logs"<font class="notranslate immersive-translate-target-wrapper" data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br><font class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper" data-immersive-translate-translation-element-mark="1"><font class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner" data-immersive-translate-translation-element-mark="1">我在调用“microk8s kubectl logs”时收到“i/o 超时”</font></font></font></strong></summary>
<p data-immersive-translate-walked="7a038aed-f864-4cc1-8d5d-0758a9bf2781" data-immersive-translate-paragraph="1">Make
 sure your hostname resolves correctly to the IP address of your host or
 localhost. The following error may indicate this misconfiguration:
   <font class="notranslate immersive-translate-target-wrapper" data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br><font class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper" data-immersive-translate-translation-element-mark="1"><font class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner" data-immersive-translate-translation-element-mark="1">确保您的主机名正确解析为主机或 localhost 的 IP 地址。以下错误可能表示此配置错误：</font></font></font></p><div data-immersive-translate-walked="7a038aed-f864-4cc1-8d5d-0758a9bf2781"><div data-immersive-translate-walked="7a038aed-f864-4cc1-8d5d-0758a9bf2781"><pre><code>  microk8s kubectl logs 
  Error from server: Get "https://hostname:10250/containerLogs/default/...": dial tcp host-IP:10250: i/o timeout</code></pre></div></div>
<p data-immersive-translate-walked="7a038aed-f864-4cc1-8d5d-0758a9bf2781" data-immersive-translate-paragraph="1">One way to address this issue is to add the hostname and IP details of the host in <code data-immersive-translate-walked="7a038aed-f864-4cc1-8d5d-0758a9bf2781">/etc/hosts</code>. In the  case of a multi-node cluster, the <code data-immersive-translate-walked="7a038aed-f864-4cc1-8d5d-0758a9bf2781">/etc/hosts</code> on each machine has to be updated with the details of all cluster nodes.<font class="notranslate immersive-translate-target-wrapper" data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br><font class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper" data-immersive-translate-translation-element-mark="1"><font class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner" data-immersive-translate-translation-element-mark="1">解决此问题的一种方法是在 <code data-immersive-translate-walked="7a038aed-f864-4cc1-8d5d-0758a9bf2781">/etc/hosts</code> 中添加主机的主机名和 IP 详细信息。对于多节点集群，每台计算机上的 <code data-immersive-translate-walked="7a038aed-f864-4cc1-8d5d-0758a9bf2781">/etc/hosts</code> 必须更新所有集群节点的详细信息。</font></font></font></p>
</details>

<details open="" data-immersive-translate-walked="7a038aed-f864-4cc1-8d5d-0758a9bf2781" data-immersive-translate-paragraph="1">
<summary data-immersive-translate-walked="7a038aed-f864-4cc1-8d5d-0758a9bf2781"><strong data-immersive-translate-walked="7a038aed-f864-4cc1-8d5d-0758a9bf2781" data-immersive-translate-paragraph="1"> I get "Unable to connect to the server: x509" on a multi-node cluster<font class="notranslate immersive-translate-target-wrapper" data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br><font class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper" data-immersive-translate-translation-element-mark="1"><font class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner" data-immersive-translate-translation-element-mark="1">我在多节点集群上收到 “Unable to connect to the server： x509”</font></font></font></strong></summary>
<p data-immersive-translate-walked="7a038aed-f864-4cc1-8d5d-0758a9bf2781" data-immersive-translate-paragraph="1">This
 indicates that the certificates are not being regenerated correctly to 
reflect network changes. A workaround is to temporarily rename the file 
found at:
/<font class="notranslate immersive-translate-target-wrapper" data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br><font class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper" data-immersive-translate-translation-element-mark="1"><font class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner" data-immersive-translate-translation-element-mark="1">这表示未正确重新生成证书以反映网络更改。解决方法是暂时重命名位于以下位置的文件： /</font></font></font></p><div data-immersive-translate-walked="7a038aed-f864-4cc1-8d5d-0758a9bf2781"><div data-immersive-translate-walked="7a038aed-f864-4cc1-8d5d-0758a9bf2781"><pre><code>var/snap/microk8s/current/var/lock/no-cert-reissue</code></pre></div></div>
The certificates should then be automatically regenerated. The above file can then be returned to its original name.
<font class="notranslate immersive-translate-target-wrapper" data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br><font class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper" data-immersive-translate-translation-element-mark="1"><font class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner" data-immersive-translate-translation-element-mark="1">然后，应自动重新生成证书。然后，可以将上述文件恢复为其原始名称。</font></font></font></details>

<details open="" data-immersive-translate-walked="7a038aed-f864-4cc1-8d5d-0758a9bf2781">
<summary data-immersive-translate-walked="7a038aed-f864-4cc1-8d5d-0758a9bf2781"><strong data-immersive-translate-walked="7a038aed-f864-4cc1-8d5d-0758a9bf2781" data-immersive-translate-paragraph="1">Calico controller fails on Raspberry Pi with Ubuntu 21.10<font class="notranslate immersive-translate-target-wrapper" data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br><font class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper" data-immersive-translate-translation-element-mark="1"><font class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner" data-immersive-translate-translation-element-mark="1">Calico 控制器在装有 Ubuntu 21.10 的 Raspberry Pi 上失败</font></font></font></strong></summary>
<p data-immersive-translate-walked="7a038aed-f864-4cc1-8d5d-0758a9bf2781" data-immersive-translate-paragraph="1">Extra kernel modules are needed on RPi after upgrading to Ubuntu 21.10. Install those with <code data-immersive-translate-walked="7a038aed-f864-4cc1-8d5d-0758a9bf2781">sudo apt install linux-modules-extra-raspi</code>. You may need to restart MicroK8s afterwards.
<font class="notranslate immersive-translate-target-wrapper" data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br><font class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper" data-immersive-translate-translation-element-mark="1"><font class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner" data-immersive-translate-translation-element-mark="1">升级到 Ubuntu 21.10 后，RPi 上需要额外的内核模块。使用 <code data-immersive-translate-walked="7a038aed-f864-4cc1-8d5d-0758a9bf2781">sudo apt install linux-modules-extra-raspi</code> .之后您可能需要重新启动 MicroK8s。</font></font></font></p>
</details>

<details open="" data-immersive-translate-walked="7a038aed-f864-4cc1-8d5d-0758a9bf2781" data-immersive-translate-paragraph="1">
<summary data-immersive-translate-walked="7a038aed-f864-4cc1-8d5d-0758a9bf2781"><strong data-immersive-translate-walked="7a038aed-f864-4cc1-8d5d-0758a9bf2781" data-immersive-translate-paragraph="1"> Pod communication problems when using firewall-cmd (Fedora etc)<font class="notranslate immersive-translate-target-wrapper" data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br><font class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper" data-immersive-translate-translation-element-mark="1"><font class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner" data-immersive-translate-translation-element-mark="1">使用 firewall-cmd 时出现 Pod 通信问题（Fedora 等）</font></font></font></strong></summary>
On systems which use firewall-cmd, pods are unable to communicate with 
each other because the firewall drops the packets. To check if this is 
the case, do the following:
<font class="notranslate immersive-translate-target-wrapper" data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br><font class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper" data-immersive-translate-translation-element-mark="1"><font class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner" data-immersive-translate-translation-element-mark="1">在使用 firewall-cmd 的系统上，Pod 无法相互通信，因为防火墙会丢弃数据包。要检查是否是这种情况，请执行以下作：</font></font></font><pre data-code-wrap="bash"><code class="lang-bash"># get the subnet cidr the pods are using
SUBNET=`cat /var/snap/microk8s/current/args/cni-network/cni.yaml | grep CALICO_IPV4POOL_CIDR -a1 | tail -n1 | grep -oP '[\d\./]+'`
echo $SUBNET

# enable logging of denied packets
sudo firewall-cmd --set-log-denied=all
sudo firewall-cmd --reload

# e.g. restart a pod and check for denied packets with dmesg
# (look for packets having an IP from the SUBNET above as SRC)
dmesg | grep -i REJECT
</code></pre>
<p data-immersive-translate-walked="7a038aed-f864-4cc1-8d5d-0758a9bf2781" data-immersive-translate-paragraph="1"><strong data-immersive-translate-walked="7a038aed-f864-4cc1-8d5d-0758a9bf2781">Solution:</strong> Create a dedicated zone for the microk8s subnet to avoid packets being dropped:<font class="notranslate immersive-translate-target-wrapper" data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br><font class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper" data-immersive-translate-translation-element-mark="1"><font class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner" data-immersive-translate-translation-element-mark="1"><strong data-immersive-translate-walked="7a038aed-f864-4cc1-8d5d-0758a9bf2781">溶液：</strong>为 microk8s 子网创建专用区域，以避免丢弃数据包：</font></font></font></p>
<pre><code class="lang-auto"># if you see packets being rejected create a dedicated zone for microk8s:
sudo firewall-cmd --permanent --new-zone=microk8s-cluster
sudo firewall-cmd --permanent --zone=microk8s-cluster --set-target=ACCEPT
sudo firewall-cmd --permanent --zone=microk8s-cluster --add-source=$SUBNET
sudo firewall-cmd --reload

# finally reset the logging
sudo firewall-cmd --set-log-denied=off
sudo firewall-cmd --reload
</code></pre>
</details>

<details open="" data-immersive-translate-walked="7a038aed-f864-4cc1-8d5d-0758a9bf2781">
<summary data-immersive-translate-walked="7a038aed-f864-4cc1-8d5d-0758a9bf2781"><strong data-immersive-translate-walked="7a038aed-f864-4cc1-8d5d-0758a9bf2781" data-immersive-translate-paragraph="1"> I get "This node does not have enough RAM to host the Kubernetes control plane services"<font class="notranslate immersive-translate-target-wrapper" data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br><font class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper" data-immersive-translate-translation-element-mark="1"><font class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner" data-immersive-translate-translation-element-mark="1">我收到 “This node does not have enough RAM to hosting the Kubernetes control plane services”</font></font></font></strong></summary>
<p data-immersive-translate-walked="7a038aed-f864-4cc1-8d5d-0758a9bf2781" data-immersive-translate-paragraph="1">MicroK8s
 will refuse to start on machines with less than 512MB available RAM, in
 order to prevent the system from running out of memory. It is suggested
 that these nodes are added as worker-only nodes to an existing cluster.<font class="notranslate immersive-translate-target-wrapper" data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br><font class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper" data-immersive-translate-translation-element-mark="1"><font class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner" data-immersive-translate-translation-element-mark="1">MicroK8s 将拒绝在可用 RAM 小于 512MB 的机器上启动，以防止系统内存不足。建议将这些节点作为仅限 worker 的节点添加到现有集群中。</font></font></font></p>
<p data-immersive-translate-walked="7a038aed-f864-4cc1-8d5d-0758a9bf2781" data-immersive-translate-paragraph="1"> If you still wish to start the control plane services, you can do:  <font class="notranslate immersive-translate-target-wrapper" data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br><font class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper" data-immersive-translate-translation-element-mark="1"><font class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner" data-immersive-translate-translation-element-mark="1">如果您仍然希望启动 control plane 服务，您可以执行以下作：</font></font></font></p>
<div data-immersive-translate-walked="7a038aed-f864-4cc1-8d5d-0758a9bf2781"><div data-immersive-translate-walked="7a038aed-f864-4cc1-8d5d-0758a9bf2781"><pre><code>microk8s start --disable-low-memory-guard
</code></pre></div></div>
</details>

## Reporting a bug 报告 bug

If you cannot solve your issue and believe the fault may lie in MicroK8s, please [file an issue on the project repository](https://github.com/ubuntu/microk8s/issues/).
如果您无法解决您的问题并认为问题可能出在 MicroK8s 上，请在[项目仓库中提交问题](https://github.com/ubuntu/microk8s/issues/)。

To help us deal effectively with issues, it is incredibly useful to include the report obtained from [`microk8s inspect`](https://microk8s.io/docs/troubleshooting#inspect), as well as any additional logs, and a summary of the issue.
为了帮助我们有效地处理问题，包括从 [`microk8s inspect`](https://microk8s.io/docs/troubleshooting#inspect) 获得的报告以及任何其他日志和问题摘要非常有用。