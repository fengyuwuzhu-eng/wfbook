# Image Identifiers 图像标识符

​                                  

Images are uniquely identified by way of a URI that matches the following signature:
图像通过与以下签名匹配的 URI 进行唯一标识：

```
<Glance Server Location>/v1/images/<ID>
```

where <Glance Server Location> is the resource location of the Glance service that knows about an image, and <ID> is the image’s identifier. Image identifiers in Glance are *uuids*, making them *globally unique*.
其中<Glance Server Location> 是了解映像的 Glance 服务的资源位置，<ID>也是映像的标识符。Glance 中的图像标识符是 uuid，使它们全局唯一。

# Image Statuses 图像状态

​                                  



Images in Glance can be in one of the following statuses:
Glance 中的图像可能处于以下状态之一：

- `queued`

  The image identifier has been reserved for an image in the Glance registry. No image data has been uploaded to Glance and the image size was not explicitly set to zero on creation.
  映像标识符已为 Glance 注册表中的映像保留。没有图像数据上传到 Glance，并且图像大小在创建时未显式设置为零。

- `saving`

  Denotes that an image’s raw data is currently being uploaded to Glance. When an image is registered with a call to POST /images and there is an x-image-meta-location header present, that image will never be in the saving status (as the image data is already available in some other location).
  表示图像的原始数据当前正在上传到 Glance。当使用对 POST /images 的调用注册图像并且存在 x-image-meta-location 标头时，该图像将永远不会处于保存状态（因为图像数据已在其他位置可用）。

- `uploading`

  Denotes that an import data-put call has been made. While in this status, a call to PUT /file is disallowed. (Note that a call to PUT /file on a queued image puts the image into saving status. Calls to PUT /stage are disallowed while an image is in saving status. Thus it’s not possible to use both upload methods on the same image.)
  表示已进行导入数据输入调用。在此状态下，不允许调用 PUT /file。（请注意，对排队图像调用 PUT /file 会使图像进入保存状态。当图像处于保存状态时，不允许调用 PUT /stage。因此，不能在同一张图片上同时使用这两种上传方法。

- `importing`

  Denotes that an import call has been made but that the image is not yet ready for use.
  表示已进行导入调用，但映像尚未准备好使用。

- `active`

  Denotes an image that is fully available in Glance. This occurs when the image data is uploaded, or the image size is explicitly set to zero on creation.
  表示在 Glance 中完全可用的图像。当上传图像数据或在创建时将图像大小显式设置为零时，会发生这种情况。

- `deactivated`

  Denotes that access to image data is not allowed to any non-admin user. Prohibiting downloads of an image also prohibits operations like image export and image cloning that may require image data.
  表示不允许任何非管理员用户访问图像数据。禁止下载图像也会禁止可能需要图像数据的图像导出和图像克隆等操作。

- `killed`

  Denotes that an error occurred during the uploading of an image’s data, and that the image is not readable.
  表示在上传图像数据期间发生错误，并且图像不可读。

- `deleted`

  Glance has retained the information about the image, but it is no longer available to use. An image in this state will be removed automatically at a later date.
  Glance 保留了有关图像的信息，但无法再使用。处于此状态的图像将在以后自动删除。

- `pending_delete`

  This is similar to deleted, however, Glance has not yet removed the image data. An image in this state is not recoverable.
  这与删除类似，但是，Glance 尚未删除图像数据。处于此状态的映像不可恢复。

![The states consist of: "queued", "saving", "active", "pending_delete", "deactivated", "uploading", "importing", "killed", and "deleted". The transitions consist of: An initial transition to the "queued" state called "create image". A transition from the "queued" state to the "active" state called "add location". A transition from the "queued" state to the "saving" state called "upload". A transition from the "queued" state to the "uploading" state called "stage upload". A transition from the "queued" state to the "deleted" state called "delete". A transition from the "saving" state to the "active" state called "upload succeeded". A transition from the "saving" state to the "deleted" state called "delete". A transition from the "saving" state to the "killed" state called "[v1] upload fail". A transition from the "saving" state to the "queued" state called "[v2] upload fail". A transition from the "uploading" state to the "importing" state called "import". A transition from the "uploading" state to the "queued" state called "stage upload fail". A transition from the "uploading" state to the "deleted" state called "delete". A transition from the "importing" state to the "active" state called "import succeed". A transition from the "importing" state to the "queued" state called "import fail". A transition from the "importing" state to the "deleted" state called "delete". A transition from the "active" state to the "deleted" state called "delete". A transition from the "active" state to the "pending_delete" state called "delayed delete". A transition from the "active" state to the "deactivated" state called "deactivate". A transition from the "killed" state to the "deleted" state called "deleted". A transition from the "pending_delete" state to the "deleted" state called "after scrub time". A transition from the "deactivated" state to the "deleted" state called "delete". A transition from the "deactivated" state to the "active" state called "reactivate". There are no transitions out of the "deleted" state.](https://docs.openstack.org/glance/2023.2/_images/image_status_transition.png)

This is a representation of how the image move from one status to the next.
这是图像如何从一种状态移动到另一种状态的表示形式。¶

- Add location from zero to more than one.
  将位置从零添加到多个。



# Task Statuses 任务状态 ¶

Tasks in Glance can be in one of the following statuses:
Glance 中的任务可以处于以下状态之一：

- `pending`

  The task identifier has been reserved for a task in the Glance. No processing has begun on it yet.
  任务标识符已为 Glance 中的任务保留。尚未开始处理。

- `processing`

  The task has been picked up by the underlying executor and is being run using the backend Glance execution logic for that task type.
  该任务已由基础执行程序选取，并且正在使用该任务类型的后端 Glance 执行逻辑运行。

- `success`

  Denotes that the task has had a successful run within Glance. The `result` field of the task shows more details about the outcome.
  表示任务已在 Glance 中成功运行。任务 `result` 字段显示有关结果的更多详细信息。

- `failure`

  Denotes that an error occurred during the execution of the task and it cannot continue processing. The `message` field of the task shows what the error was.
  表示在执行任务期间发生错误，无法继续处理。任务 `message` 字段显示错误是什么。

# Disk and Container Formats 磁盘和容器格式

​                                  



When adding an image to Glance, you must specify what the virtual machine image’s *disk format* and *container format* are. Disk and container formats are configurable on a per-deployment basis. This document intends to establish a global convention for what specific values of *disk_format* and *container_format* mean.
向 Glance 添加映像时，必须指定虚拟机映像的磁盘格式和容器格式。磁盘和容器格式可基于每个部署进行配置。本文件旨在就disk_format和container_format的特定价值的含义制定一项全球公约。

## Disk Format 磁盘格式 ¶

The disk format of a virtual machine image is the format of the underlying disk image. Virtual appliance vendors have different formats for laying out the information contained in a virtual machine disk image.
虚拟机映像的磁盘格式是基础磁盘映像的格式。虚拟设备供应商使用不同的格式来对虚拟机磁盘映像中包含的信息进行布局。

You can set your image’s disk format to one of the following:
您可以将映像的磁盘格式设置为以下格式之一：

- raw

  This is an unstructured disk image format. 这是一种非结构化磁盘映像格式。 The `raw` image format is the simplest one, and is natively supported by both KVM and Xen hypervisors.  You can think of a raw image as being the bit-equivalent of a block device file, created as if somebody had copied, say, `/dev/sda` to a file using the **dd** command.  `raw` 映像格式是最简单的一种，KVM 和 Xen 虚拟机管理程序都原生支持。您可以将原始映像视为块设备文件的等效位，其创建方式就像有人使用 dd 命令复制 `/dev/sda` 到文件中一样。

- vhd

  This is the VHD (Virtual Hard Disk) disk format, a common disk format used by virtual machine monitors from VMware, Xen, Microsoft, VirtualBox, and others. 这是VHD（虚拟硬盘）磁盘格式，是VMware，Xen，Microsoft，VirtualBox等虚拟机监视器使用的常见磁盘格式。

- vhdx VHDX的

  This is the [VHDX](http://technet.microsoft.com/en-us/library/hh831446.aspx) format, an enhanced version of the `vhd` format.  It has support for larger disk sizes and protection against data corruption during power failures. 这是 VHDX 格式，是该 `vhd` 格式的增强版本。它支持更大的磁盘大小，并防止电源故障期间的数据损坏。

- vmdk VMDK （虚拟机）

  The [VMDK](https://developercenter.vmware.com/web/sdk/60/vddk) (Virtual Machine Disk) format is supported by many common virtual machine monitors, for example the VMware ESXi hypervisor. 许多常见的虚拟机监视器（例如 VMware ESXi 虚拟机管理程序）都支持 VMDK（虚拟机磁盘）格式。

- vdi

  The [VDI](https://forums.virtualbox.org/viewtopic.php?t=8046) (Virtual Disk Image) format for image files is supported by the VirtualBox virtual machine monitor and the QEMU emulator. VirtualBox 虚拟机监视器和 QEMU 仿真器支持映像文件的 VDI（虚拟磁盘映像）格式。

- iso

  The [ISO](http://www.ecma-international.org/publications/standards/Ecma-119.htm) format is a disk image formatted with the read-only ISO 9660 (also known as ECMA-119) filesystem commonly used for CDs and DVDs. ISO 格式是使用只读 ISO 9660（也称为 ECMA-119）文件系统格式化的磁盘映像，通常用于 CD 和 DVD。

- ploop 普卢普

  A disk format supported and used by Virtuozzo to run OS Containers. Virtuozzo 支持和用于运行 OS 容器的磁盘格式。

- qcow2

  The [QCOW2](http://en.wikibooks.org/wiki/QEMU/Images) (QEMU copy-on-write version 2) format is commonly used with the KVM hypervisor.  It uses a sparse representation, so the image size is smaller than a raw format file of the same virtual disk.  It can expand dynamically and supports Copy on Write. QCOW2（QEMU 写入时复制版本 2）格式通常与 KVM 虚拟机管理程序一起使用。它使用稀疏表示形式，因此映像大小小于同一虚拟磁盘的原始格式化文件。它可以动态扩展，并支持写入时复制。

The [AKI/AMI/ARI](http://docs.aws.amazon.com/AWSEC2/latest/UserGuide/AMIs.html) format was the initial image format supported by Amazon EC2. The image consists of three files, each of which has its own specific `disk_format` identifier:
AKI/AMI/ARI 格式是 Amazon EC2 支持的初始图像格式。映像由三个文件组成，每个文件都有其自己的特定 `disk_format` 标识符：

- aki

  This indicates what is stored in Glance is an Amazon Kernel Image (AKI). It is a kernel file that the hypervisor will load initially to boot the image.  For a Linux machine, this would be a `vmlinuz` file. 这表示 Glance 中存储的是 Amazon 内核映像 （AKI）。它是一个内核文件，虚拟机监控程序最初将加载该文件以引导映像。对于 Linux 计算机，这将是一个 `vmlinuz` 文件。

- ari

  This indicates what is stored in Glance is an Amazon Ramdisk Image (ARI). It is an optional ramdisk file mounted at boot time. For a Linux machine, this would be an `initrd` file. 这表示 Glance 中存储的是 Amazon Ramdisk 映像 （ARI）。它是在引导时挂载的可选 ramdisk 文件。对于 Linux 计算机，这将是一个 `initrd` 文件。

- ami

  This indicates what is stored in Glance is an Amazon Machine Image (AMI). It is a virtual machine image in raw format. 这表示 Glance 中存储的是 Amazon 系统映像 （AMI）。它是原始格式的虚拟机映像。

## Container Format 容器格式 ¶

The container format refers to whether the virtual machine image is in a file format that also contains metadata about the actual virtual machine.
容器格式是指虚拟机映像是否采用文件格式，该格式还包含有关实际虚拟机的元数据。

Note the following: 请注意以下事项：

1. Glance does not verify that the `container_format` image property accurately describes the image data payload.
   Glance 不会验证 `container_format` image 属性是否准确描述了图像数据有效负载。

2. Do not assume that all OpenStack services can handle all the container formats defined by Glance.
   不要假设所有 OpenStack 服务都可以处理 Glance 定义的所有容器格式。

   Consult the documentation for the service consuming your image to see what container formats the service supports.
   请参阅使用映像的服务文档，了解该服务支持的容器格式。

You can set your image’s container format to one of the following:
您可以将映像的容器格式设置为以下格式之一：

- bare 裸

  This indicates there is no container or metadata envelope for the image. 这表示映像没有容器或元数据信封。

- ovf

  [OVF](http://dmtf.org/sites/default/files/OVF_Overview_Document_2010.pdf) (Open Virtualization Format) is a packaging format for virtual machines, defined by the Distributed Management Task Force (DMTF) standards group. An OVF package contains one or more image files, a `.ovf` XML metadata file that contains information about the virtual machine, and possibly other files as well. OVF（开放虚拟化格式）是一种虚拟机打包格式，由分布式管理任务组 （DMTF） 标准组定义。OVF 软件包包含一个或多个映像文件、一个 `.ovf` 包含虚拟机相关信息的 XML 元数据文件，可能还有其他文件。 An OVF package can be distributed in different ways. For example, it could be distributed as a set of discrete files, or as a tar archive file with an `.ova` (open virtual appliance/application) extension. OVF 软件包可以通过不同的方式分发。例如，它可以作为一组离散文件分发，也可以作为具有 `.ova` （开放虚拟设备/应用程序）扩展名的 tar 存档文件分发。

- aki

  This indicates what is stored in Glance is an Amazon kernel image. 这表示 Glance 中存储的是 Amazon 内核映像。

- ari

  This indicates what is stored in Glance is an Amazon ramdisk image. 这表示 Glance 中存储的是 Amazon ramdisk 映像。

- ami

  This indicates what is stored in Glance is an Amazon machine image. 这表示 Glance 中存储的是 Amazon 计算机映像。

- ova

  This indicates what is stored in Glance is an OVA tar archive file, that is, an OVF package contained in a single tar archive file. 这表示 Glance 中存储的是 OVA tar 存档文件，即包含在单个 tar 存档文件中的 OVF 软件包。

- docker 码头工人

  This indicates what is stored in Glance is a Docker tar archive of the container filesystem. 这表明 Glance 中存储的是容器文件系统的 Docker tar 存档。

- compressed 压缩

  The exact format of the compressed file is not specified. It is the responsibility of the consuming service to analyze the data payload and determine the specific compression format. A particular OpenStack service may only support specific formats. 未指定压缩文件的确切格式。使用服务负责分析数据有效负载并确定特定的压缩格式。特定的 OpenStack 服务可能只支持特定的格式。 You may assume that any OpenStack service that creates an image with a ‘compressed’ container format will be able to consume that image. 您可以假设任何使用“压缩”容器格式创建映像的 OpenStack 服务都能够使用该映像。 Consult the documentation for the service that will consume your image for details. 有关详细信息，请参阅将使用映像的服务的文档。

# Common Image Properties 常见映像属性

​                                  

When adding an image to Glance, you may specify some common image properties that may prove useful to consumers of your image.
向 Glance 添加图像时，您可以指定一些常见的图像属性，这些属性可能对图像的使用者有用。

This document explains the names of these properties and the expected values.
本文档介绍这些属性的名称和预期值。

The common image properties are also described in a JSON schema, found in `/etc/glance/schema-image.json` in the Glance source code.
常见的图像属性也在 JSON 架构中进行了描述，可在 Glance 源代码中找到 `/etc/glance/schema-image.json` 。

- kernel_id

  The ID of image stored in Glance that should be used as the kernel when booting an AMI-style image. 存储在 Glance 中的映像的 ID，在引导 AMI 样式映像时应用作内核。

- ramdisk_id

  The ID of image stored in Glance that should be used as the ramdisk when booting an AMI-style image. 存储在 Glance 中的镜像的 ID，在引导 AMI 样式镜像时应用作虚拟硬盘。

- instance_uuid

  Metadata which can be used to record which instance this image is associated with. (Informational only, does not create an instance snapshot.) 元数据，可用于记录此映像与哪个实例相关联。（仅供参考，不会创建实例快照。

- architecture 建筑

  Operating system architecture as specified in https://docs.openstack.org/python-glanceclient/latest/cli/property-keys.html https://docs.openstack.org/python-glanceclient/latest/cli/property-keys.html 中指定的操作系统体系结构

- os_distro

  The common name of the operating system distribution as specified in https://docs.openstack.org/python-glanceclient/latest/cli/property-keys.html https://docs.openstack.org/python-glanceclient/latest/cli/property-keys.html 中指定的操作系统分发的公用名

- os_version

  The operating system version as specified by the distributor. 分发服务器指定的操作系统版本。

- description 描述

  A brief human-readable string, suitable for display in a user interface, describing the image. 一个简短的人类可读字符串，适合在用户界面中显示，描述图像。

- cinder_encryption_key_id

  Identifier in the OpenStack Key Management Service for the encryption key for the Block Storage Service to use when mounting a volume created from this image. OpenStack Key Management Service 中的标识符，用于挂载从此映像创建的卷时块存储服务使用的加密密钥。

- cinder_encryption_key_deletion_policy

  States the condition under which the Image Service will delete the object associated with the ‘cinder_encryption_key_id’ image property. If this property is missing, the Image Service will take no action. 说明影像服务将删除与“cinder_encryption_key_id”影像属性关联的对象的条件。如果缺少此属性，影像服务将不执行任何操作。

This file is the default schema. An operator can modify `/etc/schema-image.json` to include arbitrary properties.
此文件是默认架构。运算符可以修改 `/etc/schema-image.json` 以包含任意属性。



 

Warning 警告



- Do not delete existing properties from this default schema because this will affect interoperability
  不要从此默认架构中删除现有属性，因为这会影响互操作性
- The `type` of each property in this JSON schema, specified by the `type` key, must have value `string` even if the property you are adding is not a string in common sense. For example, if you want to add a property named `is_removable` and want its type to be `boolean`. However, you must give the `type` key the value `string`. Otherwise, when an end-user makes a call that sets a value on one of these, they will gets a 500. This is because everything in the image_properties table must be a string in the database. The API, however, won’t accept a string value when the schema says it is boolean or some other non-string JSON data type
   `type` 此 JSON 架构中的每个属性（由 `type` 键指定）必须具有值 `string` ，即使要添加的属性不是常识意义上的字符串。例如，如果要添加一个名为 `is_removable` 的属性，并希望其类型为 `boolean` 。但是，您必须为 `type` 密钥提供值 `string` 。否则，当最终用户调用其中一个值时，他们将获得 500。这是因为image_properties表中的所有内容都必须是数据库中的字符串。但是，当架构显示字符串值是布尔值或其他非字符串 JSON 数据类型时，API 不会接受字符串值



 

Note 注意



If your need is more complicated, we recommend using [metadefs](https://docs.openstack.org/api-ref/image/v2/metadefs-index.html) instead of modifying this image schema
如果您的需求更复杂，我们建议使用 metadefs 而不是修改此映像架构

# Metadata Definition Concepts 元数据定义概念

​                                  

The metadata definition service was added to Glance in the Juno release of OpenStack.
元数据定义服务已添加到 OpenStack 的 Juno 版本的 Glance 中。

It provides a common API for vendors, admins, services, and users to meaningfully **define** available key / value pair metadata that can be used on different types of resources (images, artifacts, volumes, flavors, aggregates, and other resources). A definition includes a property’s key, its description, its constraints, and the resource types to which it can be associated.
它为供应商、管理员、服务和用户提供了一个通用 API，用于有意义地定义可用于不同类型的资源（映像、项目、卷、特定实例、聚合和其他资源）的可用键/值对元数据。定义包括属性的键、属性的说明、属性的约束以及属性可以关联到的资源类型。

This catalog does not store the values for specific instance properties.
此目录不存储特定实例属性的值。

For example, a definition of a virtual CPU topology property for the number of cores will include the base key to use (for example, cpu_cores), a description, and value constraints like requiring it to be an integer. So, a user, potentially through Horizon, would be able to search this catalog to list the available properties they can add to a flavor or image. They will see the virtual CPU topology property in the list and know that it must be an integer.
例如，内核数的虚拟 CPU 拓扑属性的定义将包括要使用的基本键（例如，cpu_cores）、说明和值约束，例如要求它为整数。因此，用户（可能通过  Horizon）将能够搜索此目录，以列出他们可以添加到特定风格或映像的可用属性。他们将在列表中看到虚拟 CPU  拓扑属性，并知道它必须是一个整数。

When the user adds the property its key and value will be stored in the service that owns that resource (for example, Nova for flavors and in Glance for images). The catalog also includes any additional prefix required when the property is applied to different types of resources, such as “hw_” for images and “hw:” for flavors.  So, on an image, the user would know to set the property as “hw_cpu_cores=1”.
当用户添加属性时，其键和值将存储在拥有该资源的服务中（例如，Nova（用于风格）和  Glance（用于图像）。该目录还包括将属性应用于不同类型的资源时所需的任何其他前缀，例如“hw_”表示图像，“hw：”表示风格。因此，在图像上，用户会知道将属性设置为“hw_cpu_cores=1”。



 

Note 注意



Resource manipulation via this API is restricted to admins by default since the Wallaby release. This API does not provide limits suitable for exposure to all users, and can also leak information between users unintentionally. Even as an admin, be careful with the names you use for resources you create that are intended to be private, in order to avoid unintentional exposure. See Bug [1916926](https://bugs.launchpad.net/glance/+bug/1916926/) for more information.
自 Wallaby 发布以来，默认情况下，通过此 API 进行的资源操作仅限于管理员。此 API  不提供适合所有用户暴露的限制，并且还可能无意中泄露用户之间的信息。即使作为管理员，也要小心使用用于所创建资源的专用名称，以避免意外暴露。有关详细信息，请参阅 Bug 1916926。

## Terminology 术语 ¶

### Background 背景 ¶

The term *metadata* can become very overloaded and confusing.  This catalog is about the additional metadata that is passed as arbitrary key / value pairs or tags across various artifacts and OpenStack services.
术语元数据可能会变得非常过载和令人困惑。此目录是关于在各种工件和 OpenStack 服务中作为任意键/值对或标签传递的其他元数据。

Below are a few examples of the various terms used for metadata across OpenStack services today:
以下是目前 OpenStack 服务中用于元数据的各种术语的几个示例：

| Nova 新星                                                    | Cinder 煤渣                                                  | Glance 一目了然                                           |
| ------------------------------------------------------------ | ------------------------------------------------------------ | --------------------------------------------------------- |
| Flavor 味道 *extra specs 额外规格*  Host Aggregate 主机聚合 *metadata 元数据*  Servers 服务器 *metadata 元数据* *scheduler_hints* *tags 标签* | Volume & Snapshot 卷和快照 *image metadata 图像元数据* *metadata 元数据*  VolumeType 卷类型 *extra specs 额外规格* *qos specs QoS 规格* | Image & Snapshot 图像和快照 *properties 性能* *tags 标签* |

### Catalog Concepts 目录概念 ¶

The below figure illustrates the concept terminology used in the metadata definitions catalog:
下图说明了元数据定义目录中使用的概念术语：

```
A namespace is associated with 0 to many resource types, making it visible to
the API / UI for applying to that type of resource. RBAC Permissions are
managed at a namespace level.

+----------------------------------------------+
|         Namespace                            |
|                                              |
| +-----------------------------------------+  |
| |        Object Definition                |  |
| |                                         |  |        +--------------------+
| | +-------------------------------------+ |  |  +-->  | Resource Type:     |
| | | Property Definition A (key=integer) | |  |  |     | e.g. Nova Flavor   |
| | +-------------------------------------+ |  |  |     +--------------------+
| |                                         |  |  |
| | +-------------------------------------+ |  |  |
| | | Property Definition B (key=string)  | |  |  |     +--------------------+
| | +-------------------------------------+ |  +--+-->  | Resource Type:     |
| |                                         |  |  |     | e.g. Glance Image  |
| +-----------------------------------------+  |  |     +--------------------+
|                                              |  |
|  +-------------------------------------+     |  |
|  | Property Definition C (key=boolean) |     |  |     +--------------------+
|  +-------------------------------------+     |  +-->  | Resource Type:     |
|                                              |        | e.g. Cinder Volume |
+----------------------------------------------+        +--------------------+

 Properties may be defined standalone or within the context of an object.
```

### Catalog Terminology 目录术语 ¶

The following terminology is used within the metadata definition catalog.
元数据定义目录中使用以下术语。

**Namespaces 命名空间**

Metadata definitions are contained in namespaces.
元数据定义包含在命名空间中。

- Specify the access controls (CRUD) for everything defined in it. Allows for admin only, different projects, or the entire cloud to define and use the definitions in the namespace
  为其中定义的所有内容指定访问控制 （CRUD）。仅允许管理员、不同项目或整个云定义和使用命名空间中的定义
- Associates the contained definitions to different types of resources
  将包含的定义与不同类型的资源相关联

**Properties 性能**

A property describes a single property and its primitive constraints. Each property can ONLY be a primitive type:
属性描述单个属性及其基元约束。每个属性只能是基元类型：

- string, integer, number, boolean, array
  字符串、整数、数字、布尔值、数组

Each primitive type is described using simple JSON schema notation. This means NO nested objects and no definition referencing.
每个基元类型都使用简单的 JSON 架构表示法进行描述。这意味着没有嵌套对象，也没有定义引用。

**Objects 对象**

An object describes a group of one to many properties and their primitive constraints. Each property in the group can ONLY be a primitive type:
对象描述一组一对多属性及其基元约束。组中的每个属性只能是基元类型：

- string, integer, number, boolean, array
  字符串、整数、数字、布尔值、数组

Each primitive type is described using simple JSON schema notation. This means NO nested objects.
每个基元类型都使用简单的 JSON 架构表示法进行描述。这意味着没有嵌套对象。

The object may optionally define required properties under the semantic understanding that a user who uses the object should provide all required properties.
对象可以选择性地定义必需的属性，在语义理解下，使用该对象的用户应提供所有必需的属性。

**Resource Type Association
资源类型关联**

Resource type association specifies the relationship between resource types and the namespaces that are applicable to them. This information can be used to drive UI and CLI views. For example, the same namespace of objects, properties, and tags may be used for images, snapshots, volumes, and flavors. Or a namespace may only apply to images.
资源类型关联指定资源类型与适用于它们的命名空间之间的关系。此信息可用于驱动 UI 和 CLI 视图。例如，对象、属性和标记的相同命名空间可用于映像、快照、卷和变种。或者，命名空间可能仅适用于图像。

Resource types should be aligned with Heat resource types whenever possible. https://docs.openstack.org/heat/latest/template_guide/openstack.html
资源类型应尽可能与热资源类型保持一致。https://docs.openstack.org/heat/latest/template_guide/openstack.html

It is important to note that the same base property key can require different prefixes depending on the target resource type. The API provides a way to retrieve the correct property based on the target resource type.
请务必注意，同一基本属性键可能需要不同的前缀，具体取决于目标资源类型。该 API 提供了一种根据目标资源类型检索正确属性的方法。

Below are a few examples:
以下是一些示例：

The desired virtual CPU topology can be set on both images and flavors via metadata. The keys have different prefixes on images than on flavors. On flavors keys are prefixed with `hw:`, but on images the keys are prefixed with `hw_`.
可以通过元数据在映像和风格上设置所需的虚拟 CPU 拓扑。这些键在图像上的前缀与在风格上的前缀不同。在风格上，键以 `hw:` 为前缀，但在图像上，键以 `hw_` .

For more: https://github.com/openstack/nova-specs/blob/master/specs/juno/implemented/virt-driver-vcpu-topology.rst
更多：https://github.com/openstack/nova-specs/blob/master/specs/juno/implemented/virt-driver-vcpu-topology.rst

Another example is the AggregateInstanceExtraSpecsFilter and scoped properties (e.g. properties with something:something=value). For scoped / namespaced properties, the AggregateInstanceExtraSpecsFilter requires a prefix of “aggregate_instance_extra_specs:” to be used on flavors but not on the aggregate itself. Otherwise, the filter will not evaluate the property during scheduling.
另一个示例是 AggregateInstanceExtraSpecsFilter 和作用域属性（例如，具有  something：something=value  的属性）。对于作用域/命名空间属性，AggregateInstanceExtraSpecsFilter  需要前缀“aggregate_instance_extra_specs：”  用于特定实例，但不能用于聚合本身。否则，筛选器将不会在计划期间评估该属性。

So, on a host aggregate, you may see:
因此，在主机聚合上，您可能会看到：

companyx:fastio=true 公司x：fastio=true

But then when used on the flavor, the AggregateInstanceExtraSpecsFilter needs:
但是，当用于特定实例时，AggregateInstanceExtraSpecsFilter 需要：

aggregate_instance_extra_specs:companyx:fastio=true
aggregate_instance_extra_specs：companyx：fastio=true

In some cases, there may be multiple different filters that may use the same property with different prefixes. In this case, the correct prefix needs to be set based on which filter is enabled.
在某些情况下，可能有多个不同的筛选器可能使用具有不同前缀的同一属性。在这种情况下，需要根据启用的过滤器设置正确的前缀。

# Using Glance’s Image Public APIs 使用 Glance 的 Image Public API

​                                  

Glance is the reference implementation of the OpenStack Images API.  As such, Glance fully implements versions 1 and 2 of the Images API.
Glance 是 OpenStack Images API 的参考实现。因此，Glance 完全实现了 Images API 的版本 1 和 2。



 

Note 注意



The Images API v1, DEPRECATED in the Newton release, has been removed.
在 Newton 版本中已弃用的映像 API v1 已被删除。

There used to be a sentence here saying, “The Images API specification is developed alongside Glance, but is not considered part of the Glance project.” That’s only partially true (or completely false, depending upon how strict you are about these things).  Conceptually, the OpenStack Images API is an independent definition of a REST API.  In practice, however, the only way to participate in the evolution of the Images API is to work with the Glance community to define the new functionality and provide its reference implementation. Further, Glance falls under the “designated sections” provision of the OpenStack Interop (formerly known as DefCore) Guidelines, which basically means that in order to qualify as “OpenStack”, a cloud exposing an OpenStack Images API must include the Glance Images API implementation code. Thus, although conceptually independent, the OpenStack Images APIs are intimately associated with Glance.
这里曾经有一句话是这样说的，“Images API 规范是与 Glance 一起开发的，但不被视为 Glance  项目的一部分。这只是部分正确（或完全错误，取决于你对这些事情的严格程度）。从概念上讲，OpenStack Images API 是 REST  API 的独立定义。然而，在实践中，参与 Images API 演进的唯一方法是与 Glance  社区合作，定义新功能并提供其参考实现。此外，Glance 属于 OpenStack Interop（以前称为  DefCore）指南的“指定部分”条款，这基本上意味着，为了符合“OpenStack”的资格，公开 OpenStack Images API  的云必须包含 Glance Images API 实现代码。因此，尽管在概念上是独立的，但 OpenStack Images API 与  Glance 密切相关。

**References 引用**

- [Designated sections (definition)
  指定部分（定义）](https://docs.opendev.org/openinfra/interop/latest/process/Lexicon.html)
- [2014-04-02 DefCore Designated Sections Guidelines
  2014-04-02 DefCore 指定部分指南](https://governance.openstack.org/resolutions/20140402-defcore-designated-sections-guidelines.html)
- [OpenStack Core Definition
  OpenStack 核心定义](https://docs.opendev.org/openinfra/interop/latest/process/CoreDefinition.html)
- [Interop Guidelines Repository
  互操作准则存储库](https://opendev.org/openinfra/interop)

## Glance and the Images APIs: Past, Present, and Future Glance 和图像 API：过去、现在和未来 ¶

Here’s a quick summary of the Images APIs that have been implemented by Glance. If you’re interested in more details, you can consult the Release Notes for all the OpenStack releases (beginning with “Bexar”) to follow the evolution of features in Glance and the Images APIs.
以下是 Glance 实现的 Images API 的快速摘要。如果您对更多细节感兴趣，可以查阅所有 OpenStack 版本（以“Bexar”开头）的发行说明，以了解 Glance 和 Images API 中功能的演变。

### Images v1 API 图片 v1 API ¶

The v1 API was originally designed as a service API for use by Nova and other OpenStack services. In the Kilo release, the v1.1 API was downgraded from CURRENT to SUPPORTED. In the Newton release, the version 1 API is officially declared DEPRECATED.
v1 API 最初被设计为服务 API，供 Nova 和其他 OpenStack 服务使用。在 Kilo 版本中，v1.1 API 已从 CURRENT 降级为 SUPPORTED。在 Newton 版本中，版本 1 API 被正式声明为已弃用。

During the deprecation period, the Images v1 API is closed to further development.  The Glance code implementing the v1 API accepts only serious bugfixes.
在弃用期间，映像 v1 API 将关闭，无法进一步开发。实现 v1 API 的 Glance 代码仅接受严重的错误修复。

Since Folsom, it has been possible to deploy OpenStack without exposing the Images v1 API to end users.  The Compute v2 API contains image-related API calls allowing users to list images, list images details, show image details for a specific image, delete images, and manipulate image metadata.  Nova acts as a proxy to Glance for these image-related calls.  It’s important to note that the image-related calls in the Compute v2 API are a proper subset of the calls available in the Images APIs.
自 Folsom 以来，无需向最终用户公开 Images v1 API 即可部署 OpenStack。计算 v2 API 包含与图像相关的 API 调用，允许用户列出图像、列出图像详细信息、显示特定图像的图像详细信息、删除图像和操作图像元数据。Nova 充当 Glance  的代理，用于这些与图像相关的调用。请务必注意，计算 v2 API 中与图像相关的调用是图像 API 中可用调用的适当子集。

In the Newton release, Nova (and other OpenStack services that consume images) have been modified to use the Images v2 API by default.
在 Newton 版本中，Nova（以及其他使用镜像的 OpenStack 服务）已被修改为默认使用 Images v2 API。

**Reference 参考**

- [OpenStack Standard Deprecation Requirements
  OpenStack 标准弃用要求](https://governance.openstack.org/reference/tags/assert_follows-standard-deprecation.html#requirements)

### Images v2 API 图片 v2 API ¶

The v2 API is the CURRENT OpenStack Images API.  It provides a more friendly interface to consumers than did the v1 API, as it was specifically designed to expose images-related functionality as a public-facing endpoint.  It’s the version that’s currently open to development.
v2 API 是当前的 OpenStack 镜像 API。与 v1 API 相比，它为使用者提供了更友好的界面，因为它专门设计用于将图像相关功能公开为面向公众的终结点。这是目前开放开发的版本。

A common strategy is to deploy multiple Glance nodes: internal-facing nodes providing the Images APIs for internal consumers like Nova, and external-facing nodes providing the Images v2 API for public use.
一种常见的策略是部署多个 Glance 节点：面向内部的节点为内部使用者（如 Nova）提供 Images API，面向外部的节点提供 Images v2 API 供公众使用。

### The Future 未来 ¶

During the long and tumultuous design phase of what has since become an independent service named “Glare” (the Glance Artifacts Repository), the Glance community loosely spoke about the Artifacts API being “Glance v3”.  This, however, was only a shorthand way of speaking of the Artifacts effort.  The Artifacts API can’t be the Images v3 API since Artifacts are not the same as Images.  Conceptually, a virtual machine image could be an Artifact, and the Glare code has been designed to be compatible with the Images v2 API.  But at this time, there are no plans to implement an Images v3 API.
在漫长而动荡的设计阶段，Glance 社区松散地将 Artifacts API 称为“Glance v3”。然而，这只是对 Artifacts  努力的一种简写方式。Artifacts API 不能是 Images v3 API，因为 Artifacts 与 Images  不同。从概念上讲，虚拟机映像可以是项目，并且 Glare 代码已设计为与映像 v2 API 兼容。但目前，没有计划实现 Images v3  API。

During the Newton development cycle, Glare became an independent OpenStack project.  While it’s evident that there’s a need for an Artifact Repository in OpenStack, whether it will be as ubiquitous as the need for an Images Repository isn’t clear.  On the other hand, industry trends could go in the opposite direction where everyone needs Artifacts and deployers view images as simply another type of digital artifact.  As Yogi Berra, an experienced manager, once said, “It’s tough to make predictions, especially about the future.”
在Newton开发周期中，Glare成为一个独立的OpenStack项目。虽然很明显，OpenStack中需要一个Artifact Repository，但它是否像对Images  Repository的需求一样无处不在尚不清楚。另一方面，行业趋势可能会朝着相反的方向发展，每个人都需要工件，而部署人员将图像视为另一种类型的数字工件。正如经验丰富的经理人Yogi Berra曾经说过的那样，“很难做出预测，尤其是关于未来。

## Authentication 身份验证 ¶

Glance depends on Keystone and the OpenStack Identity API to handle authentication of clients. You must obtain an authentication token from Keystone using and send it along with all API requests to Glance through the `X-Auth-Token` header. Glance will communicate back to Keystone to verify the token validity and obtain your identity credentials.
Glance 依赖于 Keystone 和 OpenStack Identity API 来处理客户端的身份验证。您必须使用 Keystone 获取身份验证令牌，并通过 `X-Auth-Token` 标头将其与所有 API 请求一起发送到 Glance。Glance 将与 Keystone 通信，以验证令牌有效性并获取您的身份凭证。

See [Authentication With Keystone](https://docs.openstack.org/glance/2023.2/admin/authentication.html#authentication) for more information on integrating with Keystone.
有关与 Keystone 集成的更多信息，请参阅使用 Keystone 进行身份验证。

## Using v1.X 使用 v1。X ¶



 

Note 注意



The Images API v1, DEPRECATED in the Newton release, has been removed.
在 Newton 版本中已弃用的映像 API v1 已被删除。

For the purpose of examples, assume there is a Glance API server running at the URL `http://glance.openstack.example.org` on the default port 80.
出于示例的目的，假设有一个 Glance API 服务器在默认端口 80 上的 URL `http://glance.openstack.example.org` 上运行。

### List Available Images 列出可用图片 ¶

We want to see a list of available images that the authenticated user has access to. This includes images owned by the user, images shared with the user and public images.
我们希望查看经过身份验证的用户有权访问的可用映像列表。这包括用户拥有的镜像、与用户共享的镜像和公共镜像。

We issue a `GET` request to `http://glance.openstack.example.org/v1/images` to retrieve this list of available images. The data is returned as a JSON-encoded mapping in the following format:
我们发出请求 `GET` 以 `http://glance.openstack.example.org/v1/images` 检索此可用图像列表。数据以 JSON 编码的映射形式返回，格式如下：

```
{'images': [
  {'uri': 'http://glance.openstack.example.org/v1/images/71c675ab-d94f-49cd-a114-e12490b328d9',
   'name': 'Ubuntu 10.04 Plain',
   'disk_format': 'vhd',
   'container_format': 'ovf',
   'size': '5368709120'}
  ...]}
```

### List Available Images in More Detail 更详细地列出可用图像 ¶

We want to see a more detailed list of available images that the authenticated user has access to. This includes images owned by the user, images shared with the user and public images.
我们希望看到经过身份验证的用户有权访问的可用映像的更详细列表。这包括用户拥有的镜像、与用户共享的镜像和公共镜像。

We issue a `GET` request to `http://glance.openstack.example.org/v1/images/detail` to retrieve this list of available images. The data is returned as a JSON-encoded mapping in the following format:
我们发出请求 `GET` 以 `http://glance.openstack.example.org/v1/images/detail` 检索此可用图像列表。数据以 JSON 编码的映射形式返回，格式如下：

```
{'images': [
  {'uri': 'http://glance.openstack.example.org/v1/images/71c675ab-d94f-49cd-a114-e12490b328d9',
   'name': 'Ubuntu 10.04 Plain 5GB',
   'disk_format': 'vhd',
   'container_format': 'ovf',
   'size': '5368709120',
   'checksum': 'c2e5db72bd7fd153f53ede5da5a06de3',
   'created_at': '2010-02-03 09:34:01',
   'updated_at': '2010-02-03 09:34:01',
   'deleted_at': '',
   'status': 'active',
   'is_public': true,
   'min_ram': 256,
   'min_disk': 5,
   'owner': null,
   'properties': {'distro': 'Ubuntu 10.04 LTS'}},
  ...]}
```



 

Note 注意



All timestamps returned are in UTC.
返回的所有时间戳均采用 UTC 格式。

The updated_at timestamp is the timestamp when an image’s metadata was last updated, not its image data, as all image data is immutable once stored in Glance.
updated_at时间戳是上次更新图像元数据的时间戳，而不是其图像数据，因为所有图像数据一旦存储在 Glance 中，就不可变。

The properties field is a mapping of free-form key/value pairs that have been saved with the image metadata.
属性字段是与图像元数据一起保存的自由格式键/值对的映射。

The checksum field is an MD5 checksum of the image file data.
校验和字段是图像文件数据的 MD5 校验和。

The is_public field is a boolean indicating whether the image is publicly available.
is_public字段是一个布尔值，指示图像是否公开可用。

The min_ram field is an integer specifying the minimum amount of RAM needed to run this image on an instance, in megabytes.
min_ram 字段是一个整数，用于指定在实例上运行此映像所需的最小 RAM 量（以 MB 为单位）。

The min_disk field is an integer specifying the minimum amount of disk space needed to run this image on an instance, in gigabytes.
min_disk 字段是一个整数，用于指定在实例上运行此映像所需的最小磁盘空间量（以 GB 为单位）。

The owner field is a string which may either be null or which will indicate the owner of the image.
owner 字段是一个字符串，可以是 null 或指示图像的所有者。

### Filtering Images Lists 过滤图像列表 ¶

Both the `GET /v1/images` and `GET /v1/images/detail` requests take query parameters that serve to filter the returned list of images. The following list details these query parameters.
 `GET /v1/images` 和 `GET /v1/images/detail` requests 都采用查询参数，用于筛选返回的图像列表。以下列表详细介绍了这些查询参数。

- `name=NAME`

  Filters images having a `name` attribute matching `NAME`.
  筛选具有 属性匹配 `NAME` 的图像 `name` 。

- `container_format=FORMAT`

  Filters images having a `container_format` attribute matching `FORMAT`
  筛选具有属性匹配 `FORMAT` 的图像 `container_format` 

  For more information, see [Disk and Container Formats](https://docs.openstack.org/glance/2023.2/user/formats.html#formats)
  有关详细信息，请参阅磁盘和容器格式

- `disk_format=FORMAT`

  Filters images having a `disk_format` attribute matching `FORMAT`
  筛选具有属性匹配 `FORMAT` 的图像 `disk_format` 

  For more information, see [Disk and Container Formats](https://docs.openstack.org/glance/2023.2/user/formats.html#formats)
  有关详细信息，请参阅磁盘和容器格式

- `status=STATUS`

  Filters images having a `status` attribute matching `STATUS`
  筛选具有属性匹配 `STATUS` 的图像 `status` 

  For more information, see [Image Statuses](https://docs.openstack.org/glance/2023.2/user/statuses.html#image-statuses)
  有关详细信息，请参阅映像状态

- `size_min=BYTES`

  Filters images having a `size` attribute greater than or equal to `BYTES`
  筛选 `size` 属性大于或等于 `BYTES` 

- `size_max=BYTES`

  Filters images having a `size` attribute less than or equal to `BYTES`
  筛选 `size` 属性小于或等于 `BYTES` 

These two resources also accept additional query parameters:
这两个资源还接受其他查询参数：

- `sort_key=KEY`

  Results will be ordered by the specified image attribute `KEY`. Accepted values include `id`, `name`, `status`, `disk_format`, `container_format`, `size`, `created_at` (default) and `updated_at`.
  结果将按指定的 image 属性 `KEY` 排序。接受的值包括 `id` 、 `name` 、 、 `status` `disk_format` 、 `container_format` 、 `size` （ `created_at` 默认值） 和 `updated_at` 。

- `sort_dir=DIR`

  Results will be sorted in the direction `DIR`. Accepted values are `asc` for ascending or `desc` (default) for descending.
  结果将按 方向 `DIR` 排序。接受的值用于 `asc` 升序或 `desc` （默认）降序。

- `marker=ID`

  An image identifier marker may be specified. When present, only images which occur after the identifier `ID` will be listed. (These are the images that have a sort_key later than that of the marker `ID` in the sort_dir direction.)
  可以指定图像标识符标记。如果存在， `ID` 则仅列出在标识符之后出现的图像。（这些是sort_dir方向上比标记 `ID` sort_key晚的图像。

- `limit=LIMIT`

  When present, the maximum number of results returned will not exceed `LIMIT`.
  如果存在，则返回的最大结果数不会超过 `LIMIT` 。



 

Note 注意



If the specified `LIMIT` exceeds the operator defined limit (api_limit_max) then the number of results returned may be less than `LIMIT`.
如果指定的 `LIMIT` 超过运算符定义的限制 （api_limit_max），则返回的结果数可能小于 `LIMIT` 。

- `is_public=PUBLIC`

  An admin user may use the is_public parameter to control which results are returned.
  管理员用户可以使用 is_public 参数来控制返回的结果。

  When the is_public parameter is absent or set to True the following images will be listed: Images whose is_public field is True, owned images and shared images.
  当 is_public 参数不存在或设置为 True 时，将列出以下图像：is_public字段为 True 的图像、拥有的图像和共享的图像。

  When the is_public parameter is set to False the following images will be listed: Images (owned, shared, or non-owned) whose is_public field is False.
  当 is_public 参数设置为 False 时，将列出以下图像：is_public字段为 False 的图像（自有、共享或非自有）。

  When the is_public parameter is set to None all images will be listed irrespective of owner, shared status or the is_public field.
  当 is_public 参数设置为 None 时，将列出所有图像，无论所有者、共享状态或is_public字段如何。



 

Note 注意



Use of the is_public parameter is restricted to admin users. For all other users it will be ignored.
is_public 参数的使用仅限于管理员用户。对于所有其他用户，它将被忽略。

### Retrieve Image Metadata 检索图像元数据 ¶

We want to see detailed information for a specific virtual machine image that the Glance server knows about.
我们希望查看 Glance 服务器知道的特定虚拟机映像的详细信息。

We have queried the Glance server for a list of images and the data returned includes the uri field for each available image. This uri field value contains the exact location needed to get the metadata for a specific image.
我们已经在 Glance 服务器中查询了图像列表，返回的数据包括每个可用图像的 uri 字段。此 uri 字段值包含获取特定图像的元数据所需的确切位置。

Continuing the example from above, in order to get metadata about the first image returned, we can issue a `HEAD` request to the Glance server for the image’s URI.
继续上面的示例，为了获取有关返回的第一个图像的元数据，我们可以向 Glance 服务器发出 `HEAD` 请求以获取图像的 URI。

We issue a `HEAD` request to `http://glance.openstack.example.org/v1/images/71c675ab-d94f-49cd-a114-e12490b328d9` to retrieve complete metadata for that image. The metadata is returned as a set of HTTP headers that begin with the prefix `x-image-meta-`. The following shows an example of the HTTP headers returned from the above `HEAD` request:
我们发出请求 `HEAD` 以 `http://glance.openstack.example.org/v1/images/71c675ab-d94f-49cd-a114-e12490b328d9` 检索该图像的完整元数据。元数据以前缀 `x-image-meta-` . 开头的一组 HTTP 标头返回。下面显示了从上述 `HEAD` 请求返回的 HTTP 标头的示例：

```
x-image-meta-uri              http://glance.openstack.example.org/v1/images/71c675ab-d94f-49cd-a114-e12490b328d9
x-image-meta-name             Ubuntu 10.04 Plain 5GB
x-image-meta-disk_format      vhd
x-image-meta-container_format ovf
x-image-meta-size             5368709120
x-image-meta-checksum         c2e5db72bd7fd153f53ede5da5a06de3
x-image-meta-created_at       2010-02-03 09:34:01
x-image-meta-updated_at       2010-02-03 09:34:01
x-image-meta-deleted_at
x-image-meta-status           available
x-image-meta-is_public        true
x-image-meta-min_ram          256
x-image-meta-min_disk         0
x-image-meta-owner            null
x-image-meta-property-distro  Ubuntu 10.04 LTS
```



 

Note 注意



All timestamps returned are in UTC.
返回的所有时间戳均采用 UTC 格式。

The x-image-meta-updated_at timestamp is the timestamp when an image’s metadata was last updated, not its image data, as all image data is immutable once stored in Glance.
x-image-meta-updated_at 时间戳是上次更新图像元数据的时间戳，而不是其图像数据，因为所有图像数据一旦存储在 Glance 中，都是不可变的。

There may be multiple headers that begin with the prefix x-image-meta-property-. These headers are free-form key/value pairs that have been saved with the image metadata. The key is the string after x-image-meta-property- and the value is the value of the header.
可能有多个以前缀 x-image-meta-property- 开头的标头。这些标头是与图像元数据一起保存的自由格式键/值对。键是 x-image-meta-property- 后面的字符串，值是标头的值。

The response’s ETag header will always be equal to the x-image-meta-checksum value.
响应的 ETag 标头将始终等于 x-image-meta-checksum 值。

The response’s x-image-meta-is_public value is a boolean indicating whether the image is publicly available.
响应的 x-image-meta-is_public 值是一个布尔值，指示图像是否公开可用。

The response’s x-image-meta-owner value is a string which may either be null or which will indicate the owner of the image.
响应的 x-image-meta-owner 值是一个字符串，该字符串可以是 null 的，也可以指示图像的所有者。

### Retrieve Raw Image Data 检索原始图像数据 ¶

We want to retrieve that actual raw data for a specific virtual machine image that the Glance server knows about.
我们想要检索 Glance 服务器知道的特定虚拟机映像的实际原始数据。

We have queried the Glance server for a list of images and the data returned includes the uri field for each available image. This uri field value contains the exact location needed to get the metadata for a specific image.
我们已经在 Glance 服务器中查询了图像列表，返回的数据包括每个可用图像的 uri 字段。此 uri 字段值包含获取特定图像的元数据所需的确切位置。

Continuing the example from above, in order to get metadata about the first image returned, we can issue a `HEAD` request to the Glance server for the image’s URI.
继续上面的示例，为了获取有关返回的第一个图像的元数据，我们可以向 Glance 服务器发出 `HEAD` 请求以获取图像的 URI。

We issue a `GET` request to `http://glance.openstack.example.org/v1/images/71c675ab-d94f-49cd-a114-e12490b328d9` to retrieve metadata for that image as well as the image itself encoded into the response body.
我们发出一个 `GET` 请求，以 `http://glance.openstack.example.org/v1/images/71c675ab-d94f-49cd-a114-e12490b328d9` 检索该图像的元数据以及编码到响应正文中的图像本身。

The metadata is returned as a set of HTTP headers that begin with the prefix `x-image-meta-`. The following shows an example of the HTTP headers returned from the above `GET` request:
元数据以前缀 `x-image-meta-` . 开头的一组 HTTP 标头返回。下面显示了从上述 `GET` 请求返回的 HTTP 标头的示例：

```
x-image-meta-uri              http://glance.openstack.example.org/v1/images/71c675ab-d94f-49cd-a114-e12490b328d9
x-image-meta-name             Ubuntu 10.04 Plain 5GB
x-image-meta-disk_format      vhd
x-image-meta-container_format ovf
x-image-meta-size             5368709120
x-image-meta-checksum         c2e5db72bd7fd153f53ede5da5a06de3
x-image-meta-created_at       2010-02-03 09:34:01
x-image-meta-updated_at       2010-02-03 09:34:01
x-image-meta-deleted_at
x-image-meta-status           available
x-image-meta-is_public        true
x-image-meta-min_ram          256
x-image-meta-min_disk         5
x-image-meta-owner            null
x-image-meta-property-distro  Ubuntu 10.04 LTS
```



 

Note 注意



All timestamps returned are in UTC.
返回的所有时间戳均采用 UTC 格式。

The x-image-meta-updated_at timestamp is the timestamp when an image’s metadata was last updated, not its image data, as all image data is immutable once stored in Glance.
x-image-meta-updated_at 时间戳是上次更新图像元数据的时间戳，而不是其图像数据，因为所有图像数据一旦存储在 Glance 中，都是不可变的。

There may be multiple headers that begin with the prefix x-image-meta-property-. These headers are free-form key/value pairs that have been saved with the image metadata. The key is the string after x-image-meta-property- and the value is the value of the header.
可能有多个以前缀 x-image-meta-property- 开头的标头。这些标头是与图像元数据一起保存的自由格式键/值对。键是 x-image-meta-property- 后面的字符串，值是标头的值。

The response’s Content-Length header shall be equal to the value of the x-image-meta-size header.
响应的 Content-Length 标头应等于 x-image-meta-size 标头的值。

The response’s ETag header will always be equal to the x-image-meta-checksum value.
响应的 ETag 标头将始终等于 x-image-meta-checksum 值。

The response’s x-image-meta-is_public value is a boolean indicating whether the image is publicly available.
响应的 x-image-meta-is_public 值是一个布尔值，指示图像是否公开可用。

The response’s x-image-meta-owner value is a string which may either be null or which will indicate the owner of the image.
响应的 x-image-meta-owner 值是一个字符串，该字符串可以是 null 的，也可以指示图像的所有者。

The image data itself will be the body of the HTTP response returned from the request, which will have content-type of application/octet-stream.
图像数据本身将是请求返回的 HTTP 响应的正文，其内容类型为 application/octet-stream。

### Add a New Image 添加新镜像 ¶

We have created a new virtual machine image in some way (created a “golden image” or snapshotted/backed up an existing image) and we wish to do two things:
我们以某种方式创建了一个新的虚拟机映像（创建了一个“黄金映像”或快照/备份了现有映像），我们希望做两件事：

- Store the disk image data in Glance
  将磁盘映像数据存储在 Glance 中
- Store metadata about this image in Glance
  在 Glance 中存储有关此图像的元数据

We can do the above two activities in a single call to the Glance API. Assuming, like in the examples above, that a Glance API server is running at `http://glance.openstack.example.org`, we issue a `POST` request to add an image to Glance:
我们可以在对 Glance API 的单次调用中完成上述两个活动。假设，如上面的示例中所示，Glance API 服务器正在运行 `http://glance.openstack.example.org` ，我们发出向 Glance 添加图像 `POST` 的请求：

```
POST http://glance.openstack.example.org/v1/images
```

The metadata about the image is sent to Glance in HTTP headers. The body of the HTTP request to the Glance API will be the MIME-encoded disk image data.
有关图像的元数据将在 HTTP 标头中发送到 Glance。对 Glance API 的 HTTP 请求的正文将是 MIME 编码的磁盘映像数据。

### Reserve a New Image 保留新镜像 ¶

We can also perform the activities described in [Add a New Image](https://docs.openstack.org/glance/2023.2/user/glanceapi.html#add-a-new-image) using two separate calls to the Image API; the first to register the image metadata, and the second to add the image disk data. This is known as “reserving” an image.
我们还可以使用对 Image API 的两次单独调用来执行添加新映像中描述的活动;第一个用于注册镜像元数据，第二个用于添加镜像盘数据。这称为“保留”映像。

The first call should be a `POST` to `http://glance.openstack.example.org/v1/images`, which will result in a new image id being registered with a status of `queued`:
第一个调用应该是 `POST` to `http://glance.openstack.example.org/v1/images` ，这将导致注册一个新的图像 id，其状态为 `queued` ：

```
{'image':
 {'status': 'queued',
  'id': '71c675ab-d94f-49cd-a114-e12490b328d9',
  ...}
 ...}
```

The image data can then be added using a `PUT` to `http://glance.openstack.example.org/v1/images/71c675ab-d94f-49cd-a114-e12490b328d9`. The image status will then be set to `active` by Glance.
然后，可以使用 `PUT` to `http://glance.openstack.example.org/v1/images/71c675ab-d94f-49cd-a114-e12490b328d9` 添加图像数据。然后 `active` ，图像状态将由 Glance 设置为。

**Image Metadata in HTTP Headers
HTTP 标头中的图像元数据**

Glance will view as image metadata any HTTP header that it receives in a `POST` request where the header key is prefixed with the strings `x-image-meta-` and `x-image-meta-property-`.
Glance 会将它在 `POST` 请求中收到的任何 HTTP 标头视为图像元数据，其中标头键以字符串 `x-image-meta-` 和 `x-image-meta-property-` .

The list of metadata headers that Glance accepts are listed below.
下面列出了 Glance 接受的元数据标头列表。

- `x-image-meta-name`

  This header is required, unless reserving an image. Its value should be the name of the image.
  除非保留图像，否则此标头是必需的。其值应为图像的名称。

  Note that the name of an image *is not unique to a Glance node*. It would be an unrealistic expectation of users to know all the unique names of all other user’s images.
  请注意，图像的名称对于 Glance 节点来说并不是唯一的。用户知道所有其他用户图像的所有唯一名称是不切实际的期望。

- `x-image-meta-id`

  This header is optional.
  此标头是可选的。

  When present, Glance will use the supplied identifier for the image. If the identifier already exists in that Glance node, then a **409 Conflict** will be returned by Glance. The value of the header must be a uuid in hexadecimal string notation (that is 71c675ab-d94f-49cd-a114-e12490b328d9).
  如果存在，Glance 将使用为图像提供的标识符。如果该 Glance 节点中已存在标识符，则 Glance 将返回 409  冲突。标头的值必须是十六进制字符串表示法的 uuid（即 71c675ab-d94f-49cd-a114-e12490b328d9）。

  When this header is *not* present, Glance will generate an identifier for the image and return this identifier in the response (see below).
  当此标头不存在时，Glance 将为图像生成一个标识符，并在响应中返回此标识符（见下文）。

- `x-image-meta-store`

  This header is optional. Valid values are one of `file`, `rbd`, `swift`, `cinder` or `vsphere`.
  此标头是可选的。有效值为 `file` 、 `rbd` 、 `swift` `cinder` 或 `vsphere` 之一。

  When present, Glance will attempt to store the disk image data in the backing store indicated by the value of the header. If the Glance node does not support the backing store, Glance will return a **400 Bad Request**.
  如果存在，Glance 将尝试将磁盘映像数据存储在由标头值指示的后备存储中。如果 Glance 节点不支持后备存储，那么 Glance 将返回 400 Bad Request。

  When not present, Glance will store the disk image data in the backing store that is marked as default. See the configuration option `default_store` for more information.
  如果不存在，Glance 会将磁盘映像数据存储在标记为默认的后备存储中。有关详细信息，请参阅配置选项 `default_store` 。

- `x-image-meta-disk_format`

  This header is required, unless reserving an image. Valid values are one of `aki`, `ari`, `ami`, `raw`, `iso`, `vhd`, `vhdx`, `vdi`, `qcow2`, `vmdk` or `ploop`.
  除非保留图像，否则此标头是必需的。有效值为 `aki` 、 `ari` 、 、 `ami` `raw` 、 `iso` `vhd` `vhdx` `vdi` `qcow2` `vmdk` 或 之一 `ploop` 。

  For more information, see [Disk and Container Formats](https://docs.openstack.org/glance/2023.2/user/formats.html#formats).
  有关详细信息，请参阅磁盘和容器格式。

- `x-image-meta-container_format`

  This header is required, unless reserving an image. Valid values are one of `aki`, `ari`, `ami`, `bare`, `ova`, `ovf`, or `docker`.
  除非保留图像，否则此标头是必需的。有效值为 `aki` 、 `ari` 、 `ami` 、 `bare` 、 `ova` 或 `ovf` 之一 `docker` 。

  For more information, see [Disk and Container Formats](https://docs.openstack.org/glance/2023.2/user/formats.html#formats).
  有关详细信息，请参阅磁盘和容器格式。

- `x-image-meta-size`

  This header is optional.
  此标头是可选的。

  When present, Glance assumes that the expected size of the request body will be the value of this header. If the length in bytes of the request body *does not match* the value of this header, Glance will return a **400 Bad Request**.
  如果存在，Glance 假定请求正文的预期大小将是此标头的值。如果请求正文的长度（以字节为单位）与此标头的值不匹配，Glance 将返回 400 错误请求。

  When not present, Glance will calculate the image’s size based on the size of the request body.
  如果不存在，Glance 将根据请求正文的大小计算图像的大小。

- `x-image-meta-checksum`

  This header is optional. When present, it specifies the **MD5** checksum of the image file data.
  此标头是可选的。如果存在，则指定映像文件数据的 MD5 校验和。

  When present, Glance will verify the checksum generated from the back-end store while storing your image against this value and return a **400 Bad Request** if the values do not match.
  如果存在，Glance 将验证从后端存储生成的校验和，同时根据此值存储图像，如果值不匹配，则返回 400 错误请求。

- `x-image-meta-is_public`

  This header is optional.
  此标头是可选的。

  When Glance finds the string “true” (case-insensitive), the image is marked as a public one, meaning that any user may view its metadata and may read the disk image from Glance.
  当 Glance 找到字符串“true”（不区分大小写）时，该映像将被标记为公共映像，这意味着任何用户都可以查看其元数据并从 Glance 读取磁盘映像。

  When not present, the image is assumed to be *not public* and owned by a user.
  如果不存在，则假定图像不是公共的，并且归用户所有。

- `x-image-meta-min_ram`

  This header is optional. When present, it specifies the minimum amount of RAM in megabytes required to run this image on a server.
  此标头是可选的。如果存在，它指定在服务器上运行此映像所需的最小 RAM 量（以 MB 为单位）。

  When not present, the image is assumed to have a minimum RAM requirement of 0.
  如果不存在，则假定映像的最低 RAM 要求为 0。

- `x-image-meta-min_disk`

  This header is optional. When present, it specifies the expected minimum disk space in gigabytes required to run this image on a server.
  此标头是可选的。如果存在，它指定在服务器上运行此映像所需的预期最小磁盘空间（以 GB 为单位）。

  When not present, the image is assumed to have a minimum disk space requirement of 0.
  如果不存在，则假定映像的最小磁盘空间要求为 0。

- `x-image-meta-owner`

  This header is optional and only meaningful for admins.
  此标头是可选的，仅对管理员有意义。

  Glance sets the owner of an image to be the project of the authenticated user issuing the request. However, if the authenticated user has the Admin role, this default may be overridden by setting this header to null or to a string identifying the owner of the image.
  Glance 将图像的所有者设置为发出请求的经过身份验证的用户的项目。但是，如果经过身份验证的用户具有管理员角色，则可以通过将此标头设置为 null 或标识映像所有者的字符串来覆盖此默认值。

- `x-image-meta-property-*`

  When Glance receives any HTTP header whose key begins with the string prefix `x-image-meta-property-`, Glance adds the key and value to a set of custom, free-form image properties stored with the image. The key is a lower-cased string following the prefix `x-image-meta-property-` with dashes and punctuation replaced with underscores.
  当 Glance 收到任何 HTTP 标头时，其键以字符串前缀 `x-image-meta-property-` 开头，Glance 会将键和值添加到与图像一起存储的一组自定义自由格式图像属性中。键是前缀 `x-image-meta-property-` 后面的小写字符串，用破折号和标点符号替换为下划线。

  For example, if the following HTTP header were sent:
  例如，如果发送了以下 HTTP 标头：

  ```
  x-image-meta-property-distro  Ubuntu 10.10
  ```

  then a key/value pair of “distro”/”Ubuntu 10.10” will be stored with the image in Glance.
  然后，“distro”/“Ubuntu 10.10”的键/值对将与图像一起存储在 Glance 中。

  There is no limit on the number of free-form key/value attributes that can be attached to the image. However, keep in mind that the 8K limit on the size of all the HTTP headers sent in a request will effectively limit the number of image properties.
  可以附加到图像的自由格式键/值属性的数量没有限制。但是，请记住，对请求中发送的所有 HTTP 标头大小的 8K 限制将有效地限制图像属性的数量。

### Update an Image 更新镜像 ¶

Glance will consider any HTTP header that it receives in a `PUT` request as an instance of image metadata. In this case, the header key should be prefixed with the strings `x-image-meta-` and `x-image-meta-property-`.
Glance 会将其在 `PUT` 请求中收到的任何 HTTP 标头视为图像元数据的实例。在这种情况下，标头键应以字符串 `x-image-meta-` 和 `x-image-meta-property-` .

If an image was previously reserved, and thus is in the `queued` state, then image data can be added by including it as the request body. If the image already has data associated with it (for example, it is not in the `queued` state), then including a request body will result in a **409 Conflict** exception.
如果映像之前已保留，因此处于该 `queued` 状态，则可以通过将其作为请求正文来添加映像数据。如果映像已具有与其关联的数据（例如，它不在状态 `queued` 中），则包含请求正文将导致 409 冲突异常。

On success, the `PUT` request will return the image metadata encoded as HTTP headers.
成功后， `PUT` 请求将返回编码为 HTTP 标头的图像元数据。

See more about image statuses here: [Image Statuses](https://docs.openstack.org/glance/2023.2/user/statuses.html#image-statuses)
在此处查看有关映像状态的更多信息：映像状态

### List Image Memberships 列出图像成员资格 ¶

We want to see a list of projects that may access a given virtual machine image that the Glance server knows about. We take the uri field of the image data, append `/members` to it, and issue a `GET` request on the resulting URL.
我们希望查看可以访问 Glance 服务器知道的给定虚拟机映像的项目列表。我们获取图像数据的 uri 字段，附加 `/members` 到该字段，并在生成的 URL 上发出 `GET` 请求。

Continuing from the example above, in order to get the memberships for the first image returned, we can issue a `GET` request to the Glance server for `http://glance.openstack.example.org/v1/images/71c675ab-d94f-49cd-a114-e12490b328d9/members`. And we will get back JSON data such as the following:
从上面的示例继续，为了获得返回的第一个图像的成员资格，我们可以向 Glance 服务器发出 `GET` `http://glance.openstack.example.org/v1/images/71c675ab-d94f-49cd-a114-e12490b328d9/members` .我们将取回 JSON 数据，如下所示：

```
{'members': [
 {'member_id': 'project1',
  'can_share': false}
 ...]}
```

The member_id field identifies a project with which the image is shared. If that project is authorized to further share the image, the can_share field is true.
member_id字段标识与之共享映像的项目。如果该项目被授权进一步共享图像，则can_share字段为 true。

### List Shared Images 列出共享图片 ¶

We want to see a list of images which are shared with a given project. We issue a `GET` request to `http://glance.openstack.example.org/v1/shared-images/project1`. We will get back JSON data such as the following:
我们希望查看与给定项目共享的图像列表。我们向 发出 `GET` 请求 `http://glance.openstack.example.org/v1/shared-images/project1` 。我们将取回 JSON 数据，如下所示：

```
{'shared_images': [
 {'image_id': '71c675ab-d94f-49cd-a114-e12490b328d9',
  'can_share': false}
 ...]}
```

The image_id field identifies an image shared with the project named by *member_id*. If the project is authorized to further share the image, the can_share field is true.
image_id 字段标识与由 member_id 命名的项目共享的图像。如果项目被授权进一步共享图像，则can_share字段为 true。

### Add a Member to an Image 为镜像添加成员 ¶

We want to authorize a project to access a private image. We issue a `PUT` request to `http://glance.openstack.example.org/v1/images/71c675ab-d94f-49cd-a114-e12490b328d9/members/project1`. With no body, this will add the membership to the image, leaving existing memberships unmodified and defaulting new memberships to have can_share set to false. We may also optionally attach a body of the following form:
我们想要授权一个项目访问私有镜像。我们向 发出 `PUT` 请求 `http://glance.openstack.example.org/v1/images/71c675ab-d94f-49cd-a114-e12490b328d9/members/project1` 。如果没有正文，这会将成员身份添加到映像中，使现有成员身份保持不变，并且默认新成员身份can_share设置为 false。我们还可以选择附上以下形式的正文：

```
{'member':
 {'can_share': true}
}
```

If such a body is provided, both existing and new memberships will have can_share set to the provided value (either true or false). This query will return a 204 (“No Content”) status code.
如果提供了这样的正文，则现有成员身份和新成员身份都将can_share设置为提供的值（true 或 false）。此查询将返回 204（“无内容”）状态代码。

### Remove a Member from an Image 从图像中删除成员 ¶

We want to revoke a project’s right to access a private image. We issue a `DELETE` request to `http://glance.openstack.example.org/v1/images/1/members/project1`. This query will return a 204 (“No Content”) status code.
我们想要撤销项目访问私有映像的权限。我们向 发出 `DELETE` 请求 `http://glance.openstack.example.org/v1/images/1/members/project1` 。此查询将返回 204（“无内容”）状态代码。

### Replace a Membership List for an Image 替换图像的成员列表 ¶

The full membership list for a given image may be replaced. We issue a `PUT` request to `http://glance.openstack.example.org/v1/images/71c675ab-d94f-49cd-a114-e12490b328d9/members` with a body of the following form:
给定映像的完整成员资格列表可能会被替换。我们 `http://glance.openstack.example.org/v1/images/71c675ab-d94f-49cd-a114-e12490b328d9/members` 向以下形式发出 `PUT` 请求：

```
{'memberships': [
 {'member_id': 'project1',
  'can_share': false}
 ...]}
```

All existing memberships which are not named in the replacement body are removed, and those which are named have their can_share settings changed as specified. (The can_share setting may be omitted, which will cause that setting to remain unchanged in the existing memberships.) All new memberships will be created, with can_share defaulting to false unless it is specified otherwise.
所有未在替换正文中命名的现有成员资格都将被删除，而已命名的成员资格将按指定方式更改其can_share设置。（可以省略can_share设置，这将导致该设置在现有成员资格中保持不变。将创建所有新成员身份，除非另有说明，否则can_share默认为 false。

## Image Membership Changes in Version 2.0 2.0 版中的映像成员资格更改 ¶

Version 2.0 of the Images API eliminates the `can_share` attribute of image membership. In the version 2.0 model, image sharing is not transitive.
映像 API 版本 2.0 删除了映像成员资格 `can_share` 的属性。在版本 2.0 模型中，映像共享不是可传递的。

In version 2.0, image members have a `status` attribute that reflects how the image should be treated with respect to that image member’s image-list.
在版本 2.0 中，image 成员具有一个 `status` 属性，该属性反映了相对于该映像成员的 image-list 应如何处理映像。

- The `status` attribute may have one of three values: `pending`, `accepted`, or `rejected`.
  该 `status` 属性可以具有以下三个值之一： `pending` 、 `accepted` 或 `rejected` 。
- By default, only those shared images with status `accepted` are included in an image member’s image-list.
  默认情况下，只有那些具有状态 `accepted` 的共享映像才会包含在映像成员的映像列表中。
- Only an image member may change his/her own membership status.
  只有图像会员可以更改他/她自己的会员身份。
- Only an image owner may create members on an image. The status of a newly created image member is `pending`. The image owner cannot change the status of a member.
  只有映像所有者才能在映像上创建成员。新创建的镜像成员的状态为 `pending` 。映像所有者无法更改成员的状态。

### Distinctions from Version 1.x API Calls 与版本 1.x API 调用的区别 ¶

- The response to a request to list the members of an image has changed.
  对列出映像成员的请求的响应已更改。

  call: `GET` on `/v2/images/{imageId}/members`
  呼叫： `GET` 开 `/v2/images/{imageId}/members` 

  response: see the JSON schema at `/v2/schemas/members`
  response：请参阅 JSON 架构 `/v2/schemas/members` 

- The request body in the call to create an image member has changed.
  用于创建映像成员的调用中的请求正文已更改。

  call: `POST` to `/v2/images/{imageId}/members`
  调用： `POST` 至 `/v2/images/{imageId}/members` 

  request body: 请求正文：

  ```
  { "member": "<MEMBER_ID>" }
  ```

  where the {memberId} is the project ID of the image member.
  其中 {memberId} 是映像成员的项目 ID。

  The member status of a newly created image member is `pending`.
  新创建的镜像成员的会员状态为 `pending` 。

### New API Calls 新的 API 调用 ¶

- Change the status of an image member
  更改映像成员的状态

  call: `PUT` on  `/v2/images/{imageId}/members/{memberId}`
  呼叫： `PUT` 开 `/v2/images/{imageId}/members/{memberId}` 

  request body: 请求正文：

  ```
  { "status": "<STATUS_VALUE>" }
  ```

  where <STATUS_VALUE> is `pending`, `accepted`, or `rejected`. The {memberId} is the project ID of the image member.
  其中  是 `pending` 、 `accepted` 或 `rejected` 。{memberId} 是镜像成员的项目 ID。

## Resource Limits 资源限制 ¶

A user should always expect that an HTTP 413 error could result from any operation, indicating that a resource consumption limit has been exceeded. Some of the common situations are detailed below:
用户应始终预料到任何操作都可能导致 HTTP 413 错误，表明已超出资源消耗限制。下面详细介绍了一些常见情况：

- Creating an image: If your administrator has limited the total number of images that you can have, an image create may fail. Delete another image to proceed.
  创建映像：如果管理员限制了您可以拥有的映像总数，则映像创建可能会失败。删除另一张图片以继续。
- Uploading data to an image: If you have exceeded the total amount of image storage space allocated to you, then an upload may be rejected. To proceed, delete another image of sufficient size. Images with multiple locations count multiple times against your quota, so deleting a location may also free up space. There is also a quota on the number of upload operations (staging, copying, and uploading all count against this) so you may need to wait for other operations to complete before proceeding.
  将数据上传到图像：如果超出分配给您的图像存储空间总量，则上传可能会被拒绝。要继续，请删除另一张足够大小的图像。具有多个位置的图片会多次计入配额，因此删除某个位置可能会释放空间。上传操作的数量（暂存、复制和上传都计入此限制）也有配额，因此您可能需要等待其他操作完成才能继续。
- Staging data for an image: There is a separate quota on the amount of data you may have staged at any given point. To proceed, finish importing other images first or delete an image with staged data.
  暂存图像的数据：在任何给定时间点，您可能已暂存的数据量有一个单独的配额。要继续，请先完成导入其他图像或删除包含暂存数据的图像。
- Importing an image: If importing an image from staging to its final destination would overrun your total image storage quota, then the import may fail. To proceed, delete other images to make space.
  导入映像：如果将映像从暂存导入到其最终目标会超出总映像存储配额，则导入可能会失败。要继续，请删除其他图像以腾出空间。

Of course, in all over-limit situations, requesting more quota from your administrator may be an option.
当然，在所有超限情况下，向管理员请求更多配额可能是一种选择。

## Images v2 Stores API 镜像 v2 商店 API ¶

Version 2.10 of the OpenStack Images API introduces new /v2/stores/ endpoint when multiple stores is configured. The endpoint is used to delete image from specific store.
OpenStack Images API 的 2.10 版在配置多个存储时引入了新的 /v2/stores/ 端点。终结点用于从特定存储中删除映像。

### Delete from Store 从商店中删除 ¶

A user wants to delete image from specific store. The user issues a `DELETE` request to `/v2/stores/<STORE_ID>/<IMAGE_ID>`. NOTE: request body is not accepted.
用户想要从特定商店中删除图像。用户向 `/v2/stores/<STORE_ID>/<IMAGE_ID>` 发出 `DELETE` 请求。注意：不接受请求正文。

## Images v2 Tasks API 镜像 v2 任务 API ¶

Version 2 of the OpenStack Images API introduces a Task resource that is used to create and monitor long-running asynchronous image-related processes.  See the [Tasks](https://docs.openstack.org/glance/2023.2/admin/tasks.html#tasks) section of the Glance documentation for more information.
OpenStack 镜像 API 版本 2 引入了一个 Task 资源，用于创建和监控长时间运行的异步镜像相关进程。有关详细信息，请参阅 Glance 文档的“任务”部分。

The following Task calls are available:
可以使用以下任务调用：

### Create a Task 创建任务 ¶

A user wants to initiate a task.  The user issues a `POST` request to `/v2/tasks`.  The request body is of Content-type `application/json` and must contain the following fields:
用户想要启动任务。用户向 `/v2/tasks` 发出 `POST` 请求。请求正文为 Content-type `application/json` ，必须包含以下字段：

- `type`: a string specified by the enumeration defined in the Task schema
   `type` ：由 Task 架构中定义的枚举指定的字符串
- `input`: a JSON object.  The content is defined by the cloud provider who has exposed the endpoint being contacted
   `input` ：JSON 对象。内容由公开正在联系的终结点的云提供商定义

The response is a Task entity as defined by the Task schema.  It includes an `id` field that can be used in a subsequent call to poll the task for status changes.
响应是由 Task 架构定义的 Task 实体。它包括一个 `id` 字段，该字段可用于后续调用，以轮询任务的状态更改。

A task is created in `pending` status.
任务已创建 `pending` 状态。

### Show a Task 显示任务 ¶

A user wants to see detailed information about a task the user owns.  The user issues a `GET` request to `/v2/tasks/{taskId}`.
用户希望查看有关其拥有的任务的详细信息。用户向 `/v2/tasks/{taskId}` 发出 `GET` 请求。

The response is in `application/json` format.  The exact structure is given by the task schema located at `/v2/schemas/task`.
响应采用 `application/json` 格式。确切的结构由位于 的任务 `/v2/schemas/task` 架构给出。

### List Tasks 列出任务 ¶

A user wants to see what tasks have been created in his or her project.  The user issues a `GET` request to `/v2/tasks`.
用户想要查看在他或她的项目中创建了哪些任务。用户向 `/v2/tasks` 发出 `GET` 请求。

The response is in `application/json` format.  The exact structure is given by the task schema located at `/v2/schemas/tasks`.
响应采用 `application/json` 格式。确切的结构由位于 的任务 `/v2/schemas/tasks` 架构给出。

Note that, as indicated by the schema, the list of tasks is provided in a sparse format.  To see more information about a particular task in the list, the user would use the show task call described above.
请注意，如架构所示，任务列表以稀疏格式提供。若要查看有关列表中特定任务的详细信息，用户将使用上述 show task 调用。

### Filtering and Sorting the Tasks List 对任务列表进行过滤和排序 ¶

The `GET /v2/tasks` request takes query parameters that server to filter the returned list of tasks.  The following list details these query parameters.
该 `GET /v2/tasks` 请求采用该服务器的查询参数来筛选返回的任务列表。以下列表详细介绍了这些查询参数。

- `status={status}`

  Filters the list to display only those tasks in the specified status.  See the task schema or the [Task Statuses](https://docs.openstack.org/glance/2023.2/user/statuses.html#task-statuses) section of this documentation for the legal values to use for `{status}`.
  筛选列表以仅显示处于指定状态的任务。请参阅本文档的任务架构或“任务状态”部分，了解要用于 `{status}` 的合法值。

  For example, a request to `GET /v2/tasks?status=pending` would return only those tasks whose current status is `pending`.
  例如，请求 `GET /v2/tasks?status=pending` 将仅返回当前状态为 `pending` 的那些任务。

- `type={type}`

  Filters the list to display only those tasks of the specified type.  See the enumeration defined in the task schema for the legal values to use for `{type}`.
  筛选列表以仅显示指定类型的任务。请参阅任务架构中定义的枚举，了解要用于 `{type}` 的合法值。

  For example, a request to `GET /v2/tasks?type=import` would return only import tasks.
  例如，请求 `GET /v2/tasks?type=import` 将仅返回导入任务。

- `sort_dir={direction}`

  Sorts the list of tasks according to `updated_at` datetime.  Legal values are `asc` (ascending) and `desc` (descending).  By default, the task list is sorted by `created_at` time in descending chronological order.
  根据 `updated_at` 日期时间对任务列表进行排序。法定值为 `asc` （升序）和 `desc` （降序）。默认情况下，任务列表按 `created_at` 时间降序排序。

## API Message Localization API 消息本地化 ¶

Glance supports HTTP message localization. For example, an HTTP client can receive API messages in Chinese even if the locale language of the server is English.
Glance 支持 HTTP 消息本地化。例如，即使服务器的语言环境语言是英语，HTTP 客户端也可以接收中文的 API 消息。

### How to use it 如何使用它 ¶

To receive localized API messages, the HTTP client needs to specify the **Accept-Language** header to indicate the language that will translate the message. For more information about Accept-Language, please refer to http://www.w3.org/Protocols/rfc2616/rfc2616-sec14.html
若要接收本地化的 API 消息，HTTP 客户端需要指定 Accept-Language 标头以指示将翻译消息的语言。有关 Accept-Language  的更多信息，请参阅 http://www.w3.org/Protocols/rfc2616/rfc2616-sec14.html

A typical curl API request will be like below:
一个典型的 curl API 请求如下所示：

```
curl -i -X GET -H 'Accept-Language: zh' -H 'Content-Type: application/json'
http://glance.openstack.example.org/v2/images/aaa
```

Then the response will be like the following:
然后，响应将如下所示：

```
HTTP/1.1 404 Not Found
Content-Length: 234
Content-Type: text/html; charset=UTF-8
X-Openstack-Request-Id: req-54d403a0-064e-4544-8faf-4aeef086f45a
Date: Sat, 22 Feb 2014 06:26:26 GMT

<html>
<head>
<title>404 Not Found</title>
</head>
<body>
<h1>404 Not Found</h1>
&#25214;&#19981;&#21040;&#20219;&#20309;&#20855;&#26377;&#26631;&#35782; aaa &#30340;&#26144;&#20687;<br /><br />
</body>
</html>
```



 

Note 注意



Make sure to have a language package under /usr/share/locale-langpack/ on the target Glance server.
确保在目标 Glance 服务器上的 /usr/share/locale-langpack/ 下有一个语言包。

# Using Glance’s Client Tools 使用 Glance 的客户端工具

​                                  

The command-line tool and python library for Glance are both installed through the python-glanceclient project. Explore the following resources for more information:
Glance 的命令行工具和 python 库都是通过 python-glanceclient 项目安装的。有关详细信息，请浏览以下资源：

- [Official Docs 官方文档](https://docs.openstack.org/python-glanceclient/latest/)
- [Pypi Page Pypi页面](https://pypi.org/project/python-glanceclient/)
- [GitHub Project GitHub 项目](http://github.com/openstack/python-glanceclient)

# 使用 Glance 的元数据定义对公共 API 进行编目

​                                  

A common API hosted by the Glance service for vendors, admins, services, and users to meaningfully define available key / value pair and tag metadata. The intent is to enable better metadata collaboration across artifacts, services, and projects for OpenStack users.
由 Glance 服务托管的通用 API，供供应商、管理员、服务和用户有意义地定义可用的键/值对和标签元数据。其目的是为 OpenStack 用户实现跨工件、服务和项目更好的元数据协作。

This is about the definition of the available metadata that can be used on different types of resources (images, artifacts, volumes, flavors, aggregates, etc). A definition includes the properties type, its key, its description, and its constraints. This catalog will not store the values for specific instance properties.
这是关于可用于不同类型的资源（映像、工件、卷、风格、聚合等）的可用元数据的定义。定义包括属性类型、其键、其描述和约束。此目录不会存储特定实例属性的值。

For example, a definition of a virtual CPU topology property for number of cores will include the key to use, a description, and value constraints like requiring it to be an integer. So, a user, potentially through Horizon, would be able to search this catalog to list the available properties they can add to a flavor or image. They will see the virtual CPU topology property in the list and know that it must be an integer. In the Horizon example, when the user adds the property, its key and value will be stored in the service that owns that resource (Nova for flavors and in Glance for images).
例如，内核数的虚拟 CPU 拓扑属性的定义将包括要使用的键、描述和值约束，例如要求它为整数。因此，用户（可能通过  Horizon）将能够搜索此目录，以列出他们可以添加到特定风格或映像的可用属性。他们将在列表中看到虚拟 CPU  拓扑属性，并知道它必须是一个整数。在 Horizon  示例中，当用户添加属性时，其键和值将存储在拥有该资源的服务中（Nova（用于风格），Glance 用于图像）。

Diagram: https://wiki.openstack.org/w/images/b/bb/Glance-Metadata-API.png
图：https://wiki.openstack.org/w/images/b/bb/Glance-Metadata-API.png

Glance Metadata Definitions Catalog implementation started with API version v2.
Glance 元数据定义目录实现从 API 版本 v2 开始。

## Authentication 身份验证 ¶

Glance depends on Keystone and the OpenStack Identity API to handle authentication of clients. You must obtain an authentication token from Keystone send it along with all API requests to Glance through the `X-Auth-Token` header. Glance will communicate back to Keystone to verify the token validity and obtain your identity credentials.
Glance 依赖于 Keystone 和 OpenStack Identity API 来处理客户端的身份验证。您必须从 Keystone 获取身份验证令牌，然后通过 `X-Auth-Token` 标头将其与所有 API 请求一起发送到 Glance。Glance 将与 Keystone 通信，以验证令牌有效性并获取您的身份凭证。

See [Authentication With Keystone](https://docs.openstack.org/glance/2023.2/admin/authentication.html#authentication) for more information on integrating with Keystone.
有关与 Keystone 集成的更多信息，请参阅使用 Keystone 进行身份验证。

## Using v2.X 使用 v2。X ¶

For the purpose of examples, assume there is a Glance API server running at the URL `http://glance.openstack.example.org` on the default port 80.
出于示例的目的，假设有一个 Glance API 服务器在默认端口 80 上的 URL `http://glance.openstack.example.org` 上运行。

### List Available Namespaces 列出可用的命名空间 ¶

We want to see a list of available namespaces that the authenticated user has access to. This includes namespaces owned by the user, namespaces shared with the user and public namespaces.
我们希望查看经过身份验证的用户有权访问的可用命名空间的列表。这包括用户拥有的命名空间、与用户共享的命名空间和公共命名空间。

We issue a `GET` request to `http://glance.openstack.example.org/v2/metadefs/namespaces` to retrieve this list of available namespaces. The data is returned as a JSON-encoded mapping in the following format:
我们发出请求 `GET` 以 `http://glance.openstack.example.org/v2/metadefs/namespaces` 检索此可用命名空间列表。数据以 JSON 编码的映射形式返回，格式如下：

```
{
  "namespaces": [
      {
          "namespace": "MyNamespace",
          "display_name": "My User Friendly Namespace",
          "description": "My description",
          "visibility": "public",
          "protected": true,
          "owner": "The Test Owner",
          "self": "/v2/metadefs/namespaces/MyNamespace",
          "schema": "/v2/schemas/metadefs/namespace",
          "created_at": "2014-08-28T17:13:06Z",
          "updated_at": "2014-08-28T17:13:06Z",
          "resource_type_associations": [
              {
                  "name": "OS::Nova::Aggregate",
                  "created_at": "2014-08-28T17:13:06Z",
                  "updated_at": "2014-08-28T17:13:06Z"
              },
              {
                  "name": "OS::Nova::Flavor",
                  "prefix": "aggregate_instance_extra_specs:",
                  "created_at": "2014-08-28T17:13:06Z",
                  "updated_at": "2014-08-28T17:13:06Z"
              }
          ]
      }
  ],
  "first": "/v2/metadefs/namespaces?sort_key=created_at&sort_dir=asc",
  "schema": "/v2/schemas/metadefs/namespaces"
}
```



 

Note 注意



Listing namespaces will only show the summary of each namespace including counts and resource type associations. Detailed response including all its objects definitions, property definitions etc. will only be available on each individual GET namespace request.
列出命名空间将仅显示每个命名空间的摘要，包括计数和资源类型关联。详细的响应，包括其所有对象定义、属性定义等，将仅在每个单独的 GET 命名空间请求上可用。

### Filtering Namespaces Lists 过滤命名空间列表 ¶

`GET /v2/metadefs/namespaces` requests take query parameters that serve to filter the returned list of namespaces. The following list details these query parameters.
 `GET /v2/metadefs/namespaces` 请求采用查询参数，用于筛选返回的命名空间列表。以下列表详细介绍了这些查询参数。

- `resource_types=RESOURCE_TYPES`

  Filters namespaces having a `resource_types` within the list of comma separated `RESOURCE_TYPES`.
  筛选列表中以 `resource_types` 逗号分隔 `RESOURCE_TYPES` 的命名空间。

GET resource also accepts additional query parameters:
GET 资源还接受其他查询参数：

- `sort_key=KEY`

  Results will be ordered by the specified sort attribute `KEY`. Accepted values include `namespace`, `created_at` (default) and `updated_at`.
  结果将按指定的 sort 属性 `KEY` 进行排序。接受的值包括 `namespace` 、 `created_at` （默认值）和 `updated_at` 。

- `sort_dir=DIR`

  Results will be sorted in the direction `DIR`. Accepted values are `asc` for ascending or `desc` (default) for descending.
  结果将按 方向 `DIR` 排序。接受的值用于 `asc` 升序或 `desc` （默认）降序。

- `marker=NAMESPACE`

  A namespace identifier marker may be specified. When present only namespaces which occur after the identifier `NAMESPACE` will be listed, i.e. the namespaces which have a sort_key later than that of the marker `NAMESPACE` in the sort_dir direction.
  可以指定命名空间标识符标记。当存在时， `NAMESPACE` 只会列出在标识符之后出现的命名空间，即在sort_dir方向上比标记 `NAMESPACE` 晚sort_key的命名空间。

- `limit=LIMIT`

  When present the maximum number of results returned will not exceed `LIMIT`.
  如果存在，返回的最大结果数不会超过 `LIMIT` 。



 

Note 注意



If the specified `LIMIT` exceeds the operator defined limit (api_limit_max) then the number of results returned may be less than `LIMIT`.
如果指定的 `LIMIT` 超过运算符定义的限制 （api_limit_max），则返回的结果数可能小于 `LIMIT` 。

- `visibility=PUBLIC`

  An admin user may use the visibility parameter to control which results are returned (PRIVATE or PUBLIC).
  管理员用户可以使用 visibility 参数来控制返回的结果（PRIVATE 或 PUBLIC）。

### Retrieve Namespace 检索命名空间 ¶

We want to see a more detailed information about a namespace that the authenticated user has access to. The detail includes the properties, objects, and resource type associations.
我们希望看到有关经过身份验证的用户有权访问的命名空间的更多详细信息。详细信息包括属性、对象和资源类型关联。

We issue a `GET` request to `http://glance.openstack.example.org/v2/metadefs/namespaces/{namespace}` to retrieve the namespace details. The data is returned as a JSON-encoded mapping in the following format:
我们发出请求 `GET` 以 `http://glance.openstack.example.org/v2/metadefs/namespaces/{namespace}` 检索命名空间详细信息。数据以 JSON 编码的映射形式返回，格式如下：

```
{
  "namespace": "MyNamespace",
  "display_name": "My User Friendly Namespace",
  "description": "My description",
  "visibility": "public",
  "protected": true,
  "owner": "The Test Owner",
  "schema": "/v2/schemas/metadefs/namespace",
  "resource_type_associations": [
      {
          "name": "OS::Glance::Image",
          "prefix": "hw_",
          "created_at": "2014-08-28T17:13:06Z",
          "updated_at": "2014-08-28T17:13:06Z"
      },
      {
          "name": "OS::Cinder::Volume",
          "prefix": "hw_",
          "properties_target": "image",
          "created_at": "2014-08-28T17:13:06Z",
          "updated_at": "2014-08-28T17:13:06Z"
      },
      {
          "name": "OS::Nova::Flavor",
          "prefix": "filter1:",
          "created_at": "2014-08-28T17:13:06Z",
          "updated_at": "2014-08-28T17:13:06Z"
      }
  ],
  "properties": {
      "nsprop1": {
          "title": "My namespace property1",
          "description": "More info here",
          "type": "boolean",
          "default": true
      },
      "nsprop2": {
          "title": "My namespace property2",
          "description": "More info here",
          "type": "string",
          "default": "value1"
      }
  },
  "objects": [
      {
          "name": "object1",
          "description": "my-description",
          "self": "/v2/metadefs/namespaces/MyNamespace/objects/object1",
          "schema": "/v2/schemas/metadefs/object",
          "created_at": "2014-08-28T17:13:06Z",
          "updated_at": "2014-08-28T17:13:06Z",
          "required": [],
          "properties": {
              "prop1": {
                  "title": "My object1 property1",
                  "description": "More info here",
                  "type": "array",
                  "items": {
                      "type": "string"
                  }
              }
          }
      },
      {
          "name": "object2",
          "description": "my-description",
          "self": "/v2/metadefs/namespaces/MyNamespace/objects/object2",
          "schema": "/v2/schemas/metadefs/object",
          "created_at": "2014-08-28T17:13:06Z",
          "updated_at": "2014-08-28T17:13:06Z",
          "properties": {
              "prop1": {
                  "title": "My object2 property1",
                  "description": "More info here",
                  "type": "integer",
                  "default": 20
              }
          }
      }
  ]
}
```

### Retrieve available Resource Types 检索可用的资源类型 ¶

We want to see the list of all resource types that are available in Glance
我们希望查看 Glance 中可用的所有资源类型的列表

We issue a `GET` request to `http://glance.openstack.example.org/v2/metadefs/resource_types` to retrieve all resource types.
我们发出请求 `GET` 以 `http://glance.openstack.example.org/v2/metadefs/resource_types` 检索所有资源类型。

The data is returned as a JSON-encoded mapping in the following format:
数据以 JSON 编码的映射形式返回，格式如下：

```
{
  "resource_types": [
      {
          "created_at": "2014-08-28T17:13:04Z",
          "name": "OS::Glance::Image",
          "updated_at": "2014-08-28T17:13:04Z"
      },
      {
          "created_at": "2014-08-28T17:13:04Z",
          "name": "OS::Cinder::Volume",
          "updated_at": "2014-08-28T17:13:04Z"
      },
      {
          "created_at": "2014-08-28T17:13:04Z",
          "name": "OS::Nova::Flavor",
          "updated_at": "2014-08-28T17:13:04Z"
      },
      {
          "created_at": "2014-08-28T17:13:04Z",
          "name": "OS::Nova::Aggregate",
          "updated_at": "2014-08-28T17:13:04Z"
      },
      {
          "created_at": "2014-08-28T17:13:04Z",
          "name": "OS::Nova::Server",
          "updated_at": "2014-08-28T17:13:04Z"
      }
  ]
}
```

### Retrieve Resource Types associated with a Namespace 检索与命名空间关联的资源类型 ¶

We want to see the list of resource types that are associated for a specific namespace
我们希望查看与特定命名空间关联的资源类型的列表

We issue a `GET` request to `http://glance.openstack.example.org/v2/metadefs/namespaces/{namespace}/resource_types` to retrieve resource types.
我们发出请求 `GET` 以 `http://glance.openstack.example.org/v2/metadefs/namespaces/{namespace}/resource_types` 检索资源类型。

The data is returned as a JSON-encoded mapping in the following format:
数据以 JSON 编码的映射形式返回，格式如下：

```
{
  "resource_type_associations" : [
      {
         "name" : "OS::Glance::Image",
         "prefix" : "hw_",
         "created_at": "2014-08-28T17:13:04Z",
         "updated_at": "2014-08-28T17:13:04Z"
      },
      {
         "name" :"OS::Cinder::Volume",
         "prefix" : "hw_",
         "properties_target" : "image",
         "created_at": "2014-08-28T17:13:04Z",
         "updated_at": "2014-08-28T17:13:04Z"
      },
      {
         "name" : "OS::Nova::Flavor",
         "prefix" : "hw:",
         "created_at": "2014-08-28T17:13:04Z",
         "updated_at": "2014-08-28T17:13:04Z"
      }
  ]
}
```

### Add Namespace 添加命名空间 ¶

We want to create a new namespace that can contain the properties, objects, etc.
我们想创建一个可以包含属性、对象等的新命名空间。

We issue a `POST` request to add an namespace to Glance:
我们发出向 Glance 添加命名空间 `POST` 的请求：

```
POST http://glance.openstack.example.org/v2/metadefs/namespaces/
```

The input data is an JSON-encoded mapping in the following format:
输入数据是 JSON 编码的映射，格式如下：

```
{
  "namespace": "MyNamespace",
  "display_name": "My User Friendly Namespace",
  "description": "My description",
  "visibility": "public",
  "protected": true
}
```



 

Note 注意



Optionally properties, objects and resource type associations could be added in the same input. See GET Namespace output above(input will be similar).
（可选）可以在同一输入中添加属性、对象和资源类型关联。请参阅上面的 GET Namespace 输出（输入将类似）。

### Update Namespace 更新命名空间 ¶

We want to update an existing namespace
我们想要更新现有命名空间

We issue a `PUT` request to update an namespace to Glance:
我们发出一个 `PUT` 请求，将命名空间更新到 Glance：

```
PUT http://glance.openstack.example.org/v2/metadefs/namespaces/{namespace}
```

The input data is similar to Add Namespace
输入数据类似于“添加命名空间”

### Delete Namespace 删除命名空间 ¶

We want to delete an existing namespace including all its objects, properties etc.
我们想要删除一个现有的命名空间，包括它的所有对象、属性等。

We issue a `DELETE` request to delete an namespace to Glance:
我们向 Glance 发出删除命名空间 `DELETE` 的请求：

```
DELETE http://glance.openstack.example.org/v2/metadefs/namespaces/{namespace}
```

### Associate Resource Type with Namespace 将资源类型与命名空间关联 ¶

We want to associate a resource type with an existing namespace
我们希望将资源类型与现有命名空间相关联

We issue a `POST` request to associate resource type to Glance:
我们发出一个 `POST` 请求，将资源类型关联到 Glance：

```
POST http://glance.openstack.example.org/v2/metadefs/namespaces/{namespace}/resource_types
```

The input data is an JSON-encoded mapping in the following format:
输入数据是 JSON 编码的映射，格式如下：

```
{
        "name" :"OS::Cinder::Volume",
        "prefix" : "hw_",
        "properties_target" : "image",
        "created_at": "2014-08-28T17:13:04Z",
        "updated_at": "2014-08-28T17:13:04Z"
}
```

### Remove Resource Type associated with a Namespace 删除与命名空间关联的资源类型 ¶

We want to de-associate namespace from a resource type
我们想要取消命名空间与资源类型的关联

We issue a `DELETE` request to de-associate namespace resource type to Glance:
我们发出一个 `DELETE` 请求，要求取消与 Glance 的命名空间资源类型的关联：

```
DELETE http://glance.openstack.example.org/v2/metadefs/namespaces/{namespace}/resource_types/{resource_type}
```

### List Objects in Namespace 列出命名空间中的对象 ¶

We want to see the list of meta definition objects in a specific namespace
我们希望查看特定命名空间中的元定义对象列表

We issue a `GET` request to `http://glance.openstack.example.org/v2/metadefs/namespaces/{namespace}/objects` to retrieve objects.
我们发出请求 `GET` 来 `http://glance.openstack.example.org/v2/metadefs/namespaces/{namespace}/objects` 检索对象。

The data is returned as a JSON-encoded mapping in the following format:
数据以 JSON 编码的映射形式返回，格式如下：

```
{
      "objects": [
      {
          "name": "object1",
          "description": "my-description",
          "self": "/v2/metadefs/namespaces/MyNamespace/objects/object1",
          "schema": "/v2/schemas/metadefs/object",
          "created_at": "2014-08-28T17:13:06Z",
          "updated_at": "2014-08-28T17:13:06Z",
          "required": [],
          "properties": {
              "prop1": {
                  "title": "My object1 property1",
                  "description": "More info here",
                  "type": "array",
                  "items": {
                      "type": "string"
                  }
              }
          }
      },
      {
          "name": "object2",
          "description": "my-description",
          "self": "/v2/metadefs/namespaces/MyNamespace/objects/object2",
          "schema": "/v2/schemas/metadefs/object",
          "created_at": "2014-08-28T17:13:06Z",
          "updated_at": "2014-08-28T17:13:06Z",
          "properties": {
              "prop1": {
                  "title": "My object2 property1",
                  "description": "More info here",
                  "type": "integer",
                  "default": 20
              }
          }
      }
  ],
  "schema": "/v2/schemas/metadefs/objects"
}
```

### Add object in a specific namespace 在特定命名空间中添加对象 ¶

We want to create a new object which can group the properties
我们想创建一个可以对属性进行分组的新对象

We issue a `POST` request to add object to a namespace in Glance:
我们发出一个 `POST` 请求，在 Glance 中将对象添加到命名空间：

```
POST http://glance.openstack.example.org/v2/metadefs/namespaces/{namespace}/objects
```

The input data is an JSON-encoded mapping in the following format:
输入数据是 JSON 编码的映射，格式如下：

```
{
  "name": "StorageQOS",
  "description": "Our available storage QOS.",
  "required": [
      "minIOPS"
  ],
  "properties": {
      "minIOPS": {
          "type": "integer",
          "description": "The minimum IOPs required",
          "default": 100,
          "minimum": 100,
          "maximum": 30000369
      },
      "burstIOPS": {
          "type": "integer",
          "description": "The expected burst IOPs",
          "default": 1000,
          "minimum": 100,
          "maximum": 30000377
      }
  }
}
```

### Update Object in a specific namespace 更新特定命名空间中的对象 ¶

We want to update an existing object
我们想要更新现有对象

We issue a `PUT` request to update an object to Glance:
我们发出一个 `PUT` 请求，将对象更新到 Glance：

```
PUT http://glance.openstack.example.org/v2/metadefs/namespaces/{namespace}/objects/{object_name}
```

The input data is similar to Add Object
输入数据类似于 Add Object

### Delete Object in a specific namespace 删除特定命名空间中的对象 ¶

We want to delete an existing object.
我们想要删除现有对象。

We issue a `DELETE` request to delete object in a namespace to Glance:
我们向 Glance 发出删除命名空间中对象 `DELETE` 的请求：

```
DELETE http://glance.openstack.example.org/v2/metadefs/namespaces/{namespace}/objects/{object_name}
```

### Add property definition in a specific namespace 在特定命名空间中添加属性定义 ¶

We want to create a new property definition in a namespace
我们想在命名空间中创建一个新的属性定义

We issue a `POST` request to add property definition to a namespace in Glance:
我们发出一个 `POST` 请求，将属性定义添加到 Glance 中的命名空间：

```
POST http://glance.openstack.example.org/v2/metadefs/namespaces/{namespace}/properties
```

The input data is an JSON-encoded mapping in the following format:
输入数据是 JSON 编码的映射，格式如下：

```
{
  "name": "hypervisor_type",
  "title" : "Hypervisor",
  "type": "array",
  "description": "The type of hypervisor required",
  "items": {
      "type": "string",
      "enum": [
          "hyperv",
          "qemu",
          "kvm"
      ]
  }
}
```

### Update property definition in a specific namespace 更新特定命名空间中的属性定义 ¶

We want to update an existing object
我们想要更新现有对象

We issue a `PUT` request to update an property definition in a namespace to Glance:
我们发出请求 `PUT` ，将命名空间中的属性定义更新到 Glance：

```
PUT http://glance.openstack.example.org/v2/metadefs/namespaces/{namespace}/properties/{property_name}
```

The input data is similar to Add property definition
输入数据类似于添加属性定义

### Delete property definition in a specific namespace 删除特定命名空间中的属性定义 ¶

We want to delete an existing object.
我们想要删除现有对象。

We issue a `DELETE` request to delete property definition in a namespace to Glance:
我们向 Glance 发出删除命名空间中属性定义的 `DELETE` 请求：

```
DELETE http://glance.openstack.example.org/v2/metadefs/namespaces/{namespace}/properties/{property_name}
```

## API Message Localization API 消息本地化 ¶

Glance supports HTTP message localization. For example, an HTTP client can receive API messages in Chinese even if the locale language of the server is English.
Glance 支持 HTTP 消息本地化。例如，即使服务器的语言环境语言是英语，HTTP 客户端也可以接收中文的 API 消息。

### How to use it 如何使用它 ¶

To receive localized API messages, the HTTP client needs to specify the **Accept-Language** header to indicate the language to use to translate the message. For more info about Accept-Language, please refer http://www.w3.org/Protocols/rfc2616/rfc2616-sec14.html
若要接收本地化的 API 消息，HTTP 客户端需要指定 Accept-Language 标头以指示用于翻译消息的语言。有关 Accept-Language  的更多信息，请参阅 http://www.w3.org/Protocols/rfc2616/rfc2616-sec14.html

A typical curl API request will be like below:
一个典型的 curl API 请求如下所示：

```
curl -i -X GET -H 'Accept-Language: zh' -H 'Content-Type: application/json'
http://glance.openstack.example.org/v2/metadefs/namespaces/{namespace}
```

Then the response will be like the following:
然后，响应将如下所示：

```
HTTP/1.1 404 Not Found
Content-Length: 234
Content-Type: text/html; charset=UTF-8
X-Openstack-Request-Id: req-54d403a0-064e-4544-8faf-4aeef086f45a
Date: Sat, 22 Feb 2014 06:26:26 GMT

<html>
<head>
<title>404 Not Found</title>
</head>
<body>
<h1>404 Not Found</h1>
&#25214;&#19981;&#21040;&#20219;&#20309;&#20855;&#26377;&#26631;&#35782; aaa &#30340;&#26144;&#20687;<br /><br />
</body>
</html>
```



 

Note 注意



Be sure there is the language package under /usr/share/locale-langpack/ on the target Glance server.
确保目标 Glance 服务器上的 /usr/share/locale-langpack/ 下有语言包。

​                      

# Image Signature Verification 图像签名验证

​                                  

Glance has the ability to perform image validation using a digital signature and asymmetric cryptography.  To trigger this, you must define specific image properties (described below), and have stored a certificate signed with your private key in a local Barbican installation.
Glance 能够使用数字签名和非对称加密技术执行图像验证。要触发此功能，您必须定义特定的映像属性（如下所述），并在本地 Barbican 安装中存储使用私钥签名的证书。

When the image properties exist on an image, Glance will validate the uploaded image data against these properties before storing it. If validation is unsuccessful, the upload will fail and the image will be deleted.
当图像上存在图像属性时，Glance 将在存储上传的图像数据之前根据这些属性对其进行验证。如果验证不成功，上传将失败，图像将被删除。

Additionally, the image properties may be used by other services (for example, Nova) to perform data verification when the image is downloaded from Glance.
此外，当从 Glance 下载图像时，其他服务（例如 Nova）可能会使用图像属性来执行数据验证。

## Requirements 要求 ¶

Barbican key manager - See https://docs.openstack.org/barbican/latest/contributor/devstack.html
巴比肯钥匙管理器 - 查看 https://docs.openstack.org/barbican/latest/contributor/devstack.html

## Configuration 配置 ¶

The etc/glance-api.conf can be modified to change keystone endpoint of barbican. By default barbican will try to connect to keystone at http://localhost:5000/v3 but if keystone is on another host then this should be changed.
可以修改 etc/glance-api.conf 以更改 barbican 的 keystone 端点。默认情况下，barbican 将尝试在  http://localhost:5000/v3 连接到 keystone，但如果 keystone 位于另一台主机上，则应更改此设置。

In glance-api.conf find the following lines:
在 glance-api.conf 中，找到以下行：

```
[barbican]
auth_endpoint = http://localhost:5000/v3
```

Then replace http://localhost:5000/v3 with the URL of keystone, also adding /v3 to the end of it. For example, ‘https://192.168.245.9:5000/v3’.
然后将 http://localhost:5000/v3 替换为 keystone 的 URL，并在其末尾添加 /v3。例如，“https://192.168.245.9:5000/v3”。

Another option in etc/glance-api.conf which can be configured is which key manager to use. By default Glance will use the default key manager defined by the Castellan key manager interface, which is currently the Barbican key manager.
etc/glance-api.conf 中另一个可以配置的选项是要使用的密钥管理器。默认情况下，Glance 将使用 Castellan 密钥管理器界面定义的默认密钥管理器，该接口目前是 Barbican 密钥管理器。

In glance-api.conf find the following lines:
在 glance-api.conf 中，找到以下行：

```
[key_manager]
backend = barbican
```

Then replace the value with the desired key manager class.
然后将该值替换为所需的密钥管理器类。



 

Note 注意



If those lines do not exist then simply add them to the end of the file.
如果这些行不存在，则只需将它们添加到文件末尾即可。

## Using the Signature Verification 使用签名验证 ¶

An image will need a few properties for signature verification to be enabled, these are:
映像需要一些属性才能启用签名验证，这些属性是：

```
img_signature
img_signature_hash_method
img_signature_key_type
img_signature_certificate_uuid
```

### Property img_signature 属性img_signature ¶

This is the signature of your image.
这是您图像的签名。



 

Note 注意



The max character limit is 255.
最大字符数限制为 255 个。

### Property img_signature_hash_method 属性img_signature_hash_method ¶

Hash methods is the method you hash with.
哈希方法是哈希使用的方法。

Current ones you can use are:
您可以使用的当前版本是：

- SHA-224 SHA-224型
- SHA-256 SHA-256型
- SHA-384 SHA-384型
- SHA-512 SHA-512型

### Property img_signature_key_type 属性img_signature_key_type ¶

This is the key_types you can use for your image.
这是可用于图像的key_types。

Current ones you can use are:
您可以使用的当前版本是：

- RSA-PSS RSA-PSS系统
- DSA
- ECC-CURVES ECC 曲线
- SECT571K1
- SECT409K1
- SECT571R1
- SECT409R1
- SECP521R1
- SECP384R1



 

Note 注意



ECC curves - Only keysizes above 384 are included. Not all ECC curves may be supported by the back end.
ECC 曲线 - 仅包括大于 384 的密钥大小。并非所有 ECC 曲线都可能受后端支持。

### Property img_signature_certificate_uuid 属性img_signature_certificate_uuid ¶

This is the UUID of the certificate that you upload to Barbican.
这是您上传到 Barbican 的证书的 UUID。

Therefore the type passed to glance is:
因此，传递给 glance 的类型是：

- UUID UUID的



 

Note 注意



The supported certificate types are:
支持的证书类型包括：

- X_509

## Example Usage 用法示例 ¶

Follow these instructions to create your keys:
按照以下说明创建密钥：

```
$ openssl genrsa -out private_key.pem 1024
Generating RSA private key, 1024 bit long modulus
...............................................++++++
..++++++
e is 65537 (0x10001)

$ openssl rsa -pubout -in private_key.pem -out public_key.pem
writing RSA key

$ openssl req -new -key private_key.pem -out cert_request.csr
You are about to be asked to enter information that will be incorporated
into your certificate request.

$ openssl x509 -req -days 14 -in cert_request.csr -signkey private_key.pem -out new_cert.crt
Signature ok
subject=/C=AU/ST=Some-State/O=Internet Widgits Pty Ltd
Getting Private key
```

Upload your certificate. This only has to be done once as you can use the same `Secret href` for many images until it expires.
上传您的证书。这只需要执行一次，因为您可以 `Secret href` 将其用于许多图像，直到它过期。

```
openstack secret store --name test --algorithm RSA --expiration 2016-06-29 --secret-type certificate --payload-content-type "application/octet-stream" --payload-content-encoding base64 --payload "$(base64 new_cert.crt)"
+---------------+-----------------------------------------------------------------------+
| Field         | Value                                                                 |
+---------------+-----------------------------------------------------------------------+
| Secret href   | http://127.0.0.1:9311/v1/secrets/cd7cc675-e573-419c-8fff-33a72734a243 |
cert_uuid=cd7cc675-e573-419c-8fff-33a72734a243
```

Get an image and create the signature:
获取图像并创建签名：

```
$ echo This is a dodgy image > myimage

$ openssl dgst -sha256 -sign private_key.pem -sigopt rsa_padding_mode:pss -out myimage.signature myimage

$ base64 -w 0 myimage.signature > myimage.signature.b64

$ image_signature=$(cat myimage.signature.b64)
```



 

Note 注意



Using Glance v1 requires ‘-w 0’ due to not supporting multiline image properties. Glance v2 does support multiline image properties and does not require ‘-w 0’ but may still be used.
使用 Glance v1 需要“-w 0”，因为不支持多行图像属性。Glance v2 支持多行图像属性，不需要“-w 0”，但仍可以使用。

Create the image: 创建映像：

```
$ glance image-create --name mySignedImage --container-format bare --disk-format qcow2 --property img_signature="$image_signature" --property img_signature_certificate_uuid="$cert_uuid" --property img_signature_hash_method='SHA-256' --property img_signature_key_type='RSA-PSS' < myimage
```



 

Note 注意



Creating the image can fail if validation does not succeed. This will cause the image to be deleted.
如果验证不成功，则创建映像可能会失败。这将导致图像被删除。

## Other Links 其他链接 ¶

- https://etherpad.openstack.org/p/mitaka-glance-image-signing-instructions
- https://wiki.openstack.org/wiki/OpsGuide/User-Facing_Operations

# Secure Hash Algorithm Support (Multihash) 安全哈希算法支持（多哈希）

​                                  

The Secure Hash Algorithm feature adds image properties that may be used to verify image integrity based on its hash.
安全哈希算法功能添加了图像属性，可用于根据其哈希来验证图像完整性。

The Secure Hash consists of two new image properties:
安全哈希由两个新的映像属性组成：

- `os_hash_algo`

  Contains the name of the secure hash algorithm used to generate the value on the image 包含用于在映像上生成值的安全哈希算法的名称

- `os_hash_value`

  The hexdigest computed by applying the secure hash algorithm named in the `os_hash_algo` property to the image data 通过将 `os_hash_algo` 属性中命名的安全哈希算法应用于图像数据来计算的十六进制摘要

## Image Verification 镜像验证 ¶

When Secure Hash is used, the Glance image properties will include the two fields `os_hash_algo` and `os_hash_value`. These two fields provide the hashing algorithm used to calculate the secure hash, along with the hash value calculated for the image.
使用安全哈希时，Glance 图像属性将包括两个字段 `os_hash_algo` 和 `os_hash_value` 。这两个字段提供用于计算安全哈希的哈希算法，以及为图像计算的哈希值。

These values can be used to verify the image integrity when used. For example, an image and its properties may be viewed with the following:
这些值可用于在使用时验证图像完整性。例如，可以使用以下命令查看图像及其属性：

```
 $ glance image-show fa33e3cd-5fe4-46df-a604-1e9b9438b420
+------------------+----------------------------------------------------------------------------------+
| Property         | Value                                                                            |
+------------------+----------------------------------------------------------------------------------+
| checksum         | ffa3dd42fae539dcd8fe72d429bc677b                                                 |
| container_format | bare                                                                             |
| created_at       | 2019-06-05T13:39:46Z                                                             |
| disk_format      | qcow2                                                                            |
| id               | fa33e3cd-5fe4-46df-a604-1e9b9438b420                                             |
| min_disk         | 10                                                                               |
| min_ram          | 1024                                                                             |
| name             | fedora-30                                                                        |
| os_hash_algo     | sha512                                                                           |
| os_hash_value    | d9f99d22a6b6ea1e8b93379dd2080f51a7ed6885aa7d4c2f2262ea1054935e02c47b45f9b56aa7f5 |
|                  | 5e61d149d06f4ff6de03efde24f9d6774baf35f08c5e9d92                                 |
| os_hidden        | False                                                                            |
| owner            | 0e82e8f863a4485fabfbed1b5b856cd7                                                 |
| protected        | False                                                                            |
| size             | 332267520                                                                        |
| status           | active                                                                           |
| tags             | []                                                                               |
| updated_at       | 2019-06-07T11:41:12Z                                                             |
| virtual_size     | Not available                                                                    |
| visibility       | public                                                                           |
+------------------+----------------------------------------------------------------------------------+
```

From that output, we can see the `os_hash_algo` property shows that **sha512** was used to generate the multihash. The `os_hash_value` then shows the generated hash value is:
从该输出中，我们可以看到该 `os_hash_algo` 属性显示 sha512 用于生成多哈希。 `os_hash_value` 然后显示生成的哈希值为：

```
d9f99d22a6b6ea1e8b93379dd2080f51a7ed6885aa7d4c2f2262ea1054935e02c47b45f9b56aa7f55e61d149d06f4ff6de03efde24f9d6774baf35f08c5e9d92
```

When downloading the image, you may now use these values to be able to verify the integrity of the image. For example:
下载映像时，您现在可以使用这些值来验证映像的完整性。例如：

```
$ glance image-download fa33e3cd-5fe4-46df-a604-1e9b9438b420 --file fedora-30
$ sha512sum fedora-30
d9f99d22a6b6ea1e8b93379dd2080f51a7ed6885aa7d4c2f2262ea1054935e02c47b45f9b56aa7f55e61d149d06f4ff6de03efde24f9d6774baf35f08c5e9d92
```

Using the `sha512sum` command, we are able to calculate the hash locally on the image and verify it matches what was expected. If the output were not to match, that would indicate the image has somehow been modified or corrupted since being uploaded to Glance, and should likely not be used.
使用该 `sha512sum` 命令，我们能够在本地计算图像上的哈希值，并验证它是否符合预期。如果输出不匹配，则表明图像在上传到 Glance 后已以某种方式被修改或损坏，并且可能不应使用。