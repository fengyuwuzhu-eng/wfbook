# 函数

[TOC]

## 定义格式 

```bash
[ function ] funname()
{
    statements;
    [return int;]
}
```

**说明：**

1. 可以带function fun()  定义，也可以直接fun() 定义,不带任何参数。
2. 参数返回，return。如果不加，将以最后一条命令运行结果，作为返回值。 return后跟数值 n (0-255）。 

## 函数参数

在Shell中，调用函数时可以向其传递参数。在函数体内部，通过 $n 的形式来获取参数的值，例如，$1表示第一个参数，$2表示第二个参数... $10 不能获取第十个参数，获取第十个参数需要${10}。当n>=10时，需要使用${n}来获取参数。

```bash
fname arg1 arg2;
```

带参数的函数示例： 

```bash
fname(){
    echo "第一个参数为 $1 !"
    echo "第二个参数为 $2 !"
    echo "第十个参数为 ${10} !"
    echo "第十一个参数为 ${11} !"
    echo "参数总数有 $# 个!"
    echo "作为一个字符串输出所有参数 $* !"
}

fname 1 2 3 4 5 6 7 8 9 34 73
```

输出结果： 

```bash
第一个参数为 1 !
第二个参数为 2 !
第十个参数为 34 !
第十一个参数为 73 !
参数总数有 11 个!
作为一个字符串输出所有参数 1 2 3 4 5 6 7 8 9 34 73 !
```

特殊字符用来处理参数： 

| 参数处理 | 说明                                                         |
| -------- | ------------------------------------------------------------ |
| $#       | 传递到脚本的参数个数                                         |
| $*       | 以一个单字符串显示所有向脚本传递的参数                       |
| $$       | 脚本运行的当前进程ID号                                       |
| $!       | 后台运行的最后一个进程的ID号                                 |
| $@       | 与$*相同，但是使用时加引号，并在引号中返回每个参数。         |
| $-       | 显示Shell使用的当前选项，与set命令功能相同。                 |
| $?       | 显示最后命令的退出状态。0表示没有错误，其他任何值表明有错误。 |

参数可以传递给脚本并通过`script:$0`（脚本名）访问。

```bash
$1 是第一个参数。
$2 是第二个参数。
$n 是第n个参数。
$@ 被扩展成 "$1" "$2" "$3"等。
$* 被扩展成 "$1c$2c$3"，其中c是IFS的第一个字符。
$@ 用得最多。由于 "$*"将所有的参数当做单个字符串，因此它很少被使用。
```

## 函数调用

```bash
fname;
```

## 补充内容
### 递归函数

在Bash中，函数支持递归。例如，

```bash
F() { echo $1; F hello;sleep 1; }
```

#### Fork炸弹

```bash
:(){ :|:& };:
```

这个递归函数能够调用自身，不断地生成新的进程，最终造成拒绝服务攻击。函数调用前的 `&` 将子进程放入后台。这段危险的代码会分支出大量的进程，因而被称为Fork炸弹。请参阅维基百科http://en.wikipedia.org/wiki/Fork_bomb，那里列出了有关Fork炸弹的细节以及更详细的解释。可以通过修改配置文件/etc/security/limits.conf来限制可生成的最大进程数来避开这枚炸弹。

### 导出函数

函数也能像环境变量一样用export导出，如此一来，函数的作用域就可以扩展到子进程中，如下：

```bash
export -f fname
```

### 读取命令返回值（状态）

获取命令或函数的返回值

```bash
cmd;
echo $?;
```

返回值被称为退出状态。它可用于分析命令执行成功与否。

> 命令成功退出，0
>
> 命令异常退出，非0

按照下面的方法检测某个命令是否成功结束：

```bash
#!/bin/bash
#文件名: success_test.sh
CMD="command"             # command指代你要检测退出与否的目标命令
status
$CMD
if [ $? -eq 0 ];
then
echo "$CMD executed successfully"
else
echo "$CMD terminated unsuccessfully"
fi
```

### 向命令传递参数

命令的参数能够以不同的格式进行传递。假设-p、-v是可用选项，-k NO是另一个可以接受数字的选项，同时该命令还接受一个文件名作为参数，那么，它有如下几种执行方式：

```bash
command -p -v -k 1 file
command -pv -k 1 file
command -vpk 1 file
command file -pvk 1
```

